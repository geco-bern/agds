<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data visualisation | Applied Geodata Science</title>
  <meta name="description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data visualisation | Applied Geodata Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="github-repo" content="stineb/agsd" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data visualisation | Applied Geodata Science" />
  
  <meta name="twitter:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  

<meta name="author" content="Benjamin Stocker (lead), Koen Hufkens (contributing), Pepa Arán (contributing), Pascal Schneider (contributing)" />


<meta name="date" content="2023-02-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="datawrangling.html"/>
<link rel="next" href="datavariety.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Geodata Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-course"><i class="fa fa-check"></i>About this course</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-goal"><i class="fa fa-check"></i>Course goal</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#what-is-applied-geodata-science"><i class="fa fa-check"></i>What is Applied Geodata Science?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#the-data-science-workflow"><i class="fa fa-check"></i>The data science workflow</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#why-now"><i class="fa fa-check"></i>Why now?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-new-modelling-paradigm"><i class="fa fa-check"></i>A new modelling paradigm</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reading-and-link-collection"><i class="fa fa-check"></i>Reading and link collection</a></li>
<li class="chapter" data-level="0.1" data-path="introduction.html"><a href="introduction.html#system-information-and-package-list"><i class="fa fa-check"></i><b>0.1</b> System information and package list</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="gettingstarted.html"><a href="gettingstarted.html#learning-objectives-1"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2" data-path="gettingstarted.html"><a href="gettingstarted.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="gettingstarted.html"><a href="gettingstarted.html#working-with-r-and-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Working with R and RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="gettingstarted.html"><a href="gettingstarted.html#r-objects"><i class="fa fa-check"></i><b>1.2.2</b> R objects</a></li>
<li class="chapter" data-level="1.2.3" data-path="gettingstarted.html"><a href="gettingstarted.html#r-scripts"><i class="fa fa-check"></i><b>1.2.3</b> R scripts</a></li>
<li class="chapter" data-level="1.2.4" data-path="gettingstarted.html"><a href="gettingstarted.html#workspace-management"><i class="fa fa-check"></i><b>1.2.4</b> Workspace management</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="gettingstarted.html"><a href="gettingstarted.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programmingprimers.html"><a href="programmingprimers.html"><i class="fa fa-check"></i><b>2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#learning-objectives-2"><i class="fa fa-check"></i><b>2.1</b> Learning objectives</a></li>
<li class="chapter" data-level="2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#libraries"><i class="fa fa-check"></i><b>2.2.1</b> Libraries</a></li>
<li class="chapter" data-level="2.2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#programming-basics"><i class="fa fa-check"></i><b>2.2.2</b> Programming basics</a></li>
<li class="chapter" data-level="2.2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#working-with-data-frames"><i class="fa fa-check"></i><b>2.2.3</b> Working with data frames</a></li>
<li class="chapter" data-level="2.2.4" data-path="programmingprimers.html"><a href="programmingprimers.html#where-to-find-help"><i class="fa fa-check"></i><b>2.2.4</b> Where to find help</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#exercises-1"><i class="fa fa-check"></i><b>2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datawrangling.html"><a href="datawrangling.html#learning-objectives-3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives</a></li>
<li class="chapter" data-level="3.2" data-path="datawrangling.html"><a href="datawrangling.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datawrangling.html"><a href="datawrangling.html#example-data"><i class="fa fa-check"></i><b>3.2.1</b> Example data</a></li>
<li class="chapter" data-level="3.2.2" data-path="datawrangling.html"><a href="datawrangling.html#tidyverse"><i class="fa fa-check"></i><b>3.2.2</b> Tidyverse</a></li>
<li class="chapter" data-level="3.2.3" data-path="datawrangling.html"><a href="datawrangling.html#tabular-data"><i class="fa fa-check"></i><b>3.2.3</b> Tabular data</a></li>
<li class="chapter" data-level="3.2.4" data-path="datawrangling.html"><a href="datawrangling.html#variable-selection"><i class="fa fa-check"></i><b>3.2.4</b> Variable selection</a></li>
<li class="chapter" data-level="3.2.5" data-path="datawrangling.html"><a href="datawrangling.html#time-objects"><i class="fa fa-check"></i><b>3.2.5</b> Time objects</a></li>
<li class="chapter" data-level="3.2.6" data-path="datawrangling.html"><a href="datawrangling.html#variable-re--definition"><i class="fa fa-check"></i><b>3.2.6</b> Variable (re-) definition</a></li>
<li class="chapter" data-level="3.2.7" data-path="datawrangling.html"><a href="datawrangling.html#axes-of-variation"><i class="fa fa-check"></i><b>3.2.7</b> Axes of variation</a></li>
<li class="chapter" data-level="3.2.8" data-path="datawrangling.html"><a href="datawrangling.html#tidy-data"><i class="fa fa-check"></i><b>3.2.8</b> Tidy data</a></li>
<li class="chapter" data-level="3.2.9" data-path="datawrangling.html"><a href="datawrangling.html#aggregating-data"><i class="fa fa-check"></i><b>3.2.9</b> Aggregating data</a></li>
<li class="chapter" data-level="3.2.10" data-path="datawrangling.html"><a href="datawrangling.html#data-cleaning"><i class="fa fa-check"></i><b>3.2.10</b> Data cleaning</a></li>
<li class="chapter" data-level="3.2.11" data-path="datawrangling.html"><a href="datawrangling.html#combining-relational-data"><i class="fa fa-check"></i><b>3.2.11</b> Combining relational data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datawrangling.html"><a href="datawrangling.html#extra-material"><i class="fa fa-check"></i><b>3.3</b> Extra material</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-i"><i class="fa fa-check"></i><b>3.3.1</b> Functional programming I</a></li>
<li class="chapter" data-level="3.3.2" data-path="datawrangling.html"><a href="datawrangling.html#strings"><i class="fa fa-check"></i><b>3.3.2</b> Strings</a></li>
<li class="chapter" data-level="3.3.3" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-ii"><i class="fa fa-check"></i><b>3.3.3</b> Functional programming II</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datawrangling.html"><a href="datawrangling.html#exercises-2"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>4</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="datavis.html"><a href="datavis.html#learning-objectives-4"><i class="fa fa-check"></i><b>4.1</b> Learning objectives</a></li>
<li class="chapter" data-level="4.2" data-path="datavis.html"><a href="datavis.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="datavis.html"><a href="datavis.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.2.1</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.2.2" data-path="datavis.html"><a href="datavis.html#every-data-has-its-representation"><i class="fa fa-check"></i><b>4.2.2</b> Every data has its representation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="datavis.html"><a href="datavis.html#exercises-3"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
<li class="chapter" data-level="4.4" data-path="datavis.html"><a href="datavis.html#exercises-for-the-report"><i class="fa fa-check"></i><b>4.4</b> Exercises for The Report</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datavariety.html"><a href="datavariety.html"><i class="fa fa-check"></i><b>5</b> Data variety</a>
<ul>
<li class="chapter" data-level="5.1" data-path="datavariety.html"><a href="datavariety.html#learning-objectives-5"><i class="fa fa-check"></i><b>5.1</b> Learning objectives</a></li>
<li class="chapter" data-level="5.2" data-path="datavariety.html"><a href="datavariety.html#tutorial-4"><i class="fa fa-check"></i><b>5.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats"><i class="fa fa-check"></i><b>5.2.1</b> Files and file formats</a></li>
<li class="chapter" data-level="5.2.2" data-path="datavariety.html"><a href="datavariety.html#meta-data"><i class="fa fa-check"></i><b>5.2.2</b> Meta-data</a></li>
<li class="chapter" data-level="5.2.3" data-path="datavariety.html"><a href="datavariety.html#spatial-data-representation"><i class="fa fa-check"></i><b>5.2.3</b> Spatial data representation</a></li>
<li class="chapter" data-level="5.2.4" data-path="datavariety.html"><a href="datavariety.html#online-data-sources"><i class="fa fa-check"></i><b>5.2.4</b> Online data sources</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="datavariety.html"><a href="datavariety.html#exercises-4"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats-1"><i class="fa fa-check"></i><b>5.3.1</b> Files and file formats</a></li>
<li class="chapter" data-level="5.3.2" data-path="datavariety.html"><a href="datavariety.html#api-use"><i class="fa fa-check"></i><b>5.3.2</b> API use</a></li>
<li class="chapter" data-level="5.3.3" data-path="datavariety.html"><a href="datavariety.html#get-1"><i class="fa fa-check"></i><b>5.3.3</b> GET</a></li>
<li class="chapter" data-level="5.3.4" data-path="datavariety.html"><a href="datavariety.html#dedicated-library"><i class="fa fa-check"></i><b>5.3.4</b> Dedicated library</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="openscience.html"><a href="openscience.html"><i class="fa fa-check"></i><b>6</b> Open science practices</a>
<ul>
<li class="chapter" data-level="6.1" data-path="openscience.html"><a href="openscience.html#learning-objectives-6"><i class="fa fa-check"></i><b>6.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.2" data-path="openscience.html"><a href="openscience.html#tutorial-5"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="openscience.html"><a href="openscience.html#project-structure"><i class="fa fa-check"></i><b>6.2.1</b> Project structure</a></li>
<li class="chapter" data-level="6.2.2" data-path="openscience.html"><a href="openscience.html#managing-workflows"><i class="fa fa-check"></i><b>6.2.2</b> Managing workflows</a></li>
<li class="chapter" data-level="6.2.3" data-path="openscience.html"><a href="openscience.html#capturing-your-session-state"><i class="fa fa-check"></i><b>6.2.3</b> Capturing your session state</a></li>
<li class="chapter" data-level="6.2.4" data-path="openscience.html"><a href="openscience.html#capturing-a-system-state"><i class="fa fa-check"></i><b>6.2.4</b> Capturing a system state</a></li>
<li class="chapter" data-level="6.2.5" data-path="openscience.html"><a href="openscience.html#readable-reporting-using-rmarkdown"><i class="fa fa-check"></i><b>6.2.5</b> Readable reporting using Rmarkdown</a></li>
<li class="chapter" data-level="6.2.6" data-path="openscience.html"><a href="openscience.html#data-retention"><i class="fa fa-check"></i><b>6.2.6</b> Data retention</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="openscience.html"><a href="openscience.html#exercises-5"><i class="fa fa-check"></i><b>6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="codemgmt.html"><a href="codemgmt.html"><i class="fa fa-check"></i><b>7</b> Code management</a>
<ul>
<li class="chapter" data-level="7.1" data-path="codemgmt.html"><a href="codemgmt.html#learning-objectives-7"><i class="fa fa-check"></i><b>7.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.2" data-path="codemgmt.html"><a href="codemgmt.html#tutorial-6"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="codemgmt.html"><a href="codemgmt.html#git-and-local-version-control"><i class="fa fa-check"></i><b>7.2.1</b> Git and local version control</a></li>
<li class="chapter" data-level="7.2.2" data-path="codemgmt.html"><a href="codemgmt.html#remote-version-control"><i class="fa fa-check"></i><b>7.2.2</b> Remote version control</a></li>
<li class="chapter" data-level="7.2.3" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management---github-templates"><i class="fa fa-check"></i><b>7.2.3</b> Location based code management - github templates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="codemgmt.html"><a href="codemgmt.html#exercises-6"><i class="fa fa-check"></i><b>7.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regressionclassification.html"><a href="regressionclassification.html"><i class="fa fa-check"></i><b>8</b> Regression and classification</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regressionclassification.html"><a href="regressionclassification.html#learning-objectives-8"><i class="fa fa-check"></i><b>8.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.2" data-path="regressionclassification.html"><a href="regressionclassification.html#tutorial-7"><i class="fa fa-check"></i><b>8.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regressionclassification.html"><a href="regressionclassification.html#types-of-models"><i class="fa fa-check"></i><b>8.2.1</b> Types of models</a></li>
<li class="chapter" data-level="8.2.2" data-path="regressionclassification.html"><a href="regressionclassification.html#regression"><i class="fa fa-check"></i><b>8.2.2</b> Regression</a></li>
<li class="chapter" data-level="8.2.3" data-path="regressionclassification.html"><a href="regressionclassification.html#classification"><i class="fa fa-check"></i><b>8.2.3</b> Classification</a></li>
<li class="chapter" data-level="8.2.4" data-path="regressionclassification.html"><a href="regressionclassification.html#model-evaluation"><i class="fa fa-check"></i><b>8.2.4</b> Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regressionclassification.html"><a href="regressionclassification.html#report-exercise"><i class="fa fa-check"></i><b>8.3</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regressionclassification.html"><a href="regressionclassification.html#task-statement"><i class="fa fa-check"></i><b>8.3.1</b> Task Statement</a></li>
<li class="chapter" data-level="8.3.2" data-path="regressionclassification.html"><a href="regressionclassification.html#warm-up-exercises"><i class="fa fa-check"></i><b>8.3.2</b> Warm-Up Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="supervisedmli.html"><a href="supervisedmli.html"><i class="fa fa-check"></i><b>9</b> Supervised machine learning I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="supervisedmli.html"><a href="supervisedmli.html#learning-objectives-9"><i class="fa fa-check"></i><b>9.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="supervisedmli.html"><a href="supervisedmli.html#tutorial-8"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="supervisedmli.html"><a href="supervisedmli.html#what-is-supervised-machine-learning"><i class="fa fa-check"></i><b>9.2.1</b> What is supervised machine learning?</a></li>
<li class="chapter" data-level="9.2.2" data-path="supervisedmli.html"><a href="supervisedmli.html#overfitting"><i class="fa fa-check"></i><b>9.2.2</b> Overfitting</a></li>
<li class="chapter" data-level="9.2.3" data-path="supervisedmli.html"><a href="supervisedmli.html#data-and-the-modelling-challenge"><i class="fa fa-check"></i><b>9.2.3</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="9.2.4" data-path="supervisedmli.html"><a href="supervisedmli.html#k-nearest-neighbours"><i class="fa fa-check"></i><b>9.2.4</b> K-nearest neighbours</a></li>
<li class="chapter" data-level="9.2.5" data-path="supervisedmli.html"><a href="supervisedmli.html#model-formulation"><i class="fa fa-check"></i><b>9.2.5</b> Model formulation</a></li>
<li class="chapter" data-level="9.2.6" data-path="supervisedmli.html"><a href="supervisedmli.html#data-splitting"><i class="fa fa-check"></i><b>9.2.6</b> Data splitting</a></li>
<li class="chapter" data-level="9.2.7" data-path="supervisedmli.html"><a href="supervisedmli.html#preprocessing"><i class="fa fa-check"></i><b>9.2.7</b> Pre-processing</a></li>
<li class="chapter" data-level="9.2.8" data-path="supervisedmli.html"><a href="supervisedmli.html#putting-it-all-together-half-way"><i class="fa fa-check"></i><b>9.2.8</b> Putting it all together (half-way)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="supervisedmli.html"><a href="supervisedmli.html#exercises-7"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
<li class="chapter" data-level="9.4" data-path="supervisedmli.html"><a href="supervisedmli.html#solutions"><i class="fa fa-check"></i><b>9.4</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="supervisedmlii.html"><a href="supervisedmlii.html"><i class="fa fa-check"></i><b>10</b> Supervised machine learning II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#learning-objectives-10"><i class="fa fa-check"></i><b>10.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#tutorial-9"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#data-and-the-modelling-challenge-1"><i class="fa fa-check"></i><b>10.2.1</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="10.2.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#training"><i class="fa fa-check"></i><b>10.2.2</b> Loss function</a></li>
<li class="chapter" data-level="10.2.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#hyperparameters"><i class="fa fa-check"></i><b>10.2.3</b> Hyperparameters</a></li>
<li class="chapter" data-level="10.2.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#resampling"><i class="fa fa-check"></i><b>10.2.4</b> Resampling</a></li>
<li class="chapter" data-level="10.2.5" data-path="supervisedmlii.html"><a href="supervisedmlii.html#validation-versus-testing-data"><i class="fa fa-check"></i><b>10.2.5</b> Validation versus testing data</a></li>
<li class="chapter" data-level="10.2.6" data-path="supervisedmlii.html"><a href="supervisedmlii.html#modeling-with-structured-data"><i class="fa fa-check"></i><b>10.2.6</b> Modeling with structured data</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#exercises-8"><i class="fa fa-check"></i><b>10.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="randomforest.html"><a href="randomforest.html"><i class="fa fa-check"></i><b>11</b> Random Forest</a>
<ul>
<li class="chapter" data-level="11.1" data-path="randomforest.html"><a href="randomforest.html#learning-objectives-11"><i class="fa fa-check"></i><b>11.1</b> Learning objectives</a></li>
<li class="chapter" data-level="11.2" data-path="randomforest.html"><a href="randomforest.html#tutorial-10"><i class="fa fa-check"></i><b>11.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="randomforest.html"><a href="randomforest.html#decision-trees"><i class="fa fa-check"></i><b>11.2.1</b> Decision trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="randomforest.html"><a href="randomforest.html#bagging"><i class="fa fa-check"></i><b>11.2.2</b> Bagging</a></li>
<li class="chapter" data-level="11.2.3" data-path="randomforest.html"><a href="randomforest.html#from-trees-to-a-forest"><i class="fa fa-check"></i><b>11.2.3</b> From trees to a forest</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="randomforest.html"><a href="randomforest.html#exercises-9"><i class="fa fa-check"></i><b>11.3</b> Exercises</a></li>
<li class="chapter" data-level="11.4" data-path="randomforest.html"><a href="randomforest.html#solutions-1"><i class="fa fa-check"></i><b>11.4</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="solutions-2.html"><a href="solutions-2.html"><i class="fa fa-check"></i><b>12</b> Solutions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="solutions-2.html"><a href="solutions-2.html#chapter-01---getting-started"><i class="fa fa-check"></i><b>12.1</b> Chapter 01 - Getting Started</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="solutions-2.html"><a href="solutions-2.html#magic-trick"><i class="fa fa-check"></i><b>12.1.1</b> Magic Trick</a></li>
<li class="chapter" data-level="12.1.2" data-path="solutions-2.html"><a href="solutions-2.html#code-clean-up"><i class="fa fa-check"></i><b>12.1.2</b> Code Clean-up</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="solutions-2.html"><a href="solutions-2.html#chapter-02---primers"><i class="fa fa-check"></i><b>12.2</b> Chapter 02 - Primers</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="solutions-2.html"><a href="solutions-2.html#loops-using-for-and-while"><i class="fa fa-check"></i><b>12.2.1</b> Loops using <code>for</code> and <code>while</code></a></li>
<li class="chapter" data-level="12.2.2" data-path="solutions-2.html"><a href="solutions-2.html#add-up-all-numbers-that-are-multiples-of-3-and-7"><i class="fa fa-check"></i><b>12.2.2</b> Add up all numbers that are multiples of 3 and 7</a></li>
<li class="chapter" data-level="12.2.3" data-path="solutions-2.html"><a href="solutions-2.html#define-and-interpolate-vector"><i class="fa fa-check"></i><b>12.2.3</b> Define and interpolate vector</a></li>
<li class="chapter" data-level="12.2.4" data-path="solutions-2.html"><a href="solutions-2.html#find-the-sum-of-the-values-per-column"><i class="fa fa-check"></i><b>12.2.4</b> Find the sum of the values per column</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="solutions-2.html"><a href="solutions-2.html#chapter-03---data-wrangling"><i class="fa fa-check"></i><b>12.3</b> Chapter 03 - Data Wrangling</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="solutions-2.html"><a href="solutions-2.html#tidyverse-exercises"><i class="fa fa-check"></i><b>12.3.1</b> Tidyverse exercises</a></li>
<li class="chapter" data-level="12.3.2" data-path="solutions-2.html"><a href="solutions-2.html#aggregation-of-data-in-tidy-style"><i class="fa fa-check"></i><b>12.3.2</b> Aggregation of data in tidy style</a></li>
<li class="chapter" data-level="12.3.3" data-path="solutions-2.html"><a href="solutions-2.html#temporal-pattern-of-gap-filled-data"><i class="fa fa-check"></i><b>12.3.3</b> Temporal pattern of gap-filled data</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="solutions-2.html"><a href="solutions-2.html#chapter-04---data-visualisation"><i class="fa fa-check"></i><b>12.4</b> Chapter 04 - Data Visualisation</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="solutions-2.html"><a href="solutions-2.html#identifying-outliers"><i class="fa fa-check"></i><b>12.4.1</b> Identifying Outliers</a></li>
<li class="chapter" data-level="12.4.2" data-path="solutions-2.html"><a href="solutions-2.html#diurnal-and-seasonal-cycles"><i class="fa fa-check"></i><b>12.4.2</b> Diurnal and seasonal cycles</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="solutions-2.html"><a href="solutions-2.html#chapter-05"><i class="fa fa-check"></i><b>12.5</b> Chapter 05</a></li>
<li class="chapter" data-level="12.6" data-path="solutions-2.html"><a href="solutions-2.html#chapter-06"><i class="fa fa-check"></i><b>12.6</b> Chapter 06</a></li>
<li class="chapter" data-level="12.7" data-path="solutions-2.html"><a href="solutions-2.html#chapter-07"><i class="fa fa-check"></i><b>12.7</b> Chapter 07</a></li>
<li class="chapter" data-level="12.8" data-path="solutions-2.html"><a href="solutions-2.html#chapter-08"><i class="fa fa-check"></i><b>12.8</b> Chapter 08</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="solutions-2.html"><a href="solutions-2.html#warm-up-exercises-1"><i class="fa fa-check"></i><b>12.8.1</b> Warm-up Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Geodata Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datavis" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Data visualisation<a href="datavis.html#datavis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Chapter lead author: Benjamin Stocker</strong></p>
<div id="learning-objectives-4" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Learning objectives<a href="datavis.html#learning-objectives-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="tutorial-3" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Tutorial<a href="datavis.html#tutorial-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Visualizations often take the center stage of publications and are often the main vehicles for transporting information in scientific publications and (ever more often) in the media. Visualizations communicate data and its patterns in visual form. Visualizing data is also an integral part of the exploratory data analysis cycle. Visually understanding the data guides its transformation and the identification of suitable models and analysis methods.</p>
<p>The quality of a data visualization can be measured by its effectiveness of conveying information about the data and thus of answering a question with the data and telling a story. Different aspects determine this effectiveness, including the appropriateness of visualization elements, the intuitiveness of how information can be decoded from the visualization by the reader, the visual clarity and legibility (taking into account the vision and potential vision deficiencies of the reader), the visual appeal, etc. This tutorial introduces data visualization under the premise that not all aspects of data visualization are a matter of taste. There are appropriate and less appropriate ways of encoding data in visual form.</p>
<p>This tutorial is inspired by the comprehensive and online available textbook Fundamentals of <a href="https://clauswilke.com/dataviz/index.html">Data Visualization by Claus O. Wilke</a>. Another excellent resource is the <a href="https://r4ds.had.co.nz/data-visualisation.html">Chapter Data Visualisation in R for Data Science by Hadley Wickham</a></p>
<div id="the-grammar-of-graphics" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> The grammar of graphics<a href="datavis.html#the-grammar-of-graphics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Chapter @ref(data_wrangling), we learned about axes of variation in the data. For example, time is an axis of variation in our example data <code>hhdf</code>, or site identity and the date are axes of variation in our example data <code>ddf</code>. We have also learned that we can aggregate over axes of variation, and that we can often separate an axis of variation into a hierarchy of subordinate axes of variation (e.g., years, months, days, and a half-hourly time axis).</p>
<p>In this chapter, we will be working mainly with the same half-hourly time series data of ecosystem-atmosphere fluxes and parallel measurements of meteorological variables - as in Chapters @ref(getting_started) and @ref(data_wrangling). For time series data, the entry point of the exploratory data analysis cycle may be a visualization of some variable of interest (here <code>GPP_NT_VUT_REF</code>) against time:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="datavis.html#cb222-1" aria-hidden="true" tabindex="-1"></a>hhdf <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006_CLEAN.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 52608 Columns: 20
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl  (18): TA_F, SW_IN_F, LW_IN_F, VPD_F, PA_F, P_F, WS_F, GPP_NT_VUT_REF, N...
## dttm  (2): TIMESTAMP_START, TIMESTAMP_END
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="datavis.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hhdf<span class="sc">$</span>TIMESTAMP_START, hhdf<span class="sc">$</span>GPP_NT_VUT_REF, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-125-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You may notice the spurious-looking values on the left, in the first third of year 2004. We’ll revisit this point later in this Chapter.</p>
<p>From <a href="https://clauswilke.com/dataviz/">(Wilke)</a>:</p>
<p>“All data visualizations map data values into quantifiable features of the resulting graphic. We refer to these features as <em>aesthetics</em>.”</p>
<p>Applied to our example, the aesthetics are the x-axis and the y-axis of a cartesian coordinate system. <code>TIMESTAMP_START</code> is mapped onto the x-axis, <code>GPP_NT_VUT_REF</code> is mapped onto the y-axis, and their respective values specify the position of points in the cartesian coordinate system that are then connected with lines - making up the geometrical object that represents the data. Often, the aesthetic that is used to plot the target variable against corresponds to a known axis of variation in the data.</p>
<p>The notion of mapping data onto aesthetics and using objects whose geometry is defined by the aesthetics gives rise to the <em>grammar of graphics</em> and to the {ggplot2} R package for data visualisation (which we will use throughout the remainder of this course). The equivalent {ggplot2} code that follows the philosophy of the grammar of graphics is:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="datavis.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> hhdf, <span class="fu">aes</span>(<span class="at">x =</span> TIMESTAMP_START, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb225-2"><a href="datavis.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-126-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The argument provided by the <code>aes()</code> statement specifies the aesthetics (<code>x</code>, and <code>y</code>) and which variables in <code>data</code> are mapped onto them. Once this is specified, we can use any suitable geometrical object that is defined by these aesthetics. Here, we used a line plot specified by <code>+ geom_line()</code>.</p>
<p>The data visualisation above is a dense plot and we cannot distinguish patterns because variations in GPP happen at time scales that are too narrow for displaying three years of half-hourly data in one plot. GPP varies throughout a day just as much as it varies throughout a season. To see this, we can focus on a narrower time span (selecting rows by index using <code>dplyr::slice()</code> in the code below). Visual clarity is also facilitated by an appropriate labeling (title and axes labels using <code>labs()</code>) and by a reduction of displayed elements to a minimum (therefore, the changing of the formatting theme by <code>theme_classic()</code>):</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="datavis.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare plot data</span></span>
<span id="cb226-2"><a href="datavis.html#cb226-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> hhdf <span class="sc">|&gt;</span> </span>
<span id="cb226-3"><a href="datavis.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">24000</span><span class="sc">:</span><span class="dv">25000</span>)</span>
<span id="cb226-4"><a href="datavis.html#cb226-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-5"><a href="datavis.html#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot figure</span></span>
<span id="cb226-6"><a href="datavis.html#cb226-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb226-7"><a href="datavis.html#cb226-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plot_data,</span>
<span id="cb226-8"><a href="datavis.html#cb226-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> TIMESTAMP_START, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb226-9"><a href="datavis.html#cb226-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb226-10"><a href="datavis.html#cb226-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Gross primary productivity&quot;</span>, </span>
<span id="cb226-11"><a href="datavis.html#cb226-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Site: CH-Lae&quot;</span>,</span>
<span id="cb226-12"><a href="datavis.html#cb226-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, </span>
<span id="cb226-13"><a href="datavis.html#cb226-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb226-14"><a href="datavis.html#cb226-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-127-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Find a complete reference to {ggplot2} <a href="https://ggplot2.tidyverse.org/">here</a> <span class="citation">(<a href="#ref-R-ggplot2" role="doc-biblioref"><strong>R-ggplot2?</strong></a>)</span>. The grammar of graphics has found its way also into Python and you can use ggplot using the <em>plotnine</em> Python package (see <a href="https://realpython.com/ggplot-python/">here</a>).</p>
</div>
<div id="every-data-has-its-representation" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Every data has its representation<a href="datavis.html#every-data-has-its-representation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the above example, we mapped two continuous variables (<code>TIMESTAMP_START</code> and <code>GPP_NT_VUT_REF</code>) onto the aesthetics <code>x</code>, and <code>y</code> to visualize time series data. A line plot is an appropriate choice for such data as points are ordered along the time axis and can be connected by a line. Different “geometries” are suitable for visualizing different aspects of the data, and different variable types are suited to mapping onto different aesthetics. Common, available aesthetics are shown in Fig. <a href="datavis.html#fig:common-aesthetics">4.1</a> and can be allocated to variable types:</p>
<ul>
<li>Continuous variables: position, size, color (a color gradient), line width, etc.</li>
<li>Categorical variables: shape, color (a discrete set of colors), line type, etc.</li>
</ul>
<!-- https://clauswilke.com/dataviz/aesthetic_mapping_files/figure-html/common-aesthetics-1.png -->
<!-- ![test](./figures/common-aesthetics-1.png){#fig:test} \@ref(fig:test -->
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:common-aesthetics"></span>
<img src="figures/common-aesthetics-1.png" alt="Common aesthetics to display different variable types."  />
<p class="caption">
Figure 4.1: Common aesthetics to display different variable types.
</p>
</div>
<p>Not only the different aesthetics, but also the type of <em>geometry</em> (the layers of the visualization added to a plot by <code>+ geom_*()</code>) goes with certain types of variables and aspects of the data (but not with others). The sub-sections below provide a brief categorization of data visualization types. A more comprehensive overview is given by <a href="http://www.sthda.com/english/wiki/be-awesome-in-ggplot2-a-practical-guide-to-be-highly-effective-r-software-and-data-visualization#geom_bar-bar-plot">GGPlot2 Essentials for Great Data Visualization in R by Alboukadel Kassambara</a>.</p>
<div id="one-value-per-category" class="section level4 hasAnchor" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> One value per category<a href="datavis.html#one-value-per-category" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Probably the simplest case of data visualization is where a single value is shown across a categorical variable. This calls for a bar plot (<code>geom_bar()</code>). In the example below, we plot the mean GPP for within each month. The “custom plot” shown below is a demonstration for what you can do by combining different elements with {ggplot2}. Try to understand the command for creating the object <code>gg2</code>. Both examples are based on the data frame <code>ddf</code> which we created in Chapter @ref(data_wrangling).</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="datavis.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in demo daily data</span></span>
<span id="cb227-2"><a href="datavis.html#cb227-2" aria-hidden="true" tabindex="-1"></a>ddf <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/ddf.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1096 Columns: 6
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl  (5): GPP_NT_VUT_REF, n_datapoints, n_measured, SW_IN_F, f_measured
## date (1): date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="datavis.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plot</span></span>
<span id="cb229-2"><a href="datavis.html#cb229-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> ddf <span class="sc">|&gt;</span> </span>
<span id="cb229-3"><a href="datavis.html#cb229-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb229-4"><a href="datavis.html#cb229-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(month) <span class="sc">|&gt;</span> </span>
<span id="cb229-5"><a href="datavis.html#cb229-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb229-6"><a href="datavis.html#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="datavis.html#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="datavis.html#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plot</span></span>
<span id="cb229-9"><a href="datavis.html#cb229-9" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb229-10"><a href="datavis.html#cb229-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb229-11"><a href="datavis.html#cb229-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb229-12"><a href="datavis.html#cb229-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb229-13"><a href="datavis.html#cb229-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb229-14"><a href="datavis.html#cb229-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Bar plot&quot;</span>,</span>
<span id="cb229-15"><a href="datavis.html#cb229-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Month&quot;</span>, </span>
<span id="cb229-16"><a href="datavis.html#cb229-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mean GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)))</span>
<span id="cb229-17"><a href="datavis.html#cb229-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-18"><a href="datavis.html#cb229-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom plot</span></span>
<span id="cb229-19"><a href="datavis.html#cb229-19" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb229-20"><a href="datavis.html#cb229-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb229-21"><a href="datavis.html#cb229-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb229-22"><a href="datavis.html#cb229-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">xend =</span> month, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> GPP_NT_VUT_REF), </span>
<span id="cb229-23"><a href="datavis.html#cb229-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;grey40&quot;</span>) <span class="sc">+</span></span>
<span id="cb229-24"><a href="datavis.html#cb229-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> GPP_NT_VUT_REF), <span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;grey40&quot;</span>) <span class="sc">+</span></span>
<span id="cb229-25"><a href="datavis.html#cb229-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">label =</span> <span class="fu">format</span>(GPP_NT_VUT_REF, <span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb229-26"><a href="datavis.html#cb229-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb229-27"><a href="datavis.html#cb229-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb229-28"><a href="datavis.html#cb229-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Custom plot&quot;</span>,</span>
<span id="cb229-29"><a href="datavis.html#cb229-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Month&quot;</span>, </span>
<span id="cb229-30"><a href="datavis.html#cb229-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Mean GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb229-31"><a href="datavis.html#cb229-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">8.75</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb229-32"><a href="datavis.html#cb229-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="datavis.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots</span></span>
<span id="cb231-2"><a href="datavis.html#cb231-2" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(gg1, gg2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-128-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Above, we created two objects, <code>gg1</code> and <code>gg2</code>, that contain the instructions for creating the plots. To combine multiple sub-plots within panels of a single plot, we used <code>cowplot::plot_grid()</code> from the {cowplot} library.</p>
<p>Note also the <code>stat = "identity"</code> specification within the <code>geom_bar()</code> function call. This is required when the bar height is specified by a single value within each category (<code>month</code> in the example above). To visualize not a value <em>per se</em> but the <em>count</em> of values within categories, use <code>stat = "count"</code> to get the equivalent result as when aggregating by taking the number of observations within categories explicitly using the function <code>dplyr::summarise()</code>. This equivalency is demonstrated below.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="datavis.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset plot data and count occurences</span></span>
<span id="cb232-2"><a href="datavis.html#cb232-2" aria-hidden="true" tabindex="-1"></a>plot_data_counted <span class="ot">&lt;-</span> hhdf <span class="sc">|&gt;</span> </span>
<span id="cb232-3"><a href="datavis.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb232-4"><a href="datavis.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(NIGHT) <span class="sc">|&gt;</span> </span>
<span id="cb232-5"><a href="datavis.html#cb232-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb232-6"><a href="datavis.html#cb232-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-7"><a href="datavis.html#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="co"># separate aggregation  </span></span>
<span id="cb232-8"><a href="datavis.html#cb232-8" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(</span>
<span id="cb232-9"><a href="datavis.html#cb232-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data_counted,</span>
<span id="cb232-10"><a href="datavis.html#cb232-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> NIGHT, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb232-11"><a href="datavis.html#cb232-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-12"><a href="datavis.html#cb232-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Count via &#39;summarise&#39; and &#39;stat = identiy&#39;&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-13"><a href="datavis.html#cb232-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb232-14"><a href="datavis.html#cb232-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-15"><a href="datavis.html#cb232-15" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data (not summarizing counts)</span></span>
<span id="cb232-16"><a href="datavis.html#cb232-16" aria-hidden="true" tabindex="-1"></a>plot_data_uncounted <span class="ot">&lt;-</span> hhdf <span class="sc">|&gt;</span> </span>
<span id="cb232-17"><a href="datavis.html#cb232-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb232-18"><a href="datavis.html#cb232-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-19"><a href="datavis.html#cb232-19" aria-hidden="true" tabindex="-1"></a><span class="co"># implicit aggregation by &#39;stat&#39;</span></span>
<span id="cb232-20"><a href="datavis.html#cb232-20" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb232-21"><a href="datavis.html#cb232-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data_uncounted,</span>
<span id="cb232-22"><a href="datavis.html#cb232-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> NIGHT)) <span class="sc">+</span></span>
<span id="cb232-23"><a href="datavis.html#cb232-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;count&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-24"><a href="datavis.html#cb232-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Count directly via &#39;stat = count&#39;&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-25"><a href="datavis.html#cb232-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb232-26"><a href="datavis.html#cb232-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-27"><a href="datavis.html#cb232-27" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots</span></span>
<span id="cb232-28"><a href="datavis.html#cb232-28" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(gg1, gg2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-129-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="distribution-of-one-variable" class="section level4 hasAnchor" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Distribution of one variable<a href="datavis.html#distribution-of-one-variable" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Examining the distribution of a variable is often the first step of exploratory data analysis. A <em>histogram</em> displays the distribution of numerical data by mapping the frequency (or count) of values within discrete bins (equally spaced ranges along the full range values of a given variable) onto the “height” of a bar, and the range of values within bins onto the position of the bar. In other words, it shows the count of how many points of a certain variable (below <code>GPP_NT_VUT_REF</code>) fall into a discrete set of bins. When normalizing (scaling) the “bars” of the histogram to unity, we get a <em>density histogram</em>. To specify the y-axis position of the upper end of the histogram bar as the density, use <code>y = ..density..</code> in the <code>aes()</code> call. To show counts, use <code>y = ..count..</code>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="datavis.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb233-2"><a href="datavis.html#cb233-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> hhdf,</span>
<span id="cb233-3"><a href="datavis.html#cb233-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> GPP_NT_VUT_REF, <span class="at">y =</span> ..density..)</span>
<span id="cb233-4"><a href="datavis.html#cb233-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb233-5"><a href="datavis.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-6"><a href="datavis.html#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span>  <span class="co"># we can overlay multiple plot layers!</span></span>
<span id="cb233-7"><a href="datavis.html#cb233-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Histogram and density&quot;</span>, <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb233-8"><a href="datavis.html#cb233-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-130-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that the red line plotted by <code>geom_density()</code> on top of the density histogram visualises the <em>density distribution</em> in continuous (not discrete, or binned) form. Note also that both “geoms” share the same aesthetics with <code>aes()</code> specified in the <code>ggplot()</code> function call.</p>
</div>
<div id="distributions-within-categories" class="section level4 hasAnchor" number="4.2.2.3">
<h4><span class="header-section-number">4.2.2.3</span> Distributions within categories<a href="datavis.html#distributions-within-categories" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To visualize distributions of a single continuous variable within categories, perhaps the most common visualization type is the <em>box plot</em>. As described in Chapter @ref(data_wrangling), it shows the median (bold line in the center), the upper and lower quartiles, corresponding to the 25% and the 75% quantiles, often referred to as <span class="math inline">\(Q_1\)</span> and <span class="math inline">\(Q_3\)</span> , and given by the upper and lower edge of the box plot. The lines extending from the box edges visualize the range of <span class="math inline">\(( Q_1 - 1.5 (Q_3 - Q_1)\)</span> to <span class="math inline">\(Q_3 + 1.5 (Q_3 - Q_1)\)</span>. Any point outside this range is plotted by a point.</p>
<p>The box plot is rather reductionist in showing the data (the vector of all values is reduced to the median, <span class="math inline">\(Q_1\)</span> , <span class="math inline">\(Q_3\)</span>, and outlying points) and may yield a distorted picture of the data distribution and does not reflect information about the data volume. For this reason, several journals are now requiring individual data points or at least the number of data points to be shown in addition to each box. Below, points are added by <code>geom_jitter()</code> , where points are “jittered”, that is, randomly spread out along the x-axis. Violin plots are a hybrid of a density plot and a box plot. The form of their edge is given by the density distribution of the points they represent.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="datavis.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare plot data</span></span>
<span id="cb235-2"><a href="datavis.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1985</span>)  <span class="co"># for random number reproducibility in sample_n() and jitter</span></span>
<span id="cb235-3"><a href="datavis.html#cb235-3" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> hhdf <span class="sc">|&gt;</span> </span>
<span id="cb235-4"><a href="datavis.html#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">300</span>) <span class="sc">|&gt;</span> </span>
<span id="cb235-5"><a href="datavis.html#cb235-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Night =</span> <span class="fu">ifelse</span>(NIGHT <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb235-6"><a href="datavis.html#cb235-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-7"><a href="datavis.html#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot</span></span>
<span id="cb235-8"><a href="datavis.html#cb235-8" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(</span>
<span id="cb235-9"><a href="datavis.html#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb235-10"><a href="datavis.html#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Night, <span class="at">y =</span> VPD_F)) <span class="sc">+</span></span>
<span id="cb235-11"><a href="datavis.html#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-12"><a href="datavis.html#cb235-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Box plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-13"><a href="datavis.html#cb235-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;VPD (hPa)&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-14"><a href="datavis.html#cb235-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb235-15"><a href="datavis.html#cb235-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-16"><a href="datavis.html#cb235-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot + jittered points</span></span>
<span id="cb235-17"><a href="datavis.html#cb235-17" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(</span>
<span id="cb235-18"><a href="datavis.html#cb235-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb235-19"><a href="datavis.html#cb235-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Night, <span class="at">y =</span> VPD_F)) <span class="sc">+</span></span>
<span id="cb235-20"><a href="datavis.html#cb235-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb235-21"><a href="datavis.html#cb235-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb235-22"><a href="datavis.html#cb235-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Boxplot + jittered points&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-23"><a href="datavis.html#cb235-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;VPD (hPa)&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-24"><a href="datavis.html#cb235-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb235-25"><a href="datavis.html#cb235-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-26"><a href="datavis.html#cb235-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Violin plot</span></span>
<span id="cb235-27"><a href="datavis.html#cb235-27" aria-hidden="true" tabindex="-1"></a>gg3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb235-28"><a href="datavis.html#cb235-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb235-29"><a href="datavis.html#cb235-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Night, <span class="at">y =</span> VPD_F)) <span class="sc">+</span></span>
<span id="cb235-30"><a href="datavis.html#cb235-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-31"><a href="datavis.html#cb235-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Violin plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-32"><a href="datavis.html#cb235-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;VPD (hPa)&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-33"><a href="datavis.html#cb235-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb235-34"><a href="datavis.html#cb235-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-35"><a href="datavis.html#cb235-35" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots</span></span>
<span id="cb235-36"><a href="datavis.html#cb235-36" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(gg1, gg2, gg3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-131-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="regression-of-two-continuous-variables" class="section level4 hasAnchor" number="4.2.2.4">
<h4><span class="header-section-number">4.2.2.4</span> Regression of two continuous variables<a href="datavis.html#regression-of-two-continuous-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Scatter plots visualize how two variables co-vary. The position of each point in a scatter plot is given by the simultaneously recorded value of two variables, provided in two columns along the same row in a data frame, and mapped onto two dimensions in a cartesian coordinate system. We can also say that two variables are <em>regressed</em> against each other.</p>
<p>In the figure below, we start with a simple scatter plot (a), regressing GPP against shortwave radiation. A visualization is supposed to tell a story with data. The positive and largely linear relationship between shortwave radiation and GPP is expected from theory (Monteith, 1972) and our process understanding of the dominant controls on photosynthesis - it’s mainly solar (shortwave) radiation. The linear regression line, added by <code>geom_smooth(method = "lm")</code> in (a), indicates that relationship.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="datavis.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare plot data</span></span>
<span id="cb236-2"><a href="datavis.html#cb236-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> hhdf <span class="sc">|&gt;</span></span>
<span id="cb236-3"><a href="datavis.html#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">1000</span>)</span>
<span id="cb236-4"><a href="datavis.html#cb236-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-5"><a href="datavis.html#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="co"># a</span></span>
<span id="cb236-6"><a href="datavis.html#cb236-6" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb236-7"><a href="datavis.html#cb236-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb236-8"><a href="datavis.html#cb236-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb236-9"><a href="datavis.html#cb236-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb236-10"><a href="datavis.html#cb236-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb236-11"><a href="datavis.html#cb236-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb236-12"><a href="datavis.html#cb236-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb236-13"><a href="datavis.html#cb236-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb236-14"><a href="datavis.html#cb236-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-15"><a href="datavis.html#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="co"># b</span></span>
<span id="cb236-16"><a href="datavis.html#cb236-16" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb236-17"><a href="datavis.html#cb236-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb236-18"><a href="datavis.html#cb236-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> NIGHT)) <span class="sc">+</span></span>
<span id="cb236-19"><a href="datavis.html#cb236-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb236-20"><a href="datavis.html#cb236-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb236-21"><a href="datavis.html#cb236-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb236-22"><a href="datavis.html#cb236-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb236-23"><a href="datavis.html#cb236-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-24"><a href="datavis.html#cb236-24" aria-hidden="true" tabindex="-1"></a><span class="co"># c</span></span>
<span id="cb236-25"><a href="datavis.html#cb236-25" aria-hidden="true" tabindex="-1"></a>gg3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb236-26"><a href="datavis.html#cb236-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb236-27"><a href="datavis.html#cb236-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> <span class="fu">as.factor</span>(NIGHT))) <span class="sc">+</span></span>
<span id="cb236-28"><a href="datavis.html#cb236-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb236-29"><a href="datavis.html#cb236-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb236-30"><a href="datavis.html#cb236-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb236-31"><a href="datavis.html#cb236-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb236-32"><a href="datavis.html#cb236-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-33"><a href="datavis.html#cb236-33" aria-hidden="true" tabindex="-1"></a><span class="co"># d</span></span>
<span id="cb236-34"><a href="datavis.html#cb236-34" aria-hidden="true" tabindex="-1"></a>gg4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb236-35"><a href="datavis.html#cb236-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb236-36"><a href="datavis.html#cb236-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> TA_F)) <span class="sc">+</span></span>
<span id="cb236-37"><a href="datavis.html#cb236-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb236-38"><a href="datavis.html#cb236-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb236-39"><a href="datavis.html#cb236-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb236-40"><a href="datavis.html#cb236-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb236-41"><a href="datavis.html#cb236-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>()</span>
<span id="cb236-42"><a href="datavis.html#cb236-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-43"><a href="datavis.html#cb236-43" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots</span></span>
<span id="cb236-44"><a href="datavis.html#cb236-44" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(gg1, gg2, gg3, gg4, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">&quot;auto&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-132-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Are there additional variables that modify the relationship between solar radiation and GPP? To visually investigate this, we can map additional variables in our data set onto additional aesthetics. For example, at night, photosynthesis ceases as shown in (b). Here, the variable <code>NIGHT</code> was mapped onto the aesthetic <code>color</code> of same geometry (<code>geom_point()</code>). By default, <code>ggplot()</code> used a <em>continuous color scale</em>, as indicated by the color key on the right. It did so although <code>NIGHT</code> is a categorical (a binary) variable because in the data frame, <code>NIGHT</code> is stored as a numeric value (as can be checked by <code>class(hhdf$NIGHT)</code>). To avoid this, and automatically trigger the use of a color scheme that is suitable for categorical variables, we specify <code>aes(x = SW_IN_F, y = GPP_NT_VUT_REF, color = as.factor(NIGHT))</code> in (c). (d) is an example for using a continuous color scheme, as explained in the next section.</p>
</div>
<div id="use-of-colors" class="section level4 hasAnchor" number="4.2.2.5">
<h4><span class="header-section-number">4.2.2.5</span> Use of colors<a href="datavis.html#use-of-colors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The above example demonstrates that color schemes have to be chosen depending on the nature of the data. Mapping a continuous variable onto the aesthetics <code>color</code> requires a continuous color scheme to be applied, categorical data requires discrete color schemes. More distinctions should be considered:</p>
<ul>
<li>Continuous variables should be distinguished further if they span a range that includes zero or not. If so, <em>diverging</em> color schemes should be used, where zero appears neutral (e.g., white). If zero is not contained within the range of values in the data, diverging color schemes should be avoided.</li>
<li>Continuous or ordinal variables may be <em>cyclic</em> in nature. For example, hours in a day are cyclic, although there are twelve discrete numbers. The time 00:00 is nearer to 23:59 than it is from, for example, 01:00. The cyclical, or periodical nature of the data should be reflected in the choice of a color scheme where the edges of the range are more similar to one another than they are to the center of the range (see example below XXX)</li>
<li><em>Multisequential</em> color schemes reflect that there is a natural distinction between two parts of the range of continuous values (see example below XXX).</li>
</ul>
<p>Choices of colors and their combination is far from trivial. Colors in color schemes (or “scales”) should be:</p>
<ul>
<li>Distinguishable for people with color vision deficiency</li>
<li>Distinguishable when printed in black and white</li>
<li>Evenly spaced in the color space</li>
<li>Intuitively encoding the information in the data (for example, blue-red for cold-hot)</li>
<li>Visually appealing</li>
</ul>
<p>In (d), we mapped temperature, a continuous variable, onto the color aesthetic of the points and chose the continuous <em>viridis</em> color scale by specifying <code>+ scale_color_viridis_c()</code>. The viridis scales have become popular for their respect of the points listed above.</p>
<p>For further reading, several excellent resources exist that theorize and guide the use of color in data visualization. Excellent sources are:</p>
<ul>
<li><a href="https://www.fabiocrameri.ch/colourmaps/">Fabio Crameri’s Scientific colour maps</a>, <a href="https://gmd.copernicus.org/articles/11/2541/2018/">Crameri (2018)</a> and its R package <em>scico</em> (on CRAN).</li>
<li><a href="https://personal.sron.nl/~pault/">Paul Tol’s Notes</a>, available for example in the <em>khroma</em> R package (on CRAN).</li>
</ul>
</div>
<div id="vis_regr_cat" class="section level4 hasAnchor" number="4.2.2.6">
<h4><span class="header-section-number">4.2.2.6</span> Regression within categories<a href="datavis.html#vis_regr_cat" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the sub-plot (d) above, we may observe a pattern: GPP recorded at low temperatures (dark colored points) tend to be located in the lower range of the cloud of points. We may formulate a hypothesis from this observation, guiding further data analysis and modelling. This illustrates how data visualization is an integral part of any (geo-) data science workflow.</p>
<p>Since the relationship between incoming solar radiation and ecosystem photosynthesis is strongly affected by how much of this light is actually absorbed by leaves, and because the amount of green foliage varies strongly throughout a year (the site CH-Lae from which the data is recorded is located in a mixed forest), the slope of the regression between solar radiation and GPP should change between months.</p>
<p>Hence, let’s consider months as the categories to be used for separating the data and analyzing the bi-variate relationships separately within. Below, two alternatives are presented. Either the data is separated into a grid of sub-plots, or the data is separated by colors within the same plot panel.</p>
<p><strong>Separation by color</strong></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="datavis.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb238-2"><a href="datavis.html#cb238-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span>ddf <span class="sc">|&gt;</span></span>
<span id="cb238-3"><a href="datavis.html#cb238-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb238-4"><a href="datavis.html#cb238-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-5"><a href="datavis.html#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb238-6"><a href="datavis.html#cb238-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb238-7"><a href="datavis.html#cb238-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> month)) <span class="sc">+</span></span>
<span id="cb238-8"><a href="datavis.html#cb238-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb238-9"><a href="datavis.html#cb238-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> <span class="dv">0</span>, <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb238-10"><a href="datavis.html#cb238-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;PPFD (&quot;</span>, mu, <span class="st">&quot;mol m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb238-11"><a href="datavis.html#cb238-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb238-12"><a href="datavis.html#cb238-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb238-13"><a href="datavis.html#cb238-13" aria-hidden="true" tabindex="-1"></a>  scico<span class="sc">::</span><span class="fu">scale_color_scico_d</span>(<span class="at">palette =</span> <span class="st">&quot;romaO&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-133-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note three aspects here. First, the color-mapping is specified within <code>aes()</code> in the <code>ggplot()</code> function call and then adopted for all subsequent additions of geoms. Hence, also the <code>geom_smooth()</code> thus takes the color information, and not by a “hard-coded” specification of <code>color =</code> inside the <code>geom_smooth()</code> call as done in Fig. XXX.</p>
<p>Second, we specified a formula for the linear regression “smooting curve” to force the lines through the origin (<code>y ~ x + 0</code>). This is motivated by our a priori understanding of the process generating the data: when solar radiation is zero, photosynthesis (and hence GPP) should be zero.</p>
<p>Third, we chose a color palette that reflects the cyclic (or periodic) nature of the categories (months). January is closer to December than it is to April. Therefore, their respective colors should also be closer in the <em>color space</em>. An appropriate palette for this is <code>"romaO"</code> from the <em>scico</em> package.</p>
<p><strong>Separation into sub-plots</strong></p>
<p>Yet another “mapping” is available with <code>facet_wrap()</code>. It separates the visualisation into different sub-plots, each showing only the part of the data that falls into the respective category, separated by <code>facet_wrap()</code>. Note, this mapping is not dealt with the same way as other aesthetics - not with specifying it with <code>aes()</code>), but with adding the <code>facet_wrap()</code> with a <code>+</code> to the <code>ggplot()</code> object. The variable by which <code>facet_wrap()</code> separates the plot has to be specified as an argument with a preceeding <code>~</code>. Here, this is <code>~month</code>.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="datavis.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb239-2"><a href="datavis.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data, <span class="co"># reusing the previously subset data (see above)</span></span>
<span id="cb239-3"><a href="datavis.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb239-4"><a href="datavis.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb239-5"><a href="datavis.html#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> <span class="dv">0</span>, <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb239-6"><a href="datavis.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;PPFD (&quot;</span>, mu, <span class="st">&quot;mol m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb239-7"><a href="datavis.html#cb239-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb239-8"><a href="datavis.html#cb239-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>month)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-134-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You may object here that a linear regression is not a good model for our data. Instead, the relationship looks saturating, as indicated for example by the data in August. But we’ll get to modelling in later chapters. Nevertheless, the two visualizations above confirm our suspicion that the light-GPP relationship varies between months - a demonstration for why data visualization is an integral part of the scientific process.</p>
</div>
<div id="time-series" class="section level4 hasAnchor" number="4.2.2.7">
<h4><span class="header-section-number">4.2.2.7</span> Time series<a href="datavis.html#time-series" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A time series plot can be regarded as a special case of a regression of two variables. In this case, one variable is regressed against time. A defining aspect of time is that there is a natural order in time steps. Therefore, it makes sense to visualize temporal data using lines that connect the points using <code>geom_line()</code>. The example below shows the time series of daily GPP in three years.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="datavis.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb240-2"><a href="datavis.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ddf,</span>
<span id="cb240-3"><a href="datavis.html#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb240-4"><a href="datavis.html#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb240-5"><a href="datavis.html#cb240-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Line plot&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb240-6"><a href="datavis.html#cb240-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-135-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In the line plot above, we see a spurious-looking part of the time series in the first third of year 2004. Is this bad data that should be removed? Also, in winter of 2005/2005, some daily GPP values appear as high as a typical summer level of GPP. Is this bad data? Remember, that in Chapter @ref(data_wrangling), we aggregated the half-hourly <code>hhdf</code> data frame to a daily data frame <code>ddf</code> from which data is visualized above. The aggregation kept a record of the fraction fraction of actually measured (not gap-filled) half-hourly data points per day (<code>f_measured</code>). This yields a “data quality axis”. Is there a pattern between <code>f_measured</code> and the presumably bad data? Discerning such patterns is often only possible with a suitable visualization. What is suitable here?</p>
<p>A solution is to “map” <code>f_measured</code> to the color axis. When adding such an additional mapping to visualisation dimensions (“aesthetics”), we have to specify it using <code>aes()</code>. This only affects the points and the color of points, while the lines and points and their position in x-y space is shared. Hence, we write <code>aes(x = date, y = GPP_NT_VUT_REF)</code> in the <code>ggplot()</code> function call (indicating that all subsequent additions of <code>geom_</code> layers share this x-y mapping); while <code>aes(color = f_measured)</code> is specified only in the <code>geom_point()</code> layer.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="datavis.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb241-2"><a href="datavis.html#cb241-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ddf,</span>
<span id="cb241-3"><a href="datavis.html#cb241-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb241-4"><a href="datavis.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb241-5"><a href="datavis.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> f_measured), <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb241-6"><a href="datavis.html#cb241-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb241-7"><a href="datavis.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> <span class="co"># inverse color scale is more intuitive here</span></span>
<span id="cb241-8"><a href="datavis.html#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-136-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We observe the presumably bad data appear in yellow, and are therefore indeed characterised with a particularly low fraction of actually measured data from which their values are derived. This is an insight we would never have reached by just looking at the naked values in our data frames. Data visualizations are essential for guiding analyses and data processing throughout all steps. Having learned this, we now have a justification for applying further data filtering criteria.</p>
</div>
<div id="periodic-data" class="section level4 hasAnchor" number="4.2.2.8">
<h4><span class="header-section-number">4.2.2.8</span> Periodic data<a href="datavis.html#periodic-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The seasons are an important axis of variation in our data. Hence our data are periodic - with a periodicity of 365 days in the <code>ddf</code> dataset and with both 12 hours and 365 days in the <code>hhdf</code> dataset. A polar coordinate system, instead of a cartesian system, lends itself to displaying periodic data. A polar coordinate system reflects the fact that, for example, January 1st is closer to December 31st, although they are located on the extreme end of a linear spectrum of days in a year. In a polar coordinate system, the x-axis spans the angle (360<span class="math inline">\(^\circ\)</span>, like a clock), while the y-axis spans the radius (distance from the center). This is specified by changing the coordinate system of the ggplot object by <code>+ coord_polar()</code>.</p>
<p>Below, we first aggregate the data to get a mean seasonal cycle from <code>ddf</code> (a, b), and to get a mean diurnal (daily) cycle from June data in <code>hhdf</code> (c, d). To get the mean seasonal cycle, we first determine the day-of-year (counting from 1 for January first to 365 for December 31st) using the {lubridate} function <code>yday()</code>.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="datavis.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare plot data</span></span>
<span id="cb242-2"><a href="datavis.html#cb242-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> ddf <span class="sc">|&gt;</span></span>
<span id="cb242-3"><a href="datavis.html#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doy =</span> <span class="fu">yday</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb242-4"><a href="datavis.html#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doy) <span class="sc">|&gt;</span> </span>
<span id="cb242-5"><a href="datavis.html#cb242-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb242-6"><a href="datavis.html#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="datavis.html#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal cycle, cartesian</span></span>
<span id="cb242-8"><a href="datavis.html#cb242-8" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb242-9"><a href="datavis.html#cb242-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb242-10"><a href="datavis.html#cb242-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(doy, GPP_NT_VUT_REF)) <span class="sc">+</span> </span>
<span id="cb242-11"><a href="datavis.html#cb242-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb242-12"><a href="datavis.html#cb242-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-13"><a href="datavis.html#cb242-13" aria-hidden="true" tabindex="-1"></a><span class="co"># seasonal cycle, polar</span></span>
<span id="cb242-14"><a href="datavis.html#cb242-14" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb242-15"><a href="datavis.html#cb242-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data,</span>
<span id="cb242-16"><a href="datavis.html#cb242-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(doy, GPP_NT_VUT_REF)) <span class="sc">+</span> </span>
<span id="cb242-17"><a href="datavis.html#cb242-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb242-18"><a href="datavis.html#cb242-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>()</span>
<span id="cb242-19"><a href="datavis.html#cb242-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-20"><a href="datavis.html#cb242-20" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare plot data (diurnal step)</span></span>
<span id="cb242-21"><a href="datavis.html#cb242-21" aria-hidden="true" tabindex="-1"></a>plot_data_diurnal <span class="ot">&lt;-</span> hhdf <span class="sc">|&gt;</span></span>
<span id="cb242-22"><a href="datavis.html#cb242-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb242-23"><a href="datavis.html#cb242-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">|&gt;</span>  <span class="co"># taking only June data</span></span>
<span id="cb242-24"><a href="datavis.html#cb242-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hour =</span> <span class="fu">hour</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb242-25"><a href="datavis.html#cb242-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour) <span class="sc">|&gt;</span> </span>
<span id="cb242-26"><a href="datavis.html#cb242-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb242-27"><a href="datavis.html#cb242-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-28"><a href="datavis.html#cb242-28" aria-hidden="true" tabindex="-1"></a><span class="co"># diurnal cycle, cartesian</span></span>
<span id="cb242-29"><a href="datavis.html#cb242-29" aria-hidden="true" tabindex="-1"></a>gg3 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(</span>
<span id="cb242-30"><a href="datavis.html#cb242-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plot_data_diurnal,</span>
<span id="cb242-31"><a href="datavis.html#cb242-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(hour, GPP_NT_VUT_REF)) <span class="sc">+</span> </span>
<span id="cb242-32"><a href="datavis.html#cb242-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb242-33"><a href="datavis.html#cb242-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-34"><a href="datavis.html#cb242-34" aria-hidden="true" tabindex="-1"></a><span class="co"># diurnal cycle, polar</span></span>
<span id="cb242-35"><a href="datavis.html#cb242-35" aria-hidden="true" tabindex="-1"></a>gg4 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(</span>
<span id="cb242-36"><a href="datavis.html#cb242-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plot_data_diurnal,</span>
<span id="cb242-37"><a href="datavis.html#cb242-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(hour, GPP_NT_VUT_REF)) <span class="sc">+</span> </span>
<span id="cb242-38"><a href="datavis.html#cb242-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb242-39"><a href="datavis.html#cb242-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>()</span>
<span id="cb242-40"><a href="datavis.html#cb242-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-41"><a href="datavis.html#cb242-41" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots</span></span>
<span id="cb242-42"><a href="datavis.html#cb242-42" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(gg1, gg2, gg3, gg4, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">&quot;auto&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-137-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="density-along-two-continuous-variables" class="section level4 hasAnchor" number="4.2.2.9">
<h4><span class="header-section-number">4.2.2.9</span> Density along two continuous variables<a href="datavis.html#density-along-two-continuous-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Scatter plots can appear “overcrowded” when points are plotted on top of each other and potentially important information is lost in the visualization.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="datavis.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb243-2"><a href="datavis.html#cb243-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> hhdf,</span>
<span id="cb243-3"><a href="datavis.html#cb243-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb243-4"><a href="datavis.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb243-5"><a href="datavis.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb243-6"><a href="datavis.html#cb243-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb243-7"><a href="datavis.html#cb243-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-138-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To avoid obscuring important details about the data, we may want to visualise the <em>density</em> of points. We want to plot how many points fall within bins of a certain range values in GPP and shortwave radiation, or, in other words, within grid cells in the GPP-radiation space. We can visualize the data, for example, with a raster plot that measures the density using <code>stat_density_2d()</code> or with a binning into hexagonal cells using the simple <code>geom_hex()</code> layer.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="datavis.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density raster</span></span>
<span id="cb244-2"><a href="datavis.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb244-3"><a href="datavis.html#cb244-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ddf,</span>
<span id="cb244-4"><a href="datavis.html#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb244-5"><a href="datavis.html#cb244-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(</span>
<span id="cb244-6"><a href="datavis.html#cb244-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;raster&quot;</span>, <span class="co"># the geometric object to display the data</span></span>
<span id="cb244-7"><a href="datavis.html#cb244-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_stat</span>(density)), <span class="co"># using `density`, a variable calculated by the stat</span></span>
<span id="cb244-8"><a href="datavis.html#cb244-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">contour =</span> <span class="cn">FALSE</span> </span>
<span id="cb244-9"><a href="datavis.html#cb244-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb244-10"><a href="datavis.html#cb244-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb244-11"><a href="datavis.html#cb244-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;PPFD (&quot;</span>, mu, <span class="st">&quot;mol m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb244-12"><a href="datavis.html#cb244-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb244-13"><a href="datavis.html#cb244-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb244-14"><a href="datavis.html#cb244-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span>  <span class="co"># avoid gap between plotting ara and axis</span></span>
<span id="cb244-15"><a href="datavis.html#cb244-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-139-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="datavis.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density hexagonal bins</span></span>
<span id="cb245-2"><a href="datavis.html#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb245-3"><a href="datavis.html#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ddf,</span>
<span id="cb245-4"><a href="datavis.html#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb245-5"><a href="datavis.html#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>() <span class="sc">+</span></span>
<span id="cb245-6"><a href="datavis.html#cb245-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb245-7"><a href="datavis.html#cb245-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;PPFD (&quot;</span>, mu, <span class="st">&quot;mol m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb245-8"><a href="datavis.html#cb245-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb245-9"><a href="datavis.html#cb245-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb245-10"><a href="datavis.html#cb245-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb245-11"><a href="datavis.html#cb245-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-139-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>An alternative solution to “overplotting” points is described in <a href="https://geco-group.org/post/lsd/">this blog post</a>.</p>
</div>
<div id="raster-data" class="section level4 hasAnchor" number="4.2.2.10">
<h4><span class="header-section-number">4.2.2.10</span> Raster data<a href="datavis.html#raster-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the figure above, the density of points in a grid of equally spaced bins along two axes, one for each variable, was shown. Often, data is organised along a grid of equally spaced bins by nature - think a matrix or raster data. Examples of such data are climate model outputs (which often span more than two dimensions), remote sensing images (again, just one “layer” of an image or one “band”), or images in general. In these cases, two (often spatial) axes span the space of a cartesian coordinate system and the value within each pixel is mapped onto the <code>color</code> aesthetic.</p>
<p>The base-R function <code>image()</code> can be used to visualize such spatial data as images.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="datavis.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(volcano)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-140-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>{ggplot2}forces us to the data frame paradigm and therefore doesn’t lend itself naturally to raster data. We can, however, convert raster data into a data frame in a separate step.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="datavis.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example from https://github.com/thomasp85/scico</span></span>
<span id="cb247-2"><a href="datavis.html#cb247-2" aria-hidden="true" tabindex="-1"></a>df_volcano <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb247-3"><a href="datavis.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="fu">ncol</span>(volcano)), <span class="at">each =</span> <span class="fu">nrow</span>(volcano)),</span>
<span id="cb247-4"><a href="datavis.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="fu">nrow</span>(volcano)), <span class="fu">ncol</span>(volcano)),</span>
<span id="cb247-5"><a href="datavis.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">c</span>(volcano) <span class="sc">-</span> <span class="dv">140</span>  <span class="co"># subtract 140 for example below</span></span>
<span id="cb247-6"><a href="datavis.html#cb247-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb247-7"><a href="datavis.html#cb247-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-8"><a href="datavis.html#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb247-9"><a href="datavis.html#cb247-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_volcano,</span>
<span id="cb247-10"><a href="datavis.html#cb247-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> height)) <span class="sc">+</span> </span>
<span id="cb247-11"><a href="datavis.html#cb247-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span> </span>
<span id="cb247-12"><a href="datavis.html#cb247-12" aria-hidden="true" tabindex="-1"></a>  scico<span class="sc">::</span><span class="fu">scale_fill_scico</span>(<span class="at">palette =</span> <span class="st">&#39;bukavu&#39;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb247-13"><a href="datavis.html#cb247-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb247-14"><a href="datavis.html#cb247-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-141-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In this example, we used the <em>multisequential</em> <code>"bukavu"</code> color scale from the <em>scico</em> package to reflect values above 0 (e.g., elevation above the sea level) and below 0 (ocean depth).</p>
</div>
<div id="geospatial-data" class="section level4 hasAnchor" number="4.2.2.11">
<h4><span class="header-section-number">4.2.2.11</span> Geospatial data<a href="datavis.html#geospatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Raster data often reflects values in geographic space. Also points and polygons may be located in geographic space. This opens the door to geospatial data visualisation (a.k.a. creating maps) which does not form part of this course.</p>
<p>Interested readers can find more content on geospatial data visualisation here:</p>
<ul>
<li>Timo Grossenbacher’s blog on geographic data journalism (<a href="https://timogrossenbacher.ch/blog/">link</a>)</li>
<li>Koen Hufken’s blog containing various worked example XXX</li>
</ul>
</div>
</div>
</div>
<div id="exercises-3" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Exercises<a href="datavis.html#exercises-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Identifying Outliers</strong>:</p>
<ul>
<li>Based on this and previous tutorials, read the half-hourly dataset for site CH-Lae, drop entries with <code>-9999</code> and aggregate <code>GPP_NT_VUT_REF</code> and <code>PPFD_IN</code> to daily means.</li>
<li>Fit a linear relationship between <code>GPP_NT_VUT_REF</code> and <code>PPFD_IN</code>, using <code>lm()</code>.</li>
<li>The function returns a list of objects which you can access using the <code>$</code> syntax. Access the fitted <code>residuals</code> and use them in <code>boxplot.stats()</code> to get box plot statistics to determine outliers.</li>
<li>The output of <code>boxplot.stats()</code> is a list with the object <code>out</code>, a named vector where the names are the row number of the <code>residuals</code> in your original dataframe and the values are the entries for that row. Use <code>out_boxplot$out |&gt; names() |&gt; as.integer()</code> to get all row numbers.</li>
<li>Create a new variable in the daily-aggregated dataset, which defines whether a datapoint is an outlier or not.</li>
</ul>
<p><strong>Visualising diurnal and seasonal cycles:</strong>
- Using the half-hourly dataset for site CH-Lae (after dropping <code>-9999</code> entries), visualise how GPP (<code>GPP_NT_VUT_REF</code>) varies on two time scales: diurnal (within-day at hourly time scale) and seasonal. To implement this, follow the following steps:
- Summarise half-hourly data for each hour and day across multiple years to get a mean seasonality with a mean diurnal cycle for each day of the year. To deal with date-time objects, use the {lubridate} package. Use the functions <code>lubridate::yday()</code> and <code>lubridate::hour()</code> to extract the day of year and hour of day across entries. See <code>?yday</code> to get more hints.
- Create a raster plot (<code>geom_raster()</code>), mapping the hour of the day to the x-axis, the day of the year to the y-axis, and the magnitude of <code>GPP_NT_VUT_REF</code> to color (use the <code>fill</code> argument).
- Make this figure ready for publication by adding nice labels and choosing a good color scale.</p>
<!-- -   Remove data in `ddf` based on `f_measured`. Visualize data removal, fill missing data with the respective day's value of the mean seasonal cycle, visualize good data, bad removed data, and filled data in one plot using different colors. -->
</div>
<div id="exercises-for-the-report" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Exercises for The Report<a href="datavis.html#exercises-for-the-report" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Running mean of monthly CO2 concentrations:</strong>
- Read the famous monthly Mauna Loa CO2 record from file <code>co2_monthly_maunaloa.txt</code>. Plot the data with x-values from the column <code>co2_avg</code> and y-values from the column co2 avg. Plot it as a line graph.</p>
<ul>
<li>Define a function to compute a 12-month running mean of the monthly CO2 time series. Arguments to your function may be a vector of the original (monthly) data and a parameter defining the number of elements over which the mean is to be taken (in this case 12). Plot the running mean on top of the monthly data. Use a different color for the running mean graph.</li>
</ul>
<p><strong>Data exploration:</strong>
- ***Tell a story about the <code>airquality</code> data (data is directly available, just type <code>airquality</code> into the console). Apply what you have learned in this Chapter. Explore the data and find suitable ways to display variables. Detect, visualise, and hypothesise patterns that seem interesting to you.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datawrangling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="datavariety.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-data_vis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
