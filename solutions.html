<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>A Solutions | Applied Geodata Science</title>
  <meta name="description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="A Solutions | Applied Geodata Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="github-repo" content="geco-bern/agsd" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Solutions | Applied Geodata Science" />
  
  <meta name="twitter:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  

<meta name="author" content="Benjamin Stocker, Koen Hufkens, Pepa Arán, and Pascal Schneider" />


<meta name="date" content="2023-08-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="figures/apple-touch-icon.png" />
  <link rel="shortcut icon" href="figures/favicon.ico" type="image/x-icon" />
<link rel="prev" href="interpretableml.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Geodata Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links"><i class="fa fa-check"></i>Links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-cite-this-book"><i class="fa fa-check"></i>How to cite this book</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-course"><i class="fa fa-check"></i>About this course</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-goal"><i class="fa fa-check"></i>Course goal</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#what-is-applied-geodata-science"><i class="fa fa-check"></i>What is Applied Geodata Science?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#the-data-science-workflow"><i class="fa fa-check"></i>The data science workflow</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#why-now"><i class="fa fa-check"></i>Why now?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-new-modelling-paradigm"><i class="fa fa-check"></i>A new modelling paradigm</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reading-and-link-collection"><i class="fa fa-check"></i>Reading and link collection</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="gettingstarted.html"><a href="gettingstarted.html#learning-objectives-1"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2" data-path="gettingstarted.html"><a href="gettingstarted.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="gettingstarted.html"><a href="gettingstarted.html#working-with-r-and-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Working with R and RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="gettingstarted.html"><a href="gettingstarted.html#r-objects"><i class="fa fa-check"></i><b>1.2.2</b> R objects</a></li>
<li class="chapter" data-level="1.2.3" data-path="gettingstarted.html"><a href="gettingstarted.html#r-environment"><i class="fa fa-check"></i><b>1.2.3</b> R environment</a></li>
<li class="chapter" data-level="1.2.4" data-path="gettingstarted.html"><a href="gettingstarted.html#libraries"><i class="fa fa-check"></i><b>1.2.4</b> Libraries</a></li>
<li class="chapter" data-level="1.2.5" data-path="gettingstarted.html"><a href="gettingstarted.html#r-scripts"><i class="fa fa-check"></i><b>1.2.5</b> R scripts</a></li>
<li class="chapter" data-level="1.2.6" data-path="gettingstarted.html"><a href="gettingstarted.html#rmarkdown"><i class="fa fa-check"></i><b>1.2.6</b> R Markdown</a></li>
<li class="chapter" data-level="1.2.7" data-path="gettingstarted.html"><a href="gettingstarted.html#wspmgmt"><i class="fa fa-check"></i><b>1.2.7</b> Workspace management</a></li>
<li class="chapter" data-level="1.2.8" data-path="gettingstarted.html"><a href="gettingstarted.html#setup"><i class="fa fa-check"></i><b>1.2.8</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="gettingstarted.html"><a href="gettingstarted.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#dimensions-of-a-circle"><i class="fa fa-check"></i>Dimensions of a circle</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#sequence-of-numbers"><i class="fa fa-check"></i>Sequence of numbers</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#gauss-sum"><i class="fa fa-check"></i>Gauss sum</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#magic-trick-algorithm"><i class="fa fa-check"></i>Magic trick algorithm</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#vectors-1"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#data-frames-1"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#workspace"><i class="fa fa-check"></i>Workspace</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programmingprimers.html"><a href="programmingprimers.html"><i class="fa fa-check"></i><b>2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#learning-objectives-2"><i class="fa fa-check"></i><b>2.1</b> Learning objectives</a></li>
<li class="chapter" data-level="2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#programming-basics"><i class="fa fa-check"></i><b>2.2.1</b> Programming basics</a></li>
<li class="chapter" data-level="2.2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#style-your-code"><i class="fa fa-check"></i><b>2.2.2</b> Style your code</a></li>
<li class="chapter" data-level="2.2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#findinghelp"><i class="fa fa-check"></i><b>2.2.3</b> Where to find help</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#exercises-1"><i class="fa fa-check"></i><b>2.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#gauss-variations"><i class="fa fa-check"></i>Gauss variations</a></li>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#nested-loops"><i class="fa fa-check"></i>Nested loops</a></li>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#interpolation"><i class="fa fa-check"></i>Interpolation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datawrangling.html"><a href="datawrangling.html#learning-objectives-3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives</a></li>
<li class="chapter" data-level="3.2" data-path="datawrangling.html"><a href="datawrangling.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datawrangling.html"><a href="datawrangling.html#example-data"><i class="fa fa-check"></i><b>3.2.1</b> Example data</a></li>
<li class="chapter" data-level="3.2.2" data-path="datawrangling.html"><a href="datawrangling.html#tidyverse"><i class="fa fa-check"></i><b>3.2.2</b> Tidyverse</a></li>
<li class="chapter" data-level="3.2.3" data-path="datawrangling.html"><a href="datawrangling.html#reading-tabular-data"><i class="fa fa-check"></i><b>3.2.3</b> Reading tabular data</a></li>
<li class="chapter" data-level="3.2.4" data-path="datawrangling.html"><a href="datawrangling.html#variable-selection"><i class="fa fa-check"></i><b>3.2.4</b> Variable selection</a></li>
<li class="chapter" data-level="3.2.5" data-path="datawrangling.html"><a href="datawrangling.html#time-objects"><i class="fa fa-check"></i><b>3.2.5</b> Time objects</a></li>
<li class="chapter" data-level="3.2.6" data-path="datawrangling.html"><a href="datawrangling.html#variable-re--definition"><i class="fa fa-check"></i><b>3.2.6</b> Variable (re-) definition</a></li>
<li class="chapter" data-level="3.2.7" data-path="datawrangling.html"><a href="datawrangling.html#axes-of-variation"><i class="fa fa-check"></i><b>3.2.7</b> Axes of variation</a></li>
<li class="chapter" data-level="3.2.8" data-path="datawrangling.html"><a href="datawrangling.html#tidydata"><i class="fa fa-check"></i><b>3.2.8</b> Tidy data</a></li>
<li class="chapter" data-level="3.2.9" data-path="datawrangling.html"><a href="datawrangling.html#aggregating-data"><i class="fa fa-check"></i><b>3.2.9</b> Aggregating data</a></li>
<li class="chapter" data-level="3.2.10" data-path="datawrangling.html"><a href="datawrangling.html#data-cleaning"><i class="fa fa-check"></i><b>3.2.10</b> Data cleaning</a></li>
<li class="chapter" data-level="3.2.11" data-path="datawrangling.html"><a href="datawrangling.html#writing-data-to-csv"><i class="fa fa-check"></i><b>3.2.11</b> Writing data to CSV</a></li>
<li class="chapter" data-level="3.2.12" data-path="datawrangling.html"><a href="datawrangling.html#combining-relational-data"><i class="fa fa-check"></i><b>3.2.12</b> Combining relational data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datawrangling.html"><a href="datawrangling.html#extramaterialwrangling"><i class="fa fa-check"></i><b>3.3</b> Extra material</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-i"><i class="fa fa-check"></i><b>3.3.1</b> Functional programming I</a></li>
<li class="chapter" data-level="3.3.2" data-path="datawrangling.html"><a href="datawrangling.html#strings"><i class="fa fa-check"></i><b>3.3.2</b> Strings</a></li>
<li class="chapter" data-level="3.3.3" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-ii"><i class="fa fa-check"></i><b>3.3.3</b> Functional programming II</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datawrangling.html"><a href="datawrangling.html#exerciseswrangling"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#star-wars"><i class="fa fa-check"></i>Star wars</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#aggregating"><i class="fa fa-check"></i>Aggregating</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#patterns-in-data-quality"><i class="fa fa-check"></i>Patterns in data quality</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="datawrangling.html"><a href="datawrangling.html#retidy"><i class="fa fa-check"></i><b>3.5</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#analyzing-changes-in-soil-organic-matter-during-elevated-co_2-experiments"><i class="fa fa-check"></i>Analyzing changes in soil organic matter during elevated CO<span class="math inline">\(_2\)</span> experiments</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#deliverables-for-the-report"><i class="fa fa-check"></i>Deliverables for the report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>4</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="datavis.html"><a href="datavis.html#learning-objectives-4"><i class="fa fa-check"></i><b>4.1</b> Learning objectives</a></li>
<li class="chapter" data-level="4.2" data-path="datavis.html"><a href="datavis.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="datavis.html"><a href="datavis.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.2.1</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.2.2" data-path="datavis.html"><a href="datavis.html#every-data-has-its-representation"><i class="fa fa-check"></i><b>4.2.2</b> Every data has its representation</a></li>
<li class="chapter" data-level="4.2.3" data-path="datavis.html"><a href="datavis.html#writing-to-file"><i class="fa fa-check"></i><b>4.2.3</b> Writing to file</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="datavis.html"><a href="datavis.html#exercises-2"><i class="fa fa-check"></i><b>4.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#spurious-data"><i class="fa fa-check"></i>Spurious data</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#identifying-outliers"><i class="fa fa-check"></i>Identifying Outliers</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#visualising-diurnal-and-seasonal-cycles-of-gpp"><i class="fa fa-check"></i>Visualising diurnal and seasonal cycles of GPP</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#trend-in-carbon-dioxide-concentrations"><i class="fa fa-check"></i>Trend in carbon dioxide concentrations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="datavis.html"><a href="datavis.html#report-exercises"><i class="fa fa-check"></i><b>4.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#telling-a-story-from-data"><i class="fa fa-check"></i>Telling a story from data</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#deliverables-for-the-report-1"><i class="fa fa-check"></i>Deliverables for the report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datavariety.html"><a href="datavariety.html"><i class="fa fa-check"></i><b>5</b> Data variety</a>
<ul>
<li class="chapter" data-level="5.1" data-path="datavariety.html"><a href="datavariety.html#learning-objectives-5"><i class="fa fa-check"></i><b>5.1</b> Learning objectives</a></li>
<li class="chapter" data-level="5.2" data-path="datavariety.html"><a href="datavariety.html#tutorial-4"><i class="fa fa-check"></i><b>5.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats"><i class="fa fa-check"></i><b>5.2.1</b> Files and file formats</a></li>
<li class="chapter" data-level="5.2.2" data-path="datavariety.html"><a href="datavariety.html#meta-data"><i class="fa fa-check"></i><b>5.2.2</b> Meta-data</a></li>
<li class="chapter" data-level="5.2.3" data-path="datavariety.html"><a href="datavariety.html#spatial-data-representation"><i class="fa fa-check"></i><b>5.2.3</b> Spatial data representation</a></li>
<li class="chapter" data-level="5.2.4" data-path="datavariety.html"><a href="datavariety.html#online-data-sources"><i class="fa fa-check"></i><b>5.2.4</b> Online data sources</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="datavariety.html"><a href="datavariety.html#exercises-3"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats-1"><i class="fa fa-check"></i>Files and file formats</a></li>
<li class="chapter" data-level="" data-path="datavariety.html"><a href="datavariety.html#api-use"><i class="fa fa-check"></i>API use</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="openscience.html"><a href="openscience.html"><i class="fa fa-check"></i><b>6</b> Open science practices</a>
<ul>
<li class="chapter" data-level="6.1" data-path="openscience.html"><a href="openscience.html#learning-objectives-6"><i class="fa fa-check"></i><b>6.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.2" data-path="openscience.html"><a href="openscience.html#tutorial-5"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="openscience.html"><a href="openscience.html#project-structure"><i class="fa fa-check"></i><b>6.2.1</b> Project structure</a></li>
<li class="chapter" data-level="6.2.2" data-path="openscience.html"><a href="openscience.html#managing-workflows"><i class="fa fa-check"></i><b>6.2.2</b> Managing workflows</a></li>
<li class="chapter" data-level="6.2.3" data-path="openscience.html"><a href="openscience.html#capturing-your-session-state"><i class="fa fa-check"></i><b>6.2.3</b> Capturing your session state</a></li>
<li class="chapter" data-level="6.2.4" data-path="openscience.html"><a href="openscience.html#capturing-a-system-state"><i class="fa fa-check"></i><b>6.2.4</b> Capturing a system state</a></li>
<li class="chapter" data-level="6.2.5" data-path="openscience.html"><a href="openscience.html#readable-reporting-using-rmarkdown"><i class="fa fa-check"></i><b>6.2.5</b> Readable reporting using Rmarkdown</a></li>
<li class="chapter" data-level="6.2.6" data-path="openscience.html"><a href="openscience.html#project-structure-1"><i class="fa fa-check"></i><b>6.2.6</b> Project structure</a></li>
<li class="chapter" data-level="6.2.7" data-path="openscience.html"><a href="openscience.html#data-retention"><i class="fa fa-check"></i><b>6.2.7</b> Data retention</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="openscience.html"><a href="openscience.html#exercises-4"><i class="fa fa-check"></i><b>6.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#external-data"><i class="fa fa-check"></i>External data</a></li>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#a-new-project"><i class="fa fa-check"></i>A new project</a></li>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#tracking-the-state-of-your-project"><i class="fa fa-check"></i>Tracking the state of your project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="codemgmt.html"><a href="codemgmt.html"><i class="fa fa-check"></i><b>7</b> Code management</a>
<ul>
<li class="chapter" data-level="7.1" data-path="codemgmt.html"><a href="codemgmt.html#learning-objectives-7"><i class="fa fa-check"></i><b>7.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.2" data-path="codemgmt.html"><a href="codemgmt.html#tutorial-6"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="codemgmt.html"><a href="codemgmt.html#gitworkflow"><i class="fa fa-check"></i><b>7.2.1</b> Git and local version control</a></li>
<li class="chapter" data-level="7.2.2" data-path="codemgmt.html"><a href="codemgmt.html#remote-version-control"><i class="fa fa-check"></i><b>7.2.2</b> Remote version control</a></li>
<li class="chapter" data-level="7.2.3" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management---github-templates"><i class="fa fa-check"></i><b>7.2.3</b> Location based code management - github templates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="codemgmt.html"><a href="codemgmt.html#exercises-5"><i class="fa fa-check"></i><b>7.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management"><i class="fa fa-check"></i>Location based code management</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="codemgmt.html"><a href="codemgmt.html#report-exercises-1"><i class="fa fa-check"></i><b>7.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#collaborative-work-on-github"><i class="fa fa-check"></i>Collaborative Work on Github</a></li>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#deliverables-for-the-report-2"><i class="fa fa-check"></i>Deliverables for the report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regressionclassification.html"><a href="regressionclassification.html"><i class="fa fa-check"></i><b>8</b> Regression and classification</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regressionclassification.html"><a href="regressionclassification.html#learning-objectives-8"><i class="fa fa-check"></i><b>8.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.2" data-path="regressionclassification.html"><a href="regressionclassification.html#tutorial-7"><i class="fa fa-check"></i><b>8.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regressionclassification.html"><a href="regressionclassification.html#types-of-models"><i class="fa fa-check"></i><b>8.2.1</b> Types of models</a></li>
<li class="chapter" data-level="8.2.2" data-path="regressionclassification.html"><a href="regressionclassification.html#regression"><i class="fa fa-check"></i><b>8.2.2</b> Regression</a></li>
<li class="chapter" data-level="8.2.3" data-path="regressionclassification.html"><a href="regressionclassification.html#model-selection"><i class="fa fa-check"></i><b>8.2.3</b> Model selection</a></li>
<li class="chapter" data-level="8.2.4" data-path="regressionclassification.html"><a href="regressionclassification.html#outlier-detection"><i class="fa fa-check"></i><b>8.2.4</b> Outlier detection</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regressionclassification.html"><a href="regressionclassification.html#extra-material"><i class="fa fa-check"></i><b>8.3</b> Extra material</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regressionclassification.html"><a href="regressionclassification.html#classification"><i class="fa fa-check"></i><b>8.3.1</b> Classification</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regressionclassification.html"><a href="regressionclassification.html#exercises-6"><i class="fa fa-check"></i><b>8.4</b> Exercises</a></li>
<li class="chapter" data-level="8.5" data-path="regressionclassification.html"><a href="regressionclassification.html#report-exercise"><i class="fa fa-check"></i><b>8.5</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#deliverables-for-the-report-3"><i class="fa fa-check"></i>Deliverables for the report</a></li>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#guide-for-your-implementation"><i class="fa fa-check"></i>Guide for your implementation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="supervisedmli.html"><a href="supervisedmli.html"><i class="fa fa-check"></i><b>9</b> Supervised machine learning I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="supervisedmli.html"><a href="supervisedmli.html#learning-objectives-9"><i class="fa fa-check"></i><b>9.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="supervisedmli.html"><a href="supervisedmli.html#tutorial-8"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="supervisedmli.html"><a href="supervisedmli.html#what-is-supervised-machine-learning"><i class="fa fa-check"></i><b>9.2.1</b> What is supervised machine learning?</a></li>
<li class="chapter" data-level="9.2.2" data-path="supervisedmli.html"><a href="supervisedmli.html#overfitting"><i class="fa fa-check"></i><b>9.2.2</b> Overfitting</a></li>
<li class="chapter" data-level="9.2.3" data-path="supervisedmli.html"><a href="supervisedmli.html#data-and-the-modelling-challenge"><i class="fa fa-check"></i><b>9.2.3</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="9.2.4" data-path="supervisedmli.html"><a href="supervisedmli.html#k-nearest-neighbours"><i class="fa fa-check"></i><b>9.2.4</b> K-nearest neighbours</a></li>
<li class="chapter" data-level="9.2.5" data-path="supervisedmli.html"><a href="supervisedmli.html#model-formulation"><i class="fa fa-check"></i><b>9.2.5</b> Model formulation</a></li>
<li class="chapter" data-level="9.2.6" data-path="supervisedmli.html"><a href="supervisedmli.html#data-splitting"><i class="fa fa-check"></i><b>9.2.6</b> Data splitting</a></li>
<li class="chapter" data-level="9.2.7" data-path="supervisedmli.html"><a href="supervisedmli.html#preprocessing"><i class="fa fa-check"></i><b>9.2.7</b> Pre-processing</a></li>
<li class="chapter" data-level="9.2.8" data-path="supervisedmli.html"><a href="supervisedmli.html#putting-it-all-together-half-way"><i class="fa fa-check"></i><b>9.2.8</b> Putting it all together (half-way)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="supervisedmli.html"><a href="supervisedmli.html#exercises-7"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
<li class="chapter" data-level="9.4" data-path="supervisedmli.html"><a href="supervisedmli.html#report-exercises-2"><i class="fa fa-check"></i><b>9.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmli.html"><a href="supervisedmli.html#comparison-of-the-linear-regression-and-knn-models"><i class="fa fa-check"></i>Comparison of the linear regression and KNN models</a></li>
<li class="chapter" data-level="" data-path="supervisedmli.html"><a href="supervisedmli.html#the-role-of-k"><i class="fa fa-check"></i>The role of k</a></li>
<li class="chapter" data-level="" data-path="supervisedmli.html"><a href="supervisedmli.html#deliverables-for-the-report-4"><i class="fa fa-check"></i>Deliverables for the report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="supervisedmlii.html"><a href="supervisedmlii.html"><i class="fa fa-check"></i><b>10</b> Supervised machine learning II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#learning-objectives-10"><i class="fa fa-check"></i><b>10.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#tutorial-9"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#data-and-the-modelling-challenge-1"><i class="fa fa-check"></i><b>10.2.1</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="10.2.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#training"><i class="fa fa-check"></i><b>10.2.2</b> Loss function</a></li>
<li class="chapter" data-level="10.2.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#hyperparameters"><i class="fa fa-check"></i><b>10.2.3</b> Hyperparameters</a></li>
<li class="chapter" data-level="10.2.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#resampling"><i class="fa fa-check"></i><b>10.2.4</b> Resampling</a></li>
<li class="chapter" data-level="10.2.5" data-path="supervisedmlii.html"><a href="supervisedmlii.html#validation-versus-testing-data"><i class="fa fa-check"></i><b>10.2.5</b> Validation versus testing data</a></li>
<li class="chapter" data-level="10.2.6" data-path="supervisedmlii.html"><a href="supervisedmlii.html#modeling-with-structured-data"><i class="fa fa-check"></i><b>10.2.6</b> Modeling with structured data</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#exercises-8"><i class="fa fa-check"></i><b>10.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmlii.html"><a href="supervisedmlii.html#cross-validation-by-hand"><i class="fa fa-check"></i>Cross-validation by hand</a></li>
<li class="chapter" data-level="10.3.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#cross-validation-vs.-test-error"><i class="fa fa-check"></i><b>10.3.1</b> Cross-validation vs. test error</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#report-exercise-1"><i class="fa fa-check"></i><b>10.4</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmlii.html"><a href="supervisedmlii.html#deliverables-for-the-report-5"><i class="fa fa-check"></i>Deliverables for the report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="randomforest.html"><a href="randomforest.html"><i class="fa fa-check"></i><b>11</b> Random Forest</a>
<ul>
<li class="chapter" data-level="11.1" data-path="randomforest.html"><a href="randomforest.html#learning-objectives-11"><i class="fa fa-check"></i><b>11.1</b> Learning objectives</a></li>
<li class="chapter" data-level="11.2" data-path="randomforest.html"><a href="randomforest.html#tutorial-10"><i class="fa fa-check"></i><b>11.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="randomforest.html"><a href="randomforest.html#decision-trees"><i class="fa fa-check"></i><b>11.2.1</b> Decision trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="randomforest.html"><a href="randomforest.html#bagging"><i class="fa fa-check"></i><b>11.2.2</b> Bagging</a></li>
<li class="chapter" data-level="11.2.3" data-path="randomforest.html"><a href="randomforest.html#from-trees-to-a-forest"><i class="fa fa-check"></i><b>11.2.3</b> From trees to a forest</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="randomforest.html"><a href="randomforest.html#exercises-9"><i class="fa fa-check"></i><b>11.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="randomforest.html"><a href="randomforest.html#fitting-a-random-forest"><i class="fa fa-check"></i>Fitting a Random Forest</a></li>
<li class="chapter" data-level="" data-path="randomforest.html"><a href="randomforest.html#hyperparameter-tuning"><i class="fa fa-check"></i>Hyperparameter tuning</a></li>
<li class="chapter" data-level="" data-path="randomforest.html"><a href="randomforest.html#model-performance"><i class="fa fa-check"></i>Model performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="interpretableml.html"><a href="interpretableml.html"><i class="fa fa-check"></i><b>12</b> Interpretable Machine Learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="interpretableml.html"><a href="interpretableml.html#partial-dependence-plots"><i class="fa fa-check"></i><b>12.1</b> Partial dependence plots</a></li>
<li class="chapter" data-level="12.2" data-path="interpretableml.html"><a href="interpretableml.html#variable-importance-from-permutation"><i class="fa fa-check"></i><b>12.2</b> Variable importance from permutation</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i><b>A</b> Solutions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="solutions.html"><a href="solutions.html#getting-started"><i class="fa fa-check"></i><b>A.1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#dimensions-of-a-circle-1"><i class="fa fa-check"></i>Dimensions of a circle</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#sequence-of-numbers-1"><i class="fa fa-check"></i>Sequence of numbers</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#gauss-sum-1"><i class="fa fa-check"></i>Gauss sum</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#magic-trick-algorithm-1"><i class="fa fa-check"></i>Magic trick algorithm</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#vectors-2"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#data-frames-2"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#workspace-1"><i class="fa fa-check"></i>Workspace</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="solutions.html"><a href="solutions.html#programming-primers"><i class="fa fa-check"></i><b>A.2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#gauss-variations-1"><i class="fa fa-check"></i>Gauss variations</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#nested-loops-1"><i class="fa fa-check"></i>Nested loops</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#interpolation-1"><i class="fa fa-check"></i>Interpolation</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="solutions.html"><a href="solutions.html#data-wrangling"><i class="fa fa-check"></i><b>A.3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#star-wars-1"><i class="fa fa-check"></i>Star wars</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#aggregating-1"><i class="fa fa-check"></i>Aggregating</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#patterns-in-data-quality-1"><i class="fa fa-check"></i>Patterns in data quality</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="solutions.html"><a href="solutions.html#data-visualisation"><i class="fa fa-check"></i><b>A.4</b> Data Visualisation</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#spurious-data-1"><i class="fa fa-check"></i>Spurious data</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#identifying-outliers-1"><i class="fa fa-check"></i>Identifying Outliers</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#visualising-diurnal-and-seasonal-cycles-of-gpp-1"><i class="fa fa-check"></i>Visualising diurnal and seasonal cycles of GPP</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#trend-in-carbon-dioxide-concentrations-1"><i class="fa fa-check"></i>Trend in carbon dioxide concentrations</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="solutions.html"><a href="solutions.html#data-variety"><i class="fa fa-check"></i><b>A.5</b> Data Variety</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#files-and-file-formats-2"><i class="fa fa-check"></i>Files and file formats</a></li>
<li class="chapter" data-level="A.5.1" data-path="solutions.html"><a href="solutions.html#api-use-1"><i class="fa fa-check"></i><b>A.5.1</b> API Use</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="solutions.html"><a href="solutions.html#open-science"><i class="fa fa-check"></i><b>A.6</b> Open Science</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#external-data-1"><i class="fa fa-check"></i>External data</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#a-new-project-1"><i class="fa fa-check"></i>A new project</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#tracking-the-state-of-your-project-1"><i class="fa fa-check"></i>Tracking the state of your project</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="solutions.html"><a href="solutions.html#code-management"><i class="fa fa-check"></i><b>A.7</b> Code Management</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#location-based-code-management-1"><i class="fa fa-check"></i>Location based code management</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="solutions.html"><a href="solutions.html#regression-and-classification"><i class="fa fa-check"></i><b>A.8</b> Regression and Classification</a></li>
<li class="chapter" data-level="A.9" data-path="solutions.html"><a href="solutions.html#supervised-ml-i"><i class="fa fa-check"></i><b>A.9</b> Supervised ML I</a></li>
<li class="chapter" data-level="A.10" data-path="solutions.html"><a href="solutions.html#supervised-ml-ii"><i class="fa fa-check"></i><b>A.10</b> Supervised ML II</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#cross-validation-by-hand-1"><i class="fa fa-check"></i>Cross-validation by hand</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#cross-validation-vs.-test-error-1"><i class="fa fa-check"></i>Cross-validation vs. test error</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="solutions.html"><a href="solutions.html#random-forest"><i class="fa fa-check"></i><b>A.11</b> Random Forest</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#fitting-a-random-forest-1"><i class="fa fa-check"></i>Fitting a Random Forest</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#hyperparameter-tuning-1"><i class="fa fa-check"></i>Hyperparameter tuning</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#model-performance-1"><i class="fa fa-check"></i>Model performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#system-information-and-package-list"><i class="fa fa-check"></i>System information and package list</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Geodata Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="solutions" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">A</span> Solutions<a href="solutions.html#solutions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="getting-started" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">A.1</span> Getting Started<a href="solutions.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="dimensions-of-a-circle-1" class="section level3 unnumbered hasAnchor">
<h3>Dimensions of a circle<a href="solutions.html#dimensions-of-a-circle-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Given the radius of a circle write a few lines of code that calculates its area and its circumference. Run your code with different values assigned of the radius.</li>
</ul>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="solutions.html#cb407-1" aria-hidden="true" tabindex="-1"></a>radius <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb407-2"><a href="solutions.html#cb407-2" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> pi <span class="sc">*</span> radius<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb407-3"><a href="solutions.html#cb407-3" aria-hidden="true" tabindex="-1"></a>circum <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> radius</span></code></pre></div>
<ul>
<li>Print the solution as text.</li>
</ul>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="solutions.html#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Radius:&quot;</span>, radius, <span class="st">&quot;   Circumference:&quot;</span>, circum))</span></code></pre></div>
<pre><code>## [1] &quot;Radius: 1    Circumference: 6.28318530717959&quot;</code></pre>
</div>
<div id="sequence-of-numbers-1" class="section level3 unnumbered hasAnchor">
<h3>Sequence of numbers<a href="solutions.html#sequence-of-numbers-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generate a sequence of numbers from 0 and <span class="math inline">\(\pi\)</span> as a vector with length 5.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="solutions.html#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.0000000 0.7853982 1.5707963 2.3561945 3.1415927</code></pre>
</div>
<div id="gauss-sum-1" class="section level3 unnumbered hasAnchor">
<h3>Gauss sum<a href="solutions.html#gauss-sum-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rumors have it that young Carl Friedrich Gauss was asked in primary school to calculate the sum of all natural numbers between 1 and 100. He did it in his head in no time. We’re very likely not as intelligent as young Gauss. But we have R. What’s the solution?</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="solutions.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Gauss calculated the sum with a trick. The sum of 100 and 1 is 101. The sum of 99 and 2 is 101. You do this 50 times, and you get <span class="math inline">\(50 \times 101\)</span>. Demonstrate Gauss’ trick with vectors in R.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="solutions.html#cb414-1" aria-hidden="true" tabindex="-1"></a>vec_a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb414-2"><a href="solutions.html#cb414-2" aria-hidden="true" tabindex="-1"></a>vec_b <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">:</span><span class="dv">51</span></span>
<span id="cb414-3"><a href="solutions.html#cb414-3" aria-hidden="true" tabindex="-1"></a>vec_c <span class="ot">&lt;-</span> vec_a <span class="sc">+</span> vec_b</span>
<span id="cb414-4"><a href="solutions.html#cb414-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-5"><a href="solutions.html#cb414-5" aria-hidden="true" tabindex="-1"></a><span class="co"># each element is 101</span></span>
<span id="cb414-6"><a href="solutions.html#cb414-6" aria-hidden="true" tabindex="-1"></a>vec_c</span></code></pre></div>
<pre><code>##  [1] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [20] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [39] 101 101 101 101 101 101 101 101 101 101 101 101</code></pre>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="solutions.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the length of vectors is fifty. 50 * 101</span></span>
<span id="cb416-2"><a href="solutions.html#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(vec_c)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
</div>
<div id="magic-trick-algorithm-1" class="section level3 unnumbered hasAnchor">
<h3>Magic trick algorithm<a href="solutions.html#magic-trick-algorithm-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Define a variable named <code>x</code> that contains an integer value and perform the following operations in sequence:</p>
<ul>
<li>Redefine <code>x</code> by adding 1.</li>
<li>Double the resulting number, over-writing <code>x</code>.</li>
<li>Add 4 to <code>x</code> and save the result as <code>x</code>.</li>
<li>Redefine <code>x</code> as half of the previous value of <code>x</code>.</li>
<li>Subtract the originally chosen arbitrary number from <code>x</code>.</li>
</ul>
<p>Print <code>x</code>. Restart the algorithm defined above by choosing a new arbitrary natural number.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="solutions.html#cb418-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">999</span>  <span class="co"># arbitrary integer</span></span>
<span id="cb418-2"><a href="solutions.html#cb418-2" aria-hidden="true" tabindex="-1"></a>x_save <span class="ot">&lt;-</span> x  <span class="co"># save for the last step</span></span>
<span id="cb418-3"><a href="solutions.html#cb418-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb418-4"><a href="solutions.html#cb418-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb418-5"><a href="solutions.html#cb418-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb418-6"><a href="solutions.html#cb418-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb418-7"><a href="solutions.html#cb418-7" aria-hidden="true" tabindex="-1"></a>x <span class="sc">-</span> x_save</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="vectors-2" class="section level3 unnumbered hasAnchor">
<h3>Vectors<a href="solutions.html#vectors-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print the object <code>datasets::rivers</code> and consult the manual of this object.</p>
<ul>
<li>What is the class of the object?</li>
<li>What is the length of the object?</li>
<li>Calculate the mean, median, minimum, maximum, and the 33%-quantile across all values.</li>
</ul>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="solutions.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="solutions.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] 141</code></pre>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="solutions.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] 591.1844</code></pre>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="solutions.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(datasets<span class="sc">::</span>rivers, <span class="at">probs =</span> <span class="fl">0.33</span>)</span></code></pre></div>
<pre><code>## 33% 
## 342</code></pre>
</div>
<div id="data-frames-2" class="section level3 unnumbered hasAnchor">
<h3>Data frames<a href="solutions.html#data-frames-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print the object <code>datasets::quakes</code> and consult the manual of this object.</p>
<ul>
<li>Determine the dimensions of the data frame using the respective function in R.</li>
<li>Extract the vector of values in the data frame that contain information about the Richter Magnitude.</li>
<li>Determine the value largest value in the vector of event magnitudes.</li>
<li>Determine the geographic position of the epicenter of the largest event.</li>
</ul>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="solutions.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datasets<span class="sc">::</span>quakes)</span></code></pre></div>
<pre><code>## [1] 1000    5</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="solutions.html#cb430-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> datasets<span class="sc">::</span>quakes<span class="sc">$</span>mag</span>
<span id="cb430-2"><a href="solutions.html#cb430-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(vec)</span></code></pre></div>
<pre><code>## [1] 6.4</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="solutions.html#cb432-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(vec)  <span class="co"># index of largest value</span></span>
<span id="cb432-2"><a href="solutions.html#cb432-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-3"><a href="solutions.html#cb432-3" aria-hidden="true" tabindex="-1"></a><span class="co"># geographic positions defined by longitude and latitude (columns long and lat)</span></span>
<span id="cb432-4"><a href="solutions.html#cb432-4" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>quakes<span class="sc">$</span>long[idx]</span></code></pre></div>
<pre><code>## [1] 167.62</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="solutions.html#cb434-1" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>quakes<span class="sc">$</span>lat[idx]</span></code></pre></div>
<pre><code>## [1] -15.56</code></pre>
</div>
<div id="workspace-1" class="section level3 unnumbered hasAnchor">
<h3>Workspace<a href="solutions.html#workspace-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
</div>
</div>
<div id="programming-primers" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">A.2</span> Programming primers<a href="solutions.html#programming-primers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="gauss-variations-1" class="section level3 unnumbered hasAnchor">
<h3>Gauss variations<a href="solutions.html#gauss-variations-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="solutions.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for-loop to compute sum from 1 - 100</span></span>
<span id="cb436-2"><a href="solutions.html#cb436-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb436-3"><a href="solutions.html#cb436-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb436-4"><a href="solutions.html#cb436-4" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> i <span class="co"># for-loop iterating from 1 to 100 </span></span>
<span id="cb436-5"><a href="solutions.html#cb436-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb436-6"><a href="solutions.html#cb436-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="solutions.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co"># while-loop to compute sum from 1 - 100</span></span>
<span id="cb438-2"><a href="solutions.html#cb438-2" aria-hidden="true" tabindex="-1"></a>loop_status <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb438-3"><a href="solutions.html#cb438-3" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb438-4"><a href="solutions.html#cb438-4" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb438-5"><a href="solutions.html#cb438-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (loop_status) { <span class="co"># while-loop is repeated as long as loop_status is true</span></span>
<span id="cb438-6"><a href="solutions.html#cb438-6" aria-hidden="true" tabindex="-1"></a>  counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb438-7"><a href="solutions.html#cb438-7" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> counter</span>
<span id="cb438-8"><a href="solutions.html#cb438-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (counter <span class="sc">==</span> <span class="dv">100</span>) loop_status <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb438-9"><a href="solutions.html#cb438-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb438-10"><a href="solutions.html#cb438-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="solutions.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initiate sum variable</span></span>
<span id="cb440-2"><a href="solutions.html#cb440-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb440-3"><a href="solutions.html#cb440-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-4"><a href="solutions.html#cb440-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Go through loop from 1 to 100</span></span>
<span id="cb440-5"><a href="solutions.html#cb440-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">100</span>)) {</span>
<span id="cb440-6"><a href="solutions.html#cb440-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb440-7"><a href="solutions.html#cb440-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the current number a muliple of three and seven</span></span>
<span id="cb440-8"><a href="solutions.html#cb440-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The modulo operator &#39;%%&#39; returns the remainder of a division</span></span>
<span id="cb440-9"><a href="solutions.html#cb440-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">3</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> i <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span> ) {</span>
<span id="cb440-10"><a href="solutions.html#cb440-10" aria-hidden="true" tabindex="-1"></a>        sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> i</span>
<span id="cb440-11"><a href="solutions.html#cb440-11" aria-hidden="true" tabindex="-1"></a>    }   </span>
<span id="cb440-12"><a href="solutions.html#cb440-12" aria-hidden="true" tabindex="-1"></a>}   </span>
<span id="cb440-13"><a href="solutions.html#cb440-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;The sum of multiples of 3 and 7 within 1-100 is: &quot;</span>, sum))</span></code></pre></div>
<pre><code>## [1] &quot;The sum of multiples of 3 and 7 within 1-100 is: 210&quot;</code></pre>
</div>
<div id="nested-loops-1" class="section level3 unnumbered hasAnchor">
<h3>Nested loops<a href="solutions.html#nested-loops-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="solutions.html#cb442-1" aria-hidden="true" tabindex="-1"></a>mymat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">15</span>, <span class="dv">6</span>, <span class="dv">7</span>, </span>
<span id="cb442-2"><a href="solutions.html#cb442-2" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="cn">NA</span>, <span class="dv">3</span>, </span>
<span id="cb442-3"><a href="solutions.html#cb442-3" aria-hidden="true" tabindex="-1"></a>              <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="cn">NA</span>, <span class="dv">6</span>, </span>
<span id="cb442-4"><a href="solutions.html#cb442-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">7</span>)),</span>
<span id="cb442-5"><a href="solutions.html#cb442-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb442-6"><a href="solutions.html#cb442-6" aria-hidden="true" tabindex="-1"></a>myvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">6</span>)</span></code></pre></div>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="solutions.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the rows in `mymat`.</span></span>
<span id="cb443-2"><a href="solutions.html#cb443-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mymat)){</span>
<span id="cb443-3"><a href="solutions.html#cb443-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb443-4"><a href="solutions.html#cb443-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over the columns in `mymat`.</span></span>
<span id="cb443-5"><a href="solutions.html#cb443-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mymat)){</span>
<span id="cb443-6"><a href="solutions.html#cb443-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb443-7"><a href="solutions.html#cb443-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if current value is missing, if so overwrite with max in &#39;myvec&#39;</span></span>
<span id="cb443-8"><a href="solutions.html#cb443-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(mymat[i,j])){</span>
<span id="cb443-9"><a href="solutions.html#cb443-9" aria-hidden="true" tabindex="-1"></a>      mymat[i,j] <span class="ot">&lt;-</span> <span class="fu">max</span>(myvec)</span>
<span id="cb443-10"><a href="solutions.html#cb443-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb443-11"><a href="solutions.html#cb443-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb443-12"><a href="solutions.html#cb443-12" aria-hidden="true" tabindex="-1"></a>  myvec <span class="ot">&lt;-</span> myvec[<span class="sc">-</span><span class="fu">which.max</span>(myvec)] <span class="co"># update the vector removing the maximum value</span></span>
<span id="cb443-13"><a href="solutions.html#cb443-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb443-14"><a href="solutions.html#cb443-14" aria-hidden="true" tabindex="-1"></a>mymat</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
## [1,]    6    7    3   15   15    6    7
## [2,]   12    9   12    6   11   12    3
## [3,]    9    4    7    3   21    9    6
## [4,]    8    8    8    8    8    8    8</code></pre>
</div>
<div id="interpolation-1" class="section level3 unnumbered hasAnchor">
<h3>Interpolation<a href="solutions.html#interpolation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="solutions.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up vector as required in the exercise</span></span>
<span id="cb445-2"><a href="solutions.html#cb445-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>) <span class="co"># initialize vector of length 100 with NA</span></span>
<span id="cb445-3"><a href="solutions.html#cb445-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># populate first 25 elements of &#39;vec&#39; with 6. </span></span>
<span id="cb445-4"><a href="solutions.html#cb445-4" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">66</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">20</span>  <span class="co"># populate elements 66:100 with -20.</span></span>
<span id="cb445-5"><a href="solutions.html#cb445-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-6"><a href="solutions.html#cb445-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine index of last non-missing value before gap</span></span>
<span id="cb445-7"><a href="solutions.html#cb445-7" aria-hidden="true" tabindex="-1"></a>last_non_na <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb445-8"><a href="solutions.html#cb445-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="sc">!</span><span class="fu">is.na</span>(vec[last_non_na<span class="sc">+</span><span class="dv">1</span>])) last_non_na <span class="ot">&lt;-</span> last_non_na <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb445-9"><a href="solutions.html#cb445-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-10"><a href="solutions.html#cb445-10" aria-hidden="true" tabindex="-1"></a><span class="co"># determine index of first non-missing value after gap</span></span>
<span id="cb445-11"><a href="solutions.html#cb445-11" aria-hidden="true" tabindex="-1"></a>first_non_na <span class="ot">&lt;-</span> last_non_na <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb445-12"><a href="solutions.html#cb445-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="fu">is.na</span>(vec[first_non_na])) first_non_na <span class="ot">&lt;-</span> first_non_na <span class="sc">+</span> <span class="dv">1</span>   </span>
<span id="cb445-13"><a href="solutions.html#cb445-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-14"><a href="solutions.html#cb445-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the increment that is needed for interpolation</span></span>
<span id="cb445-15"><a href="solutions.html#cb445-15" aria-hidden="true" tabindex="-1"></a>last_value  <span class="ot">&lt;-</span> vec[last_non_na]  <span class="co"># Last non-NA value</span></span>
<span id="cb445-16"><a href="solutions.html#cb445-16" aria-hidden="true" tabindex="-1"></a>first_value <span class="ot">&lt;-</span> vec[first_non_na] <span class="co"># First non-NA value</span></span>
<span id="cb445-17"><a href="solutions.html#cb445-17" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> (last_value <span class="sc">-</span> first_value) <span class="sc">/</span> (last_non_na <span class="sc">-</span> first_non_na) <span class="co"># Change in y over change in x</span></span>
<span id="cb445-18"><a href="solutions.html#cb445-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-19"><a href="solutions.html#cb445-19" aria-hidden="true" tabindex="-1"></a><span class="co"># fill missing values incrementally</span></span>
<span id="cb445-20"><a href="solutions.html#cb445-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(vec)){</span>
<span id="cb445-21"><a href="solutions.html#cb445-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(vec[i])) vec[i] <span class="ot">&lt;-</span> vec[i<span class="dv">-1</span>] <span class="sc">+</span> delta</span>
<span id="cb445-22"><a href="solutions.html#cb445-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb445-23"><a href="solutions.html#cb445-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-24"><a href="solutions.html#cb445-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vec)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-240-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="solutions.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or short using the approx() function:</span></span>
<span id="cb446-2"><a href="solutions.html#cb446-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>) <span class="co"># initialize vector of length 100 with NA</span></span>
<span id="cb446-3"><a href="solutions.html#cb446-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># populate first 25 elements of &#39;vec&#39; with 6. </span></span>
<span id="cb446-4"><a href="solutions.html#cb446-4" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">66</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">20</span>  <span class="co"># populate elements 66:100 with -20.</span></span>
<span id="cb446-5"><a href="solutions.html#cb446-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-6"><a href="solutions.html#cb446-6" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">approx</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, vec, <span class="at">xout =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb446-7"><a href="solutions.html#cb446-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-8"><a href="solutions.html#cb446-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vec)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-240-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="data-wrangling" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">A.3</span> Data wrangling<a href="solutions.html#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="star-wars-1" class="section level3 unnumbered hasAnchor">
<h3>Star wars<a href="solutions.html#star-wars-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>{dplyr} comes with a toy dataset <code>dplyr::starwars</code> (just type it into the console to see its content). Have a look at the dataset with <code>View()</code>. Play around with the dataset to get familiar with the {tidyverse} coding style. Use (possibly among others) the functions <code>dplyr::filter()</code>, <code>dplyr::arrange()</code>, <code>dplyr::pull()</code>, <code>dplyr::select()</code>, <code>dplyr::desc()</code> and <code>dplyr::slice()</code> to answer the following question:</p>
<ul>
<li>How many pale characters come from the planets Ryloth or Naboo?</li>
</ul>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="solutions.html#cb447-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb447-2"><a href="solutions.html#cb447-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb447-3"><a href="solutions.html#cb447-3" aria-hidden="true" tabindex="-1"></a>    skin_color <span class="sc">==</span> <span class="st">&quot;pale&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb447-4"><a href="solutions.html#cb447-4" aria-hidden="true" tabindex="-1"></a>      (homeworld <span class="sc">==</span> <span class="st">&quot;Naboo&quot;</span> <span class="sc">|</span> homeworld <span class="sc">==</span> <span class="st">&quot;Ryloth&quot;</span>)</span>
<span id="cb447-5"><a href="solutions.html#cb447-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb447-6"><a href="solutions.html#cb447-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()   </span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<ul>
<li>Who is the oldest among the tallest thirty characters?</li>
</ul>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="solutions.html#cb449-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb449-2"><a href="solutions.html#cb449-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(height)) <span class="sc">|&gt;</span> </span>
<span id="cb449-3"><a href="solutions.html#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb449-4"><a href="solutions.html#cb449-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(birth_year) <span class="sc">|&gt;</span> </span>
<span id="cb449-5"><a href="solutions.html#cb449-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb449-6"><a href="solutions.html#cb449-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name)</span></code></pre></div>
<pre><code>## [1] &quot;IG-88&quot;</code></pre>
<ul>
<li>What is the name of the shortest character and their starship in “Return of the Jedi”?</li>
</ul>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="solutions.html#cb451-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb451-2"><a href="solutions.html#cb451-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(films) <span class="sc">|&gt;</span> </span>
<span id="cb451-3"><a href="solutions.html#cb451-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(films <span class="sc">==</span> <span class="st">&quot;Return of the Jedi&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb451-4"><a href="solutions.html#cb451-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(starships) <span class="sc">|&gt;</span> </span>
<span id="cb451-5"><a href="solutions.html#cb451-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(height) <span class="sc">|&gt;</span> </span>
<span id="cb451-6"><a href="solutions.html#cb451-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb451-7"><a href="solutions.html#cb451-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, starships)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   name      starships        
##   &lt;chr&gt;     &lt;chr&gt;            
## 1 Nien Nunb Millennium Falcon</code></pre>
</div>
<div id="aggregating-1" class="section level3 unnumbered hasAnchor">
<h3>Aggregating<a href="solutions.html#aggregating-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have learned about aggregating in the {tidyverse}. Let’s put it in practice.</p>
<ul>
<li>Reuse the code in the tutorial to read, reduce, and aggregate the <code>half_hourly_fluxes</code> dataset to the daily scale, calculating the following metrics across half-hourly <code>VPD_F</code> values within each day: mean, 25% quantile, and 75% quantile.</li>
</ul>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="solutions.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read half hourly fluxes</span></span>
<span id="cb453-2"><a href="solutions.html#cb453-2" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb453-3"><a href="solutions.html#cb453-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv&quot;</span></span>
<span id="cb453-4"><a href="solutions.html#cb453-4" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb453-5"><a href="solutions.html#cb453-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-6"><a href="solutions.html#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only variables that we are interested in</span></span>
<span id="cb453-7"><a href="solutions.html#cb453-7" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb453-8"><a href="solutions.html#cb453-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb453-9"><a href="solutions.html#cb453-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;TIMESTAMP&quot;</span>),</span>
<span id="cb453-10"><a href="solutions.html#cb453-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">&quot;_F&quot;</span>),</span>
<span id="cb453-11"><a href="solutions.html#cb453-11" aria-hidden="true" tabindex="-1"></a>    GPP_NT_VUT_REF,</span>
<span id="cb453-12"><a href="solutions.html#cb453-12" aria-hidden="true" tabindex="-1"></a>    NEE_VUT_REF_QC,</span>
<span id="cb453-13"><a href="solutions.html#cb453-13" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;SWC_F_MDS_&quot;</span>),</span>
<span id="cb453-14"><a href="solutions.html#cb453-14" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;JSB&quot;</span>)</span>
<span id="cb453-15"><a href="solutions.html#cb453-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb453-16"><a href="solutions.html#cb453-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-17"><a href="solutions.html#cb453-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the datetime objects</span></span>
<span id="cb453-18"><a href="solutions.html#cb453-18" aria-hidden="true" tabindex="-1"></a><span class="co"># and aggregate to daily scale</span></span>
<span id="cb453-19"><a href="solutions.html#cb453-19" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span>  </span>
<span id="cb453-20"><a href="solutions.html#cb453-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb453-21"><a href="solutions.html#cb453-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb453-22"><a href="solutions.html#cb453-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb453-23"><a href="solutions.html#cb453-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb453-24"><a href="solutions.html#cb453-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb453-25"><a href="solutions.html#cb453-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(VPD_F),</span>
<span id="cb453-26"><a href="solutions.html#cb453-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">q25  =</span> <span class="fu">quantile</span>(VPD_F, <span class="at">probs =</span> <span class="fl">0.25</span>),</span>
<span id="cb453-27"><a href="solutions.html#cb453-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">q75  =</span> <span class="fu">quantile</span>(VPD_F, <span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb453-28"><a href="solutions.html#cb453-28" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<ul>
<li>Retain only the daily data for which the daily mean VPD is among the upper or the lower 10% quantiles.</li>
</ul>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="solutions.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In two steps. First, get thresholds of the quantiles</span></span>
<span id="cb454-2"><a href="solutions.html#cb454-2" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_fluxes<span class="sc">$</span>mean, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>))</span>
<span id="cb454-3"><a href="solutions.html#cb454-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-4"><a href="solutions.html#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, filter data to be above/below the upper/lower quantiles and combine</span></span>
<span id="cb454-5"><a href="solutions.html#cb454-5" aria-hidden="true" tabindex="-1"></a>daily_fluxes_sub <span class="ot">&lt;-</span> daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb454-6"><a href="solutions.html#cb454-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb454-7"><a href="solutions.html#cb454-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in lower 10% quantile</span></span>
<span id="cb454-8"><a href="solutions.html#cb454-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean <span class="sc">&lt;</span> thresholds[<span class="dv">1</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb454-9"><a href="solutions.html#cb454-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qq =</span> <span class="st">&quot;lower&quot;</span>) <span class="sc">|&gt;</span>   <span class="co"># add label</span></span>
<span id="cb454-10"><a href="solutions.html#cb454-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb454-11"><a href="solutions.html#cb454-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb454-12"><a href="solutions.html#cb454-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb454-13"><a href="solutions.html#cb454-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb454-14"><a href="solutions.html#cb454-14" aria-hidden="true" tabindex="-1"></a>    daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb454-15"><a href="solutions.html#cb454-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># in upper 90% quantile</span></span>
<span id="cb454-16"><a href="solutions.html#cb454-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(mean <span class="sc">&gt;</span> thresholds[<span class="dv">2</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb454-17"><a href="solutions.html#cb454-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">qq =</span> <span class="st">&quot;upper&quot;</span>)</span>
<span id="cb454-18"><a href="solutions.html#cb454-18" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<ul>
<li>Calculate the mean of the 25% and the mean of the 75% quantiles of half-hourly VPD within the upper and lower 10% quantiles of mean daily VPD.</li>
</ul>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="solutions.html#cb455-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_sub <span class="sc">|&gt;</span> </span>
<span id="cb455-2"><a href="solutions.html#cb455-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(qq) <span class="sc">|&gt;</span> </span>
<span id="cb455-3"><a href="solutions.html#cb455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb455-4"><a href="solutions.html#cb455-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">q25_mean =</span> <span class="fu">mean</span>(q25),</span>
<span id="cb455-5"><a href="solutions.html#cb455-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">q75_mean =</span> <span class="fu">mean</span>(q75)</span>
<span id="cb455-6"><a href="solutions.html#cb455-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   qq    q25_mean q75_mean
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 lower   0.0989    0.149
## 2 upper   6.56     15.2</code></pre>
</div>
<div id="patterns-in-data-quality-1" class="section level3 unnumbered hasAnchor">
<h3>Patterns in data quality<a href="solutions.html#patterns-in-data-quality-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The uncleaned dataset <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code> holds half-hourly data that is sometimes of poor quality. Investigate whether NEE data quality is randomly spread across hours in a day by calculating the proportion of (i) actually measured data, (ii) good quality gap-filled data, (iii) medium quality data, and (iv) poor quality data within each hour-of-day (24 hours per day).</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="solutions.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using half_hourly_fluxes read above</span></span>
<span id="cb457-2"><a href="solutions.html#cb457-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb457-3"><a href="solutions.html#cb457-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TIMESTAMP_START =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb457-4"><a href="solutions.html#cb457-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hour_of_day =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb457-5"><a href="solutions.html#cb457-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour_of_day) <span class="sc">|&gt;</span> </span>
<span id="cb457-6"><a href="solutions.html#cb457-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_measured =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb457-7"><a href="solutions.html#cb457-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_good     =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb457-8"><a href="solutions.html#cb457-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_medium   =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb457-9"><a href="solutions.html#cb457-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_poor     =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb457-10"><a href="solutions.html#cb457-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_total    =</span> <span class="fu">n</span>()</span>
<span id="cb457-11"><a href="solutions.html#cb457-11" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb457-12"><a href="solutions.html#cb457-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f_measured =</span> n_measured <span class="sc">/</span> n_total,</span>
<span id="cb457-13"><a href="solutions.html#cb457-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_good     =</span> n_good     <span class="sc">/</span> n_total,</span>
<span id="cb457-14"><a href="solutions.html#cb457-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_medium   =</span> n_medium   <span class="sc">/</span> n_total,</span>
<span id="cb457-15"><a href="solutions.html#cb457-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_poor     =</span> n_poor     <span class="sc">/</span> n_total,</span>
<span id="cb457-16"><a href="solutions.html#cb457-16" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Interpret your findings: Are the proportions evenly spread across hours in a day?</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="solutions.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is not asked for but interesting. More on data visualisation in Chapter 5</span></span>
<span id="cb458-2"><a href="solutions.html#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also just look at values of df$f_measured over the course of a day (hod)  </span></span>
<span id="cb458-3"><a href="solutions.html#cb458-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-4"><a href="solutions.html#cb458-4" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb458-5"><a href="solutions.html#cb458-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(f_measured, f_good, f_medium, f_poor), </span>
<span id="cb458-6"><a href="solutions.html#cb458-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;quality&quot;</span>, </span>
<span id="cb458-7"><a href="solutions.html#cb458-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fraction&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb458-8"><a href="solutions.html#cb458-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour_of_day, </span>
<span id="cb458-9"><a href="solutions.html#cb458-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> fraction <span class="sc">*</span> <span class="dv">100</span>,     <span class="co"># *100 to get percentages </span></span>
<span id="cb458-10"><a href="solutions.html#cb458-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> quality)) <span class="sc">+</span></span>
<span id="cb458-11"><a href="solutions.html#cb458-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span>       <span class="co"># make lines bit bigger</span></span>
<span id="cb458-12"><a href="solutions.html#cb458-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span>                  <span class="co"># Pick a nice theme</span></span>
<span id="cb458-13"><a href="solutions.html#cb458-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(                <span class="co"># Pick a nice color palette</span></span>
<span id="cb458-14"><a href="solutions.html#cb458-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Quality&quot;</span>,                       <span class="co"># Give legend a title</span></span>
<span id="cb458-15"><a href="solutions.html#cb458-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Good gap filled data&quot;</span>, <span class="st">&quot;Measured data&quot;</span>, <span class="st">&quot;Medium gap filled data&quot;</span>, <span class="st">&quot;Poor gap filled data&quot;</span>), <span class="co"># Give legend levels a label</span></span>
<span id="cb458-16"><a href="solutions.html#cb458-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="dv">3</span>,                     <span class="co"># Pick color palette</span></span>
<span id="cb458-17"><a href="solutions.html#cb458-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>                   <span class="co"># Inverse order of color palette</span></span>
<span id="cb458-18"><a href="solutions.html#cb458-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb458-19"><a href="solutions.html#cb458-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb458-20"><a href="solutions.html#cb458-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Temporal pattern of GPP quality&quot;</span>,</span>
<span id="cb458-21"><a href="solutions.html#cb458-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y     =</span> <span class="st">&quot;Fraction of total GPP entries [%]&quot;</span>,</span>
<span id="cb458-22"><a href="solutions.html#cb458-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x     =</span> <span class="st">&quot;Hour of Day&quot;</span></span>
<span id="cb458-23"><a href="solutions.html#cb458-23" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-248-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Perform an aggregation of the half-hourly GPP data (variable <code>GPP_NT_VUT_REF</code>) to daily means of the unmodified data read from file <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code>, and from cleaned data where only measured (not gap-filled) half-hourly data is kept and aggregated. This yields two data frames with daily GPP data. Calculate the overall mean GPP for the two data frames (across all days in the data frame). Are the overall mean GPP values equal? If not, why?</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="solutions.html#cb459-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_all <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb459-2"><a href="solutions.html#cb459-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb459-3"><a href="solutions.html#cb459-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb459-4"><a href="solutions.html#cb459-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)</span>
<span id="cb459-5"><a href="solutions.html#cb459-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb459-6"><a href="solutions.html#cb459-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb459-7"><a href="solutions.html#cb459-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb459-8"><a href="solutions.html#cb459-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb459-9"><a href="solutions.html#cb459-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb459-10"><a href="solutions.html#cb459-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-11"><a href="solutions.html#cb459-11" aria-hidden="true" tabindex="-1"></a>daily_fluxes_cleaned <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb459-12"><a href="solutions.html#cb459-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb459-13"><a href="solutions.html#cb459-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb459-14"><a href="solutions.html#cb459-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)</span>
<span id="cb459-15"><a href="solutions.html#cb459-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb459-16"><a href="solutions.html#cb459-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb459-17"><a href="solutions.html#cb459-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">ifelse</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>, GPP_NT_VUT_REF, <span class="cn">NA</span>)</span>
<span id="cb459-18"><a href="solutions.html#cb459-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb459-19"><a href="solutions.html#cb459-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb459-20"><a href="solutions.html#cb459-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb459-21"><a href="solutions.html#cb459-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb459-22"><a href="solutions.html#cb459-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb459-23"><a href="solutions.html#cb459-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-24"><a href="solutions.html#cb459-24" aria-hidden="true" tabindex="-1"></a><span class="co"># overall means</span></span>
<span id="cb459-25"><a href="solutions.html#cb459-25" aria-hidden="true" tabindex="-1"></a>daily_fluxes_all <span class="sc">|&gt;</span> </span>
<span id="cb459-26"><a href="solutions.html#cb459-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb459-27"><a href="solutions.html#cb459-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb459-28"><a href="solutions.html#cb459-28" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   GPP_NT_VUT_REF
##            &lt;dbl&gt;
## 1           4.20</code></pre>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="solutions.html#cb461-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb461-2"><a href="solutions.html#cb461-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb461-3"><a href="solutions.html#cb461-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb461-4"><a href="solutions.html#cb461-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   GPP_NT_VUT_REF
##            &lt;dbl&gt;
## 1           7.07</code></pre>
<!-- ### Tidying an Excel-file {-} -->
<!-- *No solutions provided because part of the final report* -->
</div>
</div>
<div id="data-visualisation" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">A.4</span> Data Visualisation<a href="solutions.html#data-visualisation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="spurious-data-1" class="section level3 unnumbered hasAnchor">
<h3>Spurious data<a href="solutions.html#spurious-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Section <a href="datawrangling.html#baddata">3.2.10.2</a>, we discovered that certain values of <code>GPP_NT_VUT_REF</code> in the half-hourly data <code>half_hourly_fluxes</code> (to be read from file <code>data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code>) are repeated with a spuriously high frequency. Determine all values of <code>GPP_NT_VUT_REF</code> that appear more than once in <code>half_hourly_fluxes</code> and label them as being “spurious”. Visualise the time series of the first two years of half-hourly GPP, mapping the information whether the data is spurious or not to the <em>color</em> aesthetic.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="solutions.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and wrangle data</span></span>
<span id="cb463-2"><a href="solutions.html#cb463-2" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb463-3"><a href="solutions.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-4"><a href="solutions.html#cb463-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set all -9999 to NA</span></span>
<span id="cb463-5"><a href="solutions.html#cb463-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">na_if</span>(., <span class="sc">-</span><span class="dv">9999</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb463-6"><a href="solutions.html#cb463-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-7"><a href="solutions.html#cb463-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interpret all variables starting with TIMESTAMP as a date-time object</span></span>
<span id="cb463-8"><a href="solutions.html#cb463-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;TIMESTAMP_&quot;</span>)), lubridate<span class="sc">::</span>ymd_hm)</span></code></pre></div>
<pre><code>## Rows: 52608 Columns: 235
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (235): TIMESTAMP_START, TIMESTAMP_END, TA_F_MDS, TA_F_MDS_QC, TA_ERA, TA...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="solutions.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># determine spurious GPP_NT_VUT_REF values as those that are duplicated</span></span>
<span id="cb465-2"><a href="solutions.html#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this creates a logical vector specifying whether the respective row has a </span></span>
<span id="cb465-3"><a href="solutions.html#cb465-3" aria-hidden="true" tabindex="-1"></a><span class="co"># duplicate</span></span>
<span id="cb465-4"><a href="solutions.html#cb465-4" aria-hidden="true" tabindex="-1"></a>vec_spurious <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb465-5"><a href="solutions.html#cb465-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb465-6"><a href="solutions.html#cb465-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># by keeping only one column, duplicated() determines duplications in </span></span>
<span id="cb465-7"><a href="solutions.html#cb465-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># that variable only </span></span>
<span id="cb465-8"><a href="solutions.html#cb465-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GPP_NT_VUT_REF) <span class="sc">|&gt;</span></span>
<span id="cb465-9"><a href="solutions.html#cb465-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">duplicated</span>()</span>
<span id="cb465-10"><a href="solutions.html#cb465-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-11"><a href="solutions.html#cb465-11" aria-hidden="true" tabindex="-1"></a><span class="co"># label spurious half-hourly data</span></span>
<span id="cb465-12"><a href="solutions.html#cb465-12" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb465-13"><a href="solutions.html#cb465-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spurious =</span> vec_spurious)</span>
<span id="cb465-14"><a href="solutions.html#cb465-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-15"><a href="solutions.html#cb465-15" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise</span></span>
<span id="cb465-16"><a href="solutions.html#cb465-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb465-17"><a href="solutions.html#cb465-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> half_hourly_fluxes <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">48</span><span class="sc">*</span><span class="dv">365</span>)),</span>
<span id="cb465-18"><a href="solutions.html#cb465-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> TIMESTAMP_START, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb465-19"><a href="solutions.html#cb465-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb465-20"><a href="solutions.html#cb465-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> spurious), <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb465-21"><a href="solutions.html#cb465-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, </span>
<span id="cb465-22"><a href="solutions.html#cb465-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb465-23"><a href="solutions.html#cb465-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span> <span class="co"># inverse color scale is more intuitive here</span></span>
<span id="cb465-24"><a href="solutions.html#cb465-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-250-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Then aggregate half-hourly to daily data, taking the mean of <code>GPP_NT_VUT_REF</code> and recording the proportion of underlying half-hourly data points that are “spurious”. Visualise the time series of daily <code>GPP_NT_VUT_REF</code> with the color scale indicating the proportion of spurious half-hourly data that was used for determining the respective date’s mean GPP.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="solutions.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate</span></span>
<span id="cb466-2"><a href="solutions.html#cb466-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb466-3"><a href="solutions.html#cb466-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb466-4"><a href="solutions.html#cb466-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb466-5"><a href="solutions.html#cb466-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">frac_spurious =</span> <span class="fu">sum</span>(spurious)<span class="sc">/</span><span class="dv">48</span>,</span>
<span id="cb466-6"><a href="solutions.html#cb466-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb466-7"><a href="solutions.html#cb466-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-8"><a href="solutions.html#cb466-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise</span></span>
<span id="cb466-9"><a href="solutions.html#cb466-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb466-10"><a href="solutions.html#cb466-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes,</span>
<span id="cb466-11"><a href="solutions.html#cb466-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb466-12"><a href="solutions.html#cb466-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb466-13"><a href="solutions.html#cb466-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> frac_spurious), <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb466-14"><a href="solutions.html#cb466-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, </span>
<span id="cb466-15"><a href="solutions.html#cb466-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb466-16"><a href="solutions.html#cb466-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> <span class="co"># inverse color scale is more intuitive here</span></span>
<span id="cb466-17"><a href="solutions.html#cb466-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-251-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="identifying-outliers-1" class="section level3 unnumbered hasAnchor">
<h3>Identifying Outliers<a href="solutions.html#identifying-outliers-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A key part of data cleaning is to detect and understand outliers. Visualisations can help. Your task here is to find outliers in <code>GPP_NT_VUT_REF</code>.</p>
<p>First, using the half-hourly fluxes data, determine “outliers” as those values of <code>GPP_NT_VUT_REF</code> that fall outside <span class="math inline">\(( Q_1 - 1.5 (Q_3 - Q_1)\)</span> to <span class="math inline">\(Q_3 + 1.5 (Q_3 - Q_1)\)</span>. Plot <code>GPP_NT_VUT_REF</code> versus shortwave radiation and highlight outliers in red.</p>
<blockquote>
<p>Hint: Use <code>boxplot.stats()</code> to return a list containing a vector of the data points which lie beyond the extremes of the whiskers of the boxplot.</p>
</blockquote>
<blockquote>
<p>Hint: Use <code>scale_color_manual()</code> to mannually define the color scale.</p>
</blockquote>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="solutions.html#cb467-1" aria-hidden="true" tabindex="-1"></a>vec_outliers <span class="ot">&lt;-</span> <span class="fu">boxplot.stats</span>(half_hourly_fluxes<span class="sc">$</span>GPP_NT_VUT_REF)<span class="sc">$</span>out</span>
<span id="cb467-2"><a href="solutions.html#cb467-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-3"><a href="solutions.html#cb467-3" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb467-4"><a href="solutions.html#cb467-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> GPP_NT_VUT_REF <span class="sc">%in%</span> vec_outliers)</span>
<span id="cb467-5"><a href="solutions.html#cb467-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-6"><a href="solutions.html#cb467-6" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span> </span>
<span id="cb467-7"><a href="solutions.html#cb467-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> outlier)) <span class="sc">+</span> </span>
<span id="cb467-8"><a href="solutions.html#cb467-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb467-9"><a href="solutions.html#cb467-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Outlier?&quot;</span>,                    <span class="co"># Set title of legend</span></span>
<span id="cb467-10"><a href="solutions.html#cb467-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),    <span class="co"># Highlight in red</span></span>
<span id="cb467-11"><a href="solutions.html#cb467-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)        <span class="co"># Add labels to the legend</span></span>
<span id="cb467-12"><a href="solutions.html#cb467-12" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb467-13"><a href="solutions.html#cb467-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb467-14"><a href="solutions.html#cb467-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb467-15"><a href="solutions.html#cb467-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now, we want to “control” for the influence of shortwave radiation on GPP and define outliers with respect to the distribution of <em>residuals</em> of the linear regression between the two variables. Relax the definition of what is considered an outlier by setting adjusting their definition to falling outside <span class="math inline">\(( Q_1 - 5 (Q_3 - Q_1)\)</span> to <span class="math inline">\(Q_3 + 5 (Q_3 - Q_1)\)</span>. Again, plot <code>GPP_NT_VUT_REF</code> versus shortwave radiation and highlight outliers in red.</p>
<blockquote>
<p>Hint: Fit the linear regression model as <code>lm(GPP_NT_VUT_REF ~ SW_IN_F, data = half_hourly_fluxes)</code> and obtain the residuals from the object returned by the <code>lm()</code> function (see ‘Value’ in its help page).</p>
</blockquote>
<blockquote>
<p>Hint: The output of <code>boxplot.stats(x)</code> is a list, containing an element <code>out</code>. <code>out</code> is a named vector of the oulier values with names referring to the row numbers of <code>x</code>. Use <code>as.integer(names(boxplot.stats(x)$out))</code> to get row numbers.</p>
</blockquote>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="solutions.html#cb468-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">lm</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F, <span class="at">data =</span> half_hourly_fluxes)<span class="sc">$</span>residuals</span>
<span id="cb468-2"><a href="solutions.html#cb468-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-3"><a href="solutions.html#cb468-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # unclear why this doesn&#39;t work:</span></span>
<span id="cb468-4"><a href="solutions.html#cb468-4" aria-hidden="true" tabindex="-1"></a><span class="co"># vec_outliers &lt;- boxplot.stats(residuals, coef = 5)$out</span></span>
<span id="cb468-5"><a href="solutions.html#cb468-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_data &lt;- half_hourly_fluxes |&gt; </span></span>
<span id="cb468-6"><a href="solutions.html#cb468-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(outlier = GPP_NT_VUT_REF %in% vec_outliers)</span></span>
<span id="cb468-7"><a href="solutions.html#cb468-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-8"><a href="solutions.html#cb468-8" aria-hidden="true" tabindex="-1"></a><span class="co"># this works:</span></span>
<span id="cb468-9"><a href="solutions.html#cb468-9" aria-hidden="true" tabindex="-1"></a>rowindex_outliers <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">names</span>(<span class="fu">boxplot.stats</span>(residuals, <span class="at">coef =</span> <span class="dv">5</span>)<span class="sc">$</span>out))</span>
<span id="cb468-10"><a href="solutions.html#cb468-10" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb468-11"><a href="solutions.html#cb468-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowindex =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb468-12"><a href="solutions.html#cb468-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> rowindex <span class="sc">%in%</span> rowindex_outliers)</span>
<span id="cb468-13"><a href="solutions.html#cb468-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-14"><a href="solutions.html#cb468-14" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span> </span>
<span id="cb468-15"><a href="solutions.html#cb468-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> outlier)) <span class="sc">+</span> </span>
<span id="cb468-16"><a href="solutions.html#cb468-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb468-17"><a href="solutions.html#cb468-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Outlier?&quot;</span>,                    <span class="co"># Set title of legend</span></span>
<span id="cb468-18"><a href="solutions.html#cb468-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),    <span class="co"># Highlight in red</span></span>
<span id="cb468-19"><a href="solutions.html#cb468-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)        <span class="co"># Add labels to the legend</span></span>
<span id="cb468-20"><a href="solutions.html#cb468-20" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb468-21"><a href="solutions.html#cb468-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb468-22"><a href="solutions.html#cb468-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb468-23"><a href="solutions.html#cb468-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-253-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>What do we see in this plot?</strong> We see that the red points, the outliers, fall outside the main point cloud of green points. The distribution of these outliers seems without systematic pattern or deviation. Nonetheless, it is good practice to go a step further and look at these data points in detail to find out whether they should be removed or not in your analysis. In later Chapters you will learn more on what disproportionate role outliers can play and how they may affect your statistical model and analysis.</p>
</div>
<div id="visualising-diurnal-and-seasonal-cycles-of-gpp-1" class="section level3 unnumbered hasAnchor">
<h3>Visualising diurnal and seasonal cycles of GPP<a href="solutions.html#visualising-diurnal-and-seasonal-cycles-of-gpp-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As explored in the previous Chapter’s exercises, GPP varies over diurnal and seasonal cycles. Create a publication-ready figure that visualises the mean diurnal cycle of GPP for each day-of-year (mean across multiple years). Make sure that the figure is properly labelled, and legible for readers with a color vision deficiency.</p>
<blockquote>
<p>Hint: To get the diurnal and seasonal cycles, summarise the half-hourly data by the hour of the day and the day of the year simultaneously using multiple grouping variables within <code>group_by()</code> and calculate mean values for GPP for each group.</p>
</blockquote>
<blockquote>
<p>Hint: Chose an appropriate visualisation that maps the hour-of-day to the x-axis and the day-of-year to the y-axis.</p>
</blockquote>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="solutions.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to hours-in-day for each day-in-year</span></span>
<span id="cb469-2"><a href="solutions.html#cb469-2" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span>          <span class="co"># df from previous exercise</span></span>
<span id="cb469-3"><a href="solutions.html#cb469-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb469-4"><a href="solutions.html#cb469-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour_day =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(TIMESTAMP_START),     <span class="co"># hour of the day</span></span>
<span id="cb469-5"><a href="solutions.html#cb469-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_year =</span> lubridate<span class="sc">::</span><span class="fu">yday</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span>  <span class="co"># day of the year</span></span>
<span id="cb469-6"><a href="solutions.html#cb469-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(hour_day, day_year) <span class="sc">|&gt;</span>             <span class="co"># multiple grouping</span></span>
<span id="cb469-7"><a href="solutions.html#cb469-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">gpp =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb469-8"><a href="solutions.html#cb469-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-9"><a href="solutions.html#cb469-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Publication-ready raster plot</span></span>
<span id="cb469-10"><a href="solutions.html#cb469-10" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="sc">|&gt;</span> </span>
<span id="cb469-11"><a href="solutions.html#cb469-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-12"><a href="solutions.html#cb469-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify aesthetics</span></span>
<span id="cb469-13"><a href="solutions.html#cb469-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour_day, </span>
<span id="cb469-14"><a href="solutions.html#cb469-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> day_year, </span>
<span id="cb469-15"><a href="solutions.html#cb469-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> gpp)) <span class="sc">+</span>  <span class="co"># fill color of the raster</span></span>
<span id="cb469-16"><a href="solutions.html#cb469-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-17"><a href="solutions.html#cb469-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb469-18"><a href="solutions.html#cb469-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-19"><a href="solutions.html#cb469-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a color scale that works also for color-blind people</span></span>
<span id="cb469-20"><a href="solutions.html#cb469-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span></span>
<span id="cb469-21"><a href="solutions.html#cb469-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-22"><a href="solutions.html#cb469-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust the aspect ratio of the plotting region</span></span>
<span id="cb469-23"><a href="solutions.html#cb469-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="fl">0.18</span>) <span class="sc">+</span></span>
<span id="cb469-24"><a href="solutions.html#cb469-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-25"><a href="solutions.html#cb469-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels of each mapping axis, \n is a line break</span></span>
<span id="cb469-26"><a href="solutions.html#cb469-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Gross primary production&quot;</span>,</span>
<span id="cb469-27"><a href="solutions.html#cb469-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Diurnal and seasonal cycle&quot;</span>,</span>
<span id="cb469-28"><a href="solutions.html#cb469-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Hour of day&quot;</span>, </span>
<span id="cb469-29"><a href="solutions.html#cb469-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Day of year&quot;</span>, </span>
<span id="cb469-30"><a href="solutions.html#cb469-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>))) <span class="sc">+</span> </span>
<span id="cb469-31"><a href="solutions.html#cb469-31" aria-hidden="true" tabindex="-1"></a>                                                               </span>
<span id="cb469-32"><a href="solutions.html#cb469-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-33"><a href="solutions.html#cb469-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># avoid having a small padding from the lowest values to the end of axes</span></span>
<span id="cb469-34"><a href="solutions.html#cb469-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb469-35"><a href="solutions.html#cb469-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-254-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Beautiful, isn’t it? We nicely see that on practically all days of the year we have the diurnal cycle of GPP which follows the sun’s cycle. And throughout a year, we see a rapid increase in GPP in the spring when all trees put out their leaves at once. After a highly productive summer, temperatures drop, sensescence kicks in and GPP gradually drops into its winter low.</p>
</div>
<div id="trend-in-carbon-dioxide-concentrations-1" class="section level3 unnumbered hasAnchor">
<h3>Trend in carbon dioxide concentrations<a href="solutions.html#trend-in-carbon-dioxide-concentrations-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This exercise explores the longest available atmospheric CO<span class="math inline">\(_2\)</span> record, obtained at the Mauna Loa observatory in Hawaii. Atmospheric CO<span class="math inline">\(_2\)</span> in the northern hemisphere is characterised by seasonal swings, caused by the seasonal course of CO<span class="math inline">\(_2\)</span> uptake and release by the terrestrial biosphere. We’ve explored the seasonality of the CO<span class="math inline">\(_2\)</span> uptake measured at one site (in Switzerland) extensively in this an previous chapters. Your task here is to calculate and visualise the long-term trend of CO<span class="math inline">\(_2\)</span>. Follow these steps:</p>
<ul>
<li>Download and read the monthly mean CO2<span class="math inline">\(_2\)</span> data as a CSV file from <a href="https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.csv">here</a> and read it into R.</li>
</ul>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="solutions.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the file</span></span>
<span id="cb470-2"><a href="solutions.html#cb470-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb470-3"><a href="solutions.html#cb470-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.csv&quot;</span>,</span>
<span id="cb470-4"><a href="solutions.html#cb470-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data/co2_mm_mlo.csv&quot;</span></span>
<span id="cb470-5"><a href="solutions.html#cb470-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb470-6"><a href="solutions.html#cb470-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-7"><a href="solutions.html#cb470-7" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb470-8"><a href="solutions.html#cb470-8" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb470-9"><a href="solutions.html#cb470-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data/co2_mm_mlo.csv&quot;</span>,</span>
<span id="cb470-10"><a href="solutions.html#cb470-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">56</span></span>
<span id="cb470-11"><a href="solutions.html#cb470-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb470-12"><a href="solutions.html#cb470-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-13"><a href="solutions.html#cb470-13" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle the data</span></span>
<span id="cb470-14"><a href="solutions.html#cb470-14" aria-hidden="true" tabindex="-1"></a><span class="co"># interpret missing values</span></span>
<span id="cb470-15"><a href="solutions.html#cb470-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename to avoid white space in column name</span></span>
<span id="cb470-16"><a href="solutions.html#cb470-16" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="ot">&lt;-</span> ml_co2 <span class="sc">|&gt;</span></span>
<span id="cb470-17"><a href="solutions.html#cb470-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">na_if</span>(., <span class="sc">-</span><span class="fl">9.99</span>))) <span class="sc">|&gt;</span></span>
<span id="cb470-18"><a href="solutions.html#cb470-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">na_if</span>(., <span class="sc">-</span><span class="fl">0.99</span>))) <span class="sc">|&gt;</span></span>
<span id="cb470-19"><a href="solutions.html#cb470-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">na_if</span>(., <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb470-20"><a href="solutions.html#cb470-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year_dec =</span> <span class="st">`</span><span class="at">decimal date</span><span class="st">`</span>)</span></code></pre></div>
<ul>
<li>Make a simple graph for visualizing the monthly CO<span class="math inline">\(_2\)</span> time series.</li>
</ul>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="solutions.html#cb471-1" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="sc">|&gt;</span> </span>
<span id="cb471-2"><a href="solutions.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb471-3"><a href="solutions.html#cb471-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(year_dec, average))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-256-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Write a function that computes a 12-month running mean of the CO<span class="math inline">\(_2\)</span> time series. The running mean for month <span class="math inline">\(m\)</span> should consider values of <span class="math inline">\(m-5\)</span> to <span class="math inline">\(m+6\)</span>. Define arguments for the function that let the user specify the width of the running mean “box” (i.e., setting the <span class="math inline">\(5\)</span> and <span class="math inline">\(6\)</span> to any other integer of choice)</li>
</ul>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="solutions.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the running mean function</span></span>
<span id="cb472-2"><a href="solutions.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variables are defined as:</span></span>
<span id="cb472-3"><a href="solutions.html#cb472-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Input vector (vec)</span></span>
<span id="cb472-4"><a href="solutions.html#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of elements to the left (left)</span></span>
<span id="cb472-5"><a href="solutions.html#cb472-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of elements to the right (right)</span></span>
<span id="cb472-6"><a href="solutions.html#cb472-6" aria-hidden="true" tabindex="-1"></a>running_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb472-7"><a href="solutions.html#cb472-7" aria-hidden="true" tabindex="-1"></a>    vec,</span>
<span id="cb472-8"><a href="solutions.html#cb472-8" aria-hidden="true" tabindex="-1"></a>    left,</span>
<span id="cb472-9"><a href="solutions.html#cb472-9" aria-hidden="true" tabindex="-1"></a>    right</span>
<span id="cb472-10"><a href="solutions.html#cb472-10" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb472-11"><a href="solutions.html#cb472-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb472-12"><a href="solutions.html#cb472-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty vector of the same length as the input data</span></span>
<span id="cb472-13"><a href="solutions.html#cb472-13" aria-hidden="true" tabindex="-1"></a>  vec_out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(vec))</span>
<span id="cb472-14"><a href="solutions.html#cb472-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb472-15"><a href="solutions.html#cb472-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over each position in the vector</span></span>
<span id="cb472-16"><a href="solutions.html#cb472-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (idx <span class="cf">in</span> (left<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(vec)<span class="sc">-</span>right)){</span>
<span id="cb472-17"><a href="solutions.html#cb472-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb472-18"><a href="solutions.html#cb472-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define start and end of the box to average over</span></span>
<span id="cb472-19"><a href="solutions.html#cb472-19" aria-hidden="true" tabindex="-1"></a>    startbox <span class="ot">&lt;-</span> idx <span class="sc">-</span> left</span>
<span id="cb472-20"><a href="solutions.html#cb472-20" aria-hidden="true" tabindex="-1"></a>    endbox   <span class="ot">&lt;-</span> idx <span class="sc">+</span> right</span>
<span id="cb472-21"><a href="solutions.html#cb472-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb472-22"><a href="solutions.html#cb472-22" aria-hidden="true" tabindex="-1"></a>        vec_out[idx] <span class="ot">&lt;-</span> <span class="fu">mean</span>(vec[startbox<span class="sc">:</span>endbox], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb472-23"><a href="solutions.html#cb472-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb472-24"><a href="solutions.html#cb472-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb472-25"><a href="solutions.html#cb472-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec_out)</span>
<span id="cb472-26"><a href="solutions.html#cb472-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb472-27"><a href="solutions.html#cb472-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-28"><a href="solutions.html#cb472-28" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="ot">&lt;-</span> ml_co2 <span class="sc">|&gt;</span> </span>
<span id="cb472-29"><a href="solutions.html#cb472-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb472-30"><a href="solutions.html#cb472-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_12m =</span> <span class="fu">running_mean</span>(average, <span class="at">left =</span> <span class="dv">5</span>, <span class="at">right =</span> <span class="dv">6</span>)</span>
<span id="cb472-31"><a href="solutions.html#cb472-31" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<ul>
<li>Make a publication-ready figure that shows the monthly and the 12-month running mean time series of the CO<span class="math inline">\(_2\)</span> record.</li>
</ul>
<blockquote>
<p>Hint: To automatically render the time axis with ggplot, you can create a time object by combining the year and month columns: <code>lubridate::ymd(paste(as.character(year), "-", as.character(month), "-15"))</code></p>
</blockquote>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="solutions.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a date object for nice plotting</span></span>
<span id="cb473-2"><a href="solutions.html#cb473-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> ml_co2 <span class="sc">|&gt;</span> </span>
<span id="cb473-3"><a href="solutions.html#cb473-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb473-4"><a href="solutions.html#cb473-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(</span>
<span id="cb473-5"><a href="solutions.html#cb473-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="fu">as.character</span>(year),</span>
<span id="cb473-6"><a href="solutions.html#cb473-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;-&quot;</span>,</span>
<span id="cb473-7"><a href="solutions.html#cb473-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.character</span>(month), <span class="st">&quot;-15&quot;</span>)  <span class="co"># centering monthly mean on the 15th of each month</span></span>
<span id="cb473-8"><a href="solutions.html#cb473-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb473-9"><a href="solutions.html#cb473-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb473-10"><a href="solutions.html#cb473-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-11"><a href="solutions.html#cb473-11" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span></span>
<span id="cb473-12"><a href="solutions.html#cb473-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb473-13"><a href="solutions.html#cb473-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb473-14"><a href="solutions.html#cb473-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># monthly means</span></span>
<span id="cb473-15"><a href="solutions.html#cb473-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb473-16"><a href="solutions.html#cb473-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb473-17"><a href="solutions.html#cb473-17" aria-hidden="true" tabindex="-1"></a>      date,</span>
<span id="cb473-18"><a href="solutions.html#cb473-18" aria-hidden="true" tabindex="-1"></a>      average,</span>
<span id="cb473-19"><a href="solutions.html#cb473-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;Monthly mean&quot;</span></span>
<span id="cb473-20"><a href="solutions.html#cb473-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb473-21"><a href="solutions.html#cb473-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb473-22"><a href="solutions.html#cb473-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb473-23"><a href="solutions.html#cb473-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># running mean</span></span>
<span id="cb473-24"><a href="solutions.html#cb473-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb473-25"><a href="solutions.html#cb473-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb473-26"><a href="solutions.html#cb473-26" aria-hidden="true" tabindex="-1"></a>      date,</span>
<span id="cb473-27"><a href="solutions.html#cb473-27" aria-hidden="true" tabindex="-1"></a>      average_12m,</span>
<span id="cb473-28"><a href="solutions.html#cb473-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;12-month running mean&quot;</span></span>
<span id="cb473-29"><a href="solutions.html#cb473-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb473-30"><a href="solutions.html#cb473-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb473-31"><a href="solutions.html#cb473-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb473-32"><a href="solutions.html#cb473-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the plot</span></span>
<span id="cb473-33"><a href="solutions.html#cb473-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb473-34"><a href="solutions.html#cb473-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb473-35"><a href="solutions.html#cb473-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>) <span class="co"># Move legend into the plot</span></span>
<span id="cb473-36"><a href="solutions.html#cb473-36" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb473-37"><a href="solutions.html#cb473-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb473-38"><a href="solutions.html#cb473-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;</span>, <span class="co"># Omit legend title</span></span>
<span id="cb473-39"><a href="solutions.html#cb473-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb473-40"><a href="solutions.html#cb473-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;12-month running mean&quot;</span>, <span class="st">&quot;Monthly mean&quot;</span>)</span>
<span id="cb473-41"><a href="solutions.html#cb473-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb473-42"><a href="solutions.html#cb473-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb473-43"><a href="solutions.html#cb473-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">expression</span>(</span>
<span id="cb473-44"><a href="solutions.html#cb473-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">&quot;Atmospheric CO&quot;</span>[<span class="dv">2</span>],</span>
<span id="cb473-45"><a href="solutions.html#cb473-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot; concentrations on Manua Lao, Hawaii&quot;</span>)</span>
<span id="cb473-46"><a href="solutions.html#cb473-46" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb473-47"><a href="solutions.html#cb473-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">y     =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; (ppm)&quot;</span>)),</span>
<span id="cb473-48"><a href="solutions.html#cb473-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">x     =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb473-49"><a href="solutions.html#cb473-49" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 11 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-258-1.png" width="672" style="display: block; margin: auto;" /></p>
<!-- ### Telling a story from data {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
</div>
<div id="data-variety" class="section level2 hasAnchor" number="13.5">
<h2><span class="header-section-number">A.5</span> Data Variety<a href="solutions.html#data-variety" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="files-and-file-formats-2" class="section level3 unnumbered hasAnchor">
<h3>Files and file formats<a href="solutions.html#files-and-file-formats-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="reading-and-writing-human-readable-files-1" class="section level4 unnumbered hasAnchor">
<h4>Reading and writing human readable files<a href="solutions.html#reading-and-writing-human-readable-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>While <strong>not leaving your R session</strong>, download and open the files at the following locations:</p>
<blockquote>
<p>The below code shows how to read in the different demo data sets (CSV files). You will note that they all need separate settings, and that a given file extension isn’t necessarily a reflection of the content the file. Inspection of your read in data is therefore key.</p>
</blockquote>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="solutions.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the first demo</span></span>
<span id="cb475-2"><a href="solutions.html#cb475-2" aria-hidden="true" tabindex="-1"></a>demo_01 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb475-3"><a href="solutions.html#cb475-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_1.csv&quot;</span>,</span>
<span id="cb475-4"><a href="solutions.html#cb475-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb475-5"><a href="solutions.html#cb475-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb475-6"><a href="solutions.html#cb475-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb475-7"><a href="solutions.html#cb475-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-8"><a href="solutions.html#cb475-8" aria-hidden="true" tabindex="-1"></a><span class="co"># read in second demo</span></span>
<span id="cb475-9"><a href="solutions.html#cb475-9" aria-hidden="true" tabindex="-1"></a>demo_02 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb475-10"><a href="solutions.html#cb475-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_2.csv&quot;</span>,</span>
<span id="cb475-11"><a href="solutions.html#cb475-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb475-12"><a href="solutions.html#cb475-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb475-13"><a href="solutions.html#cb475-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb475-14"><a href="solutions.html#cb475-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-15"><a href="solutions.html#cb475-15" aria-hidden="true" tabindex="-1"></a>demo_03 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb475-16"><a href="solutions.html#cb475-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_3.csv&quot;</span>,</span>
<span id="cb475-17"><a href="solutions.html#cb475-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb475-18"><a href="solutions.html#cb475-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment.char =</span> <span class="st">&quot;|&quot;</span>,</span>
<span id="cb475-19"><a href="solutions.html#cb475-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb475-20"><a href="solutions.html#cb475-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>All the demo data sets are equal, except for their formatting. We can test if the content is identical by using the <code>identical()</code> function in R.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="solutions.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 1 with 2</span></span>
<span id="cb476-2"><a href="solutions.html#cb476-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(demo_01, demo_02)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="solutions.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 2 with 3</span></span>
<span id="cb478-2"><a href="solutions.html#cb478-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(demo_02, demo_03)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="solutions.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given transitive properties, demo_01 is identical to demo_03</span></span></code></pre></div>
<p>Once loaded into your R environment, combine and save all data as a <strong>temporary</strong> <code>CSV</code> file. Read in the new temporary <code>CSV</code> file, and save it as a <code>JSON</code> file in your current working directory.</p>
<blockquote>
<p>You can combine the three datasets using the {dplyr} <code>bind_rows()</code> function.</p>
</blockquote>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="solutions.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combining all demo datasets</span></span>
<span id="cb481-2"><a href="solutions.html#cb481-2" aria-hidden="true" tabindex="-1"></a>demo_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(demo_01, demo_02, demo_03)</span>
<span id="cb481-3"><a href="solutions.html#cb481-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-4"><a href="solutions.html#cb481-4" aria-hidden="true" tabindex="-1"></a><span class="co"># writing the data to a temporary CSV file</span></span>
<span id="cb481-5"><a href="solutions.html#cb481-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(</span>
<span id="cb481-6"><a href="solutions.html#cb481-6" aria-hidden="true" tabindex="-1"></a>  demo_all, </span>
<span id="cb481-7"><a href="solutions.html#cb481-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb481-8"><a href="solutions.html#cb481-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb481-9"><a href="solutions.html#cb481-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb481-10"><a href="solutions.html#cb481-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb481-11"><a href="solutions.html#cb481-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb481-12"><a href="solutions.html#cb481-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-13"><a href="solutions.html#cb481-13" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb481-14"><a href="solutions.html#cb481-14" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb481-15"><a href="solutions.html#cb481-15" aria-hidden="true" tabindex="-1"></a>  demo_all,</span>
<span id="cb481-16"><a href="solutions.html#cb481-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb481-17"><a href="solutions.html#cb481-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb481-18"><a href="solutions.html#cb481-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb481-19"><a href="solutions.html#cb481-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-20"><a href="solutions.html#cb481-20" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the previous CSV file</span></span>
<span id="cb481-21"><a href="solutions.html#cb481-21" aria-hidden="true" tabindex="-1"></a>demo_all_new <span class="ot">&lt;-</span><span class="fu">read.table</span>(</span>
<span id="cb481-22"><a href="solutions.html#cb481-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb481-23"><a href="solutions.html#cb481-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb481-24"><a href="solutions.html#cb481-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb481-25"><a href="solutions.html#cb481-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb481-26"><a href="solutions.html#cb481-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-27"><a href="solutions.html#cb481-27" aria-hidden="true" tabindex="-1"></a><span class="co"># writing the data to a JSON file</span></span>
<span id="cb481-28"><a href="solutions.html#cb481-28" aria-hidden="true" tabindex="-1"></a>jsonlite<span class="sc">::</span><span class="fu">write_json</span>(demo_all_new, <span class="at">path =</span> <span class="st">&quot;./my_json_file.json&quot;</span>)</span></code></pre></div>
</div>
<div id="reading-and-writing-binary-files-1" class="section level4 unnumbered hasAnchor">
<h4>Reading and writing binary files<a href="solutions.html#reading-and-writing-binary-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Download and open the following file:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb482-1"><a href="solutions.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="ex">https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.nc</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>What file format are we dealing with?</li>
</ol>
<p>It is a NetCDF file (ending <code>.nc</code>, see Table in Chapter <a href="datavariety.html#datavariety">5</a>)</p>
<ol start="2" style="list-style-type: decimal">
<li>What library would you use to read this kind of data?</li>
</ol>
<p>Different libraries are available, including {terra}, {raster} (the predecessor of {terra}), and {ncdf4}, see Table in Chapter <a href="datavariety.html#datavariety">5</a>.</p>
<ol start="3" style="list-style-type: decimal">
<li>What does this file contain?</li>
</ol>
<p>In R:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="solutions.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read unknown netcdf file using the {terra} library</span></span>
<span id="cb483-2"><a href="solutions.html#cb483-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb483-3"><a href="solutions.html#cb483-3" aria-hidden="true" tabindex="-1"></a>unknown_netcdf <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb483-4"><a href="solutions.html#cb483-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.nc&quot;</span></span>
<span id="cb483-5"><a href="solutions.html#cb483-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb483-6"><a href="solutions.html#cb483-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-7"><a href="solutions.html#cb483-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print the meta-data by calling the variable</span></span>
<span id="cb483-8"><a href="solutions.html#cb483-8" aria-hidden="true" tabindex="-1"></a>unknown_netcdf</span>
<span id="cb483-9"><a href="solutions.html#cb483-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-10"><a href="solutions.html#cb483-10" aria-hidden="true" tabindex="-1"></a><span class="co"># visually plot the data</span></span>
<span id="cb483-11"><a href="solutions.html#cb483-11" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_netcdf)</span></code></pre></div>
<p>From your terminal (when the file is located in the current working directory:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb484-1"><a href="solutions.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ncdump</span> <span class="at">-h</span> demo_data.nc</span></code></pre></div>
<p>When printing the object in R, we get: <code>varname     : t2m (2 metre temperature)</code>.</p>
<ol start="4" style="list-style-type: decimal">
<li>Write this file to disk in a different geospatial format you desire (use the R documentation of the library used to read the file and the chapter information).</li>
</ol>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="solutions.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the data as a geotiff (other options are possible as well in writeRaster)</span></span>
<span id="cb485-2"><a href="solutions.html#cb485-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb485-3"><a href="solutions.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  unknown_netcdf,</span>
<span id="cb485-4"><a href="solutions.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;./test.tif&quot;</span>,</span>
<span id="cb485-5"><a href="solutions.html#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb485-6"><a href="solutions.html#cb485-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Download and open the following file: <code>https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.tif</code>. Does this data seem familiar, and how can you tell? What are your conclusions?</li>
</ol>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="solutions.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read unknown tif file using the {terra} library</span></span>
<span id="cb486-2"><a href="solutions.html#cb486-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb486-3"><a href="solutions.html#cb486-3" aria-hidden="true" tabindex="-1"></a>unknown_tif <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb486-4"><a href="solutions.html#cb486-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.tif&quot;</span></span>
<span id="cb486-5"><a href="solutions.html#cb486-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb486-6"><a href="solutions.html#cb486-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-7"><a href="solutions.html#cb486-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print the meta-data by calling the variable</span></span>
<span id="cb486-8"><a href="solutions.html#cb486-8" aria-hidden="true" tabindex="-1"></a>unknown_tif</span>
<span id="cb486-9"><a href="solutions.html#cb486-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-10"><a href="solutions.html#cb486-10" aria-hidden="true" tabindex="-1"></a><span class="co"># visually plot the data</span></span>
<span id="cb486-11"><a href="solutions.html#cb486-11" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_tif)</span>
<span id="cb486-12"><a href="solutions.html#cb486-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-13"><a href="solutions.html#cb486-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Are they exactly the same</span></span>
<span id="cb486-14"><a href="solutions.html#cb486-14" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_tif <span class="sc">-</span> unknown_netcdf)</span>
<span id="cb486-15"><a href="solutions.html#cb486-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-16"><a href="solutions.html#cb486-16" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb486-17"><a href="solutions.html#cb486-17" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(unknown_netcdf, unknown_tif)</span></code></pre></div>
<p>Looks similar to the NetCDF data, but temperature appears to be given in Celsius in the GeoTIFF file and in Kelvin in the NetCDF file.</p>
</div>
</div>
<div id="api-use-1" class="section level3 hasAnchor" number="13.5.1">
<h3><span class="header-section-number">A.5.1</span> API Use<a href="solutions.html#api-use-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="get-2" class="section level4 hasAnchor" number="13.5.1.1">
<h4><span class="header-section-number">A.5.1.1</span> Get<a href="solutions.html#get-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We can get the total sand content using the tutorial using new coodinates outlining Switzerland.</li>
</ol>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="solutions.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set API URL endpoint</span></span>
<span id="cb487-2"><a href="solutions.html#cb487-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for the total sand content</span></span>
<span id="cb487-3"><a href="solutions.html#cb487-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://thredds.daac.ornl.gov/thredds/ncss/ornldaac/1247/T_SAND.nc4&quot;</span></span>
<span id="cb487-4"><a href="solutions.html#cb487-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-5"><a href="solutions.html#cb487-5" aria-hidden="true" tabindex="-1"></a><span class="co"># formulate query to pass to httr</span></span>
<span id="cb487-6"><a href="solutions.html#cb487-6" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb487-7"><a href="solutions.html#cb487-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="st">&quot;T_SAND&quot;</span>,</span>
<span id="cb487-8"><a href="solutions.html#cb487-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;south&quot;</span> <span class="ot">=</span> <span class="fl">45.5</span>,</span>
<span id="cb487-9"><a href="solutions.html#cb487-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;west&quot;</span> <span class="ot">=</span>  <span class="fl">5.9</span>,</span>
<span id="cb487-10"><a href="solutions.html#cb487-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;east&quot;</span> <span class="ot">=</span>  <span class="fl">10.7</span>,</span>
<span id="cb487-11"><a href="solutions.html#cb487-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;north&quot;</span> <span class="ot">=</span> <span class="dv">48</span>,</span>
<span id="cb487-12"><a href="solutions.html#cb487-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;disableProjSubset&quot;</span> <span class="ot">=</span> <span class="st">&quot;on&quot;</span>,</span>
<span id="cb487-13"><a href="solutions.html#cb487-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;horizStride&quot;</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb487-14"><a href="solutions.html#cb487-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;accept&quot;</span> <span class="ot">=</span> <span class="st">&quot;netcdf4&quot;</span></span>
<span id="cb487-15"><a href="solutions.html#cb487-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb487-16"><a href="solutions.html#cb487-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-17"><a href="solutions.html#cb487-17" aria-hidden="true" tabindex="-1"></a><span class="co"># download data using the</span></span>
<span id="cb487-18"><a href="solutions.html#cb487-18" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint and query data</span></span>
<span id="cb487-19"><a href="solutions.html#cb487-19" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(</span>
<span id="cb487-20"><a href="solutions.html#cb487-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> url,</span>
<span id="cb487-21"><a href="solutions.html#cb487-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> query,</span>
<span id="cb487-22"><a href="solutions.html#cb487-22" aria-hidden="true" tabindex="-1"></a>  httr<span class="sc">::</span><span class="fu">write_disk</span>(</span>
<span id="cb487-23"><a href="solutions.html#cb487-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;T_SAND.nc&quot;</span>),</span>
<span id="cb487-24"><a href="solutions.html#cb487-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb487-25"><a href="solutions.html#cb487-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb487-26"><a href="solutions.html#cb487-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb487-27"><a href="solutions.html#cb487-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-28"><a href="solutions.html#cb487-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to visualize the data</span></span>
<span id="cb487-29"><a href="solutions.html#cb487-29" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to load the {terra}</span></span>
<span id="cb487-30"><a href="solutions.html#cb487-30" aria-hidden="true" tabindex="-1"></a><span class="co"># library</span></span>
<span id="cb487-31"><a href="solutions.html#cb487-31" aria-hidden="true" tabindex="-1"></a>sand <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;T_SAND.nc&quot;</span>))</span>
<span id="cb487-32"><a href="solutions.html#cb487-32" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(sand)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-265-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Consulting the original data pages or the package help files one can determine that the parameter “T_SAND” needs to be replaced by “T_SILT” in both the URL and the query.</li>
</ol>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="solutions.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set API URL endpoint</span></span>
<span id="cb488-2"><a href="solutions.html#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for the total sand content</span></span>
<span id="cb488-3"><a href="solutions.html#cb488-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://thredds.daac.ornl.gov/thredds/ncss/ornldaac/1247/T_SILT.nc4&quot;</span></span>
<span id="cb488-4"><a href="solutions.html#cb488-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-5"><a href="solutions.html#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="co"># formulate query to pass to httr</span></span>
<span id="cb488-6"><a href="solutions.html#cb488-6" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb488-7"><a href="solutions.html#cb488-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="st">&quot;T_SILT&quot;</span>,</span>
<span id="cb488-8"><a href="solutions.html#cb488-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;south&quot;</span> <span class="ot">=</span> <span class="fl">45.5</span>,</span>
<span id="cb488-9"><a href="solutions.html#cb488-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;west&quot;</span> <span class="ot">=</span>  <span class="fl">5.9</span>,</span>
<span id="cb488-10"><a href="solutions.html#cb488-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;east&quot;</span> <span class="ot">=</span>  <span class="fl">10.7</span>,</span>
<span id="cb488-11"><a href="solutions.html#cb488-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;north&quot;</span> <span class="ot">=</span> <span class="dv">48</span>,</span>
<span id="cb488-12"><a href="solutions.html#cb488-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;disableProjSubset&quot;</span> <span class="ot">=</span> <span class="st">&quot;on&quot;</span>,</span>
<span id="cb488-13"><a href="solutions.html#cb488-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;horizStride&quot;</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb488-14"><a href="solutions.html#cb488-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;accept&quot;</span> <span class="ot">=</span> <span class="st">&quot;netcdf4&quot;</span></span>
<span id="cb488-15"><a href="solutions.html#cb488-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb488-16"><a href="solutions.html#cb488-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-17"><a href="solutions.html#cb488-17" aria-hidden="true" tabindex="-1"></a><span class="co"># download data using the</span></span>
<span id="cb488-18"><a href="solutions.html#cb488-18" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint and query data</span></span>
<span id="cb488-19"><a href="solutions.html#cb488-19" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(</span>
<span id="cb488-20"><a href="solutions.html#cb488-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> url,</span>
<span id="cb488-21"><a href="solutions.html#cb488-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> query,</span>
<span id="cb488-22"><a href="solutions.html#cb488-22" aria-hidden="true" tabindex="-1"></a>  httr<span class="sc">::</span><span class="fu">write_disk</span>(</span>
<span id="cb488-23"><a href="solutions.html#cb488-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;T_SAND.nc&quot;</span>),</span>
<span id="cb488-24"><a href="solutions.html#cb488-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb488-25"><a href="solutions.html#cb488-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb488-26"><a href="solutions.html#cb488-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb488-27"><a href="solutions.html#cb488-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-28"><a href="solutions.html#cb488-28" aria-hidden="true" tabindex="-1"></a><span class="co"># to visualize the data</span></span>
<span id="cb488-29"><a href="solutions.html#cb488-29" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to load the {terra}</span></span>
<span id="cb488-30"><a href="solutions.html#cb488-30" aria-hidden="true" tabindex="-1"></a><span class="co"># library</span></span>
<span id="cb488-31"><a href="solutions.html#cb488-31" aria-hidden="true" tabindex="-1"></a>sand <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;T_SAND.nc&quot;</span>))</span>
<span id="cb488-32"><a href="solutions.html#cb488-32" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(sand)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-266-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="dedicated-libraries" class="section level4 hasAnchor" number="13.5.1.2">
<h4><span class="header-section-number">A.5.1.2</span> Dedicated libraries<a href="solutions.html#dedicated-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol start="2" style="list-style-type: decimal">
<li>Using the {hwsdr} package this simplifies to:</li>
</ol>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="solutions.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download a soil fraction map</span></span>
<span id="cb489-2"><a href="solutions.html#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of sand for a given bounding box</span></span>
<span id="cb489-3"><a href="solutions.html#cb489-3" aria-hidden="true" tabindex="-1"></a>hwsdr<span class="sc">::</span><span class="fu">ws_subset</span>(</span>
<span id="cb489-4"><a href="solutions.html#cb489-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">location =</span> <span class="fu">c</span>(<span class="fl">45.5</span>, <span class="fl">5.9</span>, <span class="dv">48</span>, <span class="fl">10.7</span>),</span>
<span id="cb489-5"><a href="solutions.html#cb489-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;T_SAND&quot;</span>,</span>
<span id="cb489-6"><a href="solutions.html#cb489-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb489-7"><a href="solutions.html#cb489-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 51, 97, 4947, 1  (nrow, ncol, ncell, nlayers)
## resolution : 0.05, 0.05  (x, y)
## extent     : 5.9, 10.75, 45.5, 48.05  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 
## names      : topsoil.sand.fraction.by.percent.weight</code></pre>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="solutions.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to visualize the data</span></span>
<span id="cb491-2"><a href="solutions.html#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to load the {terra}</span></span>
<span id="cb491-3"><a href="solutions.html#cb491-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library</span></span>
<span id="cb491-4"><a href="solutions.html#cb491-4" aria-hidden="true" tabindex="-1"></a>sand <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;T_SAND.nc&quot;</span>))</span>
<span id="cb491-5"><a href="solutions.html#cb491-5" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(sand)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-267-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>You can easily list all {MODISTools} products using:</li>
</ol>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="solutions.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list all products</span></span>
<span id="cb492-2"><a href="solutions.html#cb492-2" aria-hidden="true" tabindex="-1"></a>products <span class="ot">&lt;-</span> MODISTools<span class="sc">::</span><span class="fu">mt_products</span>()</span>
<span id="cb492-3"><a href="solutions.html#cb492-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-4"><a href="solutions.html#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We count</span></span>
<span id="cb492-5"><a href="solutions.html#cb492-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(products)</span></code></pre></div>
<pre><code>## [1] 47</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>You can use the {MODISTools} package to easily query the land cover data. Use the <code>MODISTools::mt_products()</code> and <code>MODISTools::mt_bands()</code> functions to determine products to use (i.e. MCD12Q1). Note that MODISTools does not use a bounding box but km left/right and top/bottom - an approximation is therefore good enough.</li>
</ol>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="solutions.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download land cover data (for a single year to speed things up)</span></span>
<span id="cb494-2"><a href="solutions.html#cb494-2" aria-hidden="true" tabindex="-1"></a>land_cover <span class="ot">&lt;-</span> MODISTools<span class="sc">::</span><span class="fu">mt_subset</span>(</span>
<span id="cb494-3"><a href="solutions.html#cb494-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">product =</span> <span class="st">&quot;MCD12Q1&quot;</span>,</span>
<span id="cb494-4"><a href="solutions.html#cb494-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">site_name =</span> <span class="st">&quot;Swiss&quot;</span>,</span>
<span id="cb494-5"><a href="solutions.html#cb494-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fl">46.6756</span>,</span>
<span id="cb494-6"><a href="solutions.html#cb494-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon =</span> <span class="fl">7.85480</span>,</span>
<span id="cb494-7"><a href="solutions.html#cb494-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">band =</span> <span class="st">&quot;LC_Type1&quot;</span>,</span>
<span id="cb494-8"><a href="solutions.html#cb494-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="st">&quot;2012-01-01&quot;</span>,</span>
<span id="cb494-9"><a href="solutions.html#cb494-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">end =</span> <span class="st">&quot;2012-12-31&quot;</span>,</span>
<span id="cb494-10"><a href="solutions.html#cb494-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">km_lr =</span> <span class="dv">50</span>,</span>
<span id="cb494-11"><a href="solutions.html#cb494-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">km_ab =</span> <span class="dv">50</span>,</span>
<span id="cb494-12"><a href="solutions.html#cb494-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">internal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb494-13"><a href="solutions.html#cb494-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">TRUE</span></span>
<span id="cb494-14"><a href="solutions.html#cb494-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Downloading chunks:</code></pre>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="solutions.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to a raster map for plotting</span></span>
<span id="cb497-2"><a href="solutions.html#cb497-2" aria-hidden="true" tabindex="-1"></a>land_cover <span class="ot">&lt;-</span> MODISTools<span class="sc">::</span><span class="fu">mt_to_terra</span>(land_cover)</span>
<span id="cb497-3"><a href="solutions.html#cb497-3" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(land_cover)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-269-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="open-science" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">A.6</span> Open Science<a href="solutions.html#open-science" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="external-data-1" class="section level3 unnumbered hasAnchor">
<h3>External data<a href="solutions.html#external-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The project data is stored in one folder without folders to sort data from code to give it structure.</p>
<p>The project can be re-organized using a simple project structure as such:</p>
<pre><code>~/project/
├─ data/
     ├─ 00_convert_data.R
     ├─ survey.xlsx # the original
     ├─ survey.csv # from (xls conversion (copy 1).csv)
├─ R/
     ├─ my_functions.R
├─ analysis/
     ├─ 00_model_fits.R # from Model-test-final.R
     ├─ 01_model_plots.R # from Plots.R
├─ vignettes/
     ├─ Report.Rmd
├─ manuscript/
     ├─ Report.html
     ├─ Figure 1.png</code></pre>
<p>Note that duplicate files are removed, code to cleanup data is numbered and stored with the data, functions which are accessible for analysis are stored in the <code>./R/</code> folder, Rmarkdown files are stored in the <code>vignettes</code> folder and the results of the full analysis is stored in a <code>manuscript</code> folder. Some variations on naming is possible.</p>
</div>
<div id="a-new-project-1" class="section level3 unnumbered hasAnchor">
<h3>A new project<a href="solutions.html#a-new-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This exercise trains your ability to access and wrangle data yourself in a reproducible way. The best solution to test whether you successfully did so is by letting a friend run all of your code on their machine. Resolving the errors you may encounter helps you to improve your workflow and ensures a streamlined submission of your final report.</p>
</div>
<div id="tracking-the-state-of-your-project-1" class="section level3 unnumbered hasAnchor">
<h3>Tracking the state of your project<a href="solutions.html#tracking-the-state-of-your-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For your new project created above run {renv} by following the tutorial outline.</p>
<p>In short, in the main project run all project code (or load all require libraries) and execute:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="solutions.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initiate a local index of used libraries</span></span>
<span id="cb499-2"><a href="solutions.html#cb499-2" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()</span>
<span id="cb499-3"><a href="solutions.html#cb499-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-4"><a href="solutions.html#cb499-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a snapshot of all used libraries</span></span>
<span id="cb499-5"><a href="solutions.html#cb499-5" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">snapshot</span>()</span></code></pre></div>
<p>You should now find an <code>renv</code> folder in your project as well as an <code>renv.lock</code> file.</p>
</div>
</div>
<div id="code-management" class="section level2 hasAnchor" number="13.7">
<h2><span class="header-section-number">A.7</span> Code Management<a href="solutions.html#code-management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="location-based-code-management-1" class="section level3 unnumbered hasAnchor">
<h3>Location based code management<a href="solutions.html#location-based-code-management-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
<!-- ### Collaborative Work on Github {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
</div>
<div id="regression-and-classification" class="section level2 hasAnchor" number="13.8">
<h2><span class="header-section-number">A.8</span> Regression and Classification<a href="solutions.html#regression-and-classification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- ### Stepwise regression and asking for help {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
<div id="supervised-ml-i" class="section level2 hasAnchor" number="13.9">
<h2><span class="header-section-number">A.9</span> Supervised ML I<a href="solutions.html#supervised-ml-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>No solutions provided</em></p>
<!-- ### Comparison of LM and KNN {-} -->
<!-- *No solutions provided because part of the final report.* -->
<!-- ### The role of picking a hyperparameter {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
<div id="supervised-ml-ii" class="section level2 hasAnchor" number="13.10">
<h2><span class="header-section-number">A.10</span> Supervised ML II<a href="solutions.html#supervised-ml-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="cross-validation-by-hand-1" class="section level3 unnumbered hasAnchor">
<h3>Cross-validation by hand<a href="solutions.html#cross-validation-by-hand-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the tutorial we “built on shoulder of giants” - people that went through the struggle of writing a robust package to implement a cross validation. Although we can and should use such packages, we still have to understand how a cross validation works in detail.</p>
<p>Write a function that implements <em>n</em>-fold cross-validation for KNN with <span class="math inline">\(k=30\)</span>. (We write ‘n-fold CV’ here to avoid confusion with the k in KNN, but mean the same as described in Section <a href="supervisedmlii.html#resampling">10.2.4</a>.) The function should take as arguments the training data object, <em>n</em> for specifying the number of folds (use <span class="math inline">\(n=60\)</span>), the name of the target variable, the names of the predictor variables as a character vector, and the <span class="math inline">\(k\)</span> for KNN. The function should return a vector of length <em>n</em>, containing the MAE evaluated on the <em>n</em> folds. To randomize the split of data points into folds, first “re-shuffle” the rows in the training data as part of the function. Centering and scaling of the training and validation data should be applied manually before getting the KNN model object within each fold.</p>
<p>As data, use daily ecosystem flux data from <a href="./data/df_daily_exercise_supervisedmlii.csv">here</a>. As target variable, use <code>"GPP_NT_VUT_REF"</code>. As predictor variables, use <code>c("TA_F", "SW_IN_F", "VPD_F")</code>.</p>
<p>Visualise the distribution of the validation errors (MAE) across folds.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="solutions.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data provided for this exercise</span></span>
<span id="cb500-2"><a href="solutions.html#cb500-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/df_daily_exercise_supervisedmlii.csv&quot;</span>)</span>
<span id="cb500-3"><a href="solutions.html#cb500-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-4"><a href="solutions.html#cb500-4" aria-hidden="true" tabindex="-1"></a>nam_target <span class="ot">&lt;-</span> <span class="st">&quot;GPP_NT_VUT_REF&quot;</span></span>
<span id="cb500-5"><a href="solutions.html#cb500-5" aria-hidden="true" tabindex="-1"></a>nams_predictors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;TA_F&quot;</span>, <span class="st">&quot;SW_IN_F&quot;</span>, <span class="st">&quot;VPD_F&quot;</span>)</span>
<span id="cb500-6"><a href="solutions.html#cb500-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-7"><a href="solutions.html#cb500-7" aria-hidden="true" tabindex="-1"></a><span class="co"># function returning the MAE for each fold, given the indices of the </span></span>
<span id="cb500-8"><a href="solutions.html#cb500-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rows to be used as the validation set.</span></span>
<span id="cb500-9"><a href="solutions.html#cb500-9" aria-hidden="true" tabindex="-1"></a>get_mae_byfold <span class="ot">&lt;-</span> <span class="cf">function</span>(df,              </span>
<span id="cb500-10"><a href="solutions.html#cb500-10" aria-hidden="true" tabindex="-1"></a>                           idx_fold,        <span class="co"># row indices for validation set</span></span>
<span id="cb500-11"><a href="solutions.html#cb500-11" aria-hidden="true" tabindex="-1"></a>                           nam_target,      <span class="co"># character string for target variables</span></span>
<span id="cb500-12"><a href="solutions.html#cb500-12" aria-hidden="true" tabindex="-1"></a>                           nams_predictors, <span class="co"># vector of character strings for predictors</span></span>
<span id="cb500-13"><a href="solutions.html#cb500-13" aria-hidden="true" tabindex="-1"></a>                           use_k            <span class="co"># k for KNN</span></span>
<span id="cb500-14"><a href="solutions.html#cb500-14" aria-hidden="true" tabindex="-1"></a>                           ){</span>
<span id="cb500-15"><a href="solutions.html#cb500-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-16"><a href="solutions.html#cb500-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># validation set</span></span>
<span id="cb500-17"><a href="solutions.html#cb500-17" aria-hidden="true" tabindex="-1"></a>  df_valid <span class="ot">&lt;-</span> df[idx_fold, <span class="fu">c</span>(nam_target, nams_predictors)]</span>
<span id="cb500-18"><a href="solutions.html#cb500-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-19"><a href="solutions.html#cb500-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remaining training set</span></span>
<span id="cb500-20"><a href="solutions.html#cb500-20" aria-hidden="true" tabindex="-1"></a>  df_train <span class="ot">&lt;-</span> df[<span class="sc">-</span>idx_fold, <span class="fu">c</span>(nam_target, nams_predictors)]</span>
<span id="cb500-21"><a href="solutions.html#cb500-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-22"><a href="solutions.html#cb500-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># center and scale based on training data parameters</span></span>
<span id="cb500-23"><a href="solutions.html#cb500-23" aria-hidden="true" tabindex="-1"></a>  mean_byvar <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb500-24"><a href="solutions.html#cb500-24" aria-hidden="true" tabindex="-1"></a>  sd_byvar <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb500-25"><a href="solutions.html#cb500-25" aria-hidden="true" tabindex="-1"></a>  df_train_cs <span class="ot">&lt;-</span> df_train <span class="sc">*</span> <span class="cn">NA</span></span>
<span id="cb500-26"><a href="solutions.html#cb500-26" aria-hidden="true" tabindex="-1"></a>  df_valid_cs <span class="ot">&lt;-</span> df_valid <span class="sc">*</span> <span class="cn">NA</span></span>
<span id="cb500-27"><a href="solutions.html#cb500-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-28"><a href="solutions.html#cb500-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># center and scale each predictor</span></span>
<span id="cb500-29"><a href="solutions.html#cb500-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ivar <span class="cf">in</span> nams_predictors){</span>
<span id="cb500-30"><a href="solutions.html#cb500-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb500-31"><a href="solutions.html#cb500-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># determine mean and sd for centering and scaling</span></span>
<span id="cb500-32"><a href="solutions.html#cb500-32" aria-hidden="true" tabindex="-1"></a>    mean_byvar[ivar]   <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_train[,ivar], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb500-33"><a href="solutions.html#cb500-33" aria-hidden="true" tabindex="-1"></a>    sd_byvar[ivar]     <span class="ot">&lt;-</span> <span class="fu">sd</span>(df_train[,ivar], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb500-34"><a href="solutions.html#cb500-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb500-35"><a href="solutions.html#cb500-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># center and scale training data</span></span>
<span id="cb500-36"><a href="solutions.html#cb500-36" aria-hidden="true" tabindex="-1"></a>    df_train_cs[,ivar] <span class="ot">&lt;-</span> df_train[,ivar] <span class="sc">-</span> mean_byvar[ivar]</span>
<span id="cb500-37"><a href="solutions.html#cb500-37" aria-hidden="true" tabindex="-1"></a>    df_train_cs[,ivar] <span class="ot">&lt;-</span> df_train_cs[,ivar] <span class="sc">/</span> sd_byvar[ivar]</span>
<span id="cb500-38"><a href="solutions.html#cb500-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb500-39"><a href="solutions.html#cb500-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># center and scale validation data </span></span>
<span id="cb500-40"><a href="solutions.html#cb500-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># important: use parameters (mean and sd) determined on training data</span></span>
<span id="cb500-41"><a href="solutions.html#cb500-41" aria-hidden="true" tabindex="-1"></a>    df_valid_cs[,ivar] <span class="ot">&lt;-</span> df_valid[,ivar] <span class="sc">-</span> mean_byvar[ivar]</span>
<span id="cb500-42"><a href="solutions.html#cb500-42" aria-hidden="true" tabindex="-1"></a>    df_valid_cs[,ivar] <span class="ot">&lt;-</span> df_valid_cs[,ivar] <span class="sc">/</span> sd_byvar[ivar]</span>
<span id="cb500-43"><a href="solutions.html#cb500-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb500-44"><a href="solutions.html#cb500-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-45"><a href="solutions.html#cb500-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add unmodified target variable</span></span>
<span id="cb500-46"><a href="solutions.html#cb500-46" aria-hidden="true" tabindex="-1"></a>  df_valid_cs[,nam_target] <span class="ot">&lt;-</span> df_valid[,nam_target] </span>
<span id="cb500-47"><a href="solutions.html#cb500-47" aria-hidden="true" tabindex="-1"></a>  df_train_cs[,nam_target] <span class="ot">&lt;-</span> df_train[,nam_target] </span>
<span id="cb500-48"><a href="solutions.html#cb500-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-49"><a href="solutions.html#cb500-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train using the scaled training data</span></span>
<span id="cb500-50"><a href="solutions.html#cb500-50" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">knnreg</span>(df_train_cs[,nams_predictors], </span>
<span id="cb500-51"><a href="solutions.html#cb500-51" aria-hidden="true" tabindex="-1"></a>                       df_train_cs[,nam_target], </span>
<span id="cb500-52"><a href="solutions.html#cb500-52" aria-hidden="true" tabindex="-1"></a>                       <span class="at">k =</span> use_k</span>
<span id="cb500-53"><a href="solutions.html#cb500-53" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb500-54"><a href="solutions.html#cb500-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-55"><a href="solutions.html#cb500-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predict using the scaled validation data</span></span>
<span id="cb500-56"><a href="solutions.html#cb500-56" aria-hidden="true" tabindex="-1"></a>  df_valid_cs<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> df_valid_cs[,nams_predictors])</span>
<span id="cb500-57"><a href="solutions.html#cb500-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-58"><a href="solutions.html#cb500-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate MAE on validation data</span></span>
<span id="cb500-59"><a href="solutions.html#cb500-59" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(df_valid_cs<span class="sc">$</span>pred <span class="sc">-</span> df_valid_cs[,nam_target]))</span>
<span id="cb500-60"><a href="solutions.html#cb500-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-61"><a href="solutions.html#cb500-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb500-62"><a href="solutions.html#cb500-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-63"><a href="solutions.html#cb500-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb500-64"><a href="solutions.html#cb500-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-65"><a href="solutions.html#cb500-65" aria-hidden="true" tabindex="-1"></a><span class="co"># function reshuffling data, creating folds (list of row indices), and </span></span>
<span id="cb500-66"><a href="solutions.html#cb500-66" aria-hidden="true" tabindex="-1"></a><span class="co"># calling function to calculate MAE on each fold. Returns vector of MAE for each fold.</span></span>
<span id="cb500-67"><a href="solutions.html#cb500-67" aria-hidden="true" tabindex="-1"></a>get_mae_cv <span class="ot">&lt;-</span> <span class="cf">function</span>(df, </span>
<span id="cb500-68"><a href="solutions.html#cb500-68" aria-hidden="true" tabindex="-1"></a>                       nam_target,       <span class="co"># character string for target variables</span></span>
<span id="cb500-69"><a href="solutions.html#cb500-69" aria-hidden="true" tabindex="-1"></a>                       nams_predictors,  <span class="co"># vector of character strings for predictors</span></span>
<span id="cb500-70"><a href="solutions.html#cb500-70" aria-hidden="true" tabindex="-1"></a>                       n_folds,          <span class="co"># number of folds for cross-validation</span></span>
<span id="cb500-71"><a href="solutions.html#cb500-71" aria-hidden="true" tabindex="-1"></a>                       use_k             <span class="co"># k for KNN</span></span>
<span id="cb500-72"><a href="solutions.html#cb500-72" aria-hidden="true" tabindex="-1"></a>                       ){</span>
<span id="cb500-73"><a href="solutions.html#cb500-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-74"><a href="solutions.html#cb500-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># re-shuffle rows in data frame</span></span>
<span id="cb500-75"><a href="solutions.html#cb500-75" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="fu">sample</span>(<span class="fu">nrow</span>(df)),]</span>
<span id="cb500-76"><a href="solutions.html#cb500-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-77"><a href="solutions.html#cb500-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine row indices to be allocated to each fold</span></span>
<span id="cb500-78"><a href="solutions.html#cb500-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># each fold takes in 1/n_folds of the total number of rows</span></span>
<span id="cb500-79"><a href="solutions.html#cb500-79" aria-hidden="true" tabindex="-1"></a>  nrows_per_fold <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">nrow</span>(df) <span class="sc">/</span> n_folds)</span>
<span id="cb500-80"><a href="solutions.html#cb500-80" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_folds), <span class="at">each =</span> nrows_per_fold)</span>
<span id="cb500-81"><a href="solutions.html#cb500-81" aria-hidden="true" tabindex="-1"></a>  folds_1 <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), idx[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)])</span>
<span id="cb500-82"><a href="solutions.html#cb500-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-83"><a href="solutions.html#cb500-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alternative option</span></span>
<span id="cb500-84"><a href="solutions.html#cb500-84" aria-hidden="true" tabindex="-1"></a>  n_folds <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb500-85"><a href="solutions.html#cb500-85" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span>  (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%/%</span> (<span class="fu">nrow</span>(df) <span class="sc">/</span> n_folds)</span>
<span id="cb500-86"><a href="solutions.html#cb500-86" aria-hidden="true" tabindex="-1"></a>  folds_2 <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), idx)</span>
<span id="cb500-87"><a href="solutions.html#cb500-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-88"><a href="solutions.html#cb500-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># using caret built-in function</span></span>
<span id="cb500-89"><a href="solutions.html#cb500-89" aria-hidden="true" tabindex="-1"></a>  folds_3 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">createFolds</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="at">k =</span> n_folds)</span>
<span id="cb500-90"><a href="solutions.html#cb500-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-91"><a href="solutions.html#cb500-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop over folds and get MAE determined on each validation set</span></span>
<span id="cb500-92"><a href="solutions.html#cb500-92" aria-hidden="true" tabindex="-1"></a>  mae_list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb500-93"><a href="solutions.html#cb500-93" aria-hidden="true" tabindex="-1"></a>    folds_1,</span>
<span id="cb500-94"><a href="solutions.html#cb500-94" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">get_mae_byfold</span>(df, ., nam_target, nams_predictors, use_k)</span>
<span id="cb500-95"><a href="solutions.html#cb500-95" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb500-96"><a href="solutions.html#cb500-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-97"><a href="solutions.html#cb500-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return a vector of MAE in each fold</span></span>
<span id="cb500-98"><a href="solutions.html#cb500-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">unlist</span>(mae_list))</span>
<span id="cb500-99"><a href="solutions.html#cb500-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb500-100"><a href="solutions.html#cb500-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-101"><a href="solutions.html#cb500-101" aria-hidden="true" tabindex="-1"></a><span class="co"># get MAE for each fold of the cross-validation</span></span>
<span id="cb500-102"><a href="solutions.html#cb500-102" aria-hidden="true" tabindex="-1"></a>vec_mae_byhand <span class="ot">&lt;-</span> <span class="fu">get_mae_cv</span>(daily_fluxes, </span>
<span id="cb500-103"><a href="solutions.html#cb500-103" aria-hidden="true" tabindex="-1"></a>                             nam_target, </span>
<span id="cb500-104"><a href="solutions.html#cb500-104" aria-hidden="true" tabindex="-1"></a>                             nams_predictors, </span>
<span id="cb500-105"><a href="solutions.html#cb500-105" aria-hidden="true" tabindex="-1"></a>                             <span class="at">n_folds =</span> <span class="dv">60</span>, </span>
<span id="cb500-106"><a href="solutions.html#cb500-106" aria-hidden="true" tabindex="-1"></a>                             <span class="at">use_k =</span> <span class="dv">30</span></span>
<span id="cb500-107"><a href="solutions.html#cb500-107" aria-hidden="true" tabindex="-1"></a>                             )</span></code></pre></div>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="solutions.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">mae =</span> vec_mae_byhand) <span class="sc">|&gt;</span> </span>
<span id="cb501-2"><a href="solutions.html#cb501-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mae, ..count..)) <span class="sc">+</span></span>
<span id="cb501-3"><a href="solutions.html#cb501-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb501-4"><a href="solutions.html#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-274-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="cross-validation-vs.-test-error-1" class="section level3 unnumbered hasAnchor">
<h3>Cross-validation vs. test error<a href="solutions.html#cross-validation-vs.-test-error-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, you can use the user-friendly <code>caret::train()</code> for KNN with 60-fold cross-validation and tuning the hyperparameter k. Use the MAE as the loss metric. Use the same data as in the Exercise above and withhold 20% of the data for the test set. Visually compare the reported mean MAE from the cross-validation folds with the MAE determined on a test set.</p>
<p>In your visual comparison, add a plot layer showing the distribution of validation errors from you manual implementation of cross-validation (Exercise above).</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="solutions.html#cb502-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/df_daily_exercise_supervisedmlii.csv&quot;</span>)</span>
<span id="cb502-2"><a href="solutions.html#cb502-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-3"><a href="solutions.html#cb502-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1982</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb502-4"><a href="solutions.html#cb502-4" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(daily_fluxes, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb502-5"><a href="solutions.html#cb502-5" aria-hidden="true" tabindex="-1"></a>daily_fluxes_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(split)</span>
<span id="cb502-6"><a href="solutions.html#cb502-6" aria-hidden="true" tabindex="-1"></a>daily_fluxes_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(split)</span>
<span id="cb502-7"><a href="solutions.html#cb502-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-8"><a href="solutions.html#cb502-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The same model formulation is in the previous chapter</span></span>
<span id="cb502-9"><a href="solutions.html#cb502-9" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> TA_F, </span>
<span id="cb502-10"><a href="solutions.html#cb502-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> daily_fluxes_train) <span class="sc">|&gt;</span> </span>
<span id="cb502-11"><a href="solutions.html#cb502-11" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_center</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb502-12"><a href="solutions.html#cb502-12" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_scale</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>())</span>
<span id="cb502-13"><a href="solutions.html#cb502-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-14"><a href="solutions.html#cb502-14" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(pp, </span>
<span id="cb502-15"><a href="solutions.html#cb502-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> daily_fluxes_train <span class="sc">|&gt;</span> <span class="fu">drop_na</span>(), </span>
<span id="cb502-16"><a href="solutions.html#cb502-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb502-17"><a href="solutions.html#cb502-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, </span>
<span id="cb502-18"><a href="solutions.html#cb502-18" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">number =</span> <span class="dv">60</span></span>
<span id="cb502-19"><a href="solutions.html#cb502-19" aria-hidden="true" tabindex="-1"></a>                                                    ),</span>
<span id="cb502-20"><a href="solutions.html#cb502-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">100</span>)),</span>
<span id="cb502-21"><a href="solutions.html#cb502-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">metric =</span> <span class="st">&quot;MAE&quot;</span></span>
<span id="cb502-22"><a href="solutions.html#cb502-22" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb502-23"><a href="solutions.html#cb502-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-24"><a href="solutions.html#cb502-24" aria-hidden="true" tabindex="-1"></a><span class="co"># data frame containing metrics on validation set by fold</span></span>
<span id="cb502-25"><a href="solutions.html#cb502-25" aria-hidden="true" tabindex="-1"></a>metrics_byfold <span class="ot">&lt;-</span> mod<span class="sc">$</span>resample</span>
<span id="cb502-26"><a href="solutions.html#cb502-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-27"><a href="solutions.html#cb502-27" aria-hidden="true" tabindex="-1"></a><span class="co"># MAE on test set</span></span>
<span id="cb502-28"><a href="solutions.html#cb502-28" aria-hidden="true" tabindex="-1"></a>daily_fluxes_test <span class="ot">&lt;-</span> daily_fluxes_test <span class="sc">|&gt;</span> </span>
<span id="cb502-29"><a href="solutions.html#cb502-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span>  <span class="co"># use magrittr-pipe here for the dot evaluation</span></span>
<span id="cb502-30"><a href="solutions.html#cb502-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span>  <span class="fu">predict</span>(mod, <span class="at">newdata =</span> .))  </span>
<span id="cb502-31"><a href="solutions.html#cb502-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-32"><a href="solutions.html#cb502-32" aria-hidden="true" tabindex="-1"></a>mae_test <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(daily_fluxes_test<span class="sc">$</span>fitted <span class="sc">-</span> daily_fluxes_test<span class="sc">$</span>GPP_NT_VUT_REF))</span></code></pre></div>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="solutions.html#cb503-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> metrics_byfold <span class="sc">|&gt;</span> </span>
<span id="cb503-2"><a href="solutions.html#cb503-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">caret =</span> MAE) <span class="sc">|&gt;</span> </span>
<span id="cb503-3"><a href="solutions.html#cb503-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb503-4"><a href="solutions.html#cb503-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">byhand =</span> vec_mae_byhand)</span>
<span id="cb503-5"><a href="solutions.html#cb503-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb503-6"><a href="solutions.html#cb503-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(caret, byhand), </span>
<span id="cb503-7"><a href="solutions.html#cb503-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;implementation&quot;</span>, </span>
<span id="cb503-8"><a href="solutions.html#cb503-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;MAE&quot;</span>)</span>
<span id="cb503-9"><a href="solutions.html#cb503-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-10"><a href="solutions.html#cb503-10" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span> </span>
<span id="cb503-11"><a href="solutions.html#cb503-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MAE, <span class="at">y =</span> ..count.., <span class="at">fill =</span> implementation)) <span class="sc">+</span></span>
<span id="cb503-12"><a href="solutions.html#cb503-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb503-13"><a href="solutions.html#cb503-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb503-14"><a href="solutions.html#cb503-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test error</span></span>
<span id="cb503-15"><a href="solutions.html#cb503-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> mae_test, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb503-16"><a href="solutions.html#cb503-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb503-17"><a href="solutions.html#cb503-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;darkgoldenrod&quot;</span>, <span class="st">&quot;royalblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb503-18"><a href="solutions.html#cb503-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-278-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="random-forest" class="section level2 hasAnchor" number="13.11">
<h2><span class="header-section-number">A.11</span> Random Forest<a href="solutions.html#random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fitting-a-random-forest-1" class="section level3 unnumbered hasAnchor">
<h3>Fitting a Random Forest<a href="solutions.html#fitting-a-random-forest-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fit a Random Forest model to the flux data used in the examples of this chapter. Implement bagging 12 decision trees (<code>num.trees</code>), each with a minimum number of observations per leaf of 5 (<code>min.node.size</code>). You can consult the respective arguments for the <code>"ranger"</code> method typing <code>?ranger</code>.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="solutions.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data loading and cleaning</span></span>
<span id="cb504-2"><a href="solutions.html#cb504-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/FLX_CH-Dav_FLUXNET2015_FULLSET_DD_1997-2014_1-3.csv&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb504-3"><a href="solutions.html#cb504-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb504-4"><a href="solutions.html#cb504-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only the variables we are interested in</span></span>
<span id="cb504-5"><a href="solutions.html#cb504-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(TIMESTAMP,</span>
<span id="cb504-6"><a href="solutions.html#cb504-6" aria-hidden="true" tabindex="-1"></a>                GPP_NT_VUT_REF,    <span class="co"># the target</span></span>
<span id="cb504-7"><a href="solutions.html#cb504-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>),  <span class="co"># quality control info</span></span>
<span id="cb504-8"><a href="solutions.html#cb504-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;_F&quot;</span>),   <span class="co"># includes all all meteorological covariates</span></span>
<span id="cb504-9"><a href="solutions.html#cb504-9" aria-hidden="true" tabindex="-1"></a>                <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;JSB&quot;</span>)   <span class="co"># weird useless variable</span></span>
<span id="cb504-10"><a href="solutions.html#cb504-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb504-11"><a href="solutions.html#cb504-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-12"><a href="solutions.html#cb504-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to a nice date object</span></span>
<span id="cb504-13"><a href="solutions.html#cb504-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">TIMESTAMP =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(TIMESTAMP)) <span class="sc">|&gt;</span></span>
<span id="cb504-14"><a href="solutions.html#cb504-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-15"><a href="solutions.html#cb504-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set all -9999 to NA</span></span>
<span id="cb504-16"><a href="solutions.html#cb504-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">na_if</span>(., <span class="sc">-</span><span class="dv">9999</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb504-17"><a href="solutions.html#cb504-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-18"><a href="solutions.html#cb504-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># retain only data based on &gt;=80% good-quality measurements</span></span>
<span id="cb504-19"><a href="solutions.html#cb504-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># overwrite bad data with NA (not dropping rows)</span></span>
<span id="cb504-20"><a href="solutions.html#cb504-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">ifelse</span>(NEE_VUT_REF_QC <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, GPP_NT_VUT_REF),</span>
<span id="cb504-21"><a href="solutions.html#cb504-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">TA_F           =</span> <span class="fu">ifelse</span>(TA_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, TA_F),</span>
<span id="cb504-22"><a href="solutions.html#cb504-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">SW_IN_F        =</span> <span class="fu">ifelse</span>(SW_IN_F_QC     <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, SW_IN_F),</span>
<span id="cb504-23"><a href="solutions.html#cb504-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">LW_IN_F        =</span> <span class="fu">ifelse</span>(LW_IN_F_QC     <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, LW_IN_F),</span>
<span id="cb504-24"><a href="solutions.html#cb504-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">VPD_F          =</span> <span class="fu">ifelse</span>(VPD_F_QC       <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, VPD_F),</span>
<span id="cb504-25"><a href="solutions.html#cb504-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">PA_F           =</span> <span class="fu">ifelse</span>(PA_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, PA_F),</span>
<span id="cb504-26"><a href="solutions.html#cb504-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">P_F            =</span> <span class="fu">ifelse</span>(P_F_QC         <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, P_F),</span>
<span id="cb504-27"><a href="solutions.html#cb504-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">WS_F           =</span> <span class="fu">ifelse</span>(WS_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, WS_F)) <span class="sc">|&gt;</span> </span>
<span id="cb504-28"><a href="solutions.html#cb504-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-29"><a href="solutions.html#cb504-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop QC variables (no longer needed)</span></span>
<span id="cb504-30"><a href="solutions.html#cb504-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>))</span>
<span id="cb504-31"><a href="solutions.html#cb504-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-32"><a href="solutions.html#cb504-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Data splitting</span></span>
<span id="cb504-33"><a href="solutions.html#cb504-33" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb504-34"><a href="solutions.html#cb504-34" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(daily_fluxes, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> <span class="st">&quot;VPD_F&quot;</span>)</span>
<span id="cb504-35"><a href="solutions.html#cb504-35" aria-hidden="true" tabindex="-1"></a>daily_fluxes_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(split)</span>
<span id="cb504-36"><a href="solutions.html#cb504-36" aria-hidden="true" tabindex="-1"></a>daily_fluxes_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(split)</span>
<span id="cb504-37"><a href="solutions.html#cb504-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-38"><a href="solutions.html#cb504-38" aria-hidden="true" tabindex="-1"></a><span class="co"># The same model formulation is in the previous chapter</span></span>
<span id="cb504-39"><a href="solutions.html#cb504-39" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> TA_F <span class="sc">+</span> SW_IN_F <span class="sc">+</span> LW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> P_F <span class="sc">+</span> WS_F, </span>
<span id="cb504-40"><a href="solutions.html#cb504-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> daily_fluxes_train) <span class="sc">|&gt;</span> </span>
<span id="cb504-41"><a href="solutions.html#cb504-41" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_center</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb504-42"><a href="solutions.html#cb504-42" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_scale</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>())</span></code></pre></div>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="solutions.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the first model of 12 trees and maximum depth 4</span></span>
<span id="cb505-2"><a href="solutions.html#cb505-2" aria-hidden="true" tabindex="-1"></a>rf_12_5 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb505-3"><a href="solutions.html#cb505-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb505-4"><a href="solutions.html#cb505-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb505-5"><a href="solutions.html#cb505-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb505-6"><a href="solutions.html#cb505-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb505-7"><a href="solutions.html#cb505-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb505-8"><a href="solutions.html#cb505-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb505-9"><a href="solutions.html#cb505-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb505-10"><a href="solutions.html#cb505-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb505-11"><a href="solutions.html#cb505-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb505-12"><a href="solutions.html#cb505-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb505-13"><a href="solutions.html#cb505-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb505-14"><a href="solutions.html#cb505-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.mtry =</span> <span class="fu">floor</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">3</span>),        <span class="co"># default p/3</span></span>
<span id="cb505-15"><a href="solutions.html#cb505-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.min.node.size =</span> <span class="dv">5</span>,          <span class="co"># set to 5</span></span>
<span id="cb505-16"><a href="solutions.html#cb505-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb505-17"><a href="solutions.html#cb505-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb505-18"><a href="solutions.html#cb505-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb505-19"><a href="solutions.html#cb505-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb505-20"><a href="solutions.html#cb505-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb505-21"><a href="solutions.html#cb505-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">12</span>,       </span>
<span id="cb505-22"><a href="solutions.html#cb505-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb505-23"><a href="solutions.html#cb505-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb505-24"><a href="solutions.html#cb505-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-25"><a href="solutions.html#cb505-25" aria-hidden="true" tabindex="-1"></a><span class="co"># generic print</span></span>
<span id="cb505-26"><a href="solutions.html#cb505-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_12_5)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 1910 samples
##    8 predictor
## 
## Recipe steps: center, scale 
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1528, 1528, 1529, 1527, 1528 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   1.468118  0.6796483  1.116388
## 
## Tuning parameter &#39;mtry&#39; was held constant at a value of 2
## Tuning
##  parameter &#39;splitrule&#39; was held constant at a value of variance
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 5</code></pre>
<p>Repeat the fitting with 1000 decision trees and minimum node size of 5, then with 12 decision trees and a minimum node size of 1. Then, discuss the role that the number of decision trees and the minimum number of leaf observations of a tree play in the bias-variance trade-off and in the computation time.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="solutions.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Directly fit the model again, with same data and model formulation</span></span>
<span id="cb507-2"><a href="solutions.html#cb507-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Now train with 1000 trees and maximum depth 4</span></span>
<span id="cb507-3"><a href="solutions.html#cb507-3" aria-hidden="true" tabindex="-1"></a>rf_1000_5 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb507-4"><a href="solutions.html#cb507-4" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb507-5"><a href="solutions.html#cb507-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb507-6"><a href="solutions.html#cb507-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb507-7"><a href="solutions.html#cb507-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb507-8"><a href="solutions.html#cb507-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb507-9"><a href="solutions.html#cb507-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb507-10"><a href="solutions.html#cb507-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb507-11"><a href="solutions.html#cb507-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb507-12"><a href="solutions.html#cb507-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb507-13"><a href="solutions.html#cb507-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb507-14"><a href="solutions.html#cb507-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb507-15"><a href="solutions.html#cb507-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.mtry =</span> <span class="fu">floor</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">3</span>),       <span class="co"># default p/3</span></span>
<span id="cb507-16"><a href="solutions.html#cb507-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.min.node.size =</span> <span class="dv">5</span>,         <span class="co"># set to 5</span></span>
<span id="cb507-17"><a href="solutions.html#cb507-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>     <span class="co"># default variance</span></span>
<span id="cb507-18"><a href="solutions.html#cb507-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb507-19"><a href="solutions.html#cb507-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb507-20"><a href="solutions.html#cb507-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb507-21"><a href="solutions.html#cb507-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb507-22"><a href="solutions.html#cb507-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">1000</span>,       </span>
<span id="cb507-23"><a href="solutions.html#cb507-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb507-24"><a href="solutions.html#cb507-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb507-25"><a href="solutions.html#cb507-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-26"><a href="solutions.html#cb507-26" aria-hidden="true" tabindex="-1"></a><span class="co"># generic print</span></span>
<span id="cb507-27"><a href="solutions.html#cb507-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_1000_5)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 1910 samples
##    8 predictor
## 
## Recipe steps: center, scale 
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1527, 1528, 1529, 1529, 1527 
## Resampling results:
## 
##   RMSE      Rsquared  MAE     
##   1.415667  0.701975  1.078454
## 
## Tuning parameter &#39;mtry&#39; was held constant at a value of 2
## Tuning
##  parameter &#39;splitrule&#39; was held constant at a value of variance
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 5</code></pre>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="solutions.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat model fit with 12 trees and maximum depth 6</span></span>
<span id="cb509-2"><a href="solutions.html#cb509-2" aria-hidden="true" tabindex="-1"></a>rf_12_1 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb509-3"><a href="solutions.html#cb509-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb509-4"><a href="solutions.html#cb509-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb509-5"><a href="solutions.html#cb509-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb509-6"><a href="solutions.html#cb509-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb509-7"><a href="solutions.html#cb509-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb509-8"><a href="solutions.html#cb509-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb509-9"><a href="solutions.html#cb509-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb509-10"><a href="solutions.html#cb509-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">5</span>, </span>
<span id="cb509-11"><a href="solutions.html#cb509-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb509-12"><a href="solutions.html#cb509-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb509-13"><a href="solutions.html#cb509-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb509-14"><a href="solutions.html#cb509-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.mtry =</span> <span class="fu">floor</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">3</span>),        <span class="co"># default p/3</span></span>
<span id="cb509-15"><a href="solutions.html#cb509-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.min.node.size =</span> <span class="dv">1</span>,          <span class="co"># set to 1</span></span>
<span id="cb509-16"><a href="solutions.html#cb509-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb509-17"><a href="solutions.html#cb509-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb509-18"><a href="solutions.html#cb509-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb509-19"><a href="solutions.html#cb509-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb509-20"><a href="solutions.html#cb509-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb509-21"><a href="solutions.html#cb509-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">12</span>,       </span>
<span id="cb509-22"><a href="solutions.html#cb509-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb509-23"><a href="solutions.html#cb509-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb509-24"><a href="solutions.html#cb509-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-25"><a href="solutions.html#cb509-25" aria-hidden="true" tabindex="-1"></a><span class="co"># generic print</span></span>
<span id="cb509-26"><a href="solutions.html#cb509-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_12_1)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 1910 samples
##    8 predictor
## 
## Recipe steps: center, scale 
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1527, 1528, 1529, 1528, 1528 
## Resampling results:
## 
##   RMSE      Rsquared  MAE    
##   1.470344  0.678954  1.11868
## 
## Tuning parameter &#39;mtry&#39; was held constant at a value of 2
## Tuning
##  parameter &#39;splitrule&#39; was held constant at a value of variance
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 1</code></pre>
<p><strong>Interpretation of results</strong></p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="solutions.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check results</span></span>
<span id="cb511-2"><a href="solutions.html#cb511-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb511-3"><a href="solutions.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  rf_12_5<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Setup =</span> <span class="st">&quot;12 Trees with at least 5 obs per leaf&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Setup),</span>
<span id="cb511-4"><a href="solutions.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  rf_1000_5<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Setup =</span> <span class="st">&quot;1000 Trees with at least 5 obs per leaf&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Setup),</span>
<span id="cb511-5"><a href="solutions.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  rf_12_1<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Setup =</span> <span class="st">&quot;12 Trees with at least 1 obs per leaf&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Setup)</span>
<span id="cb511-6"><a href="solutions.html#cb511-6" aria-hidden="true" tabindex="-1"></a>)[,<span class="sc">-</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)] <span class="sc">|&gt;</span></span>
<span id="cb511-7"><a href="solutions.html#cb511-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;Comparison of cross-validated metrics across Random Forest setups.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-283">Table A.1: </span>Comparison of cross-validated metrics across Random Forest setups.</caption>
<colgroup>
<col width="40%" />
<col width="9%" />
<col width="10%" />
<col width="9%" />
<col width="10%" />
<col width="11%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Setup</th>
<th align="right">RMSE</th>
<th align="right">Rsquared</th>
<th align="right">MAE</th>
<th align="right">RMSESD</th>
<th align="right">RsquaredSD</th>
<th align="right">MAESD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">12 Trees with at least 5 obs per leaf</td>
<td align="right">1.468118</td>
<td align="right">0.6796483</td>
<td align="right">1.116388</td>
<td align="right">0.0631198</td>
<td align="right">0.0243411</td>
<td align="right">0.0436952</td>
</tr>
<tr class="even">
<td align="left">1000 Trees with at least 5 obs per leaf</td>
<td align="right">1.415667</td>
<td align="right">0.7019750</td>
<td align="right">1.078454</td>
<td align="right">0.0661862</td>
<td align="right">0.0228750</td>
<td align="right">0.0308386</td>
</tr>
<tr class="odd">
<td align="left">12 Trees with at least 1 obs per leaf</td>
<td align="right">1.470344</td>
<td align="right">0.6789540</td>
<td align="right">1.118680</td>
<td align="right">0.0766487</td>
<td align="right">0.0244763</td>
<td align="right">0.0588226</td>
</tr>
</tbody>
</table>
<p>Increasing the number of decision trees leads to a decrease in error (e.g. RMSE) and in error variance in the random forest results, making the model more accurate, robust and generalisable. This can be seen by the smaller values of practically all the metrics above. In the bias-variance trade-off, higher <code>num.trees</code> shifts the balance towards both lower bias and lower variance.</p>
<p>Decreasing the number of observations required to go to each split allows for a better fit of the data, but makes the model less generalisable. Actually, it would lead to a perfect fit of the training data. Since the error metrics are calcualted using cross-validation, the lack of generalisability is captured together with the model fit. This is seen by an increase in both the error metrics and their estimated standard deviation. Hence, using low values for <code>min.node.size</code> may lead to overfitting.</p>
</div>
<div id="hyperparameter-tuning-1" class="section level3 unnumbered hasAnchor">
<h3>Hyperparameter tuning<a href="solutions.html#hyperparameter-tuning-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a previous tutorial, you learned how to tune the hyperparameter <span class="math inline">\(k\)</span> in a KNN by hand. Now you will do the hyperparameter tuning for a Random Forest model. The task gets more complicated because there are more hyperparameters in a random forest. The {caret} package allows to vary three hyperparameters:</p>
<ul>
<li><code>mtry</code>: The number of variables to consider to make decisions at each node, often taken as <span class="math inline">\(p/3\)</span> for regression, where <span class="math inline">\(p\)</span> is the number of predictors.</li>
<li><code>min.node.size</code>: The number of data points at the “bottom” of each decision tree, i.e. the leaves.</li>
<li><code>splitrule</code>: The function applied to data in each branch of a tree, used for determining the goodness of a decision.</li>
</ul>
<p>Answer the following questions, giving a reason for your responses:</p>
<ol style="list-style-type: decimal">
<li>Check the help for the <code>ranger()</code> function and identify which values each of the three hyperparameters/arguments can take. Select a sensible range of values for each hyperparameter, that you will use in the hyperparameter search.</li>
</ol>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="solutions.html#cb512-1" aria-hidden="true" tabindex="-1"></a>mtry_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>)</span>
<span id="cb512-2"><a href="solutions.html#cb512-2" aria-hidden="true" tabindex="-1"></a>min.node.size_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb512-3"><a href="solutions.html#cb512-3" aria-hidden="true" tabindex="-1"></a>splitrule_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;variance&quot;</span>, <span class="st">&quot;extratrees&quot;</span>, <span class="st">&quot;maxstat&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>In the previous exercise, you have seen how the minimum node size regulates fit quality and overfitting. How does the minimum node size relate to tree depth? What happens at the edge cases, when <code>min.node.size = 1</code> and when <code>min.node.size = n</code> (<code>n</code> being the number of observations)? Note that it’s not necessary to provide the <code>max.depth</code> argument to <code>train()</code> because <code>min.node.size</code> is already limiting the size of the trees in the Random Forests.</li>
</ol>
<p><strong>Solution</strong>:
The minimum node size is inversely related to the tree depth. The more nodes are required to be at the leaves, the shorter the tree will be, because not so many splits can be done. If we allowed each leave to correspond to a single observation, we would have a very large tree, such that each branch corresponds to one observation. If we force each leave to have at least <span class="math inline">\(n\)</span> observations, then the tree will not “grow”, that is, it will never even split.</p>
<ol start="3" style="list-style-type: decimal">
<li><em>Greedy hyperparameter tuning</em>: Sequentially optimize the choice of each hyperparameter, one at a time and keeping the other two constant. Take the code from the tutorial as a starting point, and those hyperparameter values as an initial point for the search. Implement the optimization routine yourself, using loops.
&gt; Tip: Keep the number of trees low, otherwise it takes too long to fit each Random Forest model.</li>
</ol>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="solutions.html#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use data and model formulation created before</span></span>
<span id="cb513-2"><a href="solutions.html#cb513-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-3"><a href="solutions.html#cb513-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>()   <span class="co"># initialise results</span></span>
<span id="cb513-4"><a href="solutions.html#cb513-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1997</span>)   <span class="co"># for reproducibility</span></span>
<span id="cb513-5"><a href="solutions.html#cb513-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-6"><a href="solutions.html#cb513-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models in a loop, save metrics</span></span>
<span id="cb513-7"><a href="solutions.html#cb513-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (mtry_value <span class="cf">in</span> mtry_values){</span>
<span id="cb513-8"><a href="solutions.html#cb513-8" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb513-9"><a href="solutions.html#cb513-9" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb513-10"><a href="solutions.html#cb513-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb513-11"><a href="solutions.html#cb513-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(), </span>
<span id="cb513-12"><a href="solutions.html#cb513-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb513-13"><a href="solutions.html#cb513-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb513-14"><a href="solutions.html#cb513-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb513-15"><a href="solutions.html#cb513-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb513-16"><a href="solutions.html#cb513-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb513-17"><a href="solutions.html#cb513-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb513-18"><a href="solutions.html#cb513-18" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb513-19"><a href="solutions.html#cb513-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb513-20"><a href="solutions.html#cb513-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.mtry =</span> mtry_value,           <span class="co"># modify mtry</span></span>
<span id="cb513-21"><a href="solutions.html#cb513-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">.min.node.size =</span> <span class="dv">5</span>,           <span class="co"># default 5</span></span>
<span id="cb513-22"><a href="solutions.html#cb513-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>       <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb513-23"><a href="solutions.html#cb513-23" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb513-24"><a href="solutions.html#cb513-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb513-25"><a href="solutions.html#cb513-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb513-26"><a href="solutions.html#cb513-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb513-27"><a href="solutions.html#cb513-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">100</span>,</span>
<span id="cb513-28"><a href="solutions.html#cb513-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb513-29"><a href="solutions.html#cb513-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb513-30"><a href="solutions.html#cb513-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-31"><a href="solutions.html#cb513-31" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, mod<span class="sc">$</span>results)</span>
<span id="cb513-32"><a href="solutions.html#cb513-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb513-33"><a href="solutions.html#cb513-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-34"><a href="solutions.html#cb513-34" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##   mtry min.node.size splitrule     RMSE  Rsquared      MAE     RMSESD
## 1    2             5  variance 1.408401 0.7048393 1.079003 0.06273482
## 2    4             5  variance 1.415472 0.7036540 1.078367 0.02791004
## 3    6             5  variance 1.433248 0.6946220 1.094301 0.11539229
##   RsquaredSD      MAESD
## 1 0.01596849 0.04919243
## 2 0.01083131 0.03353947
## 3 0.03200823 0.07272992</code></pre>
<p>Based on the first round of hyperparameter tuning, we should take <code>mtry = 2</code> because it leads to the smallest RMSE and MAE, and the highest Rsquared. That is, the best fit. Nevertheless, the difference between taking <code>mtry = 2</code> or <code>4</code> is very small and the second actually leads to smaller variance in the metric estimates. Hence, the decision is not so clear.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="solutions.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the previous best model and tune next hyperparameter</span></span>
<span id="cb515-2"><a href="solutions.html#cb515-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-3"><a href="solutions.html#cb515-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>()   <span class="co"># initialise results</span></span>
<span id="cb515-4"><a href="solutions.html#cb515-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1997</span>)   <span class="co"># for reproducibility</span></span>
<span id="cb515-5"><a href="solutions.html#cb515-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-6"><a href="solutions.html#cb515-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models in a loop, save metrics</span></span>
<span id="cb515-7"><a href="solutions.html#cb515-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (min.node.size_value <span class="cf">in</span> min.node.size_values){</span>
<span id="cb515-8"><a href="solutions.html#cb515-8" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb515-9"><a href="solutions.html#cb515-9" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb515-10"><a href="solutions.html#cb515-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb515-11"><a href="solutions.html#cb515-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(), </span>
<span id="cb515-12"><a href="solutions.html#cb515-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb515-13"><a href="solutions.html#cb515-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb515-14"><a href="solutions.html#cb515-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb515-15"><a href="solutions.html#cb515-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb515-16"><a href="solutions.html#cb515-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb515-17"><a href="solutions.html#cb515-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb515-18"><a href="solutions.html#cb515-18" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb515-19"><a href="solutions.html#cb515-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb515-20"><a href="solutions.html#cb515-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.mtry =</span> <span class="dv">2</span>,      <span class="co"># best mtry</span></span>
<span id="cb515-21"><a href="solutions.html#cb515-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">.min.node.size =</span> min.node.size_value,   <span class="co"># modify</span></span>
<span id="cb515-22"><a href="solutions.html#cb515-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>       <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb515-23"><a href="solutions.html#cb515-23" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb515-24"><a href="solutions.html#cb515-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb515-25"><a href="solutions.html#cb515-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep num.trees keep small for computation</span></span>
<span id="cb515-26"><a href="solutions.html#cb515-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for reproducibility set the seed value</span></span>
<span id="cb515-27"><a href="solutions.html#cb515-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb515-28"><a href="solutions.html#cb515-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">100</span>,</span>
<span id="cb515-29"><a href="solutions.html#cb515-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb515-30"><a href="solutions.html#cb515-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb515-31"><a href="solutions.html#cb515-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb515-32"><a href="solutions.html#cb515-32" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, mod<span class="sc">$</span>results)</span>
<span id="cb515-33"><a href="solutions.html#cb515-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb515-34"><a href="solutions.html#cb515-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-35"><a href="solutions.html#cb515-35" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##   mtry min.node.size splitrule     RMSE  Rsquared      MAE     RMSESD
## 1    2             2  variance 1.414459 0.7021521 1.080694 0.06568570
## 2    2             5  variance 1.416445 0.7033030 1.078525 0.03266685
## 3    2            10  variance 1.429133 0.6971880 1.090143 0.12087515
## 4    2            20  variance 1.426698 0.6983137 1.085333 0.05662594
##    RsquaredSD      MAESD
## 1 0.016183122 0.05218533
## 2 0.005366239 0.03448577
## 3 0.034472910 0.07423081
## 4 0.015027167 0.03858145</code></pre>
<p>The second hyperparameter should be either <code>min.node.size = 2</code> or <code>5</code> because they lead to the best metrics overall. Again, the differences are very small and each metric would lead to a different decision. By increasing <code>min.node.size</code>, we get more generalisability, but if it’s too high we will lose fit quality. If you change the random seed, you’ll see that the tuning results are not robust, so whichever hyperparameter we choose won’t make a big difference in the model fit (at least within the ranges searched). Let’s take <code>min.node.size = 2</code> for the next loop.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="solutions.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the previous best models and tune last hyperparameter</span></span>
<span id="cb517-2"><a href="solutions.html#cb517-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb517-3"><a href="solutions.html#cb517-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-4"><a href="solutions.html#cb517-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models in a loop, save metrics</span></span>
<span id="cb517-5"><a href="solutions.html#cb517-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (splitrule_value <span class="cf">in</span> splitrule_values){</span>
<span id="cb517-6"><a href="solutions.html#cb517-6" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb517-7"><a href="solutions.html#cb517-7" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb517-8"><a href="solutions.html#cb517-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb517-9"><a href="solutions.html#cb517-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(), </span>
<span id="cb517-10"><a href="solutions.html#cb517-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb517-11"><a href="solutions.html#cb517-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb517-12"><a href="solutions.html#cb517-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb517-13"><a href="solutions.html#cb517-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb517-14"><a href="solutions.html#cb517-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb517-15"><a href="solutions.html#cb517-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb517-16"><a href="solutions.html#cb517-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb517-17"><a href="solutions.html#cb517-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb517-18"><a href="solutions.html#cb517-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">.mtry =</span> <span class="dv">2</span>,                    <span class="co"># best mtry</span></span>
<span id="cb517-19"><a href="solutions.html#cb517-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">.min.node.size =</span> <span class="dv">2</span>,             <span class="co"># best min.node.size</span></span>
<span id="cb517-20"><a href="solutions.html#cb517-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.splitrule =</span> splitrule_value  <span class="co"># modify</span></span>
<span id="cb517-21"><a href="solutions.html#cb517-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb517-22"><a href="solutions.html#cb517-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb517-23"><a href="solutions.html#cb517-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep num.trees keep small for computation</span></span>
<span id="cb517-24"><a href="solutions.html#cb517-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for reproducibility set the seed value</span></span>
<span id="cb517-25"><a href="solutions.html#cb517-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb517-26"><a href="solutions.html#cb517-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb517-27"><a href="solutions.html#cb517-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">100</span>,</span>
<span id="cb517-28"><a href="solutions.html#cb517-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb517-29"><a href="solutions.html#cb517-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb517-30"><a href="solutions.html#cb517-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb517-31"><a href="solutions.html#cb517-31" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, mod<span class="sc">$</span>results)</span>
<span id="cb517-32"><a href="solutions.html#cb517-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb517-33"><a href="solutions.html#cb517-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-34"><a href="solutions.html#cb517-34" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##   mtry min.node.size  splitrule     RMSE  Rsquared      MAE     RMSESD
## 1    2             2   variance 1.430041 0.6960092 1.089296 0.07545037
## 2    2             2 extratrees 1.406141 0.7084745 1.067863 0.08168255
## 3    2             2    maxstat 1.450796 0.6908389 1.109260 0.06738257
##   RsquaredSD      MAESD
## 1 0.02332409 0.05434451
## 2 0.01930827 0.04337092
## 3 0.01935027 0.04709398</code></pre>
<p>According to the last round of tuning, we should use <code>splitrule = "extratrees"</code>. With that, we found the best model so far.</p>
<ol start="4" style="list-style-type: decimal">
<li><em>Grid hyperparameter tuning</em>: Starting with the same range of values for each hyperparameter as before, look for the combination that leads to the best model performance among all combinations of hyperparameter values. This time, use the <code>expand.grid()</code> function to create a data.frame of hyperparameter value combinations. This grid will be passed to <code>train()</code> via the <code>tuneGrid</code> argument (see example in the tutorial). This will automatically do the hyperparameter search for you. Comment the output of <code>train()</code> and the results of the hyperparameter search.</li>
</ol>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="solutions.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1403</span>)    <span class="co"># for reproducibility</span></span>
<span id="cb519-2"><a href="solutions.html#cb519-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb519-3"><a href="solutions.html#cb519-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb519-4"><a href="solutions.html#cb519-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb519-5"><a href="solutions.html#cb519-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb519-6"><a href="solutions.html#cb519-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb519-7"><a href="solutions.html#cb519-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb519-8"><a href="solutions.html#cb519-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb519-9"><a href="solutions.html#cb519-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb519-10"><a href="solutions.html#cb519-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb519-11"><a href="solutions.html#cb519-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb519-12"><a href="solutions.html#cb519-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb519-13"><a href="solutions.html#cb519-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand grid of tunable hyperparameters</span></span>
<span id="cb519-14"><a href="solutions.html#cb519-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb519-15"><a href="solutions.html#cb519-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.mtry =</span> mtry_values,             </span>
<span id="cb519-16"><a href="solutions.html#cb519-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.min.node.size =</span> min.node.size_values,    </span>
<span id="cb519-17"><a href="solutions.html#cb519-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.splitrule =</span> splitrule_values</span>
<span id="cb519-18"><a href="solutions.html#cb519-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb519-19"><a href="solutions.html#cb519-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb519-20"><a href="solutions.html#cb519-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep num.trees keep small for computation</span></span>
<span id="cb519-21"><a href="solutions.html#cb519-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for reproducibility set the seed value</span></span>
<span id="cb519-22"><a href="solutions.html#cb519-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb519-23"><a href="solutions.html#cb519-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb519-24"><a href="solutions.html#cb519-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">100</span>,</span>
<span id="cb519-25"><a href="solutions.html#cb519-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb519-26"><a href="solutions.html#cb519-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="solutions.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-291-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="solutions.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">metric =</span> <span class="st">&quot;Rsquared&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-291-2.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Compare the results from the two hyperparameter tuning approaches. Do the optimal hyperparameters coincide? Are the corresponding RMSE estimates similar? What are the advantages and disadvantages of the greedy and the grid approaches?</li>
</ol>
<p>The best model according to the grid search, with lowest RMSE and highest <span class="math inline">\(R^2\)</span>, is the one with <code>mtry = 6</code>, <code>min.node.size = 10</code> and <code>splitrule = "extratrees"</code> . This is not the “best model” we found with the greedy approach (with <code>mtry = 2</code> and <code>min.node.size = 2</code>) but actually this model is overall the second best model. The metric used for tuning matters, and looking at several of them at the same can help make decisions, if different metrics agree. All these hyperparameter tuning approaches agree that the best <code>splitrule</code> is <code>"extratrees"</code> (and if you change the random seed, this result is consistent). The best <code>mtry</code> value is different for each split rule used, so having started with <code>"variance"</code> in the greedy search lead the tuning in the wrong direction, moving us towards a local optimum rather than a global optimum. This highlights that hyperparameter values interact with each other and optimizing over grids is preferred (although it takes more time).</p>
</div>
<div id="model-performance-1" class="section level3 unnumbered hasAnchor">
<h3>Model performance<a href="solutions.html#model-performance-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have trained several random forest models. Evaluate the model performance on the best model (the one for the tuned hyperparameters) and on one of your worse models. If you compare the RMSE and <span class="math inline">\(R^2\)</span> on the training and the test set, does it show overfitting?</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="solutions.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train best model</span></span>
<span id="cb522-2"><a href="solutions.html#cb522-2" aria-hidden="true" tabindex="-1"></a>mod_best <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb522-3"><a href="solutions.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb522-4"><a href="solutions.html#cb522-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb522-5"><a href="solutions.html#cb522-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb522-6"><a href="solutions.html#cb522-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb522-7"><a href="solutions.html#cb522-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb522-8"><a href="solutions.html#cb522-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb522-9"><a href="solutions.html#cb522-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb522-10"><a href="solutions.html#cb522-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb522-11"><a href="solutions.html#cb522-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb522-12"><a href="solutions.html#cb522-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb522-13"><a href="solutions.html#cb522-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand grid of tunable hyperparameters</span></span>
<span id="cb522-14"><a href="solutions.html#cb522-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb522-15"><a href="solutions.html#cb522-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.mtry =</span> <span class="dv">6</span>,             </span>
<span id="cb522-16"><a href="solutions.html#cb522-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.min.node.size =</span> <span class="dv">10</span>,    </span>
<span id="cb522-17"><a href="solutions.html#cb522-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.splitrule =</span> <span class="st">&quot;extratrees&quot;</span></span>
<span id="cb522-18"><a href="solutions.html#cb522-18" aria-hidden="true" tabindex="-1"></a>  ),  </span>
<span id="cb522-19"><a href="solutions.html#cb522-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb522-20"><a href="solutions.html#cb522-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep num.trees keep small for computation</span></span>
<span id="cb522-21"><a href="solutions.html#cb522-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for reproducibility set the seed value</span></span>
<span id="cb522-22"><a href="solutions.html#cb522-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb522-23"><a href="solutions.html#cb522-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb522-24"><a href="solutions.html#cb522-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">100</span>,</span>
<span id="cb522-25"><a href="solutions.html#cb522-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb522-26"><a href="solutions.html#cb522-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb522-27"><a href="solutions.html#cb522-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-28"><a href="solutions.html#cb522-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions</span></span>
<span id="cb522-29"><a href="solutions.html#cb522-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-30"><a href="solutions.html#cb522-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Train worst model</span></span>
<span id="cb522-31"><a href="solutions.html#cb522-31" aria-hidden="true" tabindex="-1"></a>mod_worst <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb522-32"><a href="solutions.html#cb522-32" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb522-33"><a href="solutions.html#cb522-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb522-34"><a href="solutions.html#cb522-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb522-35"><a href="solutions.html#cb522-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb522-36"><a href="solutions.html#cb522-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb522-37"><a href="solutions.html#cb522-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb522-38"><a href="solutions.html#cb522-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb522-39"><a href="solutions.html#cb522-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb522-40"><a href="solutions.html#cb522-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span></span>
<span id="cb522-41"><a href="solutions.html#cb522-41" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb522-42"><a href="solutions.html#cb522-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand grid of tunable hyperparameters</span></span>
<span id="cb522-43"><a href="solutions.html#cb522-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb522-44"><a href="solutions.html#cb522-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">.mtry =</span> <span class="dv">2</span>,             </span>
<span id="cb522-45"><a href="solutions.html#cb522-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">.min.node.size =</span> <span class="dv">20</span>,    </span>
<span id="cb522-46"><a href="solutions.html#cb522-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">.splitrule =</span> <span class="st">&quot;maxstat&quot;</span></span>
<span id="cb522-47"><a href="solutions.html#cb522-47" aria-hidden="true" tabindex="-1"></a>  ),  </span>
<span id="cb522-48"><a href="solutions.html#cb522-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb522-49"><a href="solutions.html#cb522-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep num.trees keep small for computation</span></span>
<span id="cb522-50"><a href="solutions.html#cb522-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for reproducibility set the seed value</span></span>
<span id="cb522-51"><a href="solutions.html#cb522-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb522-52"><a href="solutions.html#cb522-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb522-53"><a href="solutions.html#cb522-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">100</span>,</span>
<span id="cb522-54"><a href="solutions.html#cb522-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span></span>
<span id="cb522-55"><a href="solutions.html#cb522-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb522-56"><a href="solutions.html#cb522-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-57"><a href="solutions.html#cb522-57" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/eval_model.R&quot;</span>)</span>
<span id="cb522-58"><a href="solutions.html#cb522-58" aria-hidden="true" tabindex="-1"></a><span class="fu">eval_model</span>(</span>
<span id="cb522-59"><a href="solutions.html#cb522-59" aria-hidden="true" tabindex="-1"></a>  mod_best,</span>
<span id="cb522-60"><a href="solutions.html#cb522-60" aria-hidden="true" tabindex="-1"></a>  daily_fluxes_train,</span>
<span id="cb522-61"><a href="solutions.html#cb522-61" aria-hidden="true" tabindex="-1"></a>  daily_fluxes_test</span>
<span id="cb522-62"><a href="solutions.html#cb522-62" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-292-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="solutions.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval_model</span>(</span>
<span id="cb524-2"><a href="solutions.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  mod_worst,</span>
<span id="cb524-3"><a href="solutions.html#cb524-3" aria-hidden="true" tabindex="-1"></a>  daily_fluxes_train,</span>
<span id="cb524-4"><a href="solutions.html#cb524-4" aria-hidden="true" tabindex="-1"></a>  daily_fluxes_test</span>
<span id="cb524-5"><a href="solutions.html#cb524-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-292-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>The performance on the test set for the best model is still close to the performance on the training set, so the model doesn’t seem to overfit. The same goes for the worse model, which leads to worse <span class="math inline">\(R^2\)</span> and RMSE and visually the fit is slightly worse.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="interpretableml.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
