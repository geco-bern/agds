<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>A Solutions | Applied Geodata Science</title>
  <meta name="description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="A Solutions | Applied Geodata Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="github-repo" content="stineb/agsd" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Solutions | Applied Geodata Science" />
  
  <meta name="twitter:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  

<meta name="author" content="Benjamin Stocker (lead), Koen Hufkens (contributing), Pepa Arán (contributing), Pascal Schneider (contributing)" />


<meta name="date" content="2023-02-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="figures/apple-touch-icon.png" />
  <link rel="shortcut icon" href="figures/favicon.ico" type="image/x-icon" />
<link rel="prev" href="randomforest.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Geodata Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-course"><i class="fa fa-check"></i>About this course</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-goal"><i class="fa fa-check"></i>Course goal</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#what-is-applied-geodata-science"><i class="fa fa-check"></i>What is Applied Geodata Science?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#the-data-science-workflow"><i class="fa fa-check"></i>The data science workflow</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#why-now"><i class="fa fa-check"></i>Why now?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-new-modelling-paradigm"><i class="fa fa-check"></i>A new modelling paradigm</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reading-and-link-collection"><i class="fa fa-check"></i>Reading and link collection</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="gettingstarted.html"><a href="gettingstarted.html#learning-objectives-1"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2" data-path="gettingstarted.html"><a href="gettingstarted.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="gettingstarted.html"><a href="gettingstarted.html#working-with-r-and-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Working with R and RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="gettingstarted.html"><a href="gettingstarted.html#r-objects"><i class="fa fa-check"></i><b>1.2.2</b> R objects</a></li>
<li class="chapter" data-level="1.2.3" data-path="gettingstarted.html"><a href="gettingstarted.html#r-environment"><i class="fa fa-check"></i><b>1.2.3</b> R environment</a></li>
<li class="chapter" data-level="1.2.4" data-path="gettingstarted.html"><a href="gettingstarted.html#libraries"><i class="fa fa-check"></i><b>1.2.4</b> Libraries</a></li>
<li class="chapter" data-level="1.2.5" data-path="gettingstarted.html"><a href="gettingstarted.html#r-scripts"><i class="fa fa-check"></i><b>1.2.5</b> R scripts</a></li>
<li class="chapter" data-level="1.2.6" data-path="gettingstarted.html"><a href="gettingstarted.html#rmarkdown"><i class="fa fa-check"></i><b>1.2.6</b> R Markdown</a></li>
<li class="chapter" data-level="1.2.7" data-path="gettingstarted.html"><a href="gettingstarted.html#wspmgmt"><i class="fa fa-check"></i><b>1.2.7</b> Workspace management</a></li>
<li class="chapter" data-level="1.2.8" data-path="gettingstarted.html"><a href="gettingstarted.html#setup"><i class="fa fa-check"></i><b>1.2.8</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="gettingstarted.html"><a href="gettingstarted.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#dimensions-of-a-circle"><i class="fa fa-check"></i>Dimensions of a circle</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#sequence-of-numbers"><i class="fa fa-check"></i>Sequence of numbers</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#gauss-sum"><i class="fa fa-check"></i>Gauss sum</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#magic-trick-algorithm"><i class="fa fa-check"></i>Magic trick algorithm</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#vectors-1"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#data-frames-1"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#workspace"><i class="fa fa-check"></i>Workspace</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programmingprimers.html"><a href="programmingprimers.html"><i class="fa fa-check"></i><b>2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#learning-objectives-2"><i class="fa fa-check"></i><b>2.1</b> Learning objectives</a></li>
<li class="chapter" data-level="2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#programming-basics"><i class="fa fa-check"></i><b>2.2.1</b> Programming basics</a></li>
<li class="chapter" data-level="2.2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#style-your-code"><i class="fa fa-check"></i><b>2.2.2</b> Style your code</a></li>
<li class="chapter" data-level="2.2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#findinghelp"><i class="fa fa-check"></i><b>2.2.3</b> Where to find help</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#exercises-1"><i class="fa fa-check"></i><b>2.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#gauss-variations"><i class="fa fa-check"></i>Gauss variations</a></li>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#nested-loops"><i class="fa fa-check"></i>Nested loops</a></li>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#interpolation"><i class="fa fa-check"></i>Interpolation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datawrangling.html"><a href="datawrangling.html#learning-objectives-3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives</a></li>
<li class="chapter" data-level="3.2" data-path="datawrangling.html"><a href="datawrangling.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datawrangling.html"><a href="datawrangling.html#example-data"><i class="fa fa-check"></i><b>3.2.1</b> Example data</a></li>
<li class="chapter" data-level="3.2.2" data-path="datawrangling.html"><a href="datawrangling.html#tidyverse"><i class="fa fa-check"></i><b>3.2.2</b> Tidyverse</a></li>
<li class="chapter" data-level="3.2.3" data-path="datawrangling.html"><a href="datawrangling.html#reading-tabular-data"><i class="fa fa-check"></i><b>3.2.3</b> Reading tabular data</a></li>
<li class="chapter" data-level="3.2.4" data-path="datawrangling.html"><a href="datawrangling.html#variable-selection"><i class="fa fa-check"></i><b>3.2.4</b> Variable selection</a></li>
<li class="chapter" data-level="3.2.5" data-path="datawrangling.html"><a href="datawrangling.html#time-objects"><i class="fa fa-check"></i><b>3.2.5</b> Time objects</a></li>
<li class="chapter" data-level="3.2.6" data-path="datawrangling.html"><a href="datawrangling.html#variable-re--definition"><i class="fa fa-check"></i><b>3.2.6</b> Variable (re-) definition</a></li>
<li class="chapter" data-level="3.2.7" data-path="datawrangling.html"><a href="datawrangling.html#axes-of-variation"><i class="fa fa-check"></i><b>3.2.7</b> Axes of variation</a></li>
<li class="chapter" data-level="3.2.8" data-path="datawrangling.html"><a href="datawrangling.html#tidydata"><i class="fa fa-check"></i><b>3.2.8</b> Tidy data</a></li>
<li class="chapter" data-level="3.2.9" data-path="datawrangling.html"><a href="datawrangling.html#aggregating-data"><i class="fa fa-check"></i><b>3.2.9</b> Aggregating data</a></li>
<li class="chapter" data-level="3.2.10" data-path="datawrangling.html"><a href="datawrangling.html#data-cleaning"><i class="fa fa-check"></i><b>3.2.10</b> Data cleaning</a></li>
<li class="chapter" data-level="3.2.11" data-path="datawrangling.html"><a href="datawrangling.html#writing-data-to-csv"><i class="fa fa-check"></i><b>3.2.11</b> Writing data to CSV</a></li>
<li class="chapter" data-level="3.2.12" data-path="datawrangling.html"><a href="datawrangling.html#combining-relational-data"><i class="fa fa-check"></i><b>3.2.12</b> Combining relational data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datawrangling.html"><a href="datawrangling.html#extramaterialwrangling"><i class="fa fa-check"></i><b>3.3</b> Extra material</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-i"><i class="fa fa-check"></i><b>3.3.1</b> Functional programming I</a></li>
<li class="chapter" data-level="3.3.2" data-path="datawrangling.html"><a href="datawrangling.html#strings"><i class="fa fa-check"></i><b>3.3.2</b> Strings</a></li>
<li class="chapter" data-level="3.3.3" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-ii"><i class="fa fa-check"></i><b>3.3.3</b> Functional programming II</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datawrangling.html"><a href="datawrangling.html#exerciseswrangling"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#star-wars"><i class="fa fa-check"></i>Star wars</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#aggregating"><i class="fa fa-check"></i>Aggregating</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#patterns-in-data-quality"><i class="fa fa-check"></i>Patterns in data quality</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="datawrangling.html"><a href="datawrangling.html#report-exercise"><i class="fa fa-check"></i><b>3.5</b> Report Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>4</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="datavis.html"><a href="datavis.html#learning-objectives-4"><i class="fa fa-check"></i><b>4.1</b> Learning objectives</a></li>
<li class="chapter" data-level="4.2" data-path="datavis.html"><a href="datavis.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="datavis.html"><a href="datavis.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.2.1</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.2.2" data-path="datavis.html"><a href="datavis.html#every-data-has-its-representation"><i class="fa fa-check"></i><b>4.2.2</b> Every data has its representation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="datavis.html"><a href="datavis.html#exercises-2"><i class="fa fa-check"></i><b>4.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#identifying-outliers"><i class="fa fa-check"></i>Identifying Outliers</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#visualising-diurnal-and-seasonal-cycles-of-gpp"><i class="fa fa-check"></i>Visualising diurnal and seasonal cycles of GPP</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#trend-in-carbon-dioxide-concentrations"><i class="fa fa-check"></i>Trend in carbon dioxide concentrations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="datavis.html"><a href="datavis.html#report-exercises"><i class="fa fa-check"></i><b>4.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#telling-a-story-from-data"><i class="fa fa-check"></i>Telling a story from data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datavariety.html"><a href="datavariety.html"><i class="fa fa-check"></i><b>5</b> Data variety</a>
<ul>
<li class="chapter" data-level="5.1" data-path="datavariety.html"><a href="datavariety.html#learning-objectives-5"><i class="fa fa-check"></i><b>5.1</b> Learning objectives</a></li>
<li class="chapter" data-level="5.2" data-path="datavariety.html"><a href="datavariety.html#tutorial-4"><i class="fa fa-check"></i><b>5.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats"><i class="fa fa-check"></i><b>5.2.1</b> Files and file formats</a></li>
<li class="chapter" data-level="5.2.2" data-path="datavariety.html"><a href="datavariety.html#meta-data"><i class="fa fa-check"></i><b>5.2.2</b> Meta-data</a></li>
<li class="chapter" data-level="5.2.3" data-path="datavariety.html"><a href="datavariety.html#spatial-data-representation"><i class="fa fa-check"></i><b>5.2.3</b> Spatial data representation</a></li>
<li class="chapter" data-level="5.2.4" data-path="datavariety.html"><a href="datavariety.html#online-data-sources"><i class="fa fa-check"></i><b>5.2.4</b> Online data sources</a></li>
<li class="chapter" data-level="5.2.5" data-path="datavariety.html"><a href="datavariety.html#example-environmental-data-repositories"><i class="fa fa-check"></i><b>5.2.5</b> Example environmental data repositories</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="datavariety.html"><a href="datavariety.html#exercises-3"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats-1"><i class="fa fa-check"></i>Files and file formats</a></li>
<li class="chapter" data-level="" data-path="datavariety.html"><a href="datavariety.html#api-use"><i class="fa fa-check"></i>API use</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="openscience.html"><a href="openscience.html"><i class="fa fa-check"></i><b>6</b> Open science practices</a>
<ul>
<li class="chapter" data-level="6.1" data-path="openscience.html"><a href="openscience.html#learning-objectives-6"><i class="fa fa-check"></i><b>6.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.2" data-path="openscience.html"><a href="openscience.html#tutorial-5"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="openscience.html"><a href="openscience.html#project-structure"><i class="fa fa-check"></i><b>6.2.1</b> Project structure</a></li>
<li class="chapter" data-level="6.2.2" data-path="openscience.html"><a href="openscience.html#managing-workflows"><i class="fa fa-check"></i><b>6.2.2</b> Managing workflows</a></li>
<li class="chapter" data-level="6.2.3" data-path="openscience.html"><a href="openscience.html#capturing-your-session-state"><i class="fa fa-check"></i><b>6.2.3</b> Capturing your session state</a></li>
<li class="chapter" data-level="6.2.4" data-path="openscience.html"><a href="openscience.html#capturing-a-system-state"><i class="fa fa-check"></i><b>6.2.4</b> Capturing a system state</a></li>
<li class="chapter" data-level="6.2.5" data-path="openscience.html"><a href="openscience.html#readable-reporting-using-rmarkdown"><i class="fa fa-check"></i><b>6.2.5</b> Readable reporting using Rmarkdown</a></li>
<li class="chapter" data-level="6.2.6" data-path="openscience.html"><a href="openscience.html#data-retention"><i class="fa fa-check"></i><b>6.2.6</b> Data retention</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="openscience.html"><a href="openscience.html#exercises-4"><i class="fa fa-check"></i><b>6.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#external-data"><i class="fa fa-check"></i>External data</a></li>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#a-new-project"><i class="fa fa-check"></i>A new project</a></li>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#tracking-the-state-of-your-project"><i class="fa fa-check"></i>Tracking the state of your project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="codemgmt.html"><a href="codemgmt.html"><i class="fa fa-check"></i><b>7</b> Code management</a>
<ul>
<li class="chapter" data-level="7.1" data-path="codemgmt.html"><a href="codemgmt.html#learning-objectives-7"><i class="fa fa-check"></i><b>7.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.2" data-path="codemgmt.html"><a href="codemgmt.html#tutorial-6"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="codemgmt.html"><a href="codemgmt.html#gitworkflow"><i class="fa fa-check"></i><b>7.2.1</b> Git and local version control</a></li>
<li class="chapter" data-level="7.2.2" data-path="codemgmt.html"><a href="codemgmt.html#remote-version-control"><i class="fa fa-check"></i><b>7.2.2</b> Remote version control</a></li>
<li class="chapter" data-level="7.2.3" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management---github-templates"><i class="fa fa-check"></i><b>7.2.3</b> Location based code management - github templates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="codemgmt.html"><a href="codemgmt.html#exercises-5"><i class="fa fa-check"></i><b>7.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management"><i class="fa fa-check"></i>Location based code management</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="codemgmt.html"><a href="codemgmt.html#report-exercises-1"><i class="fa fa-check"></i><b>7.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#collaborative-work-on-github"><i class="fa fa-check"></i>Collaborative Work on Github</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regressionclassification.html"><a href="regressionclassification.html"><i class="fa fa-check"></i><b>8</b> Regression and classification</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regressionclassification.html"><a href="regressionclassification.html#learning-objectives-8"><i class="fa fa-check"></i><b>8.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.2" data-path="regressionclassification.html"><a href="regressionclassification.html#tutorial-7"><i class="fa fa-check"></i><b>8.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regressionclassification.html"><a href="regressionclassification.html#types-of-models"><i class="fa fa-check"></i><b>8.2.1</b> Types of models</a></li>
<li class="chapter" data-level="8.2.2" data-path="regressionclassification.html"><a href="regressionclassification.html#regression"><i class="fa fa-check"></i><b>8.2.2</b> Regression</a></li>
<li class="chapter" data-level="8.2.3" data-path="regressionclassification.html"><a href="regressionclassification.html#classification"><i class="fa fa-check"></i><b>8.2.3</b> Classification</a></li>
<li class="chapter" data-level="8.2.4" data-path="regressionclassification.html"><a href="regressionclassification.html#model-evaluation"><i class="fa fa-check"></i><b>8.2.4</b> Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regressionclassification.html"><a href="regressionclassification.html#exercises-6"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
<li class="chapter" data-level="8.4" data-path="regressionclassification.html"><a href="regressionclassification.html#report-exercise-1"><i class="fa fa-check"></i><b>8.4</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#stepwise-regression-and-asking-for-help"><i class="fa fa-check"></i>Stepwise regression and asking for help</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="supervisedmli.html"><a href="supervisedmli.html"><i class="fa fa-check"></i><b>9</b> Supervised machine learning I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="supervisedmli.html"><a href="supervisedmli.html#learning-objectives-9"><i class="fa fa-check"></i><b>9.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="supervisedmli.html"><a href="supervisedmli.html#tutorial-8"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="supervisedmli.html"><a href="supervisedmli.html#what-is-supervised-machine-learning"><i class="fa fa-check"></i><b>9.2.1</b> What is supervised machine learning?</a></li>
<li class="chapter" data-level="9.2.2" data-path="supervisedmli.html"><a href="supervisedmli.html#overfitting"><i class="fa fa-check"></i><b>9.2.2</b> Overfitting</a></li>
<li class="chapter" data-level="9.2.3" data-path="supervisedmli.html"><a href="supervisedmli.html#data-and-the-modelling-challenge"><i class="fa fa-check"></i><b>9.2.3</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="9.2.4" data-path="supervisedmli.html"><a href="supervisedmli.html#k-nearest-neighbours"><i class="fa fa-check"></i><b>9.2.4</b> K-nearest neighbours</a></li>
<li class="chapter" data-level="9.2.5" data-path="supervisedmli.html"><a href="supervisedmli.html#model-formulation"><i class="fa fa-check"></i><b>9.2.5</b> Model formulation</a></li>
<li class="chapter" data-level="9.2.6" data-path="supervisedmli.html"><a href="supervisedmli.html#data-splitting"><i class="fa fa-check"></i><b>9.2.6</b> Data splitting</a></li>
<li class="chapter" data-level="9.2.7" data-path="supervisedmli.html"><a href="supervisedmli.html#preprocessing"><i class="fa fa-check"></i><b>9.2.7</b> Pre-processing</a></li>
<li class="chapter" data-level="9.2.8" data-path="supervisedmli.html"><a href="supervisedmli.html#putting-it-all-together-half-way"><i class="fa fa-check"></i><b>9.2.8</b> Putting it all together (half-way)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="supervisedmli.html"><a href="supervisedmli.html#exercises-7"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
<li class="chapter" data-level="9.4" data-path="supervisedmli.html"><a href="supervisedmli.html#report-exercises-2"><i class="fa fa-check"></i><b>9.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmli.html"><a href="supervisedmli.html#the-role-of-picking-a-hyperparameter"><i class="fa fa-check"></i>The role of picking a hyperparameter</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="supervisedmlii.html"><a href="supervisedmlii.html"><i class="fa fa-check"></i><b>10</b> Supervised machine learning II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#learning-objectives-10"><i class="fa fa-check"></i><b>10.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#tutorial-9"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#data-and-the-modelling-challenge-1"><i class="fa fa-check"></i><b>10.2.1</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="10.2.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#training"><i class="fa fa-check"></i><b>10.2.2</b> Loss function</a></li>
<li class="chapter" data-level="10.2.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#hyperparameters"><i class="fa fa-check"></i><b>10.2.3</b> Hyperparameters</a></li>
<li class="chapter" data-level="10.2.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#resampling"><i class="fa fa-check"></i><b>10.2.4</b> Resampling</a></li>
<li class="chapter" data-level="10.2.5" data-path="supervisedmlii.html"><a href="supervisedmlii.html#validation-versus-testing-data"><i class="fa fa-check"></i><b>10.2.5</b> Validation versus testing data</a></li>
<li class="chapter" data-level="10.2.6" data-path="supervisedmlii.html"><a href="supervisedmlii.html#modeling-with-structured-data"><i class="fa fa-check"></i><b>10.2.6</b> Modeling with structured data</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#exercises-8"><i class="fa fa-check"></i><b>10.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmlii.html"><a href="supervisedmlii.html#cross-validation-by-hand"><i class="fa fa-check"></i>Cross-validation by hand</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#report-exercises-3"><i class="fa fa-check"></i><b>10.4</b> Report Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="randomforest.html"><a href="randomforest.html"><i class="fa fa-check"></i><b>11</b> Random Forest</a>
<ul>
<li class="chapter" data-level="11.1" data-path="randomforest.html"><a href="randomforest.html#learning-objectives-11"><i class="fa fa-check"></i><b>11.1</b> Learning objectives</a></li>
<li class="chapter" data-level="11.2" data-path="randomforest.html"><a href="randomforest.html#tutorial-10"><i class="fa fa-check"></i><b>11.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="randomforest.html"><a href="randomforest.html#decision-trees"><i class="fa fa-check"></i><b>11.2.1</b> Decision trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="randomforest.html"><a href="randomforest.html#bagging"><i class="fa fa-check"></i><b>11.2.2</b> Bagging</a></li>
<li class="chapter" data-level="11.2.3" data-path="randomforest.html"><a href="randomforest.html#from-trees-to-a-forest"><i class="fa fa-check"></i><b>11.2.3</b> From trees to a forest</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i><b>A</b> Solutions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="solutions.html"><a href="solutions.html#getting-started"><i class="fa fa-check"></i><b>A.1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#dimensions-of-a-circle-1"><i class="fa fa-check"></i>Dimensions of a circle</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#sequence-of-numbers-1"><i class="fa fa-check"></i>Sequence of numbers</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#gauss-sum-1"><i class="fa fa-check"></i>Gauss sum</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#magic-trick-algorithm-1"><i class="fa fa-check"></i>Magic trick algorithm</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#vectors-2"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#data-frames-2"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#workspace-1"><i class="fa fa-check"></i>Workspace</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="solutions.html"><a href="solutions.html#programming-primers"><i class="fa fa-check"></i><b>A.2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#gauss-variations-1"><i class="fa fa-check"></i>Gauss variations</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#nested-loops-1"><i class="fa fa-check"></i>Nested loops</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#interpolation-1"><i class="fa fa-check"></i>Interpolation</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="solutions.html"><a href="solutions.html#data-wrangling"><i class="fa fa-check"></i><b>A.3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#star-wars-1"><i class="fa fa-check"></i>Star wars</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#aggregating-1"><i class="fa fa-check"></i>Aggregating</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#patterns-in-data-quality-1"><i class="fa fa-check"></i>Patterns in data quality</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#tidying-an-excel-file"><i class="fa fa-check"></i>Tidying an Excel-file</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="solutions.html"><a href="solutions.html#data-visualisation"><i class="fa fa-check"></i><b>A.4</b> Data Visualisation</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#identifying-outliers-1"><i class="fa fa-check"></i>Identifying Outliers</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#diurnal-and-seasonal-cycles"><i class="fa fa-check"></i>Diurnal and seasonal cycles</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#trend-in-carbon-dioxide-concentrations-1"><i class="fa fa-check"></i>Trend in carbon dioxide concentrations</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#telling-a-story-from-data-1"><i class="fa fa-check"></i>Telling a story from data</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="solutions.html"><a href="solutions.html#data-variety"><i class="fa fa-check"></i><b>A.5</b> Data Variety</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#files-and-file-formats-2"><i class="fa fa-check"></i>Files and file formats</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="solutions.html"><a href="solutions.html#open-science"><i class="fa fa-check"></i><b>A.6</b> Open Science</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#external-data-1"><i class="fa fa-check"></i>External data</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#a-new-project-1"><i class="fa fa-check"></i>A new project</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#tracking-the-state-of-your-project-1"><i class="fa fa-check"></i>Tracking the state of your project</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="solutions.html"><a href="solutions.html#code-management"><i class="fa fa-check"></i><b>A.7</b> Code Management</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#location-based-code-management-1"><i class="fa fa-check"></i>Location based code management</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#collaborative-work-on-github-1"><i class="fa fa-check"></i>Collaborative Work on Github</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="solutions.html"><a href="solutions.html#regression-and-classification"><i class="fa fa-check"></i><b>A.8</b> Regression and Classification</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#stepwise-regression-and-asking-for-help-1"><i class="fa fa-check"></i>Stepwise regression and asking for help</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="solutions.html"><a href="solutions.html#supervised-ml-i"><i class="fa fa-check"></i><b>A.9</b> Supervised ML I</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#comparison-of-lm-and-knn"><i class="fa fa-check"></i>Comparison of LM and KNN</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#the-role-of-picking-a-hyperparameter-1"><i class="fa fa-check"></i>The role of picking a hyperparameter</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="solutions.html"><a href="solutions.html#supervised-ml-ii"><i class="fa fa-check"></i><b>A.10</b> Supervised ML II</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#cross-validation-by-hand-1"><i class="fa fa-check"></i>Cross-validation by hand</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#testing-the-generalisability-of-a-model"><i class="fa fa-check"></i>Testing the generalisability of a model</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="solutions.html"><a href="solutions.html#random-forests"><i class="fa fa-check"></i><b>A.11</b> Random Forests</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#system-information-and-package-list"><i class="fa fa-check"></i>System information and package list</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Geodata Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="solutions" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">A</span> Solutions<a href="solutions.html#solutions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="getting-started" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">A.1</span> Getting Started<a href="solutions.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="dimensions-of-a-circle-1" class="section level3 unnumbered hasAnchor">
<h3>Dimensions of a circle<a href="solutions.html#dimensions-of-a-circle-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Given the radius of a circle write a few lines of code that calculates its area and its circumference. Run your code with different values assigned of the radius.</li>
</ul>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="solutions.html#cb414-1" aria-hidden="true" tabindex="-1"></a>radius <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb414-2"><a href="solutions.html#cb414-2" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> pi <span class="sc">*</span> radius<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb414-3"><a href="solutions.html#cb414-3" aria-hidden="true" tabindex="-1"></a>circum <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> radius</span></code></pre></div>
<ul>
<li>Print the solution as text.</li>
</ul>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="solutions.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Radius:&quot;</span>, radius, <span class="st">&quot;   Circumference:&quot;</span>, circum))</span></code></pre></div>
<pre><code>## [1] &quot;Radius: 1    Circumference: 6.28318530717959&quot;</code></pre>
</div>
<div id="sequence-of-numbers-1" class="section level3 unnumbered hasAnchor">
<h3>Sequence of numbers<a href="solutions.html#sequence-of-numbers-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generate a sequence of numbers from 0 and <span class="math inline">\(\pi\)</span> as a vector with length 5.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="solutions.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.0000000 0.7853982 1.5707963 2.3561945 3.1415927</code></pre>
</div>
<div id="gauss-sum-1" class="section level3 unnumbered hasAnchor">
<h3>Gauss sum<a href="solutions.html#gauss-sum-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rumors have it that young Carl Friedrich Gauss was asked in primary school to calculate the sum of all natural numbers between 1 and 100. He did it in his head in no time. We’re very likely not as intelligent as young Gauss. But we have R. What’s the solution?</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="solutions.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Gauss calculated the sum with a trick. The sum of 100 and 1 is 101. The sum of 99 and 2 is 101. You do this 50 times, and you get <span class="math inline">\(50 \times 101\)</span>. Demonstrate Gauss’ trick with vectors in R.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="solutions.html#cb421-1" aria-hidden="true" tabindex="-1"></a>vec_a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb421-2"><a href="solutions.html#cb421-2" aria-hidden="true" tabindex="-1"></a>vec_b <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">:</span><span class="dv">51</span></span>
<span id="cb421-3"><a href="solutions.html#cb421-3" aria-hidden="true" tabindex="-1"></a>vec_c <span class="ot">&lt;-</span> vec_a <span class="sc">+</span> vec_b</span>
<span id="cb421-4"><a href="solutions.html#cb421-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-5"><a href="solutions.html#cb421-5" aria-hidden="true" tabindex="-1"></a><span class="co"># each element is 101</span></span>
<span id="cb421-6"><a href="solutions.html#cb421-6" aria-hidden="true" tabindex="-1"></a>vec_c</span></code></pre></div>
<pre><code>##  [1] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [20] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [39] 101 101 101 101 101 101 101 101 101 101 101 101</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="solutions.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the length of vectors is fifty. 50 * 101</span></span>
<span id="cb423-2"><a href="solutions.html#cb423-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(vec_c)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
</div>
<div id="magic-trick-algorithm-1" class="section level3 unnumbered hasAnchor">
<h3>Magic trick algorithm<a href="solutions.html#magic-trick-algorithm-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Define a variable named <code>x</code> that contains an integer value and perform the following operations in sequence:</p>
<ul>
<li>Redefine <code>x</code> by adding 1.</li>
<li>Double the resulting number, over-writing <code>x</code>.</li>
<li>Add 4 to <code>x</code> and save the result as <code>x</code>.</li>
<li>Redefine <code>x</code> as half of the previous value of <code>x</code>.</li>
<li>Subtract the originally chosen arbitrary number from <code>x</code>.</li>
</ul>
<p>Print <code>x</code>. Restart the algorithm defined above by choosing a new arbitrary natural number.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="solutions.html#cb425-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">999</span>  <span class="co"># arbitrary integer</span></span>
<span id="cb425-2"><a href="solutions.html#cb425-2" aria-hidden="true" tabindex="-1"></a>x_save <span class="ot">&lt;-</span> x  <span class="co"># save for the last step</span></span>
<span id="cb425-3"><a href="solutions.html#cb425-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb425-4"><a href="solutions.html#cb425-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb425-5"><a href="solutions.html#cb425-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb425-6"><a href="solutions.html#cb425-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb425-7"><a href="solutions.html#cb425-7" aria-hidden="true" tabindex="-1"></a>x <span class="sc">-</span> x_save</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="vectors-2" class="section level3 unnumbered hasAnchor">
<h3>Vectors<a href="solutions.html#vectors-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print the object <code>datasets::rivers</code> and consult the manual of this object.</p>
<ul>
<li>What is the class of the object?</li>
<li>What is the length of the object?</li>
<li>Calculate the mean, median, minimum, maximum, and the 33%-quantile across all values.</li>
</ul>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="solutions.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="solutions.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] 141</code></pre>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="solutions.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] 591.1844</code></pre>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="solutions.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(datasets<span class="sc">::</span>rivers, <span class="at">probs =</span> <span class="fl">0.33</span>)</span></code></pre></div>
<pre><code>## 33% 
## 342</code></pre>
</div>
<div id="data-frames-2" class="section level3 unnumbered hasAnchor">
<h3>Data frames<a href="solutions.html#data-frames-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print the object <code>datasets::quakes</code> and consult the manual of this object.</p>
<ul>
<li>Determine the dimensions of the data frame using the respective function in R.</li>
<li>Extract the vector of values in the data frame that contain information about the Richter Magnitude.</li>
<li>Determine the value largest value in the vector of event magnitudes.</li>
<li>Determine the geographic position of the epicenter of the largest event.</li>
</ul>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="solutions.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datasets<span class="sc">::</span>quakes)</span></code></pre></div>
<pre><code>## [1] 1000    5</code></pre>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="solutions.html#cb437-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> datasets<span class="sc">::</span>quakes<span class="sc">$</span>mag</span>
<span id="cb437-2"><a href="solutions.html#cb437-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(vec)</span></code></pre></div>
<pre><code>## [1] 6.4</code></pre>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="solutions.html#cb439-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(vec)  <span class="co"># index of largest value</span></span>
<span id="cb439-2"><a href="solutions.html#cb439-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-3"><a href="solutions.html#cb439-3" aria-hidden="true" tabindex="-1"></a><span class="co"># geographic positions defined by longitude and latitude (columns long and lat)</span></span>
<span id="cb439-4"><a href="solutions.html#cb439-4" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>quakes<span class="sc">$</span>long[idx]</span></code></pre></div>
<pre><code>## [1] 167.62</code></pre>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="solutions.html#cb441-1" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>quakes<span class="sc">$</span>lat[idx]</span></code></pre></div>
<pre><code>## [1] -15.56</code></pre>
</div>
<div id="workspace-1" class="section level3 unnumbered hasAnchor">
<h3>Workspace<a href="solutions.html#workspace-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create a new <em>R project</em> and create sub-directories in a meaningful way (as described in this Chapter). Create an RMarkdown file in your new project which implements your solutions to above exercises. Give the file a title, implement some structure in the document, and write some text explaining what your code does.</p>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
</div>
<div id="programming-primers" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">A.2</span> Programming primers<a href="solutions.html#programming-primers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="gauss-variations-1" class="section level3 unnumbered hasAnchor">
<h3>Gauss variations<a href="solutions.html#gauss-variations-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="solutions.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for-loop to compute sum from 1 - 100</span></span>
<span id="cb443-2"><a href="solutions.html#cb443-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb443-3"><a href="solutions.html#cb443-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb443-4"><a href="solutions.html#cb443-4" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> i <span class="co"># for-loop iterating from 1 to 100 </span></span>
<span id="cb443-5"><a href="solutions.html#cb443-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb443-6"><a href="solutions.html#cb443-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="solutions.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="co"># while-loop to compute sum from 1 - 100</span></span>
<span id="cb445-2"><a href="solutions.html#cb445-2" aria-hidden="true" tabindex="-1"></a>loop_status <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb445-3"><a href="solutions.html#cb445-3" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb445-4"><a href="solutions.html#cb445-4" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb445-5"><a href="solutions.html#cb445-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (loop_status) { <span class="co"># while-loop is repeated as long as loop_status is true</span></span>
<span id="cb445-6"><a href="solutions.html#cb445-6" aria-hidden="true" tabindex="-1"></a>  counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb445-7"><a href="solutions.html#cb445-7" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> counter</span>
<span id="cb445-8"><a href="solutions.html#cb445-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (counter <span class="sc">==</span> <span class="dv">100</span>) loop_status <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb445-9"><a href="solutions.html#cb445-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb445-10"><a href="solutions.html#cb445-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="solutions.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initiate sum variable</span></span>
<span id="cb447-2"><a href="solutions.html#cb447-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb447-3"><a href="solutions.html#cb447-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-4"><a href="solutions.html#cb447-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Go through loop from 1 to 100</span></span>
<span id="cb447-5"><a href="solutions.html#cb447-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">100</span>)) {</span>
<span id="cb447-6"><a href="solutions.html#cb447-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb447-7"><a href="solutions.html#cb447-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the current number a muliple of three and seven</span></span>
<span id="cb447-8"><a href="solutions.html#cb447-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The modulo operator &#39;%%&#39; returns the remainder of a division</span></span>
<span id="cb447-9"><a href="solutions.html#cb447-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">3</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> i <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span> ) {</span>
<span id="cb447-10"><a href="solutions.html#cb447-10" aria-hidden="true" tabindex="-1"></a>        sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> i</span>
<span id="cb447-11"><a href="solutions.html#cb447-11" aria-hidden="true" tabindex="-1"></a>    }   </span>
<span id="cb447-12"><a href="solutions.html#cb447-12" aria-hidden="true" tabindex="-1"></a>}   </span>
<span id="cb447-13"><a href="solutions.html#cb447-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;The sum of multiples of 3 and 7 within 1-100 is: &quot;</span>, sum))</span></code></pre></div>
<pre><code>## [1] &quot;The sum of multiples of 3 and 7 within 1-100 is: 210&quot;</code></pre>
</div>
<div id="nested-loops-1" class="section level3 unnumbered hasAnchor">
<h3>Nested loops<a href="solutions.html#nested-loops-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="solutions.html#cb449-1" aria-hidden="true" tabindex="-1"></a>mymat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">15</span>, <span class="dv">6</span>, <span class="dv">7</span>, </span>
<span id="cb449-2"><a href="solutions.html#cb449-2" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="cn">NA</span>, <span class="dv">3</span>, </span>
<span id="cb449-3"><a href="solutions.html#cb449-3" aria-hidden="true" tabindex="-1"></a>              <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="cn">NA</span>, <span class="dv">6</span>, </span>
<span id="cb449-4"><a href="solutions.html#cb449-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">7</span>)),</span>
<span id="cb449-5"><a href="solutions.html#cb449-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb449-6"><a href="solutions.html#cb449-6" aria-hidden="true" tabindex="-1"></a>myvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">6</span>)</span></code></pre></div>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="solutions.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the rows in `mymat`.</span></span>
<span id="cb450-2"><a href="solutions.html#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mymat)){</span>
<span id="cb450-3"><a href="solutions.html#cb450-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb450-4"><a href="solutions.html#cb450-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over the columns in `mymat`.</span></span>
<span id="cb450-5"><a href="solutions.html#cb450-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mymat)){</span>
<span id="cb450-6"><a href="solutions.html#cb450-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb450-7"><a href="solutions.html#cb450-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if current value is missing, if so overwrite with max in &#39;myvec&#39;</span></span>
<span id="cb450-8"><a href="solutions.html#cb450-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(mymat[i,j])){</span>
<span id="cb450-9"><a href="solutions.html#cb450-9" aria-hidden="true" tabindex="-1"></a>      mymat[i,j] <span class="ot">&lt;-</span> <span class="fu">max</span>(myvec)</span>
<span id="cb450-10"><a href="solutions.html#cb450-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb450-11"><a href="solutions.html#cb450-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb450-12"><a href="solutions.html#cb450-12" aria-hidden="true" tabindex="-1"></a>  myvec <span class="ot">&lt;-</span> myvec[<span class="sc">-</span><span class="fu">which.max</span>(myvec)] <span class="co"># update the vector removing the maximum value</span></span>
<span id="cb450-13"><a href="solutions.html#cb450-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb450-14"><a href="solutions.html#cb450-14" aria-hidden="true" tabindex="-1"></a>mymat</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
## [1,]    6    7    3   15   15    6    7
## [2,]   12    9   12    6   11   12    3
## [3,]    9    4    7    3   21    9    6
## [4,]    8    8    8    8    8    8    8</code></pre>
</div>
<div id="interpolation-1" class="section level3 unnumbered hasAnchor">
<h3>Interpolation<a href="solutions.html#interpolation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="solutions.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up vector as required in the exercise</span></span>
<span id="cb452-2"><a href="solutions.html#cb452-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>) <span class="co"># initialize vector of length 100 with NA</span></span>
<span id="cb452-3"><a href="solutions.html#cb452-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># populate first 25 elements of &#39;vec&#39; with 6. </span></span>
<span id="cb452-4"><a href="solutions.html#cb452-4" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">66</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">20</span>  <span class="co"># populate elements 66:100 with -20.</span></span>
<span id="cb452-5"><a href="solutions.html#cb452-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-6"><a href="solutions.html#cb452-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine index of last non-missing value before gap</span></span>
<span id="cb452-7"><a href="solutions.html#cb452-7" aria-hidden="true" tabindex="-1"></a>last_non_na <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb452-8"><a href="solutions.html#cb452-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="sc">!</span><span class="fu">is.na</span>(vec[last_non_na<span class="sc">+</span><span class="dv">1</span>])) last_non_na <span class="ot">&lt;-</span> last_non_na <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb452-9"><a href="solutions.html#cb452-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-10"><a href="solutions.html#cb452-10" aria-hidden="true" tabindex="-1"></a><span class="co"># determine index of first non-missing value after gap</span></span>
<span id="cb452-11"><a href="solutions.html#cb452-11" aria-hidden="true" tabindex="-1"></a>first_non_na <span class="ot">&lt;-</span> last_non_na <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb452-12"><a href="solutions.html#cb452-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="fu">is.na</span>(vec[first_non_na])) first_non_na <span class="ot">&lt;-</span> first_non_na <span class="sc">+</span> <span class="dv">1</span>   </span>
<span id="cb452-13"><a href="solutions.html#cb452-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-14"><a href="solutions.html#cb452-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the increment that is needed for interpolation</span></span>
<span id="cb452-15"><a href="solutions.html#cb452-15" aria-hidden="true" tabindex="-1"></a>last_value  <span class="ot">&lt;-</span> vec[last_non_na]  <span class="co"># Last non-NA value</span></span>
<span id="cb452-16"><a href="solutions.html#cb452-16" aria-hidden="true" tabindex="-1"></a>first_value <span class="ot">&lt;-</span> vec[first_non_na] <span class="co"># First non-NA value</span></span>
<span id="cb452-17"><a href="solutions.html#cb452-17" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> (last_value <span class="sc">-</span> first_value) <span class="sc">/</span> (last_non_na <span class="sc">-</span> first_non_na) <span class="co"># Change in y over change in x</span></span>
<span id="cb452-18"><a href="solutions.html#cb452-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-19"><a href="solutions.html#cb452-19" aria-hidden="true" tabindex="-1"></a><span class="co"># fill missing values incrementally</span></span>
<span id="cb452-20"><a href="solutions.html#cb452-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(vec)){</span>
<span id="cb452-21"><a href="solutions.html#cb452-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(vec[i])) vec[i] <span class="ot">&lt;-</span> vec[i<span class="dv">-1</span>] <span class="sc">+</span> delta</span>
<span id="cb452-22"><a href="solutions.html#cb452-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb452-23"><a href="solutions.html#cb452-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-24"><a href="solutions.html#cb452-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vec)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-237-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="solutions.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or short using the approx() function:</span></span>
<span id="cb453-2"><a href="solutions.html#cb453-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>) <span class="co"># initialize vector of length 100 with NA</span></span>
<span id="cb453-3"><a href="solutions.html#cb453-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># populate first 25 elements of &#39;vec&#39; with 6. </span></span>
<span id="cb453-4"><a href="solutions.html#cb453-4" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">66</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">20</span>  <span class="co"># populate elements 66:100 with -20.</span></span>
<span id="cb453-5"><a href="solutions.html#cb453-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-6"><a href="solutions.html#cb453-6" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">approx</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, vec, <span class="at">xout =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb453-7"><a href="solutions.html#cb453-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-8"><a href="solutions.html#cb453-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vec)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-237-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="data-wrangling" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">A.3</span> Data wrangling<a href="solutions.html#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="star-wars-1" class="section level3 unnumbered hasAnchor">
<h3>Star wars<a href="solutions.html#star-wars-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>{dplyr} comes with a toy dataset <code>dplyr::starwars</code> (just type it into the console to see its content). Have a look at the dataset with <code>View()</code>. Play around with the dataset to get familiar with the {tidyverse} coding style. Use (possibly among others) the functions <code>dplyr::filter()</code>, <code>dplyr::arrange()</code>, <code>dplyr::pull()</code>, <code>dplyr::select()</code>, <code>dplyr::desc()</code> and <code>dplyr::slice()</code> to answer the following question:</p>
<ul>
<li>How many pale characters come from the planets Ryloth or Naboo?</li>
</ul>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="solutions.html#cb454-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb454-2"><a href="solutions.html#cb454-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(skin_color <span class="sc">==</span> <span class="st">&quot;pale&quot;</span> <span class="sc">&amp;</span> (homeworld <span class="sc">==</span> <span class="st">&quot;Naboo&quot;</span> <span class="sc">|</span> homeworld <span class="sc">==</span> <span class="st">&quot;Ryloth&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb454-3"><a href="solutions.html#cb454-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()   </span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<ul>
<li>Who is the oldest among the tallest thirty characters?</li>
</ul>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="solutions.html#cb456-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb456-2"><a href="solutions.html#cb456-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(height)) <span class="sc">|&gt;</span> </span>
<span id="cb456-3"><a href="solutions.html#cb456-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb456-4"><a href="solutions.html#cb456-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(birth_year) <span class="sc">|&gt;</span> </span>
<span id="cb456-5"><a href="solutions.html#cb456-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb456-6"><a href="solutions.html#cb456-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name)</span></code></pre></div>
<pre><code>## [1] &quot;IG-88&quot;</code></pre>
<ul>
<li>What is the name of the shortest character and their starship in “Return of the Jedi”?</li>
</ul>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="solutions.html#cb458-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb458-2"><a href="solutions.html#cb458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(films) <span class="sc">|&gt;</span> </span>
<span id="cb458-3"><a href="solutions.html#cb458-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(films <span class="sc">==</span> <span class="st">&quot;Return of the Jedi&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb458-4"><a href="solutions.html#cb458-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(starships) <span class="sc">|&gt;</span> </span>
<span id="cb458-5"><a href="solutions.html#cb458-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(height) <span class="sc">|&gt;</span> </span>
<span id="cb458-6"><a href="solutions.html#cb458-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb458-7"><a href="solutions.html#cb458-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, starships)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   name      starships        
##   &lt;chr&gt;     &lt;chr&gt;            
## 1 Nien Nunb Millennium Falcon</code></pre>
</div>
<div id="aggregating-1" class="section level3 unnumbered hasAnchor">
<h3>Aggregating<a href="solutions.html#aggregating-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have learned about aggregating in the {tidyverse}. Let’s put it in practice.</p>
<ul>
<li>Reuse the code in the tutorial to read, reduce, and aggregate the <code>half_hourly_fluxes</code> dataset to the daily scale, calculating the following metrics across half-hourly <code>VPD_F</code> values within each day: mean, 25% quantile, and 75% quantile.</li>
</ul>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="solutions.html#cb460-1" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb460-2"><a href="solutions.html#cb460-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb460-3"><a href="solutions.html#cb460-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only variables that we are interested in</span></span>
<span id="cb460-4"><a href="solutions.html#cb460-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb460-5"><a href="solutions.html#cb460-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;TIMESTAMP&quot;</span>),</span>
<span id="cb460-6"><a href="solutions.html#cb460-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">&quot;_F&quot;</span>),</span>
<span id="cb460-7"><a href="solutions.html#cb460-7" aria-hidden="true" tabindex="-1"></a>    GPP_NT_VUT_REF,</span>
<span id="cb460-8"><a href="solutions.html#cb460-8" aria-hidden="true" tabindex="-1"></a>    NEE_VUT_REF_QC,</span>
<span id="cb460-9"><a href="solutions.html#cb460-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;SWC_F_MDS_&quot;</span>),</span>
<span id="cb460-10"><a href="solutions.html#cb460-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;JSB&quot;</span>)</span>
<span id="cb460-11"><a href="solutions.html#cb460-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb460-12"><a href="solutions.html#cb460-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-13"><a href="solutions.html#cb460-13" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span>  </span>
<span id="cb460-14"><a href="solutions.html#cb460-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-15"><a href="solutions.html#cb460-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean the datetime objects</span></span>
<span id="cb460-16"><a href="solutions.html#cb460-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb460-17"><a href="solutions.html#cb460-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">date      =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb460-18"><a href="solutions.html#cb460-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-19"><a href="solutions.html#cb460-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate to daily scale</span></span>
<span id="cb460-20"><a href="solutions.html#cb460-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb460-21"><a href="solutions.html#cb460-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(VPD_F),</span>
<span id="cb460-22"><a href="solutions.html#cb460-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">q25  =</span> <span class="fu">quantile</span>(VPD_F, <span class="at">probs =</span> <span class="fl">0.25</span>),</span>
<span id="cb460-23"><a href="solutions.html#cb460-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">q75  =</span> <span class="fu">quantile</span>(VPD_F, <span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb460-24"><a href="solutions.html#cb460-24" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<ul>
<li>Retain only the daily data for which the daily mean VPD is among the upper or the lower 10% quantiles.</li>
</ul>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="solutions.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In two steps. First, get thresholds of the quantiles</span></span>
<span id="cb461-2"><a href="solutions.html#cb461-2" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_fluxes<span class="sc">$</span>mean, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>))</span>
<span id="cb461-3"><a href="solutions.html#cb461-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-4"><a href="solutions.html#cb461-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, filter data to be above/below the upper/lower quantiles and combine</span></span>
<span id="cb461-5"><a href="solutions.html#cb461-5" aria-hidden="true" tabindex="-1"></a>daily_fluxes_sub <span class="ot">&lt;-</span> daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb461-6"><a href="solutions.html#cb461-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb461-7"><a href="solutions.html#cb461-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in lower 10% quantile</span></span>
<span id="cb461-8"><a href="solutions.html#cb461-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean <span class="sc">&lt;</span> thresholds[<span class="dv">1</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb461-9"><a href="solutions.html#cb461-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qq =</span> <span class="st">&quot;lower&quot;</span>) <span class="sc">|&gt;</span>   <span class="co"># add label</span></span>
<span id="cb461-10"><a href="solutions.html#cb461-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb461-11"><a href="solutions.html#cb461-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb461-12"><a href="solutions.html#cb461-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb461-13"><a href="solutions.html#cb461-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb461-14"><a href="solutions.html#cb461-14" aria-hidden="true" tabindex="-1"></a>    daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb461-15"><a href="solutions.html#cb461-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># in upper 90% quantile</span></span>
<span id="cb461-16"><a href="solutions.html#cb461-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(mean <span class="sc">&gt;</span> thresholds[<span class="dv">2</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb461-17"><a href="solutions.html#cb461-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">qq =</span> <span class="st">&quot;upper&quot;</span>)</span>
<span id="cb461-18"><a href="solutions.html#cb461-18" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<ul>
<li>Calculate the mean of the 25% and the mean of the 75% quantiles of half-hourly VPD within the upper and lower 10% quantiles of mean daily VPD.</li>
</ul>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="solutions.html#cb462-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_sub <span class="sc">|&gt;</span> </span>
<span id="cb462-2"><a href="solutions.html#cb462-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(qq) <span class="sc">|&gt;</span> </span>
<span id="cb462-3"><a href="solutions.html#cb462-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">q25_mean =</span> <span class="fu">mean</span>(q25),</span>
<span id="cb462-4"><a href="solutions.html#cb462-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">q75_mean =</span> <span class="fu">mean</span>(q75))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   qq    q25_mean q75_mean
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 lower   0.0989    0.149
## 2 upper   6.56     15.2</code></pre>
</div>
<div id="patterns-in-data-quality-1" class="section level3 unnumbered hasAnchor">
<h3>Patterns in data quality<a href="solutions.html#patterns-in-data-quality-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The uncleaned dataset <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code> holds half-hourly data that is sometimes of poor quality. Investigate whether NEE data quality is randomly spread across hours in a day by calculating the proportion of (i) actually measured data, (ii) good quality gap-filled data, (iii) medium quality data, and (iv) poor quality data within each hour-of-day (24 hours per day).</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="solutions.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using half_hourly_fluxes read above</span></span>
<span id="cb464-2"><a href="solutions.html#cb464-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb464-3"><a href="solutions.html#cb464-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TIMESTAMP_START =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb464-4"><a href="solutions.html#cb464-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hour_of_day =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb464-5"><a href="solutions.html#cb464-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour_of_day) <span class="sc">|&gt;</span> </span>
<span id="cb464-6"><a href="solutions.html#cb464-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_measured =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb464-7"><a href="solutions.html#cb464-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_good     =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb464-8"><a href="solutions.html#cb464-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_medium   =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb464-9"><a href="solutions.html#cb464-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_poor     =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb464-10"><a href="solutions.html#cb464-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_total    =</span> <span class="fu">n</span>()</span>
<span id="cb464-11"><a href="solutions.html#cb464-11" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb464-12"><a href="solutions.html#cb464-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f_measured =</span> n_measured <span class="sc">/</span> n_total,</span>
<span id="cb464-13"><a href="solutions.html#cb464-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_good     =</span> n_good     <span class="sc">/</span> n_total,</span>
<span id="cb464-14"><a href="solutions.html#cb464-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_medium   =</span> n_medium   <span class="sc">/</span> n_total,</span>
<span id="cb464-15"><a href="solutions.html#cb464-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_poor     =</span> n_poor     <span class="sc">/</span> n_total,</span>
<span id="cb464-16"><a href="solutions.html#cb464-16" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Interpret your findings: Are the proportions evenly spread across hours in a day?</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="solutions.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is not asked for but interesting. More on data visualisation in Chapter 5</span></span>
<span id="cb465-2"><a href="solutions.html#cb465-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb465-3"><a href="solutions.html#cb465-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(f_measured, f_good, f_medium, f_poor), </span>
<span id="cb465-4"><a href="solutions.html#cb465-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;quality&quot;</span>, </span>
<span id="cb465-5"><a href="solutions.html#cb465-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fraction&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb465-6"><a href="solutions.html#cb465-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour_of_day, <span class="at">y =</span> fraction, <span class="at">color =</span> quality)) <span class="sc">+</span></span>
<span id="cb465-7"><a href="solutions.html#cb465-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-245-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="solutions.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also just look at values of df$f_measured over the course of a day (hod)  </span></span></code></pre></div>
<p>Perform an aggregation of the half-hourly GPP data (variable <code>GPP_NT_VUT_REF</code>) to daily means of the unmodified data read from file <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code>, and from cleaned data where only measured (not gap-filled) half-hourly data is kept and aggregated. This yields two data frames with daily GPP data. Calculate the overall mean GPP for the two data frames (across all days in the data frame). Are the overall mean GPP values equal? If not, why?</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="solutions.html#cb467-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_all <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb467-2"><a href="solutions.html#cb467-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb467-3"><a href="solutions.html#cb467-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">date      =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb467-4"><a href="solutions.html#cb467-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb467-5"><a href="solutions.html#cb467-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb467-6"><a href="solutions.html#cb467-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-7"><a href="solutions.html#cb467-7" aria-hidden="true" tabindex="-1"></a>daily_fluxes_cleaned <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb467-8"><a href="solutions.html#cb467-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb467-9"><a href="solutions.html#cb467-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">date      =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb467-10"><a href="solutions.html#cb467-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">ifelse</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>, GPP_NT_VUT_REF, <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb467-11"><a href="solutions.html#cb467-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb467-12"><a href="solutions.html#cb467-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb467-13"><a href="solutions.html#cb467-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-14"><a href="solutions.html#cb467-14" aria-hidden="true" tabindex="-1"></a><span class="co"># overall means</span></span>
<span id="cb467-15"><a href="solutions.html#cb467-15" aria-hidden="true" tabindex="-1"></a>daily_fluxes_all <span class="sc">|&gt;</span> </span>
<span id="cb467-16"><a href="solutions.html#cb467-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   GPP_NT_VUT_REF
##            &lt;dbl&gt;
## 1           4.20</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="solutions.html#cb469-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb469-2"><a href="solutions.html#cb469-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   GPP_NT_VUT_REF
##            &lt;dbl&gt;
## 1           7.07</code></pre>
</div>
<div id="tidying-an-excel-file" class="section level3 unnumbered hasAnchor">
<h3>Tidying an Excel-file<a href="solutions.html#tidying-an-excel-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report</em></p>
</div>
</div>
<div id="data-visualisation" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">A.4</span> Data Visualisation<a href="solutions.html#data-visualisation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="identifying-outliers-1" class="section level3 unnumbered hasAnchor">
<h3>Identifying Outliers<a href="solutions.html#identifying-outliers-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="solutions.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and wrangle data</span></span>
<span id="cb471-2"><a href="solutions.html#cb471-2" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb471-3"><a href="solutions.html#cb471-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb471-4"><a href="solutions.html#cb471-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interpret -9999 as missing value</span></span>
<span id="cb471-5"><a href="solutions.html#cb471-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="dv">9999</span>) <span class="sc">|&gt;</span> </span>
<span id="cb471-6"><a href="solutions.html#cb471-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb471-7"><a href="solutions.html#cb471-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interpret all variables starting with TIMESTAMP as a date-time object</span></span>
<span id="cb471-8"><a href="solutions.html#cb471-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;TIMESTAMP_&quot;</span>)), lubridate<span class="sc">::</span>ymd_hm)</span>
<span id="cb471-9"><a href="solutions.html#cb471-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-10"><a href="solutions.html#cb471-10" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate to daily</span></span>
<span id="cb471-11"><a href="solutions.html#cb471-11" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb471-12"><a href="solutions.html#cb471-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb471-13"><a href="solutions.html#cb471-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a date-only object</span></span>
<span id="cb471-14"><a href="solutions.html#cb471-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">as_date</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb471-15"><a href="solutions.html#cb471-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb471-16"><a href="solutions.html#cb471-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># aggregate</span></span>
<span id="cb471-17"><a href="solutions.html#cb471-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb471-18"><a href="solutions.html#cb471-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb471-19"><a href="solutions.html#cb471-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">PPFD_IN =</span> <span class="fu">mean</span>(PPFD_IN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb471-20"><a href="solutions.html#cb471-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span> <span class="co"># not mandatory</span></span>
<span id="cb471-21"><a href="solutions.html#cb471-21" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="solutions.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit linear regression</span></span>
<span id="cb472-2"><a href="solutions.html#cb472-2" aria-hidden="true" tabindex="-1"></a>linmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(GPP_NT_VUT_REF <span class="sc">~</span> PPFD_IN, <span class="at">data =</span> daily_fluxes)</span>
<span id="cb472-3"><a href="solutions.html#cb472-3" aria-hidden="true" tabindex="-1"></a>linmod</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = GPP_NT_VUT_REF ~ PPFD_IN, data = daily_fluxes)
## 
## Coefficients:
## (Intercept)      PPFD_IN  
##      0.9173       0.0118</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="solutions.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get box plot statistics for determining &quot;outlying&quot; points</span></span>
<span id="cb474-2"><a href="solutions.html#cb474-2" aria-hidden="true" tabindex="-1"></a>out_boxplot <span class="ot">&lt;-</span> <span class="fu">boxplot.stats</span>(linmod<span class="sc">$</span>residuals)</span>
<span id="cb474-3"><a href="solutions.html#cb474-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-4"><a href="solutions.html#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="co"># record the row numbers of outlying points based on the output list element &#39;out&#39;</span></span>
<span id="cb474-5"><a href="solutions.html#cb474-5" aria-hidden="true" tabindex="-1"></a><span class="co"># row numbers are the names of elements in out_boxplot$out, provided as strings. </span></span>
<span id="cb474-6"><a href="solutions.html#cb474-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert them to integers.</span></span>
<span id="cb474-7"><a href="solutions.html#cb474-7" aria-hidden="true" tabindex="-1"></a>outlier_index <span class="ot">&lt;-</span> out_boxplot<span class="sc">$</span>out <span class="sc">|&gt;</span> <span class="fu">names</span>() <span class="sc">|&gt;</span> <span class="fu">as.integer</span>()</span></code></pre></div>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="solutions.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label outliers</span></span>
<span id="cb475-2"><a href="solutions.html#cb475-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-3"><a href="solutions.html#cb475-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In base-R, this could be done as</span></span>
<span id="cb475-4"><a href="solutions.html#cb475-4" aria-hidden="true" tabindex="-1"></a>daily_fluxes<span class="sc">$</span>is_outlier <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb475-5"><a href="solutions.html#cb475-5" aria-hidden="true" tabindex="-1"></a>daily_fluxes<span class="sc">$</span>is_outlier[outlier_index] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb475-6"><a href="solutions.html#cb475-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-7"><a href="solutions.html#cb475-7" aria-hidden="true" tabindex="-1"></a><span class="co"># In tidyverse style:</span></span>
<span id="cb475-8"><a href="solutions.html#cb475-8" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb475-9"><a href="solutions.html#cb475-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rownumber =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">|&gt;</span>    <span class="co"># could also do: dplyr::mutate(rownumber = 1:nrow(.))</span></span>
<span id="cb475-10"><a href="solutions.html#cb475-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_outlier =</span> <span class="fu">ifelse</span>(rownumber <span class="sc">%in%</span> outlier_index, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="solutions.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatterplot</span></span>
<span id="cb476-2"><a href="solutions.html#cb476-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb476-3"><a href="solutions.html#cb476-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb476-4"><a href="solutions.html#cb476-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb476-5"><a href="solutions.html#cb476-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb476-6"><a href="solutions.html#cb476-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set variables to use for axes and filling of plots</span></span>
<span id="cb476-7"><a href="solutions.html#cb476-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> PPFD_IN,</span>
<span id="cb476-8"><a href="solutions.html#cb476-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> GPP_NT_VUT_REF,</span>
<span id="cb476-9"><a href="solutions.html#cb476-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> is_outlier) <span class="sc">+</span></span>
<span id="cb476-10"><a href="solutions.html#cb476-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size  =</span> <span class="dv">2</span>,  <span class="co"># Increase size of points</span></span>
<span id="cb476-11"><a href="solutions.html#cb476-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> <span class="co"># Shape 21 has a &quot;fill&quot; and &quot;color&quot; property</span></span>
<span id="cb476-12"><a href="solutions.html#cb476-12" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># fill refers to the shape itself</span></span>
<span id="cb476-13"><a href="solutions.html#cb476-13" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># color refers to the border around the shape</span></span>
<span id="cb476-14"><a href="solutions.html#cb476-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span>        <span class="co"># Pick a simple theme</span></span>
<span id="cb476-15"><a href="solutions.html#cb476-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(        <span class="co"># Pick a nice color scheme</span></span>
<span id="cb476-16"><a href="solutions.html#cb476-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Outlier?&quot;</span>,             <span class="co"># Set title of legend</span></span>
<span id="cb476-17"><a href="solutions.html#cb476-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>,      <span class="co"># Pick a nice palette of the scheme</span></span>
<span id="cb476-18"><a href="solutions.html#cb476-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>) <span class="co"># Add labels to the legend</span></span>
<span id="cb476-19"><a href="solutions.html#cb476-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb476-20"><a href="solutions.html#cb476-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Outliers in GPP ~ PPFD&quot;</span>,</span>
<span id="cb476-21"><a href="solutions.html#cb476-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y    =</span> <span class="fu">expression</span>(<span class="st">&quot;Gross primary production [gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span> <span class="sc">*</span> <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span> <span class="sc">*</span> <span class="st">&quot;]&quot;</span>),</span>
<span id="cb476-22"><a href="solutions.html#cb476-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x    =</span> <span class="fu">expression</span>(<span class="st">&quot;Photosynthetic photon flux density [&quot;</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">&quot;mol&quot;</span> <span class="sc">~</span> m<span class="sc">^-</span><span class="dv">2</span> <span class="sc">~</span> s<span class="sc">^-</span><span class="dv">1</span> <span class="sc">*</span> <span class="st">&quot;]&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-251-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>What do we see in this plot?</strong> We see that the orange points, that is the outliers, actually fall outside the main point cloud of green points. The distribution of these outliers seems without systematic pattern or deviation. Nonetheless, it is good practice to go a step further and look at these data points in detail to find out whether they should be removed or not in your analysis. In later Chapters you will learn more on what disproportionate role outliers can play and how they may affect your statistical model and analysis.</p>
</div>
<div id="diurnal-and-seasonal-cycles" class="section level3 unnumbered hasAnchor">
<h3>Diurnal and seasonal cycles<a href="solutions.html#diurnal-and-seasonal-cycles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="solutions.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data wrangling</span></span>
<span id="cb477-2"><a href="solutions.html#cb477-2" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="ot">&lt;-</span></span>
<span id="cb477-3"><a href="solutions.html#cb477-3" aria-hidden="true" tabindex="-1"></a>  half_hourly_fluxes <span class="sc">|&gt;</span>                        <span class="co"># df from previous exercise</span></span>
<span id="cb477-4"><a href="solutions.html#cb477-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb477-5"><a href="solutions.html#cb477-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour_day =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(TIMESTAMP_START),     <span class="co"># Save the hour of the day</span></span>
<span id="cb477-6"><a href="solutions.html#cb477-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_year =</span> lubridate<span class="sc">::</span><span class="fu">yday</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span>  <span class="co"># Save the day of the year</span></span>
<span id="cb477-7"><a href="solutions.html#cb477-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(hour_day, day_year) <span class="sc">|&gt;</span>              <span class="co"># Group by HoD and DoY at once</span></span>
<span id="cb477-8"><a href="solutions.html#cb477-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">gpp =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="co"># Take mean for GPP, ignore `NA`</span></span></code></pre></div>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="solutions.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a standard raster plot</span></span>
<span id="cb478-2"><a href="solutions.html#cb478-2" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="sc">|&gt;</span> </span>
<span id="cb478-3"><a href="solutions.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb478-4"><a href="solutions.html#cb478-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> hour_day, <span class="at">y =</span> day_year, <span class="at">fill =</span> gpp) <span class="sc">+</span></span>
<span id="cb478-5"><a href="solutions.html#cb478-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-253-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="solutions.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make raster plot publishable - This is up to your judgement. Below is an example. </span></span>
<span id="cb479-2"><a href="solutions.html#cb479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-3"><a href="solutions.html#cb479-3" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="sc">|&gt;</span> </span>
<span id="cb479-4"><a href="solutions.html#cb479-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-5"><a href="solutions.html#cb479-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify aesthetics</span></span>
<span id="cb479-6"><a href="solutions.html#cb479-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour_day, </span>
<span id="cb479-7"><a href="solutions.html#cb479-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> day_year, </span>
<span id="cb479-8"><a href="solutions.html#cb479-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> gpp)) <span class="sc">+</span> <span class="co"># The &#39;filling&#39; of the raster</span></span>
<span id="cb479-9"><a href="solutions.html#cb479-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb479-10"><a href="solutions.html#cb479-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-11"><a href="solutions.html#cb479-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a color scale that works also for color-blind people</span></span>
<span id="cb479-12"><a href="solutions.html#cb479-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span></span>
<span id="cb479-13"><a href="solutions.html#cb479-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-14"><a href="solutions.html#cb479-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change theme and layout a bit </span></span>
<span id="cb479-15"><a href="solutions.html#cb479-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb479-16"><a href="solutions.html#cb479-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="co"># Make title bold</span></span>
<span id="cb479-17"><a href="solutions.html#cb479-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">hjust =</span> <span class="fl">0.5</span>),  <span class="co"># Horizontal adjustment of title to</span></span>
<span id="cb479-18"><a href="solutions.html#cb479-18" aria-hidden="true" tabindex="-1"></a>                                             <span class="co"># be in the middle (left: 0, right: 1)</span></span>
<span id="cb479-19"><a href="solutions.html#cb479-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>               <span class="co"># Move legend to bottom</span></span>
<span id="cb479-20"><a href="solutions.html#cb479-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb479-21"><a href="solutions.html#cb479-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-22"><a href="solutions.html#cb479-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust the aspect ratio of the plotting region</span></span>
<span id="cb479-23"><a href="solutions.html#cb479-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio=</span><span class="fl">0.075</span>) <span class="sc">+</span></span>
<span id="cb479-24"><a href="solutions.html#cb479-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-25"><a href="solutions.html#cb479-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels of each mapping axis, \n is a line break</span></span>
<span id="cb479-26"><a href="solutions.html#cb479-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Diurnal and seasonal cycle of GPP&quot;</span>,</span>
<span id="cb479-27"><a href="solutions.html#cb479-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Hour of day&quot;</span>, </span>
<span id="cb479-28"><a href="solutions.html#cb479-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Day of year&quot;</span>, </span>
<span id="cb479-29"><a href="solutions.html#cb479-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">expression</span>(<span class="st">&quot;GPP </span><span class="sc">\n</span><span class="st">[gC m&quot;</span><span class="sc">^-</span><span class="dv">2</span> <span class="sc">*</span> <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span> <span class="sc">*</span> <span class="st">&quot;]: &quot;</span>)) <span class="sc">+</span> <span class="co"># Legend title for fill scale</span></span>
<span id="cb479-30"><a href="solutions.html#cb479-30" aria-hidden="true" tabindex="-1"></a>                                                               <span class="co"># The &#39;\n&#39; adds a line break</span></span>
<span id="cb479-31"><a href="solutions.html#cb479-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-32"><a href="solutions.html#cb479-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># avoid having a small padding from the lowest values to the end of axes</span></span>
<span id="cb479-33"><a href="solutions.html#cb479-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb479-34"><a href="solutions.html#cb479-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-254-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Beautiful, isn’t it? We nicely see that on practically all days of the year we have the diurnal cycle of GPP which follows the sun’s cycle. And the throughout a year, we see a rapid increase in GPP in the spring when all trees put out their leaves at once. After a highly productive summer, temperatures drop, sensescence kicks in and GPP gradually drops into its winter low.</p>
</div>
<div id="trend-in-carbon-dioxide-concentrations-1" class="section level3 unnumbered hasAnchor">
<h3>Trend in carbon dioxide concentrations<a href="solutions.html#trend-in-carbon-dioxide-concentrations-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="solutions.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read table, set &#39;header = TRUE&#39; to tell R that the first row are variable names </span></span>
<span id="cb480-2"><a href="solutions.html#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="co"># You could set &#39;skip = 70&#39; to skip all metadata, but R detects that automatically</span></span>
<span id="cb480-3"><a href="solutions.html#cb480-3" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/co2_monthly_maunaloa.txt&quot;</span>, </span>
<span id="cb480-4"><a href="solutions.html#cb480-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb480-5"><a href="solutions.html#cb480-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">na.strings =</span> <span class="st">&#39;-99.99&#39;</span> <span class="co"># The dataset specifys that these are missing variables</span></span>
<span id="cb480-6"><a href="solutions.html#cb480-6" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">|&gt;</span></span>
<span id="cb480-7"><a href="solutions.html#cb480-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-8"><a href="solutions.html#cb480-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To get a good timeseries, we need to get a nice date-time variable first</span></span>
<span id="cb480-9"><a href="solutions.html#cb480-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">paste</span>(yr, mo, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="sc">|&gt;</span> lubridate<span class="sc">::</span><span class="fu">ym</span>(), <span class="co"># Imprecise but okay</span></span>
<span id="cb480-10"><a href="solutions.html#cb480-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">datetime =</span> lubridate<span class="sc">::</span><span class="fu">date_decimal</span>(decyr, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)) <span class="co"># Exact second of measurement</span></span></code></pre></div>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="solutions.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple plot of the trend</span></span>
<span id="cb481-2"><a href="solutions.html#cb481-2" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(datetime, co2_avg))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-256-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The data looks reasonable. No outliers, no reamining <code>-99.99</code> values that where not dropped.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="solutions.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the running mean function</span></span>
<span id="cb482-2"><a href="solutions.html#cb482-2" aria-hidden="true" tabindex="-1"></a>running_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="co"># Input vector</span></span>
<span id="cb482-3"><a href="solutions.html#cb482-3" aria-hidden="true" tabindex="-1"></a>                         box_size    <span class="co"># Number of elements over which to average</span></span>
<span id="cb482-4"><a href="solutions.html#cb482-4" aria-hidden="true" tabindex="-1"></a>                         ){</span>
<span id="cb482-5"><a href="solutions.html#cb482-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb482-6"><a href="solutions.html#cb482-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty vector of the same length as the input data</span></span>
<span id="cb482-7"><a href="solutions.html#cb482-7" aria-hidden="true" tabindex="-1"></a>  output_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(input_data))</span>
<span id="cb482-8"><a href="solutions.html#cb482-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb482-9"><a href="solutions.html#cb482-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over each position in the vector</span></span>
<span id="cb482-10"><a href="solutions.html#cb482-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(input_data)){</span>
<span id="cb482-11"><a href="solutions.html#cb482-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb482-12"><a href="solutions.html#cb482-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define start and end of the box to average over</span></span>
<span id="cb482-13"><a href="solutions.html#cb482-13" aria-hidden="true" tabindex="-1"></a>        startbox <span class="ot">&lt;-</span> i <span class="sc">-</span> box_size <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb482-14"><a href="solutions.html#cb482-14" aria-hidden="true" tabindex="-1"></a>        endbox   <span class="ot">&lt;-</span> i <span class="sc">+</span> box_size <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb482-15"><a href="solutions.html#cb482-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb482-16"><a href="solutions.html#cb482-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Do not take means at the border of the input_data</span></span>
<span id="cb482-17"><a href="solutions.html#cb482-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (startbox <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb482-18"><a href="solutions.html#cb482-18" aria-hidden="true" tabindex="-1"></a>            output_data[i] <span class="ot">&lt;-</span> <span class="cn">NA</span>    </span>
<span id="cb482-19"><a href="solutions.html#cb482-19" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (endbox <span class="sc">&gt;</span> <span class="fu">length</span>(input_data)) {</span>
<span id="cb482-20"><a href="solutions.html#cb482-20" aria-hidden="true" tabindex="-1"></a>            output_data[i] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb482-21"><a href="solutions.html#cb482-21" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb482-22"><a href="solutions.html#cb482-22" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Take the mean of values within the box</span></span>
<span id="cb482-23"><a href="solutions.html#cb482-23" aria-hidden="true" tabindex="-1"></a>            output_data[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(input_data[startbox<span class="sc">:</span>endbox],</span>
<span id="cb482-24"><a href="solutions.html#cb482-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb482-25"><a href="solutions.html#cb482-25" aria-hidden="true" tabindex="-1"></a>        }   </span>
<span id="cb482-26"><a href="solutions.html#cb482-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb482-27"><a href="solutions.html#cb482-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb482-28"><a href="solutions.html#cb482-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return output_data</span></span>
<span id="cb482-29"><a href="solutions.html#cb482-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_data)</span>
<span id="cb482-30"><a href="solutions.html#cb482-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb482-31"><a href="solutions.html#cb482-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-32"><a href="solutions.html#cb482-32" aria-hidden="true" tabindex="-1"></a>ml_co2<span class="sc">$</span>co2_rm <span class="ot">&lt;-</span> <span class="fu">running_mean</span>(ml_co2<span class="sc">$</span>co2_avg, <span class="dv">12</span>)</span></code></pre></div>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="solutions.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a nice plot</span></span>
<span id="cb483-2"><a href="solutions.html#cb483-2" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="sc">|&gt;</span></span>
<span id="cb483-3"><a href="solutions.html#cb483-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb483-4"><a href="solutions.html#cb483-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb483-5"><a href="solutions.html#cb483-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First plot the measurements</span></span>
<span id="cb483-6"><a href="solutions.html#cb483-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(datetime, co2_avg, <span class="at">color =</span> <span class="st">&quot;Measured&quot;</span>)) <span class="sc">+</span></span>
<span id="cb483-7"><a href="solutions.html#cb483-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add running mean on top</span></span>
<span id="cb483-8"><a href="solutions.html#cb483-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(datetime, co2_rm, <span class="at">color =</span> <span class="st">&quot;Running Mean&quot;</span>)) <span class="sc">+</span></span>
<span id="cb483-9"><a href="solutions.html#cb483-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the plot</span></span>
<span id="cb483-10"><a href="solutions.html#cb483-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb483-11"><a href="solutions.html#cb483-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>)) <span class="sc">+</span> <span class="co"># Move legend into the plot (c(x, y))</span></span>
<span id="cb483-12"><a href="solutions.html#cb483-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb483-13"><a href="solutions.html#cb483-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;</span>, <span class="co"># Omit legend title</span></span>
<span id="cb483-14"><a href="solutions.html#cb483-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;tomato&quot;</span>),</span>
<span id="cb483-15"><a href="solutions.html#cb483-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Measured&quot;</span>, <span class="st">&quot;Running Mean&quot;</span>)</span>
<span id="cb483-16"><a href="solutions.html#cb483-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb483-17"><a href="solutions.html#cb483-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Carbon dioxide concentrations at Manua Lao&quot;</span>,</span>
<span id="cb483-18"><a href="solutions.html#cb483-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y     =</span> <span class="fu">expression</span>(<span class="st">&quot;CO&quot;</span>[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">&quot;[ppm]&quot;</span>),</span>
<span id="cb483-19"><a href="solutions.html#cb483-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x     =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-258-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="telling-a-story-from-data-1" class="section level3 unnumbered hasAnchor">
<h3>Telling a story from data<a href="solutions.html#telling-a-story-from-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
</div>
<div id="data-variety" class="section level2 hasAnchor" number="12.5">
<h2><span class="header-section-number">A.5</span> Data Variety<a href="solutions.html#data-variety" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="files-and-file-formats-2" class="section level3 unnumbered hasAnchor">
<h3>Files and file formats<a href="solutions.html#files-and-file-formats-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="reading-and-writing-human-readable-files-1" class="section level4 unnumbered hasAnchor">
<h4>Reading and writing human readable files<a href="solutions.html#reading-and-writing-human-readable-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The below code shows how to read in the different demo data sets (CSV files). You will note that they all need separate settings, and that a given file extension isn’t necessarily a reflection of the content the file. Inspection of your read in data is therefore key.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="solutions.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the first demo</span></span>
<span id="cb485-2"><a href="solutions.html#cb485-2" aria-hidden="true" tabindex="-1"></a>demo_01 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb485-3"><a href="solutions.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_1.csv&quot;</span>,</span>
<span id="cb485-4"><a href="solutions.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb485-5"><a href="solutions.html#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb485-6"><a href="solutions.html#cb485-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb485-7"><a href="solutions.html#cb485-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-8"><a href="solutions.html#cb485-8" aria-hidden="true" tabindex="-1"></a><span class="co"># read in second demo</span></span>
<span id="cb485-9"><a href="solutions.html#cb485-9" aria-hidden="true" tabindex="-1"></a>demo_02 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb485-10"><a href="solutions.html#cb485-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_2.csv&quot;</span>,</span>
<span id="cb485-11"><a href="solutions.html#cb485-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb485-12"><a href="solutions.html#cb485-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb485-13"><a href="solutions.html#cb485-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb485-14"><a href="solutions.html#cb485-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-15"><a href="solutions.html#cb485-15" aria-hidden="true" tabindex="-1"></a>demo_03 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb485-16"><a href="solutions.html#cb485-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_3.csv&quot;</span>,</span>
<span id="cb485-17"><a href="solutions.html#cb485-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb485-18"><a href="solutions.html#cb485-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment.char =</span> <span class="st">&quot;|&quot;</span>,</span>
<span id="cb485-19"><a href="solutions.html#cb485-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb485-20"><a href="solutions.html#cb485-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>All the demo data sets are equal, except for their formatting. We can test if the content is identical by using the <code>identical()</code> function in R.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="solutions.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 1 with 2</span></span>
<span id="cb486-2"><a href="solutions.html#cb486-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(demo_01, demo_02)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="solutions.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 2 with 3</span></span>
<span id="cb488-2"><a href="solutions.html#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(demo_02, demo_03)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="solutions.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given transitive properties, demo_01 is identical to demo_03</span></span></code></pre></div>
<p>You can combine the three datasets using the {dplyr} <code>bind_rows()</code> function.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="solutions.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combining all demo datasets</span></span>
<span id="cb491-2"><a href="solutions.html#cb491-2" aria-hidden="true" tabindex="-1"></a>demo_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(demo_01, demo_02, demo_03)</span>
<span id="cb491-3"><a href="solutions.html#cb491-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-4"><a href="solutions.html#cb491-4" aria-hidden="true" tabindex="-1"></a><span class="co"># writing the data to a temporary CSV file</span></span>
<span id="cb491-5"><a href="solutions.html#cb491-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(</span>
<span id="cb491-6"><a href="solutions.html#cb491-6" aria-hidden="true" tabindex="-1"></a>  demo_all, </span>
<span id="cb491-7"><a href="solutions.html#cb491-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb491-8"><a href="solutions.html#cb491-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb491-9"><a href="solutions.html#cb491-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb491-10"><a href="solutions.html#cb491-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb491-11"><a href="solutions.html#cb491-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb491-12"><a href="solutions.html#cb491-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-13"><a href="solutions.html#cb491-13" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb491-14"><a href="solutions.html#cb491-14" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb491-15"><a href="solutions.html#cb491-15" aria-hidden="true" tabindex="-1"></a>  demo_all,</span>
<span id="cb491-16"><a href="solutions.html#cb491-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb491-17"><a href="solutions.html#cb491-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb491-18"><a href="solutions.html#cb491-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb491-19"><a href="solutions.html#cb491-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-20"><a href="solutions.html#cb491-20" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the previous CSV file</span></span>
<span id="cb491-21"><a href="solutions.html#cb491-21" aria-hidden="true" tabindex="-1"></a>demo_all_new <span class="ot">&lt;-</span><span class="fu">read.table</span>(</span>
<span id="cb491-22"><a href="solutions.html#cb491-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb491-23"><a href="solutions.html#cb491-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb491-24"><a href="solutions.html#cb491-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb491-25"><a href="solutions.html#cb491-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb491-26"><a href="solutions.html#cb491-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-27"><a href="solutions.html#cb491-27" aria-hidden="true" tabindex="-1"></a><span class="co"># writing the data to a JSON file</span></span>
<span id="cb491-28"><a href="solutions.html#cb491-28" aria-hidden="true" tabindex="-1"></a>jsonlite<span class="sc">::</span><span class="fu">write_json</span>(demo_all_new, <span class="at">path =</span> <span class="st">&quot;./my_json_file.json&quot;</span>)</span></code></pre></div>
</div>
<div id="reading-and-writing-binary-files-1" class="section level4 unnumbered hasAnchor">
<h4>Reading and writing binary files<a href="solutions.html#reading-and-writing-binary-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>It is a NetCDF file</li>
<li>the {terra} library (see Table xyz)</li>
<li>Temperature data for Switzerland at noon on 2021-01-01</li>
</ol>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="solutions.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read unknown netcdf file using the {terra} library</span></span>
<span id="cb492-2"><a href="solutions.html#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb492-3"><a href="solutions.html#cb492-3" aria-hidden="true" tabindex="-1"></a>unkown_netcdf <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/some_data.nc&quot;</span>)</span>
<span id="cb492-4"><a href="solutions.html#cb492-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-5"><a href="solutions.html#cb492-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print the meta-data by calling the variable</span></span>
<span id="cb492-6"><a href="solutions.html#cb492-6" aria-hidden="true" tabindex="-1"></a>unknown_netcdf</span>
<span id="cb492-7"><a href="solutions.html#cb492-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-8"><a href="solutions.html#cb492-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visually plot the data</span></span>
<span id="cb492-9"><a href="solutions.html#cb492-9" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_netcdf)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="solutions.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the data as a geotiff (other options are possible as well in writeRaster)</span></span>
<span id="cb493-2"><a href="solutions.html#cb493-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb493-3"><a href="solutions.html#cb493-3" aria-hidden="true" tabindex="-1"></a>  unknown_netcdf,</span>
<span id="cb493-4"><a href="solutions.html#cb493-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;./test.tif&quot;</span>,</span>
<span id="cb493-5"><a href="solutions.html#cb493-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb493-6"><a href="solutions.html#cb493-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="solutions.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read unknown tif file using the {terra} library</span></span>
<span id="cb494-2"><a href="solutions.html#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb494-3"><a href="solutions.html#cb494-3" aria-hidden="true" tabindex="-1"></a>unkown_tif <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/some_data.tif&quot;</span>)</span>
<span id="cb494-4"><a href="solutions.html#cb494-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-5"><a href="solutions.html#cb494-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print the meta-data by calling the variable</span></span>
<span id="cb494-6"><a href="solutions.html#cb494-6" aria-hidden="true" tabindex="-1"></a>unknown_tif</span>
<span id="cb494-7"><a href="solutions.html#cb494-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-8"><a href="solutions.html#cb494-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visually plot the data</span></span>
<span id="cb494-9"><a href="solutions.html#cb494-9" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_tif)</span>
<span id="cb494-10"><a href="solutions.html#cb494-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-11"><a href="solutions.html#cb494-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Are they exactly the same</span></span>
<span id="cb494-12"><a href="solutions.html#cb494-12" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_tif <span class="sc">-</span> unknown_netcdf)</span>
<span id="cb494-13"><a href="solutions.html#cb494-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-14"><a href="solutions.html#cb494-14" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb494-15"><a href="solutions.html#cb494-15" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(unkown_netcdf, unkown_tif)</span></code></pre></div>
<p>Looks similar to the NetCDF data, however one pixel is different as shown by taking the difference between both datasets.</p>
</div>
</div>
</div>
<div id="open-science" class="section level2 hasAnchor" number="12.6">
<h2><span class="header-section-number">A.6</span> Open Science<a href="solutions.html#open-science" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="external-data-1" class="section level3 unnumbered hasAnchor">
<h3>External data<a href="solutions.html#external-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The project data is stored in one folder without folders to sort data from code to give it structure.</p>
<p>The project can be re-organized using a simple project structure as such:</p>
<pre><code>~/project/
├─ data/
     ├─ 00_convert_data.R
     ├─ survey.xlsx # the original
     ├─ survey.csv # from (xls conversion (copy 1).csv)
├─ R/
     ├─ my_functions.R
├─ analysis/
     ├─ 00_model_fits.R # from Model-test-final.R
     ├─ 01_model_plots.R # from Plots.R
├─ vignettes/
     ├─ Report.Rmd
├─ manuscript/
     ├─ Report.html
     ├─ Figure 1.png</code></pre>
<p>Note that duplicate files are removed, code to cleanup data is numbered and stored with the data, functions which are accessible for analysis are stored in the R folder, Rmarkdown files are stored in the vignettes folder and the results of the full analysis is stored in a manuscript folder. Some variations on naming is possible.</p>
</div>
<div id="a-new-project-1" class="section level3 unnumbered hasAnchor">
<h3>A new project<a href="solutions.html#a-new-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em> Note that this exercise trains your ability to access and wrangle data yourself in a reproducible way. The best solution to test whether your you successfully did to is by letting a friend run all of your code on their machine. Resolving the errors you may encounter, helps you to improve you workflow and ensures a streamlined submission of your final report.</p>
</div>
<div id="tracking-the-state-of-your-project-1" class="section level3 unnumbered hasAnchor">
<h3>Tracking the state of your project<a href="solutions.html#tracking-the-state-of-your-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
</div>
</div>
<div id="code-management" class="section level2 hasAnchor" number="12.7">
<h2><span class="header-section-number">A.7</span> Code Management<a href="solutions.html#code-management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="location-based-code-management-1" class="section level3 unnumbered hasAnchor">
<h3>Location based code management<a href="solutions.html#location-based-code-management-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
</div>
<div id="collaborative-work-on-github-1" class="section level3 unnumbered hasAnchor">
<h3>Collaborative Work on Github<a href="solutions.html#collaborative-work-on-github-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
</div>
<div id="regression-and-classification" class="section level2 hasAnchor" number="12.8">
<h2><span class="header-section-number">A.8</span> Regression and Classification<a href="solutions.html#regression-and-classification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="stepwise-regression-and-asking-for-help-1" class="section level3 unnumbered hasAnchor">
<h3>Stepwise regression and asking for help<a href="solutions.html#stepwise-regression-and-asking-for-help-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
</div>
<div id="supervised-ml-i" class="section level2 hasAnchor" number="12.9">
<h2><span class="header-section-number">A.9</span> Supervised ML I<a href="solutions.html#supervised-ml-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="comparison-of-lm-and-knn" class="section level3 unnumbered hasAnchor">
<h3>Comparison of LM and KNN<a href="solutions.html#comparison-of-lm-and-knn" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
<div id="the-role-of-picking-a-hyperparameter-1" class="section level3 unnumbered hasAnchor">
<h3>The role of picking a hyperparameter<a href="solutions.html#the-role-of-picking-a-hyperparameter-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
</div>
<div id="supervised-ml-ii" class="section level2 hasAnchor" number="12.10">
<h2><span class="header-section-number">A.10</span> Supervised ML II<a href="solutions.html#supervised-ml-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="cross-validation-by-hand-1" class="section level3 unnumbered hasAnchor">
<h3>Cross-validation by hand<a href="solutions.html#cross-validation-by-hand-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The goal of this exercise is to create a script that explicitly runs a cross-validation by hand. In Chapter <a href="supervisedmlii.html#supervisedmlii">10</a>, we used the function <code>caret::train()</code> and specified the argument <code>trControl = caret::trainControl(method = "cv", number = 10)</code> to let it conduct a 10-fold cross-validation under the hood. Now, we want to actually understand this process in detail by reproducing Figure <a href="supervisedmlii.html#fig:kfoldcv">10.2</a> in code.</p>
<div id="source-necessary-functions" class="section level4 unnumbered hasAnchor">
<h4>Source necessary functions<a href="solutions.html#source-necessary-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="solutions.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/eval_model.R&quot;</span>)</span></code></pre></div>
</div>
<div id="get-data-and-clean-it" class="section level4 unnumbered hasAnchor">
<h4>Get data and clean it<a href="solutions.html#get-data-and-clean-it" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="solutions.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load daily dataframe from Davos</span></span>
<span id="cb497-2"><a href="solutions.html#cb497-2" aria-hidden="true" tabindex="-1"></a>df_org <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Dav_FLUXNET2015_FULLSET_DD_1997-2014_1-3.csv&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb497-3"><a href="solutions.html#cb497-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb497-4"><a href="solutions.html#cb497-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only the variables we are interested in</span></span>
<span id="cb497-5"><a href="solutions.html#cb497-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(TIMESTAMP,</span>
<span id="cb497-6"><a href="solutions.html#cb497-6" aria-hidden="true" tabindex="-1"></a>                GPP_NT_VUT_REF,    <span class="co"># the target</span></span>
<span id="cb497-7"><a href="solutions.html#cb497-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>),  <span class="co"># quality control info</span></span>
<span id="cb497-8"><a href="solutions.html#cb497-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;_F&quot;</span>),   <span class="co"># includes all all meteorological covariates</span></span>
<span id="cb497-9"><a href="solutions.html#cb497-9" aria-hidden="true" tabindex="-1"></a>                <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;JSB&quot;</span>)   <span class="co"># weird useless variable</span></span>
<span id="cb497-10"><a href="solutions.html#cb497-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb497-11"><a href="solutions.html#cb497-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb497-12"><a href="solutions.html#cb497-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to a nice date object</span></span>
<span id="cb497-13"><a href="solutions.html#cb497-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">TIMESTAMP =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(TIMESTAMP)) <span class="sc">|&gt;</span></span>
<span id="cb497-14"><a href="solutions.html#cb497-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb497-15"><a href="solutions.html#cb497-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set all -9999 to NA</span></span>
<span id="cb497-16"><a href="solutions.html#cb497-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="dv">9999</span>) <span class="sc">|&gt;</span></span>
<span id="cb497-17"><a href="solutions.html#cb497-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb497-18"><a href="solutions.html#cb497-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># retain only data based on &gt;=80% good-quality measurements</span></span>
<span id="cb497-19"><a href="solutions.html#cb497-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># overwrite bad data with NA (not dropping rows)</span></span>
<span id="cb497-20"><a href="solutions.html#cb497-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">ifelse</span>(NEE_VUT_REF_QC <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, GPP_NT_VUT_REF),</span>
<span id="cb497-21"><a href="solutions.html#cb497-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">TA_F           =</span> <span class="fu">ifelse</span>(TA_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, TA_F),</span>
<span id="cb497-22"><a href="solutions.html#cb497-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">SW_IN_F        =</span> <span class="fu">ifelse</span>(SW_IN_F_QC     <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, SW_IN_F),</span>
<span id="cb497-23"><a href="solutions.html#cb497-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">LW_IN_F        =</span> <span class="fu">ifelse</span>(LW_IN_F_QC     <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, LW_IN_F),</span>
<span id="cb497-24"><a href="solutions.html#cb497-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">VPD_F          =</span> <span class="fu">ifelse</span>(VPD_F_QC       <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, VPD_F),</span>
<span id="cb497-25"><a href="solutions.html#cb497-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">PA_F           =</span> <span class="fu">ifelse</span>(PA_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, PA_F),</span>
<span id="cb497-26"><a href="solutions.html#cb497-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">P_F            =</span> <span class="fu">ifelse</span>(P_F_QC         <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, P_F),</span>
<span id="cb497-27"><a href="solutions.html#cb497-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">WS_F           =</span> <span class="fu">ifelse</span>(WS_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, WS_F)) <span class="sc">|&gt;</span> </span>
<span id="cb497-28"><a href="solutions.html#cb497-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb497-29"><a href="solutions.html#cb497-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop QC variables (no longer needed)</span></span>
<span id="cb497-30"><a href="solutions.html#cb497-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>))</span></code></pre></div>
</div>
<div id="create-training-and-test-sets" class="section level4 unnumbered hasAnchor">
<h4>Create training and test sets<a href="solutions.html#create-training-and-test-sets" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="solutions.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data splitting</span></span>
<span id="cb498-2"><a href="solutions.html#cb498-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb498-3"><a href="solutions.html#cb498-3" aria-hidden="true" tabindex="-1"></a>split      <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(df_org, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> <span class="st">&quot;VPD_F&quot;</span>)</span>
<span id="cb498-4"><a href="solutions.html#cb498-4" aria-hidden="true" tabindex="-1"></a>df_train   <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(split)</span>
<span id="cb498-5"><a href="solutions.html#cb498-5" aria-hidden="true" tabindex="-1"></a>df_test    <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(split)</span></code></pre></div>
</div>
<div id="write-functions-to-facilitate-repeated-cross-validation" class="section level4 unnumbered hasAnchor">
<h4>Write functions to facilitate repeated cross-validation<a href="solutions.html#write-functions-to-facilitate-repeated-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="solutions.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Function to run cross validation</span></span>
<span id="cb499-2"><a href="solutions.html#cb499-2" aria-hidden="true" tabindex="-1"></a>cross_validation_by_hand <span class="ot">&lt;-</span> <span class="cf">function</span>(df_train,</span>
<span id="cb499-3"><a href="solutions.html#cb499-3" aria-hidden="true" tabindex="-1"></a>                                     n_folds,</span>
<span id="cb499-4"><a href="solutions.html#cb499-4" aria-hidden="true" tabindex="-1"></a>                                     vec_k</span>
<span id="cb499-5"><a href="solutions.html#cb499-5" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb499-6"><a href="solutions.html#cb499-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-7"><a href="solutions.html#cb499-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pre-process data</span></span>
<span id="cb499-8"><a href="solutions.html#cb499-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-9"><a href="solutions.html#cb499-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The function does not know if we are sampling from a randomly distributed </span></span>
<span id="cb499-10"><a href="solutions.html#cb499-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># training set! For example, our df_train is structured in time, causing data</span></span>
<span id="cb499-11"><a href="solutions.html#cb499-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># leakage. Thus, we first have to randomize the df_train that is fed into</span></span>
<span id="cb499-12"><a href="solutions.html#cb499-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the function.</span></span>
<span id="cb499-13"><a href="solutions.html#cb499-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-14"><a href="solutions.html#cb499-14" aria-hidden="true" tabindex="-1"></a>  rand <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df_train)) <span class="co"># Get a vector of random indeces</span></span>
<span id="cb499-15"><a href="solutions.html#cb499-15" aria-hidden="true" tabindex="-1"></a>  df_rnd <span class="ot">&lt;-</span> df_train[rand, ] <span class="co"># Reorder df_train using random indeces</span></span>
<span id="cb499-16"><a href="solutions.html#cb499-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-17"><a href="solutions.html#cb499-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare variables used in the loops</span></span>
<span id="cb499-18"><a href="solutions.html#cb499-18" aria-hidden="true" tabindex="-1"></a>  fold_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_rnd) <span class="sc">/</span> n_folds <span class="co"># Specify size of each df in each fold</span></span>
<span id="cb499-19"><a href="solutions.html#cb499-19" aria-hidden="true" tabindex="-1"></a>  df_cv <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># Create empty dataframe to capture model performance per fold</span></span>
<span id="cb499-20"><a href="solutions.html#cb499-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb499-21"><a href="solutions.html#cb499-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over k&#39;s</span></span>
<span id="cb499-22"><a href="solutions.html#cb499-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> vec_k) {</span>
<span id="cb499-23"><a href="solutions.html#cb499-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb499-24"><a href="solutions.html#cb499-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a loop that goes through each fold</span></span>
<span id="cb499-25"><a href="solutions.html#cb499-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_folds) {</span>
<span id="cb499-26"><a href="solutions.html#cb499-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-27"><a href="solutions.html#cb499-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get current fold&#39;s starting and ending position in the training set </span></span>
<span id="cb499-28"><a href="solutions.html#cb499-28" aria-hidden="true" tabindex="-1"></a>      index_start <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> fold_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb499-29"><a href="solutions.html#cb499-29" aria-hidden="true" tabindex="-1"></a>      index_end   <span class="ot">&lt;-</span> (i) <span class="sc">*</span> fold_size</span>
<span id="cb499-30"><a href="solutions.html#cb499-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb499-31"><a href="solutions.html#cb499-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Split test set into training and validation set</span></span>
<span id="cb499-32"><a href="solutions.html#cb499-32" aria-hidden="true" tabindex="-1"></a>      i_df_val   <span class="ot">&lt;-</span> df_rnd <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(index_start <span class="sc">:</span> index_end) <span class="co"># Keep 1 fold out</span></span>
<span id="cb499-33"><a href="solutions.html#cb499-33" aria-hidden="true" tabindex="-1"></a>      i_df_train <span class="ot">&lt;-</span> df_rnd <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="sc">-</span>(index_start <span class="sc">:</span> index_end)) <span class="co"># Keep n-1 fold</span></span>
<span id="cb499-34"><a href="solutions.html#cb499-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb499-35"><a href="solutions.html#cb499-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if data was not split properly</span></span>
<span id="cb499-36"><a href="solutions.html#cb499-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if there is at least one date in train that is in validation set</span></span>
<span id="cb499-37"><a href="solutions.html#cb499-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If so, promp error</span></span>
<span id="cb499-38"><a href="solutions.html#cb499-38" aria-hidden="true" tabindex="-1"></a>      qc <span class="ot">&lt;-</span> <span class="fu">any</span>(i_df_train<span class="sc">$</span>TIMESTAMP <span class="sc">%in%</span> i_df_val<span class="sc">$</span>TIMESTAMP)</span>
<span id="cb499-39"><a href="solutions.html#cb499-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (qc) <span class="fu">stop</span>(<span class="st">&quot;Error: Data was not split properly!&quot;</span>)</span>
<span id="cb499-40"><a href="solutions.html#cb499-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb499-41"><a href="solutions.html#cb499-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create recipe based on the ith train set</span></span>
<span id="cb499-42"><a href="solutions.html#cb499-42" aria-hidden="true" tabindex="-1"></a>      i_pp <span class="ot">&lt;-</span> </span>
<span id="cb499-43"><a href="solutions.html#cb499-43" aria-hidden="true" tabindex="-1"></a>        recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> TA_F, </span>
<span id="cb499-44"><a href="solutions.html#cb499-44" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> i_df_train) <span class="sc">|&gt;</span></span>
<span id="cb499-45"><a href="solutions.html#cb499-45" aria-hidden="true" tabindex="-1"></a>        recipes<span class="sc">::</span><span class="fu">step_center</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb499-46"><a href="solutions.html#cb499-46" aria-hidden="true" tabindex="-1"></a>        recipes<span class="sc">::</span><span class="fu">step_scale</span>( recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>())</span>
<span id="cb499-47"><a href="solutions.html#cb499-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb499-48"><a href="solutions.html#cb499-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Train the model</span></span>
<span id="cb499-49"><a href="solutions.html#cb499-49" aria-hidden="true" tabindex="-1"></a>      i_knn <span class="ot">&lt;-</span> </span>
<span id="cb499-50"><a href="solutions.html#cb499-50" aria-hidden="true" tabindex="-1"></a>        caret<span class="sc">::</span><span class="fu">train</span>(i_pp, </span>
<span id="cb499-51"><a href="solutions.html#cb499-51" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> i_df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb499-52"><a href="solutions.html#cb499-52" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb499-53"><a href="solutions.html#cb499-53" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;none&quot;</span>),</span>
<span id="cb499-54"><a href="solutions.html#cb499-54" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> k),</span>
<span id="cb499-55"><a href="solutions.html#cb499-55" aria-hidden="true" tabindex="-1"></a>                      <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>)</span>
<span id="cb499-56"><a href="solutions.html#cb499-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb499-57"><a href="solutions.html#cb499-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Extract evaluation on validation set</span></span>
<span id="cb499-58"><a href="solutions.html#cb499-58" aria-hidden="true" tabindex="-1"></a>      i_eval <span class="ot">&lt;-</span> </span>
<span id="cb499-59"><a href="solutions.html#cb499-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">eval_model</span>(i_knn, </span>
<span id="cb499-60"><a href="solutions.html#cb499-60" aria-hidden="true" tabindex="-1"></a>                    i_df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb499-61"><a href="solutions.html#cb499-61" aria-hidden="true" tabindex="-1"></a>                    i_df_val, </span>
<span id="cb499-62"><a href="solutions.html#cb499-62" aria-hidden="true" tabindex="-1"></a>                    <span class="at">return_metrics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb499-63"><a href="solutions.html#cb499-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb499-64"><a href="solutions.html#cb499-64" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create df for metrics</span></span>
<span id="cb499-65"><a href="solutions.html#cb499-65" aria-hidden="true" tabindex="-1"></a>      i_metrics <span class="ot">&lt;-</span> </span>
<span id="cb499-66"><a href="solutions.html#cb499-66" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb499-67"><a href="solutions.html#cb499-67" aria-hidden="true" tabindex="-1"></a>          <span class="at">k    =</span> k,</span>
<span id="cb499-68"><a href="solutions.html#cb499-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">fold =</span> i,</span>
<span id="cb499-69"><a href="solutions.html#cb499-69" aria-hidden="true" tabindex="-1"></a>          <span class="at">rmse =</span> i_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">1</span>],</span>
<span id="cb499-70"><a href="solutions.html#cb499-70" aria-hidden="true" tabindex="-1"></a>          <span class="at">rsq  =</span> i_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">2</span>],</span>
<span id="cb499-71"><a href="solutions.html#cb499-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">mae  =</span> i_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">3</span>]</span>
<span id="cb499-72"><a href="solutions.html#cb499-72" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb499-73"><a href="solutions.html#cb499-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb499-74"><a href="solutions.html#cb499-74" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Append metrics to df</span></span>
<span id="cb499-75"><a href="solutions.html#cb499-75" aria-hidden="true" tabindex="-1"></a>      df_cv <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_cv, i_metrics)</span>
<span id="cb499-76"><a href="solutions.html#cb499-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb499-77"><a href="solutions.html#cb499-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb499-78"><a href="solutions.html#cb499-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add some verbose output to know where the loops are at</span></span>
<span id="cb499-79"><a href="solutions.html#cb499-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Done: &quot;</span>, <span class="fu">round</span>(<span class="fu">match</span>(k, vec_k)<span class="sc">/</span><span class="fu">length</span>(vec_k) <span class="sc">*</span> <span class="dv">100</span>), <span class="st">&quot; %&quot;</span>)</span>
<span id="cb499-80"><a href="solutions.html#cb499-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb499-81"><a href="solutions.html#cb499-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-82"><a href="solutions.html#cb499-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return df_cv</span></span>
<span id="cb499-83"><a href="solutions.html#cb499-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_cv)</span>
<span id="cb499-84"><a href="solutions.html#cb499-84" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="solutions.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to aggregate cross-validation output to a nice long table</span></span>
<span id="cb500-2"><a href="solutions.html#cb500-2" aria-hidden="true" tabindex="-1"></a>aggregate_cv_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(df_cv){</span>
<span id="cb500-3"><a href="solutions.html#cb500-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-4"><a href="solutions.html#cb500-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We must aggregate twice, once for means and once for standard deviations.</span></span>
<span id="cb500-5"><a href="solutions.html#cb500-5" aria-hidden="true" tabindex="-1"></a>  df_agg <span class="ot">&lt;-</span> </span>
<span id="cb500-6"><a href="solutions.html#cb500-6" aria-hidden="true" tabindex="-1"></a>    df_cv <span class="sc">|&gt;</span> </span>
<span id="cb500-7"><a href="solutions.html#cb500-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(k) <span class="sc">|&gt;</span> </span>
<span id="cb500-8"><a href="solutions.html#cb500-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_rmse   =</span> <span class="fu">mean</span>(rmse),</span>
<span id="cb500-9"><a href="solutions.html#cb500-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_rsq    =</span> <span class="fu">mean</span>(rsq),</span>
<span id="cb500-10"><a href="solutions.html#cb500-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_mae    =</span> <span class="fu">mean</span>(mae),</span>
<span id="cb500-11"><a href="solutions.html#cb500-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_rmse    =</span> <span class="fu">sd</span>(rmse),</span>
<span id="cb500-12"><a href="solutions.html#cb500-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_rsq     =</span> <span class="fu">sd</span>(rsq),</span>
<span id="cb500-13"><a href="solutions.html#cb500-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_mae     =</span> <span class="fu">sd</span>(mae))</span>
<span id="cb500-14"><a href="solutions.html#cb500-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-15"><a href="solutions.html#cb500-15" aria-hidden="true" tabindex="-1"></a>  df_long <span class="ot">&lt;-</span></span>
<span id="cb500-16"><a href="solutions.html#cb500-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb500-17"><a href="solutions.html#cb500-17" aria-hidden="true" tabindex="-1"></a>      df_agg <span class="sc">|&gt;</span> </span>
<span id="cb500-18"><a href="solutions.html#cb500-18" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(k, </span>
<span id="cb500-19"><a href="solutions.html#cb500-19" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">starts_with</span>(<span class="st">&quot;mean_&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb500-20"><a href="solutions.html#cb500-20" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;mean_&quot;</span>),</span>
<span id="cb500-21"><a href="solutions.html#cb500-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>,</span>
<span id="cb500-22"><a href="solutions.html#cb500-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb500-23"><a href="solutions.html#cb500-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;mean_&quot;</span>),</span>
<span id="cb500-24"><a href="solutions.html#cb500-24" aria-hidden="true" tabindex="-1"></a>        df_agg <span class="sc">|&gt;</span> </span>
<span id="cb500-25"><a href="solutions.html#cb500-25" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(k, </span>
<span id="cb500-26"><a href="solutions.html#cb500-26" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">starts_with</span>(<span class="st">&quot;sd_&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb500-27"><a href="solutions.html#cb500-27" aria-hidden="true" tabindex="-1"></a>          tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb500-28"><a href="solutions.html#cb500-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;sd_&quot;</span>),</span>
<span id="cb500-29"><a href="solutions.html#cb500-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>,</span>
<span id="cb500-30"><a href="solutions.html#cb500-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_to =</span> <span class="st">&quot;sd&quot;</span>,</span>
<span id="cb500-31"><a href="solutions.html#cb500-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_prefix =</span> <span class="st">&quot;sd_&quot;</span></span>
<span id="cb500-32"><a href="solutions.html#cb500-32" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb500-33"><a href="solutions.html#cb500-33" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb500-34"><a href="solutions.html#cb500-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-35"><a href="solutions.html#cb500-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_long)</span>
<span id="cb500-36"><a href="solutions.html#cb500-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="run-the-cross-validation" class="section level4 unnumbered hasAnchor">
<h4>Run the cross-validation<a href="solutions.html#run-the-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="solutions.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick parameters for cross-validation</span></span>
<span id="cb501-2"><a href="solutions.html#cb501-2" aria-hidden="true" tabindex="-1"></a>my_k <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>)</span>
<span id="cb501-3"><a href="solutions.html#cb501-3" aria-hidden="true" tabindex="-1"></a>my_folds <span class="ot">&lt;-</span> <span class="dv">10</span></span></code></pre></div>
<!-- >>> CHECK FOR REDUCING COMPUTATIONAL COST TO RENDER BOOK ONLINE <<< -->
<!-- SAVE DATA WHEN RUNNING LOCALLY BY SETTING EVAL = TRUE, PUSH ONLY WITH EVAL = FALSE -->
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="solutions.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run cross validation</span></span>
<span id="cb502-2"><a href="solutions.html#cb502-2" aria-hidden="true" tabindex="-1"></a>df_cv <span class="ot">&lt;-</span> <span class="fu">cross_validation_by_hand</span>(</span>
<span id="cb502-3"><a href="solutions.html#cb502-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_train =</span> df_train,</span>
<span id="cb502-4"><a href="solutions.html#cb502-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds  =</span> my_folds,</span>
<span id="cb502-5"><a href="solutions.html#cb502-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">vec_k    =</span> my_k</span>
<span id="cb502-6"><a href="solutions.html#cb502-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb502-7"><a href="solutions.html#cb502-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-8"><a href="solutions.html#cb502-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract metrics and prepare df for plotting</span></span>
<span id="cb502-9"><a href="solutions.html#cb502-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate the metrics plot to the mean values for each metric</span></span>
<span id="cb502-10"><a href="solutions.html#cb502-10" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">aggregate_cv_metrics</span>(df_cv)</span>
<span id="cb502-11"><a href="solutions.html#cb502-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-12"><a href="solutions.html#cb502-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract value and k for each best metric</span></span>
<span id="cb502-13"><a href="solutions.html#cb502-13" aria-hidden="true" tabindex="-1"></a>df_best <span class="ot">&lt;-</span> </span>
<span id="cb502-14"><a href="solutions.html#cb502-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb502-15"><a href="solutions.html#cb502-15" aria-hidden="true" tabindex="-1"></a>    df_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>),</span>
<span id="cb502-16"><a href="solutions.html#cb502-16" aria-hidden="true" tabindex="-1"></a>    df_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;mae&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>),</span>
<span id="cb502-17"><a href="solutions.html#cb502-17" aria-hidden="true" tabindex="-1"></a>    df_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;rsq&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mean)) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb502-18"><a href="solutions.html#cb502-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Done:  8  %
## Done:  15  %
## Done:  23  %
## Done:  31  %
## Done:  38  %
## Done:  46  %
## Done:  54  %
## Done:  62  %
## Done:  69  %
## Done:  77  %
## Done:  85  %
## Done:  92  %
## Done:  100  %</code></pre>
<!-- >>> END OF CHECK <<< -->
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="solutions.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check what out our dataframes look like</span></span>
<span id="cb504-2"><a href="solutions.html#cb504-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_best)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##       k metric  mean     sd
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1    20 rmse   1.51  0.104 
## 2    40 mae    1.15  0.0630
## 3    20 rsq    0.660 0.0378</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="solutions.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##       k metric  mean     sd
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     2 rmse   1.77  0.137 
## 2     2 rsq    0.559 0.0462
## 3     2 mae    1.35  0.0957
## 4     5 rmse   1.59  0.0784
## 5     5 rsq    0.627 0.0256
## 6     5 mae    1.21  0.0544</code></pre>
</div>
<div id="create-output" class="section level4 unnumbered hasAnchor">
<h4>Create output<a href="solutions.html#create-output" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="solutions.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a nice facet plot showing how each metric changes with k and </span></span>
<span id="cb508-2"><a href="solutions.html#cb508-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with vertical bar showing the optimal k for that parameter</span></span>
<span id="cb508-3"><a href="solutions.html#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb508-4"><a href="solutions.html#cb508-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_long, <span class="fu">aes</span>(k, mean)) <span class="sc">+</span></span>
<span id="cb508-5"><a href="solutions.html#cb508-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_long, <span class="fu">aes</span>(k, mean)) <span class="sc">+</span></span>
<span id="cb508-6"><a href="solutions.html#cb508-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> df_best,</span>
<span id="cb508-7"><a href="solutions.html#cb508-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> k),</span>
<span id="cb508-8"><a href="solutions.html#cb508-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span>    </span>
<span id="cb508-9"><a href="solutions.html#cb508-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>metric, </span>
<span id="cb508-10"><a href="solutions.html#cb508-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb508-11"><a href="solutions.html#cb508-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb508-12"><a href="solutions.html#cb508-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb508-13"><a href="solutions.html#cb508-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;rmse&quot;</span> <span class="ot">=</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb508-14"><a href="solutions.html#cb508-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;mae&quot;</span> <span class="ot">=</span>  <span class="st">&quot;MAE&quot;</span>,</span>
<span id="cb508-15"><a href="solutions.html#cb508-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;rsq&quot;</span> <span class="ot">=</span>  <span class="st">&quot;R^2&quot;</span></span>
<span id="cb508-16"><a href="solutions.html#cb508-16" aria-hidden="true" tabindex="-1"></a>             ))) <span class="sc">+</span></span>
<span id="cb508-17"><a href="solutions.html#cb508-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Cross-Validated Hyperparameter Tuning&quot;</span>,</span>
<span id="cb508-18"><a href="solutions.html#cb508-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Mean Cross-Validated Metric Value&quot;</span>,</span>
<span id="cb508-19"><a href="solutions.html#cb508-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Number of Neighbours (k)&quot;</span>) <span class="sc">+</span></span>
<span id="cb508-20"><a href="solutions.html#cb508-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb508-21"><a href="solutions.html#cb508-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-275-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="solutions.html#cb509-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(df_best, </span>
<span id="cb509-2"><a href="solutions.html#cb509-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb509-3"><a href="solutions.html#cb509-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Mean and standard deviation for cross-validated metrics and their best k.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-276">Table A.1: </span>Mean and standard deviation for cross-validated metrics and their best k.</caption>
<thead>
<tr class="header">
<th align="right">k</th>
<th align="left">metric</th>
<th align="right">mean</th>
<th align="right">sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">20</td>
<td align="left">rmse</td>
<td align="right">1.51</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="left">mae</td>
<td align="right">1.15</td>
<td align="right">0.06</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">rsq</td>
<td align="right">0.66</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
</div>
<div id="interpretation-of-results" class="section level4 hasAnchor" number="12.10.0.1">
<h4><span class="header-section-number">A.10.0.1</span> Interpretation of results<a href="solutions.html#interpretation-of-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>What do we see?</strong>
The plot above shows how the cross-validated values for MAE, RMSE, and adj. <span class="math inline">\(R^2\)</span> changes with the number of neighours, <span class="math inline">\(k\)</span>. We see that for each metric, we can find a best value at a distinct optimal <span class="math inline">\(k\)</span>. Increasing or decreasing <span class="math inline">\(k\)</span> worsens model performance. We can also see that there is some plateauing going on between a <span class="math inline">\(k\)</span> of 15-40, where there are no substantial changes for all metrics.</p>
<p><strong>What does that imply?</strong>
The pattern of cross-validated metric versus <span class="math inline">\(k\)</span> shows that we should use a value between 15-40 in order to get the best model performance. Alternatively, we could also rerun our analysis with a finer array of <span class="math inline">\(k\)</span> like <code>seq(20, 40, 1)</code> to get an even better estimate for <span class="math inline">\(k\)</span>.</p>
<p><strong>How do we continue from here?</strong>
Our goal is to get the best model and report on what is to be expected if we apply this model to unseen data.
Therefore, we now train our model again with the average optimal <span class="math inline">\(k\)</span> found but this time we include all training data. We do this because we want to utilize all available data to create our final model. Then we evaluate this final model against our test data. In theory, the model performance metrics on the test data should fall within the mean and standard deviation from the cross-validated model training. Is that the case here?</p>
</div>
<div id="teseting-our-hypothesis" class="section level4 unnumbered hasAnchor">
<h4>Teseting our hypothesis<a href="solutions.html#teseting-our-hypothesis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- >>> CHECK FOR REDUCING COMPUTATIONAL COST TO RENDER BOOK ONLINE <<< -->
<!-- SAVE DATA WHEN RUNNING LOCALLY BY SETTING EVAL = TRUE, PUSH ONLY WITH EVAL = FALSE -->
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="solutions.html#cb510-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal k from our cross-validation exercise </span></span>
<span id="cb510-2"><a href="solutions.html#cb510-2" aria-hidden="true" tabindex="-1"></a>my_k <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_best<span class="sc">$</span>k) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span>
<span id="cb510-3"><a href="solutions.html#cb510-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb510-4"><a href="solutions.html#cb510-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run cross validation</span></span>
<span id="cb510-5"><a href="solutions.html#cb510-5" aria-hidden="true" tabindex="-1"></a>df_cv <span class="ot">&lt;-</span> <span class="fu">cross_validation_by_hand</span>(</span>
<span id="cb510-6"><a href="solutions.html#cb510-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_train =</span> df_train,</span>
<span id="cb510-7"><a href="solutions.html#cb510-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds  =</span> my_folds, </span>
<span id="cb510-8"><a href="solutions.html#cb510-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">vec_k    =</span> my_k</span>
<span id="cb510-9"><a href="solutions.html#cb510-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb510-10"><a href="solutions.html#cb510-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb510-11"><a href="solutions.html#cb510-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate cv-metrics</span></span>
<span id="cb510-12"><a href="solutions.html#cb510-12" aria-hidden="true" tabindex="-1"></a>metrics_final_model <span class="ot">&lt;-</span> <span class="fu">aggregate_cv_metrics</span>(df_cv)</span></code></pre></div>
<pre><code>## Done:  100  %</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="solutions.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we train a new model with the same model setup but on the entire training set</span></span>
<span id="cb512-2"><a href="solutions.html#cb512-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s re-use the code from the tutorials!</span></span>
<span id="cb512-3"><a href="solutions.html#cb512-3" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> TA_F, </span>
<span id="cb512-4"><a href="solutions.html#cb512-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> df_train) <span class="sc">|&gt;</span> </span>
<span id="cb512-5"><a href="solutions.html#cb512-5" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_center</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb512-6"><a href="solutions.html#cb512-6" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_scale</span>( recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>())</span>
<span id="cb512-7"><a href="solutions.html#cb512-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-8"><a href="solutions.html#cb512-8" aria-hidden="true" tabindex="-1"></a>mycv_knn <span class="ot">&lt;-</span> </span>
<span id="cb512-9"><a href="solutions.html#cb512-9" aria-hidden="true" tabindex="-1"></a>  caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb512-10"><a href="solutions.html#cb512-10" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb512-11"><a href="solutions.html#cb512-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb512-12"><a href="solutions.html#cb512-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb512-13"><a href="solutions.html#cb512-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;none&quot;</span>),</span>
<span id="cb512-14"><a href="solutions.html#cb512-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> my_k),</span>
<span id="cb512-15"><a href="solutions.html#cb512-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb512-16"><a href="solutions.html#cb512-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb512-17"><a href="solutions.html#cb512-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-18"><a href="solutions.html#cb512-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model against test set</span></span>
<span id="cb512-19"><a href="solutions.html#cb512-19" aria-hidden="true" tabindex="-1"></a>mycv_eval <span class="ot">&lt;-</span> <span class="fu">eval_model</span>(mycv_knn, </span>
<span id="cb512-20"><a href="solutions.html#cb512-20" aria-hidden="true" tabindex="-1"></a>                        df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb512-21"><a href="solutions.html#cb512-21" aria-hidden="true" tabindex="-1"></a>                        df_test, </span>
<span id="cb512-22"><a href="solutions.html#cb512-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">return_metrics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="solutions.html#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s see what caret::train() estimates</span></span>
<span id="cb513-2"><a href="solutions.html#cb513-2" aria-hidden="true" tabindex="-1"></a>caretcv_knn <span class="ot">&lt;-</span> </span>
<span id="cb513-3"><a href="solutions.html#cb513-3" aria-hidden="true" tabindex="-1"></a>  caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb513-4"><a href="solutions.html#cb513-4" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb513-5"><a href="solutions.html#cb513-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb513-6"><a href="solutions.html#cb513-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb513-7"><a href="solutions.html#cb513-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, </span>
<span id="cb513-8"><a href="solutions.html#cb513-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">number =</span> my_folds),</span>
<span id="cb513-9"><a href="solutions.html#cb513-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> my_k),</span>
<span id="cb513-10"><a href="solutions.html#cb513-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb513-11"><a href="solutions.html#cb513-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb513-12"><a href="solutions.html#cb513-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-13"><a href="solutions.html#cb513-13" aria-hidden="true" tabindex="-1"></a>caretcv_eval <span class="ot">&lt;-</span> <span class="fu">eval_model</span>(caretcv_knn, </span>
<span id="cb513-14"><a href="solutions.html#cb513-14" aria-hidden="true" tabindex="-1"></a>                           df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb513-15"><a href="solutions.html#cb513-15" aria-hidden="true" tabindex="-1"></a>                           df_test, </span>
<span id="cb513-16"><a href="solutions.html#cb513-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">return_metrics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<!-- >>> END OF CHECK <<< -->
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="solutions.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, compare the cross-validated metrics against the metrics on the test set</span></span>
<span id="cb514-2"><a href="solutions.html#cb514-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Cross-Validated Metrics by hand: </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-3"><a href="solutions.html#cb514-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>mean[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>sd[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-4"><a href="solutions.html#cb514-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>mean[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-5"><a href="solutions.html#cb514-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>mean[<span class="dv">3</span>], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>sd[<span class="dv">3</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-6"><a href="solutions.html#cb514-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb514-7"><a href="solutions.html#cb514-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Cross-Validated Metrics by {caret}: </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-8"><a href="solutions.html#cb514-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">2</span>]], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">5</span>]], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-9"><a href="solutions.html#cb514-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">3</span>]], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">6</span>]], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-10"><a href="solutions.html#cb514-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">4</span>]], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">7</span>]], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-11"><a href="solutions.html#cb514-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb514-12"><a href="solutions.html#cb514-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Metrics on Test Set by hand:</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-13"><a href="solutions.html#cb514-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(mycv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">1</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-14"><a href="solutions.html#cb514-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(mycv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">2</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-15"><a href="solutions.html#cb514-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(mycv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">3</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-16"><a href="solutions.html#cb514-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb514-17"><a href="solutions.html#cb514-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Metrics on Test Set by {caret}:</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-18"><a href="solutions.html#cb514-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(caretcv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">1</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-19"><a href="solutions.html#cb514-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(caretcv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">2</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb514-20"><a href="solutions.html#cb514-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(caretcv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">3</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Cross-Validated Metrics by hand: 
##   RMSE:  1.505  +/-  0.126 
##   R^2:  0.665  +/-  0.038 
##   MAE:  1.148  +/-  0.075 
##  
## Cross-Validated Metrics by {caret}: 
##   RMSE:  1.512  +/-  0.081 
##   R^2:  0.66  +/-  0.031 
##   MAE:  1.154  +/-  0.07 
##  
## Metrics on Test Set by hand:
##   RMSE:  1.539 
##   R^2:  0.647 
##   MAE:  1.149 
##  
## Metrics on Test Set by {caret}:
##   RMSE:  1.539 
##   R^2:  0.647 
##   MAE:  1.149</code></pre>
</div>
<div id="interpretation-of-results-1" class="section level4 unnumbered hasAnchor">
<h4>Interpretation of results<a href="solutions.html#interpretation-of-results-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nice, these number look good! They give us two key results:</p>
<ol style="list-style-type: decimal">
<li><p>The cross-validated estimated model metrics are very similar between using our own algorithm and the {caret} package, suggesting that our implementation is correct. Also, the metrics on the test set of the our and {caret}’s model are identical!</p></li>
<li><p>When testing our final model, the model that was was trained on the full training set, against the test data, it shows model metrics that are within the range of our estimated cross-validated metrics. For example, the cross-validation shows that if we are training a model on the full dataset and test it on unseen data, we expect that the MAE would fall within 1.148 +/- 0.075. We found an MAE on the test set of 1.149, which is within the expected range. Therefore, we can assume that our model would predict on unseen data with a similar uncertainty.</p></li>
</ol>
<!-- Exercise Improvements:
- The splitting between train and validation data does not account for distributions of variables. This could be improved.
-->
</div>
</div>
<div id="testing-the-generalisability-of-a-model" class="section level3 unnumbered hasAnchor">
<h3>Testing the generalisability of a model<a href="solutions.html#testing-the-generalisability-of-a-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided because part of the final report.</em></p>
</div>
</div>
<div id="random-forests" class="section level2 hasAnchor" number="12.11">
<h2><span class="header-section-number">A.11</span> Random Forests<a href="solutions.html#random-forests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>81b9ad7ed75702d88893258a442ddc4568b7c91b</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="randomforest.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
