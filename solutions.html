<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>A Solutions | Applied Geodata Science</title>
  <meta name="description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="A Solutions | Applied Geodata Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  <meta name="github-repo" content="stineb/agsd" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Solutions | Applied Geodata Science" />
  
  <meta name="twitter:description" content="This course prepares you to benefit from the general data richness in environmental and geo-sciences." />
  

<meta name="author" content="Benjamin Stocker (lead), Koen Hufkens (contributing), Pepa Arán (contributing), Pascal Schneider (contributing)" />


<meta name="date" content="2023-02-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="figures/apple-touch-icon.png" />
  <link rel="shortcut icon" href="figures/favicon.ico" type="image/x-icon" />
<link rel="prev" href="randomforest.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Geodata Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-course"><i class="fa fa-check"></i>About this course</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-goal"><i class="fa fa-check"></i>Course goal</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#what-is-applied-geodata-science"><i class="fa fa-check"></i>What is Applied Geodata Science?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#the-data-science-workflow"><i class="fa fa-check"></i>The data science workflow</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#why-now"><i class="fa fa-check"></i>Why now?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-new-modelling-paradigm"><i class="fa fa-check"></i>A new modelling paradigm</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reading-and-link-collection"><i class="fa fa-check"></i>Reading and link collection</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="gettingstarted.html"><a href="gettingstarted.html#learning-objectives-1"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2" data-path="gettingstarted.html"><a href="gettingstarted.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="gettingstarted.html"><a href="gettingstarted.html#working-with-r-and-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Working with R and RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="gettingstarted.html"><a href="gettingstarted.html#r-objects"><i class="fa fa-check"></i><b>1.2.2</b> R objects</a></li>
<li class="chapter" data-level="1.2.3" data-path="gettingstarted.html"><a href="gettingstarted.html#r-environment"><i class="fa fa-check"></i><b>1.2.3</b> R environment</a></li>
<li class="chapter" data-level="1.2.4" data-path="gettingstarted.html"><a href="gettingstarted.html#libraries"><i class="fa fa-check"></i><b>1.2.4</b> Libraries</a></li>
<li class="chapter" data-level="1.2.5" data-path="gettingstarted.html"><a href="gettingstarted.html#r-scripts"><i class="fa fa-check"></i><b>1.2.5</b> R scripts</a></li>
<li class="chapter" data-level="1.2.6" data-path="gettingstarted.html"><a href="gettingstarted.html#rmarkdown"><i class="fa fa-check"></i><b>1.2.6</b> R Markdown</a></li>
<li class="chapter" data-level="1.2.7" data-path="gettingstarted.html"><a href="gettingstarted.html#wspmgmt"><i class="fa fa-check"></i><b>1.2.7</b> Workspace management</a></li>
<li class="chapter" data-level="1.2.8" data-path="gettingstarted.html"><a href="gettingstarted.html#setup"><i class="fa fa-check"></i><b>1.2.8</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="gettingstarted.html"><a href="gettingstarted.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#dimensions-of-a-circle"><i class="fa fa-check"></i>Dimensions of a circle</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#sequence-of-numbers"><i class="fa fa-check"></i>Sequence of numbers</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#gauss-sum"><i class="fa fa-check"></i>Gauss sum</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#magic-trick-algorithm"><i class="fa fa-check"></i>Magic trick algorithm</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#vectors-1"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#data-frames-1"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="gettingstarted.html"><a href="gettingstarted.html#workspace"><i class="fa fa-check"></i>Workspace</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programmingprimers.html"><a href="programmingprimers.html"><i class="fa fa-check"></i><b>2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#learning-objectives-2"><i class="fa fa-check"></i><b>2.1</b> Learning objectives</a></li>
<li class="chapter" data-level="2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programmingprimers.html"><a href="programmingprimers.html#programming-basics"><i class="fa fa-check"></i><b>2.2.1</b> Programming basics</a></li>
<li class="chapter" data-level="2.2.2" data-path="programmingprimers.html"><a href="programmingprimers.html#style-your-code"><i class="fa fa-check"></i><b>2.2.2</b> Style your code</a></li>
<li class="chapter" data-level="2.2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#findinghelp"><i class="fa fa-check"></i><b>2.2.3</b> Where to find help</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programmingprimers.html"><a href="programmingprimers.html#exercises-1"><i class="fa fa-check"></i><b>2.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#gauss-variations"><i class="fa fa-check"></i>Gauss variations</a></li>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#nested-loops"><i class="fa fa-check"></i>Nested loops</a></li>
<li class="chapter" data-level="" data-path="programmingprimers.html"><a href="programmingprimers.html#interpolation"><i class="fa fa-check"></i>Interpolation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datawrangling.html"><a href="datawrangling.html#learning-objectives-3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives</a></li>
<li class="chapter" data-level="3.2" data-path="datawrangling.html"><a href="datawrangling.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datawrangling.html"><a href="datawrangling.html#example-data"><i class="fa fa-check"></i><b>3.2.1</b> Example data</a></li>
<li class="chapter" data-level="3.2.2" data-path="datawrangling.html"><a href="datawrangling.html#tidyverse"><i class="fa fa-check"></i><b>3.2.2</b> Tidyverse</a></li>
<li class="chapter" data-level="3.2.3" data-path="datawrangling.html"><a href="datawrangling.html#reading-tabular-data"><i class="fa fa-check"></i><b>3.2.3</b> Reading tabular data</a></li>
<li class="chapter" data-level="3.2.4" data-path="datawrangling.html"><a href="datawrangling.html#variable-selection"><i class="fa fa-check"></i><b>3.2.4</b> Variable selection</a></li>
<li class="chapter" data-level="3.2.5" data-path="datawrangling.html"><a href="datawrangling.html#time-objects"><i class="fa fa-check"></i><b>3.2.5</b> Time objects</a></li>
<li class="chapter" data-level="3.2.6" data-path="datawrangling.html"><a href="datawrangling.html#variable-re--definition"><i class="fa fa-check"></i><b>3.2.6</b> Variable (re-) definition</a></li>
<li class="chapter" data-level="3.2.7" data-path="datawrangling.html"><a href="datawrangling.html#axes-of-variation"><i class="fa fa-check"></i><b>3.2.7</b> Axes of variation</a></li>
<li class="chapter" data-level="3.2.8" data-path="datawrangling.html"><a href="datawrangling.html#tidydata"><i class="fa fa-check"></i><b>3.2.8</b> Tidy data</a></li>
<li class="chapter" data-level="3.2.9" data-path="datawrangling.html"><a href="datawrangling.html#aggregating-data"><i class="fa fa-check"></i><b>3.2.9</b> Aggregating data</a></li>
<li class="chapter" data-level="3.2.10" data-path="datawrangling.html"><a href="datawrangling.html#data-cleaning"><i class="fa fa-check"></i><b>3.2.10</b> Data cleaning</a></li>
<li class="chapter" data-level="3.2.11" data-path="datawrangling.html"><a href="datawrangling.html#writing-data-to-csv"><i class="fa fa-check"></i><b>3.2.11</b> Writing data to CSV</a></li>
<li class="chapter" data-level="3.2.12" data-path="datawrangling.html"><a href="datawrangling.html#combining-relational-data"><i class="fa fa-check"></i><b>3.2.12</b> Combining relational data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datawrangling.html"><a href="datawrangling.html#extramaterialwrangling"><i class="fa fa-check"></i><b>3.3</b> Extra material</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-i"><i class="fa fa-check"></i><b>3.3.1</b> Functional programming I</a></li>
<li class="chapter" data-level="3.3.2" data-path="datawrangling.html"><a href="datawrangling.html#strings"><i class="fa fa-check"></i><b>3.3.2</b> Strings</a></li>
<li class="chapter" data-level="3.3.3" data-path="datawrangling.html"><a href="datawrangling.html#functional-programming-ii"><i class="fa fa-check"></i><b>3.3.3</b> Functional programming II</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datawrangling.html"><a href="datawrangling.html#exerciseswrangling"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#star-wars"><i class="fa fa-check"></i>Star wars</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#aggregating"><i class="fa fa-check"></i>Aggregating</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#patterns-in-data-quality"><i class="fa fa-check"></i>Patterns in data quality</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="datawrangling.html"><a href="datawrangling.html#report-exercise"><i class="fa fa-check"></i><b>3.5</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#cleaning-data-from-elevated-co_2-experiments"><i class="fa fa-check"></i>Cleaning data from elevated CO<span class="math inline">\(_2\)</span> experiments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>4</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="datavis.html"><a href="datavis.html#learning-objectives-4"><i class="fa fa-check"></i><b>4.1</b> Learning objectives</a></li>
<li class="chapter" data-level="4.2" data-path="datavis.html"><a href="datavis.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="datavis.html"><a href="datavis.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.2.1</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.2.2" data-path="datavis.html"><a href="datavis.html#every-data-has-its-representation"><i class="fa fa-check"></i><b>4.2.2</b> Every data has its representation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="datavis.html"><a href="datavis.html#exercises-2"><i class="fa fa-check"></i><b>4.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#spurious-data"><i class="fa fa-check"></i>Spurious data</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#identifying-outliers"><i class="fa fa-check"></i>Identifying Outliers</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#visualising-diurnal-and-seasonal-cycles-of-gpp"><i class="fa fa-check"></i>Visualising diurnal and seasonal cycles of GPP</a></li>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#trend-in-carbon-dioxide-concentrations"><i class="fa fa-check"></i>Trend in carbon dioxide concentrations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="datavis.html"><a href="datavis.html#report-exercises"><i class="fa fa-check"></i><b>4.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavis.html"><a href="datavis.html#telling-a-story-from-data"><i class="fa fa-check"></i>Telling a story from data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datavariety.html"><a href="datavariety.html"><i class="fa fa-check"></i><b>5</b> Data variety</a>
<ul>
<li class="chapter" data-level="5.1" data-path="datavariety.html"><a href="datavariety.html#learning-objectives-5"><i class="fa fa-check"></i><b>5.1</b> Learning objectives</a></li>
<li class="chapter" data-level="5.2" data-path="datavariety.html"><a href="datavariety.html#tutorial-4"><i class="fa fa-check"></i><b>5.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats"><i class="fa fa-check"></i><b>5.2.1</b> Files and file formats</a></li>
<li class="chapter" data-level="5.2.2" data-path="datavariety.html"><a href="datavariety.html#meta-data"><i class="fa fa-check"></i><b>5.2.2</b> Meta-data</a></li>
<li class="chapter" data-level="5.2.3" data-path="datavariety.html"><a href="datavariety.html#spatial-data-representation"><i class="fa fa-check"></i><b>5.2.3</b> Spatial data representation</a></li>
<li class="chapter" data-level="5.2.4" data-path="datavariety.html"><a href="datavariety.html#online-data-sources"><i class="fa fa-check"></i><b>5.2.4</b> Online data sources</a></li>
<li class="chapter" data-level="5.2.5" data-path="datavariety.html"><a href="datavariety.html#example-environmental-data-repositories"><i class="fa fa-check"></i><b>5.2.5</b> Example environmental data repositories</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="datavariety.html"><a href="datavariety.html#exercises-3"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="datavariety.html"><a href="datavariety.html#files-and-file-formats-1"><i class="fa fa-check"></i>Files and file formats</a></li>
<li class="chapter" data-level="" data-path="datavariety.html"><a href="datavariety.html#api-use"><i class="fa fa-check"></i>API use</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="openscience.html"><a href="openscience.html"><i class="fa fa-check"></i><b>6</b> Open science practices</a>
<ul>
<li class="chapter" data-level="6.1" data-path="openscience.html"><a href="openscience.html#learning-objectives-6"><i class="fa fa-check"></i><b>6.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.2" data-path="openscience.html"><a href="openscience.html#tutorial-5"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="openscience.html"><a href="openscience.html#project-structure"><i class="fa fa-check"></i><b>6.2.1</b> Project structure</a></li>
<li class="chapter" data-level="6.2.2" data-path="openscience.html"><a href="openscience.html#managing-workflows"><i class="fa fa-check"></i><b>6.2.2</b> Managing workflows</a></li>
<li class="chapter" data-level="6.2.3" data-path="openscience.html"><a href="openscience.html#capturing-your-session-state"><i class="fa fa-check"></i><b>6.2.3</b> Capturing your session state</a></li>
<li class="chapter" data-level="6.2.4" data-path="openscience.html"><a href="openscience.html#capturing-a-system-state"><i class="fa fa-check"></i><b>6.2.4</b> Capturing a system state</a></li>
<li class="chapter" data-level="6.2.5" data-path="openscience.html"><a href="openscience.html#readable-reporting-using-rmarkdown"><i class="fa fa-check"></i><b>6.2.5</b> Readable reporting using Rmarkdown</a></li>
<li class="chapter" data-level="6.2.6" data-path="openscience.html"><a href="openscience.html#data-retention"><i class="fa fa-check"></i><b>6.2.6</b> Data retention</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="openscience.html"><a href="openscience.html#exercises-4"><i class="fa fa-check"></i><b>6.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#external-data"><i class="fa fa-check"></i>External data</a></li>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#a-new-project"><i class="fa fa-check"></i>A new project</a></li>
<li class="chapter" data-level="" data-path="openscience.html"><a href="openscience.html#tracking-the-state-of-your-project"><i class="fa fa-check"></i>Tracking the state of your project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="codemgmt.html"><a href="codemgmt.html"><i class="fa fa-check"></i><b>7</b> Code management</a>
<ul>
<li class="chapter" data-level="7.1" data-path="codemgmt.html"><a href="codemgmt.html#learning-objectives-7"><i class="fa fa-check"></i><b>7.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.2" data-path="codemgmt.html"><a href="codemgmt.html#tutorial-6"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="codemgmt.html"><a href="codemgmt.html#gitworkflow"><i class="fa fa-check"></i><b>7.2.1</b> Git and local version control</a></li>
<li class="chapter" data-level="7.2.2" data-path="codemgmt.html"><a href="codemgmt.html#remote-version-control"><i class="fa fa-check"></i><b>7.2.2</b> Remote version control</a></li>
<li class="chapter" data-level="7.2.3" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management---github-templates"><i class="fa fa-check"></i><b>7.2.3</b> Location based code management - github templates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="codemgmt.html"><a href="codemgmt.html#exercises-5"><i class="fa fa-check"></i><b>7.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#location-based-code-management"><i class="fa fa-check"></i>Location based code management</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="codemgmt.html"><a href="codemgmt.html#report-exercises-1"><i class="fa fa-check"></i><b>7.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="codemgmt.html"><a href="codemgmt.html#collaborative-work-on-github"><i class="fa fa-check"></i>Collaborative Work on Github</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regressionclassification.html"><a href="regressionclassification.html"><i class="fa fa-check"></i><b>8</b> Regression and classification</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regressionclassification.html"><a href="regressionclassification.html#learning-objectives-8"><i class="fa fa-check"></i><b>8.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.2" data-path="regressionclassification.html"><a href="regressionclassification.html#tutorial-7"><i class="fa fa-check"></i><b>8.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regressionclassification.html"><a href="regressionclassification.html#types-of-models"><i class="fa fa-check"></i><b>8.2.1</b> Types of models</a></li>
<li class="chapter" data-level="8.2.2" data-path="regressionclassification.html"><a href="regressionclassification.html#regression"><i class="fa fa-check"></i><b>8.2.2</b> Regression</a></li>
<li class="chapter" data-level="8.2.3" data-path="regressionclassification.html"><a href="regressionclassification.html#classification"><i class="fa fa-check"></i><b>8.2.3</b> Classification</a></li>
<li class="chapter" data-level="8.2.4" data-path="regressionclassification.html"><a href="regressionclassification.html#model-evaluation"><i class="fa fa-check"></i><b>8.2.4</b> Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regressionclassification.html"><a href="regressionclassification.html#exercises-6"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
<li class="chapter" data-level="8.4" data-path="regressionclassification.html"><a href="regressionclassification.html#report-exercise-1"><i class="fa fa-check"></i><b>8.4</b> Report Exercise</a>
<ul>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#context"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#deliverables-for-the-report"><i class="fa fa-check"></i>Deliverables for the report</a></li>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#find-the-single-best-predictor"><i class="fa fa-check"></i>Find the single best predictor</a></li>
<li class="chapter" data-level="" data-path="regressionclassification.html"><a href="regressionclassification.html#minimum-reproducible-example"><i class="fa fa-check"></i>Minimum reproducible example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="supervisedmli.html"><a href="supervisedmli.html"><i class="fa fa-check"></i><b>9</b> Supervised machine learning I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="supervisedmli.html"><a href="supervisedmli.html#learning-objectives-9"><i class="fa fa-check"></i><b>9.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="supervisedmli.html"><a href="supervisedmli.html#tutorial-8"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="supervisedmli.html"><a href="supervisedmli.html#what-is-supervised-machine-learning"><i class="fa fa-check"></i><b>9.2.1</b> What is supervised machine learning?</a></li>
<li class="chapter" data-level="9.2.2" data-path="supervisedmli.html"><a href="supervisedmli.html#overfitting"><i class="fa fa-check"></i><b>9.2.2</b> Overfitting</a></li>
<li class="chapter" data-level="9.2.3" data-path="supervisedmli.html"><a href="supervisedmli.html#data-and-the-modelling-challenge"><i class="fa fa-check"></i><b>9.2.3</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="9.2.4" data-path="supervisedmli.html"><a href="supervisedmli.html#k-nearest-neighbours"><i class="fa fa-check"></i><b>9.2.4</b> K-nearest neighbours</a></li>
<li class="chapter" data-level="9.2.5" data-path="supervisedmli.html"><a href="supervisedmli.html#model-formulation"><i class="fa fa-check"></i><b>9.2.5</b> Model formulation</a></li>
<li class="chapter" data-level="9.2.6" data-path="supervisedmli.html"><a href="supervisedmli.html#data-splitting"><i class="fa fa-check"></i><b>9.2.6</b> Data splitting</a></li>
<li class="chapter" data-level="9.2.7" data-path="supervisedmli.html"><a href="supervisedmli.html#preprocessing"><i class="fa fa-check"></i><b>9.2.7</b> Pre-processing</a></li>
<li class="chapter" data-level="9.2.8" data-path="supervisedmli.html"><a href="supervisedmli.html#putting-it-all-together-half-way"><i class="fa fa-check"></i><b>9.2.8</b> Putting it all together (half-way)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="supervisedmli.html"><a href="supervisedmli.html#exercises-7"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
<li class="chapter" data-level="9.4" data-path="supervisedmli.html"><a href="supervisedmli.html#report-exercises-2"><i class="fa fa-check"></i><b>9.4</b> Report Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmli.html"><a href="supervisedmli.html#comparison-of-lm-and-knn"><i class="fa fa-check"></i>Comparison of LM and KNN</a></li>
<li class="chapter" data-level="" data-path="supervisedmli.html"><a href="supervisedmli.html#the-role-of-picking-a-hyperparameter"><i class="fa fa-check"></i>The role of picking a hyperparameter</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="supervisedmlii.html"><a href="supervisedmlii.html"><i class="fa fa-check"></i><b>10</b> Supervised machine learning II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#learning-objectives-10"><i class="fa fa-check"></i><b>10.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#tutorial-9"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="supervisedmlii.html"><a href="supervisedmlii.html#data-and-the-modelling-challenge-1"><i class="fa fa-check"></i><b>10.2.1</b> Data and the modelling challenge</a></li>
<li class="chapter" data-level="10.2.2" data-path="supervisedmlii.html"><a href="supervisedmlii.html#training"><i class="fa fa-check"></i><b>10.2.2</b> Loss function</a></li>
<li class="chapter" data-level="10.2.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#hyperparameters"><i class="fa fa-check"></i><b>10.2.3</b> Hyperparameters</a></li>
<li class="chapter" data-level="10.2.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#resampling"><i class="fa fa-check"></i><b>10.2.4</b> Resampling</a></li>
<li class="chapter" data-level="10.2.5" data-path="supervisedmlii.html"><a href="supervisedmlii.html#validation-versus-testing-data"><i class="fa fa-check"></i><b>10.2.5</b> Validation versus testing data</a></li>
<li class="chapter" data-level="10.2.6" data-path="supervisedmlii.html"><a href="supervisedmlii.html#modeling-with-structured-data"><i class="fa fa-check"></i><b>10.2.6</b> Modeling with structured data</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="supervisedmlii.html"><a href="supervisedmlii.html#exercises-8"><i class="fa fa-check"></i><b>10.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="supervisedmlii.html"><a href="supervisedmlii.html#cross-validation-by-hand"><i class="fa fa-check"></i>Cross-validation by hand</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="supervisedmlii.html"><a href="supervisedmlii.html#report-exercises-3"><i class="fa fa-check"></i><b>10.4</b> Report Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="randomforest.html"><a href="randomforest.html"><i class="fa fa-check"></i><b>11</b> Random Forest</a>
<ul>
<li class="chapter" data-level="11.1" data-path="randomforest.html"><a href="randomforest.html#learning-objectives-11"><i class="fa fa-check"></i><b>11.1</b> Learning objectives</a></li>
<li class="chapter" data-level="11.2" data-path="randomforest.html"><a href="randomforest.html#tutorial-10"><i class="fa fa-check"></i><b>11.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="randomforest.html"><a href="randomforest.html#decision-trees"><i class="fa fa-check"></i><b>11.2.1</b> Decision trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="randomforest.html"><a href="randomforest.html#bagging"><i class="fa fa-check"></i><b>11.2.2</b> Bagging</a></li>
<li class="chapter" data-level="11.2.3" data-path="randomforest.html"><a href="randomforest.html#from-trees-to-a-forest"><i class="fa fa-check"></i><b>11.2.3</b> From trees to a forest</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="randomforest.html"><a href="randomforest.html#exercises-9"><i class="fa fa-check"></i><b>11.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="randomforest.html"><a href="randomforest.html#fitting-a-random-forest"><i class="fa fa-check"></i>Fitting a Random Forest</a></li>
<li class="chapter" data-level="" data-path="randomforest.html"><a href="randomforest.html#hyperparameter-tuning"><i class="fa fa-check"></i>Hyperparameter tuning</a></li>
<li class="chapter" data-level="" data-path="randomforest.html"><a href="randomforest.html#model-performance"><i class="fa fa-check"></i>Model performance</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i><b>A</b> Solutions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="solutions.html"><a href="solutions.html#getting-started"><i class="fa fa-check"></i><b>A.1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#dimensions-of-a-circle-1"><i class="fa fa-check"></i>Dimensions of a circle</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#sequence-of-numbers-1"><i class="fa fa-check"></i>Sequence of numbers</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#gauss-sum-1"><i class="fa fa-check"></i>Gauss sum</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#magic-trick-algorithm-1"><i class="fa fa-check"></i>Magic trick algorithm</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#vectors-2"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#data-frames-2"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#workspace-1"><i class="fa fa-check"></i>Workspace</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="solutions.html"><a href="solutions.html#programming-primers"><i class="fa fa-check"></i><b>A.2</b> Programming primers</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#gauss-variations-1"><i class="fa fa-check"></i>Gauss variations</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#nested-loops-1"><i class="fa fa-check"></i>Nested loops</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#interpolation-1"><i class="fa fa-check"></i>Interpolation</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="solutions.html"><a href="solutions.html#data-wrangling"><i class="fa fa-check"></i><b>A.3</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#star-wars-1"><i class="fa fa-check"></i>Star wars</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#aggregating-1"><i class="fa fa-check"></i>Aggregating</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#patterns-in-data-quality-1"><i class="fa fa-check"></i>Patterns in data quality</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="solutions.html"><a href="solutions.html#data-visualisation"><i class="fa fa-check"></i><b>A.4</b> Data Visualisation</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#spurious-data-1"><i class="fa fa-check"></i>Spurious data</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#identifying-outliers-1"><i class="fa fa-check"></i>Identifying Outliers</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#visualising-diurnal-and-seasonal-cycles-of-gpp-1"><i class="fa fa-check"></i>Visualising diurnal and seasonal cycles of GPP</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#trend-in-carbon-dioxide-concentrations-1"><i class="fa fa-check"></i>Trend in carbon dioxide concentrations</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="solutions.html"><a href="solutions.html#data-variety"><i class="fa fa-check"></i><b>A.5</b> Data Variety</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#files-and-file-formats-2"><i class="fa fa-check"></i>Files and file formats</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="solutions.html"><a href="solutions.html#open-science"><i class="fa fa-check"></i><b>A.6</b> Open Science</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#external-data-1"><i class="fa fa-check"></i>External data</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#a-new-project-1"><i class="fa fa-check"></i>A new project</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#tracking-the-state-of-your-project-1"><i class="fa fa-check"></i>Tracking the state of your project</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="solutions.html"><a href="solutions.html#code-management"><i class="fa fa-check"></i><b>A.7</b> Code Management</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#location-based-code-management-1"><i class="fa fa-check"></i>Location based code management</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="solutions.html"><a href="solutions.html#regression-and-classification"><i class="fa fa-check"></i><b>A.8</b> Regression and Classification</a></li>
<li class="chapter" data-level="A.9" data-path="solutions.html"><a href="solutions.html#supervised-ml-i"><i class="fa fa-check"></i><b>A.9</b> Supervised ML I</a></li>
<li class="chapter" data-level="A.10" data-path="solutions.html"><a href="solutions.html#supervised-ml-ii"><i class="fa fa-check"></i><b>A.10</b> Supervised ML II</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#cross-validation-by-hand-1"><i class="fa fa-check"></i>Cross-validation by hand</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="solutions.html"><a href="solutions.html#random-forest"><i class="fa fa-check"></i><b>A.11</b> Random Forest</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#fitting-a-random-forest-1"><i class="fa fa-check"></i>Fitting a Random Forest</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#hyperparameter-tuning-1"><i class="fa fa-check"></i>Hyperparameter tuning</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#model-performance-1"><i class="fa fa-check"></i>Model performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#system-information-and-package-list"><i class="fa fa-check"></i>System information and package list</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Geodata Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="solutions" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">A</span> Solutions<a href="solutions.html#solutions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="getting-started" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">A.1</span> Getting Started<a href="solutions.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="dimensions-of-a-circle-1" class="section level3 unnumbered hasAnchor">
<h3>Dimensions of a circle<a href="solutions.html#dimensions-of-a-circle-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Given the radius of a circle write a few lines of code that calculates its area and its circumference. Run your code with different values assigned of the radius.</li>
</ul>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="solutions.html#cb413-1" aria-hidden="true" tabindex="-1"></a>radius <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb413-2"><a href="solutions.html#cb413-2" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> pi <span class="sc">*</span> radius<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb413-3"><a href="solutions.html#cb413-3" aria-hidden="true" tabindex="-1"></a>circum <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> radius</span></code></pre></div>
<ul>
<li>Print the solution as text.</li>
</ul>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="solutions.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Radius:&quot;</span>, radius, <span class="st">&quot;   Circumference:&quot;</span>, circum))</span></code></pre></div>
<pre><code>## [1] &quot;Radius: 1    Circumference: 6.28318530717959&quot;</code></pre>
</div>
<div id="sequence-of-numbers-1" class="section level3 unnumbered hasAnchor">
<h3>Sequence of numbers<a href="solutions.html#sequence-of-numbers-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generate a sequence of numbers from 0 and <span class="math inline">\(\pi\)</span> as a vector with length 5.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="solutions.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.0000000 0.7853982 1.5707963 2.3561945 3.1415927</code></pre>
</div>
<div id="gauss-sum-1" class="section level3 unnumbered hasAnchor">
<h3>Gauss sum<a href="solutions.html#gauss-sum-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rumors have it that young Carl Friedrich Gauss was asked in primary school to calculate the sum of all natural numbers between 1 and 100. He did it in his head in no time. We’re very likely not as intelligent as young Gauss. But we have R. What’s the solution?</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="solutions.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Gauss calculated the sum with a trick. The sum of 100 and 1 is 101. The sum of 99 and 2 is 101. You do this 50 times, and you get <span class="math inline">\(50 \times 101\)</span>. Demonstrate Gauss’ trick with vectors in R.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="solutions.html#cb420-1" aria-hidden="true" tabindex="-1"></a>vec_a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb420-2"><a href="solutions.html#cb420-2" aria-hidden="true" tabindex="-1"></a>vec_b <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">:</span><span class="dv">51</span></span>
<span id="cb420-3"><a href="solutions.html#cb420-3" aria-hidden="true" tabindex="-1"></a>vec_c <span class="ot">&lt;-</span> vec_a <span class="sc">+</span> vec_b</span>
<span id="cb420-4"><a href="solutions.html#cb420-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-5"><a href="solutions.html#cb420-5" aria-hidden="true" tabindex="-1"></a><span class="co"># each element is 101</span></span>
<span id="cb420-6"><a href="solutions.html#cb420-6" aria-hidden="true" tabindex="-1"></a>vec_c</span></code></pre></div>
<pre><code>##  [1] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [20] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [39] 101 101 101 101 101 101 101 101 101 101 101 101</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="solutions.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the length of vectors is fifty. 50 * 101</span></span>
<span id="cb422-2"><a href="solutions.html#cb422-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(vec_c)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
</div>
<div id="magic-trick-algorithm-1" class="section level3 unnumbered hasAnchor">
<h3>Magic trick algorithm<a href="solutions.html#magic-trick-algorithm-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Define a variable named <code>x</code> that contains an integer value and perform the following operations in sequence:</p>
<ul>
<li>Redefine <code>x</code> by adding 1.</li>
<li>Double the resulting number, over-writing <code>x</code>.</li>
<li>Add 4 to <code>x</code> and save the result as <code>x</code>.</li>
<li>Redefine <code>x</code> as half of the previous value of <code>x</code>.</li>
<li>Subtract the originally chosen arbitrary number from <code>x</code>.</li>
</ul>
<p>Print <code>x</code>. Restart the algorithm defined above by choosing a new arbitrary natural number.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="solutions.html#cb424-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">999</span>  <span class="co"># arbitrary integer</span></span>
<span id="cb424-2"><a href="solutions.html#cb424-2" aria-hidden="true" tabindex="-1"></a>x_save <span class="ot">&lt;-</span> x  <span class="co"># save for the last step</span></span>
<span id="cb424-3"><a href="solutions.html#cb424-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb424-4"><a href="solutions.html#cb424-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb424-5"><a href="solutions.html#cb424-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb424-6"><a href="solutions.html#cb424-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb424-7"><a href="solutions.html#cb424-7" aria-hidden="true" tabindex="-1"></a>x <span class="sc">-</span> x_save</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="vectors-2" class="section level3 unnumbered hasAnchor">
<h3>Vectors<a href="solutions.html#vectors-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print the object <code>datasets::rivers</code> and consult the manual of this object.</p>
<ul>
<li>What is the class of the object?</li>
<li>What is the length of the object?</li>
<li>Calculate the mean, median, minimum, maximum, and the 33%-quantile across all values.</li>
</ul>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="solutions.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="solutions.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] 141</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="solutions.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(datasets<span class="sc">::</span>rivers)</span></code></pre></div>
<pre><code>## [1] 591.1844</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="solutions.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(datasets<span class="sc">::</span>rivers, <span class="at">probs =</span> <span class="fl">0.33</span>)</span></code></pre></div>
<pre><code>## 33% 
## 342</code></pre>
</div>
<div id="data-frames-2" class="section level3 unnumbered hasAnchor">
<h3>Data frames<a href="solutions.html#data-frames-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print the object <code>datasets::quakes</code> and consult the manual of this object.</p>
<ul>
<li>Determine the dimensions of the data frame using the respective function in R.</li>
<li>Extract the vector of values in the data frame that contain information about the Richter Magnitude.</li>
<li>Determine the value largest value in the vector of event magnitudes.</li>
<li>Determine the geographic position of the epicenter of the largest event.</li>
</ul>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="solutions.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datasets<span class="sc">::</span>quakes)</span></code></pre></div>
<pre><code>## [1] 1000    5</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="solutions.html#cb436-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> datasets<span class="sc">::</span>quakes<span class="sc">$</span>mag</span>
<span id="cb436-2"><a href="solutions.html#cb436-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(vec)</span></code></pre></div>
<pre><code>## [1] 6.4</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="solutions.html#cb438-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(vec)  <span class="co"># index of largest value</span></span>
<span id="cb438-2"><a href="solutions.html#cb438-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-3"><a href="solutions.html#cb438-3" aria-hidden="true" tabindex="-1"></a><span class="co"># geographic positions defined by longitude and latitude (columns long and lat)</span></span>
<span id="cb438-4"><a href="solutions.html#cb438-4" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>quakes<span class="sc">$</span>long[idx]</span></code></pre></div>
<pre><code>## [1] 167.62</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="solutions.html#cb440-1" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>quakes<span class="sc">$</span>lat[idx]</span></code></pre></div>
<pre><code>## [1] -15.56</code></pre>
</div>
<div id="workspace-1" class="section level3 unnumbered hasAnchor">
<h3>Workspace<a href="solutions.html#workspace-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
</div>
</div>
<div id="programming-primers" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">A.2</span> Programming primers<a href="solutions.html#programming-primers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="gauss-variations-1" class="section level3 unnumbered hasAnchor">
<h3>Gauss variations<a href="solutions.html#gauss-variations-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="solutions.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for-loop to compute sum from 1 - 100</span></span>
<span id="cb442-2"><a href="solutions.html#cb442-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb442-3"><a href="solutions.html#cb442-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb442-4"><a href="solutions.html#cb442-4" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> i <span class="co"># for-loop iterating from 1 to 100 </span></span>
<span id="cb442-5"><a href="solutions.html#cb442-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb442-6"><a href="solutions.html#cb442-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="solutions.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># while-loop to compute sum from 1 - 100</span></span>
<span id="cb444-2"><a href="solutions.html#cb444-2" aria-hidden="true" tabindex="-1"></a>loop_status <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb444-3"><a href="solutions.html#cb444-3" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb444-4"><a href="solutions.html#cb444-4" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb444-5"><a href="solutions.html#cb444-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (loop_status) { <span class="co"># while-loop is repeated as long as loop_status is true</span></span>
<span id="cb444-6"><a href="solutions.html#cb444-6" aria-hidden="true" tabindex="-1"></a>  counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb444-7"><a href="solutions.html#cb444-7" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> counter</span>
<span id="cb444-8"><a href="solutions.html#cb444-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (counter <span class="sc">==</span> <span class="dv">100</span>) loop_status <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb444-9"><a href="solutions.html#cb444-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb444-10"><a href="solutions.html#cb444-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="solutions.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initiate sum variable</span></span>
<span id="cb446-2"><a href="solutions.html#cb446-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb446-3"><a href="solutions.html#cb446-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-4"><a href="solutions.html#cb446-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Go through loop from 1 to 100</span></span>
<span id="cb446-5"><a href="solutions.html#cb446-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">100</span>)) {</span>
<span id="cb446-6"><a href="solutions.html#cb446-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb446-7"><a href="solutions.html#cb446-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the current number a muliple of three and seven</span></span>
<span id="cb446-8"><a href="solutions.html#cb446-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The modulo operator &#39;%%&#39; returns the remainder of a division</span></span>
<span id="cb446-9"><a href="solutions.html#cb446-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">3</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> i <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span> ) {</span>
<span id="cb446-10"><a href="solutions.html#cb446-10" aria-hidden="true" tabindex="-1"></a>        sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> i</span>
<span id="cb446-11"><a href="solutions.html#cb446-11" aria-hidden="true" tabindex="-1"></a>    }   </span>
<span id="cb446-12"><a href="solutions.html#cb446-12" aria-hidden="true" tabindex="-1"></a>}   </span>
<span id="cb446-13"><a href="solutions.html#cb446-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;The sum of multiples of 3 and 7 within 1-100 is: &quot;</span>, sum))</span></code></pre></div>
<pre><code>## [1] &quot;The sum of multiples of 3 and 7 within 1-100 is: 210&quot;</code></pre>
</div>
<div id="nested-loops-1" class="section level3 unnumbered hasAnchor">
<h3>Nested loops<a href="solutions.html#nested-loops-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="solutions.html#cb448-1" aria-hidden="true" tabindex="-1"></a>mymat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">15</span>, <span class="dv">6</span>, <span class="dv">7</span>, </span>
<span id="cb448-2"><a href="solutions.html#cb448-2" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="cn">NA</span>, <span class="dv">3</span>, </span>
<span id="cb448-3"><a href="solutions.html#cb448-3" aria-hidden="true" tabindex="-1"></a>              <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="cn">NA</span>, <span class="dv">6</span>, </span>
<span id="cb448-4"><a href="solutions.html#cb448-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">7</span>)),</span>
<span id="cb448-5"><a href="solutions.html#cb448-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb448-6"><a href="solutions.html#cb448-6" aria-hidden="true" tabindex="-1"></a>myvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">6</span>)</span></code></pre></div>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="solutions.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the rows in `mymat`.</span></span>
<span id="cb449-2"><a href="solutions.html#cb449-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mymat)){</span>
<span id="cb449-3"><a href="solutions.html#cb449-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb449-4"><a href="solutions.html#cb449-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over the columns in `mymat`.</span></span>
<span id="cb449-5"><a href="solutions.html#cb449-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mymat)){</span>
<span id="cb449-6"><a href="solutions.html#cb449-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb449-7"><a href="solutions.html#cb449-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if current value is missing, if so overwrite with max in &#39;myvec&#39;</span></span>
<span id="cb449-8"><a href="solutions.html#cb449-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(mymat[i,j])){</span>
<span id="cb449-9"><a href="solutions.html#cb449-9" aria-hidden="true" tabindex="-1"></a>      mymat[i,j] <span class="ot">&lt;-</span> <span class="fu">max</span>(myvec)</span>
<span id="cb449-10"><a href="solutions.html#cb449-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb449-11"><a href="solutions.html#cb449-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb449-12"><a href="solutions.html#cb449-12" aria-hidden="true" tabindex="-1"></a>  myvec <span class="ot">&lt;-</span> myvec[<span class="sc">-</span><span class="fu">which.max</span>(myvec)] <span class="co"># update the vector removing the maximum value</span></span>
<span id="cb449-13"><a href="solutions.html#cb449-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb449-14"><a href="solutions.html#cb449-14" aria-hidden="true" tabindex="-1"></a>mymat</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
## [1,]    6    7    3   15   15    6    7
## [2,]   12    9   12    6   11   12    3
## [3,]    9    4    7    3   21    9    6
## [4,]    8    8    8    8    8    8    8</code></pre>
</div>
<div id="interpolation-1" class="section level3 unnumbered hasAnchor">
<h3>Interpolation<a href="solutions.html#interpolation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="solutions.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up vector as required in the exercise</span></span>
<span id="cb451-2"><a href="solutions.html#cb451-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>) <span class="co"># initialize vector of length 100 with NA</span></span>
<span id="cb451-3"><a href="solutions.html#cb451-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># populate first 25 elements of &#39;vec&#39; with 6. </span></span>
<span id="cb451-4"><a href="solutions.html#cb451-4" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">66</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">20</span>  <span class="co"># populate elements 66:100 with -20.</span></span>
<span id="cb451-5"><a href="solutions.html#cb451-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-6"><a href="solutions.html#cb451-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine index of last non-missing value before gap</span></span>
<span id="cb451-7"><a href="solutions.html#cb451-7" aria-hidden="true" tabindex="-1"></a>last_non_na <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb451-8"><a href="solutions.html#cb451-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="sc">!</span><span class="fu">is.na</span>(vec[last_non_na<span class="sc">+</span><span class="dv">1</span>])) last_non_na <span class="ot">&lt;-</span> last_non_na <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb451-9"><a href="solutions.html#cb451-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-10"><a href="solutions.html#cb451-10" aria-hidden="true" tabindex="-1"></a><span class="co"># determine index of first non-missing value after gap</span></span>
<span id="cb451-11"><a href="solutions.html#cb451-11" aria-hidden="true" tabindex="-1"></a>first_non_na <span class="ot">&lt;-</span> last_non_na <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb451-12"><a href="solutions.html#cb451-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="fu">is.na</span>(vec[first_non_na])) first_non_na <span class="ot">&lt;-</span> first_non_na <span class="sc">+</span> <span class="dv">1</span>   </span>
<span id="cb451-13"><a href="solutions.html#cb451-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-14"><a href="solutions.html#cb451-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the increment that is needed for interpolation</span></span>
<span id="cb451-15"><a href="solutions.html#cb451-15" aria-hidden="true" tabindex="-1"></a>last_value  <span class="ot">&lt;-</span> vec[last_non_na]  <span class="co"># Last non-NA value</span></span>
<span id="cb451-16"><a href="solutions.html#cb451-16" aria-hidden="true" tabindex="-1"></a>first_value <span class="ot">&lt;-</span> vec[first_non_na] <span class="co"># First non-NA value</span></span>
<span id="cb451-17"><a href="solutions.html#cb451-17" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> (last_value <span class="sc">-</span> first_value) <span class="sc">/</span> (last_non_na <span class="sc">-</span> first_non_na) <span class="co"># Change in y over change in x</span></span>
<span id="cb451-18"><a href="solutions.html#cb451-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-19"><a href="solutions.html#cb451-19" aria-hidden="true" tabindex="-1"></a><span class="co"># fill missing values incrementally</span></span>
<span id="cb451-20"><a href="solutions.html#cb451-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(vec)){</span>
<span id="cb451-21"><a href="solutions.html#cb451-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(vec[i])) vec[i] <span class="ot">&lt;-</span> vec[i<span class="dv">-1</span>] <span class="sc">+</span> delta</span>
<span id="cb451-22"><a href="solutions.html#cb451-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb451-23"><a href="solutions.html#cb451-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-24"><a href="solutions.html#cb451-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vec)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-236-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="solutions.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or short using the approx() function:</span></span>
<span id="cb452-2"><a href="solutions.html#cb452-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>) <span class="co"># initialize vector of length 100 with NA</span></span>
<span id="cb452-3"><a href="solutions.html#cb452-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># populate first 25 elements of &#39;vec&#39; with 6. </span></span>
<span id="cb452-4"><a href="solutions.html#cb452-4" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">66</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">20</span>  <span class="co"># populate elements 66:100 with -20.</span></span>
<span id="cb452-5"><a href="solutions.html#cb452-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-6"><a href="solutions.html#cb452-6" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">approx</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, vec, <span class="at">xout =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb452-7"><a href="solutions.html#cb452-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-8"><a href="solutions.html#cb452-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vec)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-236-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="data-wrangling" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">A.3</span> Data wrangling<a href="solutions.html#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="star-wars-1" class="section level3 unnumbered hasAnchor">
<h3>Star wars<a href="solutions.html#star-wars-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>{dplyr} comes with a toy dataset <code>dplyr::starwars</code> (just type it into the console to see its content). Have a look at the dataset with <code>View()</code>. Play around with the dataset to get familiar with the {tidyverse} coding style. Use (possibly among others) the functions <code>dplyr::filter()</code>, <code>dplyr::arrange()</code>, <code>dplyr::pull()</code>, <code>dplyr::select()</code>, <code>dplyr::desc()</code> and <code>dplyr::slice()</code> to answer the following question:</p>
<ul>
<li>How many pale characters come from the planets Ryloth or Naboo?</li>
</ul>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="solutions.html#cb453-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb453-2"><a href="solutions.html#cb453-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(skin_color <span class="sc">==</span> <span class="st">&quot;pale&quot;</span> <span class="sc">&amp;</span> (homeworld <span class="sc">==</span> <span class="st">&quot;Naboo&quot;</span> <span class="sc">|</span> homeworld <span class="sc">==</span> <span class="st">&quot;Ryloth&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb453-3"><a href="solutions.html#cb453-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()   </span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<ul>
<li>Who is the oldest among the tallest thirty characters?</li>
</ul>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="solutions.html#cb455-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb455-2"><a href="solutions.html#cb455-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(height)) <span class="sc">|&gt;</span> </span>
<span id="cb455-3"><a href="solutions.html#cb455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb455-4"><a href="solutions.html#cb455-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(birth_year) <span class="sc">|&gt;</span> </span>
<span id="cb455-5"><a href="solutions.html#cb455-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb455-6"><a href="solutions.html#cb455-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name)</span></code></pre></div>
<pre><code>## [1] &quot;IG-88&quot;</code></pre>
<ul>
<li>What is the name of the shortest character and their starship in “Return of the Jedi”?</li>
</ul>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="solutions.html#cb457-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb457-2"><a href="solutions.html#cb457-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(films) <span class="sc">|&gt;</span> </span>
<span id="cb457-3"><a href="solutions.html#cb457-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(films <span class="sc">==</span> <span class="st">&quot;Return of the Jedi&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb457-4"><a href="solutions.html#cb457-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(starships) <span class="sc">|&gt;</span> </span>
<span id="cb457-5"><a href="solutions.html#cb457-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(height) <span class="sc">|&gt;</span> </span>
<span id="cb457-6"><a href="solutions.html#cb457-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb457-7"><a href="solutions.html#cb457-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, starships)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   name      starships        
##   &lt;chr&gt;     &lt;chr&gt;            
## 1 Nien Nunb Millennium Falcon</code></pre>
</div>
<div id="aggregating-1" class="section level3 unnumbered hasAnchor">
<h3>Aggregating<a href="solutions.html#aggregating-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have learned about aggregating in the {tidyverse}. Let’s put it in practice.</p>
<ul>
<li>Reuse the code in the tutorial to read, reduce, and aggregate the <code>half_hourly_fluxes</code> dataset to the daily scale, calculating the following metrics across half-hourly <code>VPD_F</code> values within each day: mean, 25% quantile, and 75% quantile.</li>
</ul>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="solutions.html#cb459-1" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb459-2"><a href="solutions.html#cb459-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb459-3"><a href="solutions.html#cb459-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only variables that we are interested in</span></span>
<span id="cb459-4"><a href="solutions.html#cb459-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb459-5"><a href="solutions.html#cb459-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;TIMESTAMP&quot;</span>),</span>
<span id="cb459-6"><a href="solutions.html#cb459-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">&quot;_F&quot;</span>),</span>
<span id="cb459-7"><a href="solutions.html#cb459-7" aria-hidden="true" tabindex="-1"></a>    GPP_NT_VUT_REF,</span>
<span id="cb459-8"><a href="solutions.html#cb459-8" aria-hidden="true" tabindex="-1"></a>    NEE_VUT_REF_QC,</span>
<span id="cb459-9"><a href="solutions.html#cb459-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;SWC_F_MDS_&quot;</span>),</span>
<span id="cb459-10"><a href="solutions.html#cb459-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;JSB&quot;</span>)</span>
<span id="cb459-11"><a href="solutions.html#cb459-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb459-12"><a href="solutions.html#cb459-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-13"><a href="solutions.html#cb459-13" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span>  </span>
<span id="cb459-14"><a href="solutions.html#cb459-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-15"><a href="solutions.html#cb459-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean the datetime objects</span></span>
<span id="cb459-16"><a href="solutions.html#cb459-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb459-17"><a href="solutions.html#cb459-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">date      =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb459-18"><a href="solutions.html#cb459-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-19"><a href="solutions.html#cb459-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate to daily scale</span></span>
<span id="cb459-20"><a href="solutions.html#cb459-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb459-21"><a href="solutions.html#cb459-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(VPD_F),</span>
<span id="cb459-22"><a href="solutions.html#cb459-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">q25  =</span> <span class="fu">quantile</span>(VPD_F, <span class="at">probs =</span> <span class="fl">0.25</span>),</span>
<span id="cb459-23"><a href="solutions.html#cb459-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">q75  =</span> <span class="fu">quantile</span>(VPD_F, <span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb459-24"><a href="solutions.html#cb459-24" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<ul>
<li>Retain only the daily data for which the daily mean VPD is among the upper or the lower 10% quantiles.</li>
</ul>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="solutions.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In two steps. First, get thresholds of the quantiles</span></span>
<span id="cb460-2"><a href="solutions.html#cb460-2" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_fluxes<span class="sc">$</span>mean, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>))</span>
<span id="cb460-3"><a href="solutions.html#cb460-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-4"><a href="solutions.html#cb460-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, filter data to be above/below the upper/lower quantiles and combine</span></span>
<span id="cb460-5"><a href="solutions.html#cb460-5" aria-hidden="true" tabindex="-1"></a>daily_fluxes_sub <span class="ot">&lt;-</span> daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb460-6"><a href="solutions.html#cb460-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb460-7"><a href="solutions.html#cb460-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in lower 10% quantile</span></span>
<span id="cb460-8"><a href="solutions.html#cb460-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean <span class="sc">&lt;</span> thresholds[<span class="dv">1</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb460-9"><a href="solutions.html#cb460-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qq =</span> <span class="st">&quot;lower&quot;</span>) <span class="sc">|&gt;</span>   <span class="co"># add label</span></span>
<span id="cb460-10"><a href="solutions.html#cb460-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb460-11"><a href="solutions.html#cb460-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb460-12"><a href="solutions.html#cb460-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb460-13"><a href="solutions.html#cb460-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb460-14"><a href="solutions.html#cb460-14" aria-hidden="true" tabindex="-1"></a>    daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb460-15"><a href="solutions.html#cb460-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># in upper 90% quantile</span></span>
<span id="cb460-16"><a href="solutions.html#cb460-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(mean <span class="sc">&gt;</span> thresholds[<span class="dv">2</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb460-17"><a href="solutions.html#cb460-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">qq =</span> <span class="st">&quot;upper&quot;</span>)</span>
<span id="cb460-18"><a href="solutions.html#cb460-18" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<ul>
<li>Calculate the mean of the 25% and the mean of the 75% quantiles of half-hourly VPD within the upper and lower 10% quantiles of mean daily VPD.</li>
</ul>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="solutions.html#cb461-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_sub <span class="sc">|&gt;</span> </span>
<span id="cb461-2"><a href="solutions.html#cb461-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(qq) <span class="sc">|&gt;</span> </span>
<span id="cb461-3"><a href="solutions.html#cb461-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">q25_mean =</span> <span class="fu">mean</span>(q25),</span>
<span id="cb461-4"><a href="solutions.html#cb461-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">q75_mean =</span> <span class="fu">mean</span>(q75))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   qq    q25_mean q75_mean
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 lower   0.0989    0.149
## 2 upper   6.56     15.2</code></pre>
</div>
<div id="patterns-in-data-quality-1" class="section level3 unnumbered hasAnchor">
<h3>Patterns in data quality<a href="solutions.html#patterns-in-data-quality-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The uncleaned dataset <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code> holds half-hourly data that is sometimes of poor quality. Investigate whether NEE data quality is randomly spread across hours in a day by calculating the proportion of (i) actually measured data, (ii) good quality gap-filled data, (iii) medium quality data, and (iv) poor quality data within each hour-of-day (24 hours per day).</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="solutions.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using half_hourly_fluxes read above</span></span>
<span id="cb463-2"><a href="solutions.html#cb463-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb463-3"><a href="solutions.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TIMESTAMP_START =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb463-4"><a href="solutions.html#cb463-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hour_of_day =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb463-5"><a href="solutions.html#cb463-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour_of_day) <span class="sc">|&gt;</span> </span>
<span id="cb463-6"><a href="solutions.html#cb463-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_measured =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb463-7"><a href="solutions.html#cb463-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_good     =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb463-8"><a href="solutions.html#cb463-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_medium   =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb463-9"><a href="solutions.html#cb463-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_poor     =</span> <span class="fu">sum</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb463-10"><a href="solutions.html#cb463-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_total    =</span> <span class="fu">n</span>()</span>
<span id="cb463-11"><a href="solutions.html#cb463-11" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb463-12"><a href="solutions.html#cb463-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f_measured =</span> n_measured <span class="sc">/</span> n_total,</span>
<span id="cb463-13"><a href="solutions.html#cb463-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_good     =</span> n_good     <span class="sc">/</span> n_total,</span>
<span id="cb463-14"><a href="solutions.html#cb463-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_medium   =</span> n_medium   <span class="sc">/</span> n_total,</span>
<span id="cb463-15"><a href="solutions.html#cb463-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">f_poor     =</span> n_poor     <span class="sc">/</span> n_total,</span>
<span id="cb463-16"><a href="solutions.html#cb463-16" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Interpret your findings: Are the proportions evenly spread across hours in a day?</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="solutions.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is not asked for but interesting. More on data visualisation in Chapter 5</span></span>
<span id="cb464-2"><a href="solutions.html#cb464-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also just look at values of df$f_measured over the course of a day (hod)  </span></span>
<span id="cb464-3"><a href="solutions.html#cb464-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-4"><a href="solutions.html#cb464-4" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb464-5"><a href="solutions.html#cb464-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(f_measured, f_good, f_medium, f_poor), </span>
<span id="cb464-6"><a href="solutions.html#cb464-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;quality&quot;</span>, </span>
<span id="cb464-7"><a href="solutions.html#cb464-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fraction&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb464-8"><a href="solutions.html#cb464-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour_of_day, </span>
<span id="cb464-9"><a href="solutions.html#cb464-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> fraction <span class="sc">*</span> <span class="dv">100</span>,     <span class="co"># *100 to get percentages </span></span>
<span id="cb464-10"><a href="solutions.html#cb464-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> quality)) <span class="sc">+</span></span>
<span id="cb464-11"><a href="solutions.html#cb464-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span>       <span class="co"># make lines bit bigger</span></span>
<span id="cb464-12"><a href="solutions.html#cb464-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span>                  <span class="co"># Pick a nice theme</span></span>
<span id="cb464-13"><a href="solutions.html#cb464-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(                <span class="co"># Pick a nice color palette</span></span>
<span id="cb464-14"><a href="solutions.html#cb464-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Quality&quot;</span>,                       <span class="co"># Give legend a title</span></span>
<span id="cb464-15"><a href="solutions.html#cb464-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Measured&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Poor&quot;</span>), <span class="co"># Give legend levels a label</span></span>
<span id="cb464-16"><a href="solutions.html#cb464-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="dv">3</span>,                     <span class="co"># Pick color palette</span></span>
<span id="cb464-17"><a href="solutions.html#cb464-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>                   <span class="co"># Inverse order of color palette</span></span>
<span id="cb464-18"><a href="solutions.html#cb464-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb464-19"><a href="solutions.html#cb464-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb464-20"><a href="solutions.html#cb464-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Temporal pattern of GPP quality&quot;</span>,</span>
<span id="cb464-21"><a href="solutions.html#cb464-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y     =</span> <span class="st">&quot;Fraction of total GPP entries [%]&quot;</span>,</span>
<span id="cb464-22"><a href="solutions.html#cb464-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x     =</span> <span class="st">&quot;Hour of Day&quot;</span></span>
<span id="cb464-23"><a href="solutions.html#cb464-23" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-244-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Perform an aggregation of the half-hourly GPP data (variable <code>GPP_NT_VUT_REF</code>) to daily means of the unmodified data read from file <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code>, and from cleaned data where only measured (not gap-filled) half-hourly data is kept and aggregated. This yields two data frames with daily GPP data. Calculate the overall mean GPP for the two data frames (across all days in the data frame). Are the overall mean GPP values equal? If not, why?</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="solutions.html#cb465-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_all <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb465-2"><a href="solutions.html#cb465-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb465-3"><a href="solutions.html#cb465-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">date      =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb465-4"><a href="solutions.html#cb465-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb465-5"><a href="solutions.html#cb465-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb465-6"><a href="solutions.html#cb465-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-7"><a href="solutions.html#cb465-7" aria-hidden="true" tabindex="-1"></a>daily_fluxes_cleaned <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span></span>
<span id="cb465-8"><a href="solutions.html#cb465-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date_time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hm</span>(TIMESTAMP_START),</span>
<span id="cb465-9"><a href="solutions.html#cb465-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">date      =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(date_time)) <span class="sc">|&gt;</span></span>
<span id="cb465-10"><a href="solutions.html#cb465-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">ifelse</span>(NEE_VUT_REF_QC <span class="sc">==</span> <span class="dv">0</span>, GPP_NT_VUT_REF, <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb465-11"><a href="solutions.html#cb465-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb465-12"><a href="solutions.html#cb465-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb465-13"><a href="solutions.html#cb465-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-14"><a href="solutions.html#cb465-14" aria-hidden="true" tabindex="-1"></a><span class="co"># overall means</span></span>
<span id="cb465-15"><a href="solutions.html#cb465-15" aria-hidden="true" tabindex="-1"></a>daily_fluxes_all <span class="sc">|&gt;</span> </span>
<span id="cb465-16"><a href="solutions.html#cb465-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   GPP_NT_VUT_REF
##            &lt;dbl&gt;
## 1           4.20</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="solutions.html#cb467-1" aria-hidden="true" tabindex="-1"></a>daily_fluxes_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb467-2"><a href="solutions.html#cb467-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   GPP_NT_VUT_REF
##            &lt;dbl&gt;
## 1           7.07</code></pre>
<!-- ### Tidying an Excel-file {-} -->
<!-- *No solutions provided because part of the final report* -->
</div>
</div>
<div id="data-visualisation" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">A.4</span> Data Visualisation<a href="solutions.html#data-visualisation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="spurious-data-1" class="section level3 unnumbered hasAnchor">
<h3>Spurious data<a href="solutions.html#spurious-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Section <a href="datawrangling.html#baddata">3.2.10.2</a>, we discovered that certain values of <code>GPP_NT_VUT_REF</code> in the half-hourly data <code>half_hourly_fluxes</code> (to be read from file <code>data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv</code>) are repeated with a spuriously high frequency. Determine all values of <code>GPP_NT_VUT_REF</code> that appear more than once in <code>half_hourly_fluxes</code> and label them as being “spurious”. Visualise the time series of the first two years of half-hourly GPP, mapping the information whether the data is spurious or not to the <em>color</em> aesthetic.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="solutions.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and wrangle data</span></span>
<span id="cb469-2"><a href="solutions.html#cb469-2" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2006.csv&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb469-3"><a href="solutions.html#cb469-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-4"><a href="solutions.html#cb469-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interpret -9999 as missing value</span></span>
<span id="cb469-5"><a href="solutions.html#cb469-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="dv">9999</span>) <span class="sc">|&gt;</span> </span>
<span id="cb469-6"><a href="solutions.html#cb469-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb469-7"><a href="solutions.html#cb469-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interpret all variables starting with TIMESTAMP as a date-time object</span></span>
<span id="cb469-8"><a href="solutions.html#cb469-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;TIMESTAMP_&quot;</span>)), lubridate<span class="sc">::</span>ymd_hm)</span></code></pre></div>
<pre><code>## Rows: 52608 Columns: 235
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (235): TIMESTAMP_START, TIMESTAMP_END, TA_F_MDS, TA_F_MDS_QC, TA_ERA, TA...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="solutions.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># determine spurious GPP_NT_VUT_REF values as those that are duplicated</span></span>
<span id="cb471-2"><a href="solutions.html#cb471-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this creates a logical vector specifying whether the respective row has a </span></span>
<span id="cb471-3"><a href="solutions.html#cb471-3" aria-hidden="true" tabindex="-1"></a><span class="co"># duplicate</span></span>
<span id="cb471-4"><a href="solutions.html#cb471-4" aria-hidden="true" tabindex="-1"></a>vec_spurious <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb471-5"><a href="solutions.html#cb471-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb471-6"><a href="solutions.html#cb471-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># by keeping only one column, duplicated() determines duplications in </span></span>
<span id="cb471-7"><a href="solutions.html#cb471-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># that variable only </span></span>
<span id="cb471-8"><a href="solutions.html#cb471-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GPP_NT_VUT_REF) <span class="sc">|&gt;</span></span>
<span id="cb471-9"><a href="solutions.html#cb471-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">duplicated</span>()</span>
<span id="cb471-10"><a href="solutions.html#cb471-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-11"><a href="solutions.html#cb471-11" aria-hidden="true" tabindex="-1"></a><span class="co"># label spurious half-hourly data</span></span>
<span id="cb471-12"><a href="solutions.html#cb471-12" aria-hidden="true" tabindex="-1"></a>half_hourly_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb471-13"><a href="solutions.html#cb471-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spurious =</span> vec_spurious)</span>
<span id="cb471-14"><a href="solutions.html#cb471-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-15"><a href="solutions.html#cb471-15" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise</span></span>
<span id="cb471-16"><a href="solutions.html#cb471-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb471-17"><a href="solutions.html#cb471-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> half_hourly_fluxes <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">48</span><span class="sc">*</span><span class="dv">365</span>)),</span>
<span id="cb471-18"><a href="solutions.html#cb471-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> TIMESTAMP_START, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb471-19"><a href="solutions.html#cb471-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb471-20"><a href="solutions.html#cb471-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> spurious), <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb471-21"><a href="solutions.html#cb471-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, </span>
<span id="cb471-22"><a href="solutions.html#cb471-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb471-23"><a href="solutions.html#cb471-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span> <span class="co"># inverse color scale is more intuitive here</span></span>
<span id="cb471-24"><a href="solutions.html#cb471-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-246-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Then aggregate half-hourly to daily data, taking the mean of <code>GPP_NT_VUT_REF</code> and recording the proportion of underlying half-hourly data points that are “spurious”. Visualise the time series of daily <code>GPP_NT_VUT_REF</code> with the color scale indicating the proportion of spurious half-hourly data that was used for determining the respective date’s mean GPP.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="solutions.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate</span></span>
<span id="cb472-2"><a href="solutions.html#cb472-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb472-3"><a href="solutions.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span> </span>
<span id="cb472-4"><a href="solutions.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb472-5"><a href="solutions.html#cb472-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">frac_spurious =</span> <span class="fu">sum</span>(spurious)<span class="sc">/</span><span class="dv">48</span>,</span>
<span id="cb472-6"><a href="solutions.html#cb472-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">GPP_NT_VUT_REF =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb472-7"><a href="solutions.html#cb472-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-8"><a href="solutions.html#cb472-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise</span></span>
<span id="cb472-9"><a href="solutions.html#cb472-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb472-10"><a href="solutions.html#cb472-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes,</span>
<span id="cb472-11"><a href="solutions.html#cb472-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> GPP_NT_VUT_REF)) <span class="sc">+</span></span>
<span id="cb472-12"><a href="solutions.html#cb472-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb472-13"><a href="solutions.html#cb472-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> frac_spurious), <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb472-14"><a href="solutions.html#cb472-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, </span>
<span id="cb472-15"><a href="solutions.html#cb472-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb472-16"><a href="solutions.html#cb472-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> <span class="co"># inverse color scale is more intuitive here</span></span>
<span id="cb472-17"><a href="solutions.html#cb472-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-247-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="identifying-outliers-1" class="section level3 unnumbered hasAnchor">
<h3>Identifying Outliers<a href="solutions.html#identifying-outliers-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A key part of data cleaning is to detect and understand outliers. Visualisations can help. Your task here is to find outliers in <code>GPP_NT_VUT_REF</code>.</p>
<p>First, using the half-hourly fluxes data, determine “outliers” as those values of <code>GPP_NT_VUT_REF</code> that fall outside <span class="math inline">\(( Q_1 - 1.5 (Q_3 - Q_1)\)</span> to <span class="math inline">\(Q_3 + 1.5 (Q_3 - Q_1)\)</span>. Plot <code>GPP_NT_VUT_REF</code> versus shortwave radiation and highlight outliers in red.</p>
<blockquote>
<p>Hint: Use <code>boxplot.stats()</code> to return a list containing a vector of the data points which lie beyond the extremes of the whiskers of the boxplot.</p>
</blockquote>
<blockquote>
<p>Hint: Use <code>scale_color_manual()</code> to mannually define the color scale.</p>
</blockquote>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="solutions.html#cb473-1" aria-hidden="true" tabindex="-1"></a>vec_outliers <span class="ot">&lt;-</span> <span class="fu">boxplot.stats</span>(half_hourly_fluxes<span class="sc">$</span>GPP_NT_VUT_REF)<span class="sc">$</span>out</span>
<span id="cb473-2"><a href="solutions.html#cb473-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-3"><a href="solutions.html#cb473-3" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb473-4"><a href="solutions.html#cb473-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> GPP_NT_VUT_REF <span class="sc">%in%</span> vec_outliers)</span>
<span id="cb473-5"><a href="solutions.html#cb473-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-6"><a href="solutions.html#cb473-6" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span> </span>
<span id="cb473-7"><a href="solutions.html#cb473-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> outlier)) <span class="sc">+</span> </span>
<span id="cb473-8"><a href="solutions.html#cb473-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb473-9"><a href="solutions.html#cb473-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Outlier?&quot;</span>,                    <span class="co"># Set title of legend</span></span>
<span id="cb473-10"><a href="solutions.html#cb473-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),    <span class="co"># Highlight in red</span></span>
<span id="cb473-11"><a href="solutions.html#cb473-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)        <span class="co"># Add labels to the legend</span></span>
<span id="cb473-12"><a href="solutions.html#cb473-12" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb473-13"><a href="solutions.html#cb473-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb473-14"><a href="solutions.html#cb473-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb473-15"><a href="solutions.html#cb473-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-248-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now, we want to “control” for the influence of shortwave radiation on GPP and define outliers with respect to the distribution of <em>residuals</em> of the linear regression between the two variables. Relax the definition of what is considered an outlier by setting adjusting their definition to falling outside <span class="math inline">\(( Q_1 - 5 (Q_3 - Q_1)\)</span> to <span class="math inline">\(Q_3 + 5 (Q_3 - Q_1)\)</span>. Again, plot <code>GPP_NT_VUT_REF</code> versus shortwave radiation and highlight outliers in red.</p>
<blockquote>
<p>Hint: Fit the linear regression model as <code>lm(GPP_NT_VUT_REF ~ SW_IN_F, data = half_hourly_fluxes)</code> and obtain the residuals from the object returned by the <code>lm()</code> function (see ‘Value’ in its help page).</p>
</blockquote>
<blockquote>
<p>Hint: The output of <code>boxplot.stats(x)</code> is a list, containing an element <code>out</code>. <code>out</code> is a named vector of the oulier values with names referring to the row numbers of <code>x</code>. Use <code>as.integer(names(boxplot.stats(x)$out))</code> to get row numbers.</p>
</blockquote>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="solutions.html#cb474-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">lm</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F, <span class="at">data =</span> half_hourly_fluxes)<span class="sc">$</span>residuals</span>
<span id="cb474-2"><a href="solutions.html#cb474-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-3"><a href="solutions.html#cb474-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # unclear why this doesn&#39;t work:</span></span>
<span id="cb474-4"><a href="solutions.html#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="co"># vec_outliers &lt;- boxplot.stats(residuals, coef = 5)$out</span></span>
<span id="cb474-5"><a href="solutions.html#cb474-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_data &lt;- half_hourly_fluxes |&gt; </span></span>
<span id="cb474-6"><a href="solutions.html#cb474-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(outlier = GPP_NT_VUT_REF %in% vec_outliers)</span></span>
<span id="cb474-7"><a href="solutions.html#cb474-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-8"><a href="solutions.html#cb474-8" aria-hidden="true" tabindex="-1"></a><span class="co"># this works:</span></span>
<span id="cb474-9"><a href="solutions.html#cb474-9" aria-hidden="true" tabindex="-1"></a>rowindex_outliers <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">names</span>(<span class="fu">boxplot.stats</span>(residuals, <span class="at">coef =</span> <span class="dv">5</span>)<span class="sc">$</span>out))</span>
<span id="cb474-10"><a href="solutions.html#cb474-10" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span> </span>
<span id="cb474-11"><a href="solutions.html#cb474-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowindex =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb474-12"><a href="solutions.html#cb474-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> rowindex <span class="sc">%in%</span> rowindex_outliers)</span>
<span id="cb474-13"><a href="solutions.html#cb474-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-14"><a href="solutions.html#cb474-14" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span> </span>
<span id="cb474-15"><a href="solutions.html#cb474-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SW_IN_F, <span class="at">y =</span> GPP_NT_VUT_REF, <span class="at">color =</span> outlier)) <span class="sc">+</span> </span>
<span id="cb474-16"><a href="solutions.html#cb474-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb474-17"><a href="solutions.html#cb474-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Outlier?&quot;</span>,                    <span class="co"># Set title of legend</span></span>
<span id="cb474-18"><a href="solutions.html#cb474-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),    <span class="co"># Highlight in red</span></span>
<span id="cb474-19"><a href="solutions.html#cb474-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)        <span class="co"># Add labels to the legend</span></span>
<span id="cb474-20"><a href="solutions.html#cb474-20" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb474-21"><a href="solutions.html#cb474-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Shortwave radiation (W m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;)&quot;</span>)), </span>
<span id="cb474-22"><a href="solutions.html#cb474-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;GPP (&quot;</span>, mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">&quot;)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb474-23"><a href="solutions.html#cb474-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-249-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>What do we see in this plot?</strong> We see that the red points, the outliers, fall outside the main point cloud of green points. The distribution of these outliers seems without systematic pattern or deviation. Nonetheless, it is good practice to go a step further and look at these data points in detail to find out whether they should be removed or not in your analysis. In later Chapters you will learn more on what disproportionate role outliers can play and how they may affect your statistical model and analysis.</p>
</div>
<div id="visualising-diurnal-and-seasonal-cycles-of-gpp-1" class="section level3 unnumbered hasAnchor">
<h3>Visualising diurnal and seasonal cycles of GPP<a href="solutions.html#visualising-diurnal-and-seasonal-cycles-of-gpp-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As explored in the previous Chapter’s exercises, GPP varies over diurnal and seasonal cycles. Create a publication-ready figure that visualises the mean diurnal cycle of GPP for each day-of-year (mean across multiple years). Make sure that the figure is properly labelled, and legible for readers with a color vision deficiency.</p>
<blockquote>
<p>Hint: To get the diurnal and seasonal cycles, summarise the half-hourly data by the hour of the day and the day of the year simultaneously using multiple grouping variables within <code>group_by()</code> and calculate mean values for GPP for each group.</p>
</blockquote>
<blockquote>
<p>Hint: Chose an appropriate visualisation that maps the hour-of-day to the x-axis and the day-of-year to the y-axis.</p>
</blockquote>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="solutions.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to hours-in-day for each day-in-year</span></span>
<span id="cb475-2"><a href="solutions.html#cb475-2" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="ot">&lt;-</span> half_hourly_fluxes <span class="sc">|&gt;</span>          <span class="co"># df from previous exercise</span></span>
<span id="cb475-3"><a href="solutions.html#cb475-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb475-4"><a href="solutions.html#cb475-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour_day =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(TIMESTAMP_START),     <span class="co"># hour of the day</span></span>
<span id="cb475-5"><a href="solutions.html#cb475-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_year =</span> lubridate<span class="sc">::</span><span class="fu">yday</span>(TIMESTAMP_START)) <span class="sc">|&gt;</span>  <span class="co"># day of the year</span></span>
<span id="cb475-6"><a href="solutions.html#cb475-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(hour_day, day_year) <span class="sc">|&gt;</span>             <span class="co"># multiple grouping</span></span>
<span id="cb475-7"><a href="solutions.html#cb475-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">gpp =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF))</span>
<span id="cb475-8"><a href="solutions.html#cb475-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-9"><a href="solutions.html#cb475-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Publication-ready raster plot</span></span>
<span id="cb475-10"><a href="solutions.html#cb475-10" aria-hidden="true" tabindex="-1"></a>fluxes_per_hod_doy <span class="sc">|&gt;</span> </span>
<span id="cb475-11"><a href="solutions.html#cb475-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb475-12"><a href="solutions.html#cb475-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify aesthetics</span></span>
<span id="cb475-13"><a href="solutions.html#cb475-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour_day, </span>
<span id="cb475-14"><a href="solutions.html#cb475-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> day_year, </span>
<span id="cb475-15"><a href="solutions.html#cb475-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> gpp)) <span class="sc">+</span>  <span class="co"># fill color of the raster</span></span>
<span id="cb475-16"><a href="solutions.html#cb475-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb475-17"><a href="solutions.html#cb475-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb475-18"><a href="solutions.html#cb475-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb475-19"><a href="solutions.html#cb475-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a color scale that works also for color-blind people</span></span>
<span id="cb475-20"><a href="solutions.html#cb475-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span></span>
<span id="cb475-21"><a href="solutions.html#cb475-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-22"><a href="solutions.html#cb475-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust the aspect ratio of the plotting region</span></span>
<span id="cb475-23"><a href="solutions.html#cb475-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="fl">0.18</span>) <span class="sc">+</span></span>
<span id="cb475-24"><a href="solutions.html#cb475-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb475-25"><a href="solutions.html#cb475-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels of each mapping axis, \n is a line break</span></span>
<span id="cb475-26"><a href="solutions.html#cb475-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Gross primary production&quot;</span>,</span>
<span id="cb475-27"><a href="solutions.html#cb475-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Diurnal and seasonal cycle&quot;</span>,</span>
<span id="cb475-28"><a href="solutions.html#cb475-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Hour of day&quot;</span>, </span>
<span id="cb475-29"><a href="solutions.html#cb475-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Day of year&quot;</span>, </span>
<span id="cb475-30"><a href="solutions.html#cb475-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(mu,<span class="st">&quot;mol CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; m&quot;</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">&quot;s&quot;</span><span class="sc">^-</span><span class="dv">1</span>))) <span class="sc">+</span> </span>
<span id="cb475-31"><a href="solutions.html#cb475-31" aria-hidden="true" tabindex="-1"></a>                                                               </span>
<span id="cb475-32"><a href="solutions.html#cb475-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb475-33"><a href="solutions.html#cb475-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># avoid having a small padding from the lowest values to the end of axes</span></span>
<span id="cb475-34"><a href="solutions.html#cb475-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb475-35"><a href="solutions.html#cb475-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-250-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Beautiful, isn’t it? We nicely see that on practically all days of the year we have the diurnal cycle of GPP which follows the sun’s cycle. And throughout a year, we see a rapid increase in GPP in the spring when all trees put out their leaves at once. After a highly productive summer, temperatures drop, sensescence kicks in and GPP gradually drops into its winter low.</p>
</div>
<div id="trend-in-carbon-dioxide-concentrations-1" class="section level3 unnumbered hasAnchor">
<h3>Trend in carbon dioxide concentrations<a href="solutions.html#trend-in-carbon-dioxide-concentrations-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This exercise explores the longest available atmospheric CO<span class="math inline">\(_2\)</span> record, obtained at the Mauna Loa observatory in Hawaii. Atmospheric CO<span class="math inline">\(_2\)</span> in the northern hemisphere is characterised by seasonal swings, caused by the seasonal course of CO<span class="math inline">\(_2\)</span> uptake and release by the terrestrial biosphere. We’ve explored the seasonality of the CO<span class="math inline">\(_2\)</span> uptake measured at one site (in Switzerland) extensively in this an previous chapters. Your task here is to calculate and visualise the long-term trend of CO<span class="math inline">\(_2\)</span>. Follow these steps:</p>
<ul>
<li>Download the monthly mean CO2<span class="math inline">\(_2\)</span> data as a CSV file from <a href="https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.csv">here</a> and read it into R.</li>
</ul>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="solutions.html#cb476-1" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;data/co2_mm_mlo.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">56</span>) <span class="sc">|&gt;</span> <span class="co"># Skip metadata till line 56</span></span>
<span id="cb476-2"><a href="solutions.html#cb476-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb476-3"><a href="solutions.html#cb476-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># interpret missing values</span></span>
<span id="cb476-4"><a href="solutions.html#cb476-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="fl">9.99</span>) <span class="sc">|&gt;</span> </span>
<span id="cb476-5"><a href="solutions.html#cb476-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="fl">0.99</span>) <span class="sc">|&gt;</span> </span>
<span id="cb476-6"><a href="solutions.html#cb476-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb476-7"><a href="solutions.html#cb476-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb476-8"><a href="solutions.html#cb476-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename to avoid white space in column name</span></span>
<span id="cb476-9"><a href="solutions.html#cb476-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year_dec =</span> <span class="st">`</span><span class="at">decimal date</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## Rows: 779 Columns: 8
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (8): year, month, decimal date, average, deseasonalized, ndays, sdev, unc
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<ul>
<li>Make a simple graph for visualizing the monthly CO<span class="math inline">\(_2\)</span> time series.</li>
</ul>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="solutions.html#cb478-1" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="sc">|&gt;</span> </span>
<span id="cb478-2"><a href="solutions.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb478-3"><a href="solutions.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(year_dec, average))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Write a function that computes a 12-month running mean of the CO<span class="math inline">\(_2\)</span> time series. The running mean for month <span class="math inline">\(m\)</span> should consider values of <span class="math inline">\(m-5\)</span> to <span class="math inline">\(m+6\)</span>. Define arguments for the function that let the user specify the width of the running mean “box” (i.e., setting the <span class="math inline">\(5\)</span> and <span class="math inline">\(6\)</span> to any other integer of choice)</li>
</ul>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="solutions.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the running mean function</span></span>
<span id="cb479-2"><a href="solutions.html#cb479-2" aria-hidden="true" tabindex="-1"></a>running_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(vec,     <span class="co"># Input vector</span></span>
<span id="cb479-3"><a href="solutions.html#cb479-3" aria-hidden="true" tabindex="-1"></a>                         left,    <span class="co"># Number of elements to the left</span></span>
<span id="cb479-4"><a href="solutions.html#cb479-4" aria-hidden="true" tabindex="-1"></a>                         right    <span class="co"># Number of elements to the right</span></span>
<span id="cb479-5"><a href="solutions.html#cb479-5" aria-hidden="true" tabindex="-1"></a>                         ){</span>
<span id="cb479-6"><a href="solutions.html#cb479-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-7"><a href="solutions.html#cb479-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty vector of the same length as the input data</span></span>
<span id="cb479-8"><a href="solutions.html#cb479-8" aria-hidden="true" tabindex="-1"></a>  vec_out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(vec))</span>
<span id="cb479-9"><a href="solutions.html#cb479-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-10"><a href="solutions.html#cb479-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over each position in the vector</span></span>
<span id="cb479-11"><a href="solutions.html#cb479-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (idx <span class="cf">in</span> (left<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(vec)<span class="sc">-</span>right)){</span>
<span id="cb479-12"><a href="solutions.html#cb479-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb479-13"><a href="solutions.html#cb479-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define start and end of the box to average over</span></span>
<span id="cb479-14"><a href="solutions.html#cb479-14" aria-hidden="true" tabindex="-1"></a>        startbox <span class="ot">&lt;-</span> idx <span class="sc">-</span> left</span>
<span id="cb479-15"><a href="solutions.html#cb479-15" aria-hidden="true" tabindex="-1"></a>        endbox   <span class="ot">&lt;-</span> idx <span class="sc">+</span> right</span>
<span id="cb479-16"><a href="solutions.html#cb479-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb479-17"><a href="solutions.html#cb479-17" aria-hidden="true" tabindex="-1"></a>        vec_out[idx] <span class="ot">&lt;-</span> <span class="fu">mean</span>(vec[startbox<span class="sc">:</span>endbox], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb479-18"><a href="solutions.html#cb479-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb479-19"><a href="solutions.html#cb479-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb479-20"><a href="solutions.html#cb479-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec_out)</span>
<span id="cb479-21"><a href="solutions.html#cb479-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb479-22"><a href="solutions.html#cb479-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-23"><a href="solutions.html#cb479-23" aria-hidden="true" tabindex="-1"></a>ml_co2 <span class="ot">&lt;-</span> ml_co2 <span class="sc">|&gt;</span> </span>
<span id="cb479-24"><a href="solutions.html#cb479-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">average_12m =</span> <span class="fu">running_mean</span>(average, <span class="at">left =</span> <span class="dv">5</span>, <span class="at">right =</span> <span class="dv">6</span>))</span></code></pre></div>
<ul>
<li>Make a publication-ready figure that shows the monthly and the 12-month running mean time series of the CO<span class="math inline">\(_2\)</span> record.</li>
</ul>
<blockquote>
<p>Hint: To automatically render the time axis with ggplot, you can create a time object by combining the year and month columns: <code>lubridate::ymd(paste(as.character(year), "-", as.character(month), "-15"))</code></p>
</blockquote>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="solutions.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a date object for nice plotting</span></span>
<span id="cb480-2"><a href="solutions.html#cb480-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> ml_co2 <span class="sc">|&gt;</span> </span>
<span id="cb480-3"><a href="solutions.html#cb480-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">paste</span>(<span class="fu">as.character</span>(year), <span class="st">&quot;-&quot;</span>, <span class="fu">as.character</span>(month), <span class="st">&quot;-15&quot;</span>)))</span>
<span id="cb480-4"><a href="solutions.html#cb480-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5"><a href="solutions.html#cb480-5" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span></span>
<span id="cb480-6"><a href="solutions.html#cb480-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb480-7"><a href="solutions.html#cb480-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-8"><a href="solutions.html#cb480-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First plot the measurements</span></span>
<span id="cb480-9"><a href="solutions.html#cb480-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(date, average, <span class="at">color =</span> <span class="st">&quot;Measured&quot;</span>)) <span class="sc">+</span></span>
<span id="cb480-10"><a href="solutions.html#cb480-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-11"><a href="solutions.html#cb480-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add running mean on top</span></span>
<span id="cb480-12"><a href="solutions.html#cb480-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(date, average_12m, <span class="at">color =</span> <span class="st">&quot;12-month running mean&quot;</span>)) <span class="sc">+</span></span>
<span id="cb480-13"><a href="solutions.html#cb480-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-14"><a href="solutions.html#cb480-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the plot</span></span>
<span id="cb480-15"><a href="solutions.html#cb480-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb480-16"><a href="solutions.html#cb480-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>)) <span class="sc">+</span> <span class="co"># Move legend into the plot (c(x, y))</span></span>
<span id="cb480-17"><a href="solutions.html#cb480-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb480-18"><a href="solutions.html#cb480-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;</span>, <span class="co"># Omit legend title</span></span>
<span id="cb480-19"><a href="solutions.html#cb480-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb480-20"><a href="solutions.html#cb480-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Running mean&quot;</span>, <span class="st">&quot;Monthly mean&quot;</span>)</span>
<span id="cb480-21"><a href="solutions.html#cb480-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb480-22"><a href="solutions.html#cb480-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Atmospheric CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot; concentrations at Manua Lao, Hawaii&quot;</span>)),</span>
<span id="cb480-23"><a href="solutions.html#cb480-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y     =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;CO&quot;</span>[<span class="dv">2</span>], <span class="st">&quot;(ppm)&quot;</span>)),</span>
<span id="cb480-24"><a href="solutions.html#cb480-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x     =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 11 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-254-1.png" width="672" style="display: block; margin: auto;" /></p>
<!-- ### Telling a story from data {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
</div>
<div id="data-variety" class="section level2 hasAnchor" number="12.5">
<h2><span class="header-section-number">A.5</span> Data Variety<a href="solutions.html#data-variety" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="files-and-file-formats-2" class="section level3 unnumbered hasAnchor">
<h3>Files and file formats<a href="solutions.html#files-and-file-formats-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="reading-and-writing-human-readable-files-1" class="section level4 unnumbered hasAnchor">
<h4>Reading and writing human readable files<a href="solutions.html#reading-and-writing-human-readable-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>While <strong>not leaving your R session</strong>, download and open the files at the following locations:</p>
<blockquote>
<p>The below code shows how to read in the different demo data sets (CSV files). You will note that they all need separate settings, and that a given file extension isn’t necessarily a reflection of the content the file. Inspection of your read in data is therefore key.</p>
</blockquote>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="solutions.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the first demo</span></span>
<span id="cb482-2"><a href="solutions.html#cb482-2" aria-hidden="true" tabindex="-1"></a>demo_01 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb482-3"><a href="solutions.html#cb482-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_1.csv&quot;</span>,</span>
<span id="cb482-4"><a href="solutions.html#cb482-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb482-5"><a href="solutions.html#cb482-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb482-6"><a href="solutions.html#cb482-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb482-7"><a href="solutions.html#cb482-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-8"><a href="solutions.html#cb482-8" aria-hidden="true" tabindex="-1"></a><span class="co"># read in second demo</span></span>
<span id="cb482-9"><a href="solutions.html#cb482-9" aria-hidden="true" tabindex="-1"></a>demo_02 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb482-10"><a href="solutions.html#cb482-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_2.csv&quot;</span>,</span>
<span id="cb482-11"><a href="solutions.html#cb482-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb482-12"><a href="solutions.html#cb482-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb482-13"><a href="solutions.html#cb482-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb482-14"><a href="solutions.html#cb482-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-15"><a href="solutions.html#cb482-15" aria-hidden="true" tabindex="-1"></a>demo_03 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(</span>
<span id="cb482-16"><a href="solutions.html#cb482-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_3.csv&quot;</span>,</span>
<span id="cb482-17"><a href="solutions.html#cb482-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb482-18"><a href="solutions.html#cb482-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment.char =</span> <span class="st">&quot;|&quot;</span>,</span>
<span id="cb482-19"><a href="solutions.html#cb482-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb482-20"><a href="solutions.html#cb482-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>All the demo data sets are equal, except for their formatting. We can test if the content is identical by using the <code>identical()</code> function in R.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="solutions.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 1 with 2</span></span>
<span id="cb483-2"><a href="solutions.html#cb483-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(demo_01, demo_02)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="solutions.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare 2 with 3</span></span>
<span id="cb485-2"><a href="solutions.html#cb485-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(demo_02, demo_03)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="solutions.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given transitive properties, demo_01 is identical to demo_03</span></span></code></pre></div>
<p>Once loaded into your R environment, combine and save all data as a <strong>temporary</strong> <code>CSV</code> file. Read in the new temporary <code>CSV</code> file, and save it as a <code>JSON</code> file in your current working directory.</p>
<blockquote>
<p>You can combine the three datasets using the {dplyr} <code>bind_rows()</code> function.</p>
</blockquote>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="solutions.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combining all demo datasets</span></span>
<span id="cb488-2"><a href="solutions.html#cb488-2" aria-hidden="true" tabindex="-1"></a>demo_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(demo_01, demo_02, demo_03)</span>
<span id="cb488-3"><a href="solutions.html#cb488-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-4"><a href="solutions.html#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="co"># writing the data to a temporary CSV file</span></span>
<span id="cb488-5"><a href="solutions.html#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(</span>
<span id="cb488-6"><a href="solutions.html#cb488-6" aria-hidden="true" tabindex="-1"></a>  demo_all, </span>
<span id="cb488-7"><a href="solutions.html#cb488-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb488-8"><a href="solutions.html#cb488-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb488-9"><a href="solutions.html#cb488-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb488-10"><a href="solutions.html#cb488-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb488-11"><a href="solutions.html#cb488-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb488-12"><a href="solutions.html#cb488-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-13"><a href="solutions.html#cb488-13" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb488-14"><a href="solutions.html#cb488-14" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb488-15"><a href="solutions.html#cb488-15" aria-hidden="true" tabindex="-1"></a>  demo_all,</span>
<span id="cb488-16"><a href="solutions.html#cb488-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb488-17"><a href="solutions.html#cb488-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb488-18"><a href="solutions.html#cb488-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb488-19"><a href="solutions.html#cb488-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-20"><a href="solutions.html#cb488-20" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the previous CSV file</span></span>
<span id="cb488-21"><a href="solutions.html#cb488-21" aria-hidden="true" tabindex="-1"></a>demo_all_new <span class="ot">&lt;-</span><span class="fu">read.table</span>(</span>
<span id="cb488-22"><a href="solutions.html#cb488-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;tmp_csv_file.csv&quot;</span>),</span>
<span id="cb488-23"><a href="solutions.html#cb488-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb488-24"><a href="solutions.html#cb488-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb488-25"><a href="solutions.html#cb488-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb488-26"><a href="solutions.html#cb488-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-27"><a href="solutions.html#cb488-27" aria-hidden="true" tabindex="-1"></a><span class="co"># writing the data to a JSON file</span></span>
<span id="cb488-28"><a href="solutions.html#cb488-28" aria-hidden="true" tabindex="-1"></a>jsonlite<span class="sc">::</span><span class="fu">write_json</span>(demo_all_new, <span class="at">path =</span> <span class="st">&quot;./my_json_file.json&quot;</span>)</span></code></pre></div>
</div>
<div id="reading-and-writing-binary-files-1" class="section level4 unnumbered hasAnchor">
<h4>Reading and writing binary files<a href="solutions.html#reading-and-writing-binary-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Download and open the following file:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb489-1"><a href="solutions.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="ex">https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.nc</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>What file format are we dealing with?</li>
</ol>
<p>It is a NetCDF file (ending <code>.nc</code>, see Table in Chapter <a href="datavariety.html#datavariety">5</a>)</p>
<ol start="2" style="list-style-type: decimal">
<li>What library would you use to read this kind of data?</li>
</ol>
<p>Different libraries are available, including {terra}, {raster} (the predecessor of {terra}), and {ncdf4}, see Table in Chapter <a href="datavariety.html#datavariety">5</a>.</p>
<ol start="3" style="list-style-type: decimal">
<li>What does this file contain?</li>
</ol>
<p>In R:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="solutions.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read unknown netcdf file using the {terra} library</span></span>
<span id="cb490-2"><a href="solutions.html#cb490-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb490-3"><a href="solutions.html#cb490-3" aria-hidden="true" tabindex="-1"></a>unknown_netcdf <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.nc&quot;</span>)</span>
<span id="cb490-4"><a href="solutions.html#cb490-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-5"><a href="solutions.html#cb490-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print the meta-data by calling the variable</span></span>
<span id="cb490-6"><a href="solutions.html#cb490-6" aria-hidden="true" tabindex="-1"></a>unknown_netcdf</span>
<span id="cb490-7"><a href="solutions.html#cb490-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-8"><a href="solutions.html#cb490-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visually plot the data</span></span>
<span id="cb490-9"><a href="solutions.html#cb490-9" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_netcdf)</span></code></pre></div>
<p>From your terminal (when the file is located in the current working directory:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb491-1"><a href="solutions.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ncdump</span> <span class="at">-h</span> some_data.nc</span></code></pre></div>
<p>When printing the object in R, we get: <code>varname     : t2m (2 metre temperature)</code>.</p>
<ol start="4" style="list-style-type: decimal">
<li>Write this file to disk in a different geospatial format you desire (use the R documentation of the library used to read the file and the chapter information).</li>
</ol>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="solutions.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the data as a geotiff (other options are possible as well in writeRaster)</span></span>
<span id="cb492-2"><a href="solutions.html#cb492-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb492-3"><a href="solutions.html#cb492-3" aria-hidden="true" tabindex="-1"></a>  unknown_netcdf,</span>
<span id="cb492-4"><a href="solutions.html#cb492-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;./test.tif&quot;</span>,</span>
<span id="cb492-5"><a href="solutions.html#cb492-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb492-6"><a href="solutions.html#cb492-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Download and open the following file: <code>https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.tif</code>. Does this data seem familiar, and how can you tell? What are your conclusions?</li>
</ol>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="solutions.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read unknown tif file using the {terra} library</span></span>
<span id="cb493-2"><a href="solutions.html#cb493-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb493-3"><a href="solutions.html#cb493-3" aria-hidden="true" tabindex="-1"></a>unknown_tif <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;https://raw.githubusercontent.com/geco-bern/agds/main/data/demo_data.tif&quot;</span>)</span>
<span id="cb493-4"><a href="solutions.html#cb493-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-5"><a href="solutions.html#cb493-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print the meta-data by calling the variable</span></span>
<span id="cb493-6"><a href="solutions.html#cb493-6" aria-hidden="true" tabindex="-1"></a>unknown_tif</span>
<span id="cb493-7"><a href="solutions.html#cb493-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-8"><a href="solutions.html#cb493-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visually plot the data</span></span>
<span id="cb493-9"><a href="solutions.html#cb493-9" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_tif)</span>
<span id="cb493-10"><a href="solutions.html#cb493-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-11"><a href="solutions.html#cb493-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Are they exactly the same</span></span>
<span id="cb493-12"><a href="solutions.html#cb493-12" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(unknown_tif <span class="sc">-</span> unknown_netcdf)</span>
<span id="cb493-13"><a href="solutions.html#cb493-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-14"><a href="solutions.html#cb493-14" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb493-15"><a href="solutions.html#cb493-15" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(unkown_netcdf, unknown_tif)</span></code></pre></div>
<p>Looks similar to the NetCDF data, but temperature appears to be given in Celsius in the GeoTIFF file and in Kelvin in the NetCDF file.</p>
</div>
</div>
</div>
<div id="open-science" class="section level2 hasAnchor" number="12.6">
<h2><span class="header-section-number">A.6</span> Open Science<a href="solutions.html#open-science" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="external-data-1" class="section level3 unnumbered hasAnchor">
<h3>External data<a href="solutions.html#external-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The project data is stored in one folder without folders to sort data from code to give it structure.</p>
<p>The project can be re-organized using a simple project structure as such:</p>
<pre><code>~/project/
├─ data/
     ├─ 00_convert_data.R
     ├─ survey.xlsx # the original
     ├─ survey.csv # from (xls conversion (copy 1).csv)
├─ R/
     ├─ my_functions.R
├─ analysis/
     ├─ 00_model_fits.R # from Model-test-final.R
     ├─ 01_model_plots.R # from Plots.R
├─ vignettes/
     ├─ Report.Rmd
├─ manuscript/
     ├─ Report.html
     ├─ Figure 1.png</code></pre>
<p>Note that duplicate files are removed, code to cleanup data is numbered and stored with the data, functions which are accessible for analysis are stored in the R folder, Rmarkdown files are stored in the vignettes folder and the results of the full analysis is stored in a manuscript folder. Some variations on naming is possible.</p>
</div>
<div id="a-new-project-1" class="section level3 unnumbered hasAnchor">
<h3>A new project<a href="solutions.html#a-new-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This exercise trains your ability to access and wrangle data yourself in a reproducible way. The best solution to test whether your you successfully did to is by letting a friend run all of your code on their machine. Resolving the errors you may encounter, helps you to improve you workflow and ensures a streamlined submission of your final report.</p>
</div>
<div id="tracking-the-state-of-your-project-1" class="section level3 unnumbered hasAnchor">
<h3>Tracking the state of your project<a href="solutions.html#tracking-the-state-of-your-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
</div>
</div>
<div id="code-management" class="section level2 hasAnchor" number="12.7">
<h2><span class="header-section-number">A.7</span> Code Management<a href="solutions.html#code-management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="location-based-code-management-1" class="section level3 unnumbered hasAnchor">
<h3>Location based code management<a href="solutions.html#location-based-code-management-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>No solutions provided.</em></p>
<!-- ### Collaborative Work on Github {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
</div>
<div id="regression-and-classification" class="section level2 hasAnchor" number="12.8">
<h2><span class="header-section-number">A.8</span> Regression and Classification<a href="solutions.html#regression-and-classification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- ### Stepwise regression and asking for help {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
<div id="supervised-ml-i" class="section level2 hasAnchor" number="12.9">
<h2><span class="header-section-number">A.9</span> Supervised ML I<a href="solutions.html#supervised-ml-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>No solutions provided</em></p>
<!-- ### Comparison of LM and KNN {-} -->
<!-- *No solutions provided because part of the final report.* -->
<!-- ### The role of picking a hyperparameter {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
<div id="supervised-ml-ii" class="section level2 hasAnchor" number="12.10">
<h2><span class="header-section-number">A.10</span> Supervised ML II<a href="solutions.html#supervised-ml-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="cross-validation-by-hand-1" class="section level3 unnumbered hasAnchor">
<h3>Cross-validation by hand<a href="solutions.html#cross-validation-by-hand-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The goal of this exercise is to create a script that explicitly runs a cross-validation by hand. In Chapter <a href="supervisedmlii.html#supervisedmlii">10</a>, we used the function <code>caret::train()</code> and specified the argument <code>trControl = caret::trainControl(method = "cv", number = 10)</code> to let it conduct a 10-fold cross-validation under the hood. Now, we want to actually understand this process in detail by reproducing Figure <a href="supervisedmlii.html#fig:kfoldcv">10.2</a> in code.</p>
<div id="source-necessary-functions" class="section level4 unnumbered hasAnchor">
<h4>Source necessary functions<a href="solutions.html#source-necessary-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="solutions.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/eval_model.R&quot;</span>)</span></code></pre></div>
</div>
<div id="get-data-and-clean-it" class="section level4 unnumbered hasAnchor">
<h4>Get data and clean it<a href="solutions.html#get-data-and-clean-it" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="solutions.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load daily dataframe from Davos</span></span>
<span id="cb496-2"><a href="solutions.html#cb496-2" aria-hidden="true" tabindex="-1"></a>df_org <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;data/FLX_CH-Dav_FLUXNET2015_FULLSET_DD_1997-2014_1-3.csv&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb496-3"><a href="solutions.html#cb496-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-4"><a href="solutions.html#cb496-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop QC variables (no longer needed)</span></span>
<span id="cb496-5"><a href="solutions.html#cb496-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>))</span></code></pre></div>
</div>
<div id="create-training-and-test-sets" class="section level4 unnumbered hasAnchor">
<h4>Create training and test sets<a href="solutions.html#create-training-and-test-sets" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="solutions.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data splitting</span></span>
<span id="cb497-2"><a href="solutions.html#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb497-3"><a href="solutions.html#cb497-3" aria-hidden="true" tabindex="-1"></a>split      <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(df_org, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> <span class="st">&quot;VPD_F&quot;</span>)</span>
<span id="cb497-4"><a href="solutions.html#cb497-4" aria-hidden="true" tabindex="-1"></a>df_train   <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(split)</span>
<span id="cb497-5"><a href="solutions.html#cb497-5" aria-hidden="true" tabindex="-1"></a>df_test    <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(split)</span></code></pre></div>
</div>
<div id="write-functions-to-facilitate-repeated-cross-validation" class="section level4 unnumbered hasAnchor">
<h4>Write functions to facilitate repeated cross-validation<a href="solutions.html#write-functions-to-facilitate-repeated-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="solutions.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Function to run cross validation</span></span>
<span id="cb498-2"><a href="solutions.html#cb498-2" aria-hidden="true" tabindex="-1"></a>cross_validation_by_hand <span class="ot">&lt;-</span> <span class="cf">function</span>(df_train,</span>
<span id="cb498-3"><a href="solutions.html#cb498-3" aria-hidden="true" tabindex="-1"></a>                                     n_folds,</span>
<span id="cb498-4"><a href="solutions.html#cb498-4" aria-hidden="true" tabindex="-1"></a>                                     vec_k</span>
<span id="cb498-5"><a href="solutions.html#cb498-5" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb498-6"><a href="solutions.html#cb498-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-7"><a href="solutions.html#cb498-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pre-process data</span></span>
<span id="cb498-8"><a href="solutions.html#cb498-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-9"><a href="solutions.html#cb498-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The function does not know if we are sampling from a randomly distributed </span></span>
<span id="cb498-10"><a href="solutions.html#cb498-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># training set! For example, our df_train is structured in time, causing data</span></span>
<span id="cb498-11"><a href="solutions.html#cb498-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># leakage. Thus, we first have to randomize the df_train that is fed into</span></span>
<span id="cb498-12"><a href="solutions.html#cb498-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the function.</span></span>
<span id="cb498-13"><a href="solutions.html#cb498-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-14"><a href="solutions.html#cb498-14" aria-hidden="true" tabindex="-1"></a>  rand <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df_train)) <span class="co"># Get a vector of random indeces</span></span>
<span id="cb498-15"><a href="solutions.html#cb498-15" aria-hidden="true" tabindex="-1"></a>  df_rnd <span class="ot">&lt;-</span> df_train[rand, ] <span class="co"># Reorder df_train using random indeces</span></span>
<span id="cb498-16"><a href="solutions.html#cb498-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-17"><a href="solutions.html#cb498-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare variables used in the loops</span></span>
<span id="cb498-18"><a href="solutions.html#cb498-18" aria-hidden="true" tabindex="-1"></a>  fold_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_rnd) <span class="sc">/</span> n_folds <span class="co"># Specify size of each df in each fold</span></span>
<span id="cb498-19"><a href="solutions.html#cb498-19" aria-hidden="true" tabindex="-1"></a>  df_cv <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># Create empty dataframe to capture model performance per fold</span></span>
<span id="cb498-20"><a href="solutions.html#cb498-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb498-21"><a href="solutions.html#cb498-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over k&#39;s</span></span>
<span id="cb498-22"><a href="solutions.html#cb498-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> vec_k) {</span>
<span id="cb498-23"><a href="solutions.html#cb498-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb498-24"><a href="solutions.html#cb498-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a loop that goes through each fold</span></span>
<span id="cb498-25"><a href="solutions.html#cb498-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_folds) {</span>
<span id="cb498-26"><a href="solutions.html#cb498-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-27"><a href="solutions.html#cb498-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get current fold&#39;s starting and ending position in the training set </span></span>
<span id="cb498-28"><a href="solutions.html#cb498-28" aria-hidden="true" tabindex="-1"></a>      index_start <span class="ot">&lt;-</span> (idx <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> fold_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb498-29"><a href="solutions.html#cb498-29" aria-hidden="true" tabindex="-1"></a>      index_end   <span class="ot">&lt;-</span> (i) <span class="sc">*</span> fold_size</span>
<span id="cb498-30"><a href="solutions.html#cb498-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb498-31"><a href="solutions.html#cb498-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Split test set into training and validation set</span></span>
<span id="cb498-32"><a href="solutions.html#cb498-32" aria-hidden="true" tabindex="-1"></a>      i_df_val   <span class="ot">&lt;-</span> df_rnd <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(index_start <span class="sc">:</span> index_end) <span class="co"># Keep 1 fold out</span></span>
<span id="cb498-33"><a href="solutions.html#cb498-33" aria-hidden="true" tabindex="-1"></a>      i_df_train <span class="ot">&lt;-</span> df_rnd <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="sc">-</span>(index_start <span class="sc">:</span> index_end)) <span class="co"># Keep n-1 fold</span></span>
<span id="cb498-34"><a href="solutions.html#cb498-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb498-35"><a href="solutions.html#cb498-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if data was not split properly</span></span>
<span id="cb498-36"><a href="solutions.html#cb498-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if there is at least one date in train that is in validation set</span></span>
<span id="cb498-37"><a href="solutions.html#cb498-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If so, promp error</span></span>
<span id="cb498-38"><a href="solutions.html#cb498-38" aria-hidden="true" tabindex="-1"></a>      qc <span class="ot">&lt;-</span> <span class="fu">any</span>(i_df_train<span class="sc">$</span>TIMESTAMP <span class="sc">%in%</span> i_df_val<span class="sc">$</span>TIMESTAMP)</span>
<span id="cb498-39"><a href="solutions.html#cb498-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (qc) <span class="fu">stop</span>(<span class="st">&quot;Error: Data was not split properly!&quot;</span>)</span>
<span id="cb498-40"><a href="solutions.html#cb498-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb498-41"><a href="solutions.html#cb498-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create recipe based on the ith train set</span></span>
<span id="cb498-42"><a href="solutions.html#cb498-42" aria-hidden="true" tabindex="-1"></a>      i_pp <span class="ot">&lt;-</span> </span>
<span id="cb498-43"><a href="solutions.html#cb498-43" aria-hidden="true" tabindex="-1"></a>        recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> TA_F, </span>
<span id="cb498-44"><a href="solutions.html#cb498-44" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> i_df_train) <span class="sc">|&gt;</span></span>
<span id="cb498-45"><a href="solutions.html#cb498-45" aria-hidden="true" tabindex="-1"></a>        recipes<span class="sc">::</span><span class="fu">step_center</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb498-46"><a href="solutions.html#cb498-46" aria-hidden="true" tabindex="-1"></a>        recipes<span class="sc">::</span><span class="fu">step_scale</span>( recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>())</span>
<span id="cb498-47"><a href="solutions.html#cb498-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb498-48"><a href="solutions.html#cb498-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Train the model</span></span>
<span id="cb498-49"><a href="solutions.html#cb498-49" aria-hidden="true" tabindex="-1"></a>      i_knn <span class="ot">&lt;-</span> </span>
<span id="cb498-50"><a href="solutions.html#cb498-50" aria-hidden="true" tabindex="-1"></a>        caret<span class="sc">::</span><span class="fu">train</span>(i_pp, </span>
<span id="cb498-51"><a href="solutions.html#cb498-51" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> i_df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb498-52"><a href="solutions.html#cb498-52" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb498-53"><a href="solutions.html#cb498-53" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;none&quot;</span>),</span>
<span id="cb498-54"><a href="solutions.html#cb498-54" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> k),</span>
<span id="cb498-55"><a href="solutions.html#cb498-55" aria-hidden="true" tabindex="-1"></a>                      <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>)</span>
<span id="cb498-56"><a href="solutions.html#cb498-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb498-57"><a href="solutions.html#cb498-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Extract evaluation on validation set</span></span>
<span id="cb498-58"><a href="solutions.html#cb498-58" aria-hidden="true" tabindex="-1"></a>      i_eval <span class="ot">&lt;-</span> </span>
<span id="cb498-59"><a href="solutions.html#cb498-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">eval_model</span>(i_knn, </span>
<span id="cb498-60"><a href="solutions.html#cb498-60" aria-hidden="true" tabindex="-1"></a>                    i_df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb498-61"><a href="solutions.html#cb498-61" aria-hidden="true" tabindex="-1"></a>                    i_df_val, </span>
<span id="cb498-62"><a href="solutions.html#cb498-62" aria-hidden="true" tabindex="-1"></a>                    <span class="at">return_metrics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb498-63"><a href="solutions.html#cb498-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb498-64"><a href="solutions.html#cb498-64" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create df for metrics</span></span>
<span id="cb498-65"><a href="solutions.html#cb498-65" aria-hidden="true" tabindex="-1"></a>      i_metrics <span class="ot">&lt;-</span> </span>
<span id="cb498-66"><a href="solutions.html#cb498-66" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb498-67"><a href="solutions.html#cb498-67" aria-hidden="true" tabindex="-1"></a>          <span class="at">k    =</span> k,</span>
<span id="cb498-68"><a href="solutions.html#cb498-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">fold =</span> i,</span>
<span id="cb498-69"><a href="solutions.html#cb498-69" aria-hidden="true" tabindex="-1"></a>          <span class="at">rmse =</span> i_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">1</span>],</span>
<span id="cb498-70"><a href="solutions.html#cb498-70" aria-hidden="true" tabindex="-1"></a>          <span class="at">rsq  =</span> i_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">2</span>],</span>
<span id="cb498-71"><a href="solutions.html#cb498-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">mae  =</span> i_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">3</span>]</span>
<span id="cb498-72"><a href="solutions.html#cb498-72" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb498-73"><a href="solutions.html#cb498-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb498-74"><a href="solutions.html#cb498-74" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Append metrics to df</span></span>
<span id="cb498-75"><a href="solutions.html#cb498-75" aria-hidden="true" tabindex="-1"></a>      df_cv <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_cv, i_metrics)</span>
<span id="cb498-76"><a href="solutions.html#cb498-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb498-77"><a href="solutions.html#cb498-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb498-78"><a href="solutions.html#cb498-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add some verbose output to know where the loops are at</span></span>
<span id="cb498-79"><a href="solutions.html#cb498-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Done: &quot;</span>, <span class="fu">round</span>(<span class="fu">match</span>(k, vec_k)<span class="sc">/</span><span class="fu">length</span>(vec_k) <span class="sc">*</span> <span class="dv">100</span>), <span class="st">&quot; %&quot;</span>)</span>
<span id="cb498-80"><a href="solutions.html#cb498-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb498-81"><a href="solutions.html#cb498-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-82"><a href="solutions.html#cb498-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return df_cv</span></span>
<span id="cb498-83"><a href="solutions.html#cb498-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_cv)</span>
<span id="cb498-84"><a href="solutions.html#cb498-84" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="solutions.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to aggregate cross-validation output to a nice long table</span></span>
<span id="cb499-2"><a href="solutions.html#cb499-2" aria-hidden="true" tabindex="-1"></a>aggregate_cv_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(df_cv){</span>
<span id="cb499-3"><a href="solutions.html#cb499-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-4"><a href="solutions.html#cb499-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We must aggregate twice, once for means and once for standard deviations.</span></span>
<span id="cb499-5"><a href="solutions.html#cb499-5" aria-hidden="true" tabindex="-1"></a>  df_agg <span class="ot">&lt;-</span> </span>
<span id="cb499-6"><a href="solutions.html#cb499-6" aria-hidden="true" tabindex="-1"></a>    df_cv <span class="sc">|&gt;</span> </span>
<span id="cb499-7"><a href="solutions.html#cb499-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(k) <span class="sc">|&gt;</span> </span>
<span id="cb499-8"><a href="solutions.html#cb499-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_rmse   =</span> <span class="fu">mean</span>(rmse),</span>
<span id="cb499-9"><a href="solutions.html#cb499-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_rsq    =</span> <span class="fu">mean</span>(rsq),</span>
<span id="cb499-10"><a href="solutions.html#cb499-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_mae    =</span> <span class="fu">mean</span>(mae),</span>
<span id="cb499-11"><a href="solutions.html#cb499-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_rmse    =</span> <span class="fu">sd</span>(rmse),</span>
<span id="cb499-12"><a href="solutions.html#cb499-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_rsq     =</span> <span class="fu">sd</span>(rsq),</span>
<span id="cb499-13"><a href="solutions.html#cb499-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_mae     =</span> <span class="fu">sd</span>(mae))</span>
<span id="cb499-14"><a href="solutions.html#cb499-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-15"><a href="solutions.html#cb499-15" aria-hidden="true" tabindex="-1"></a>  df_long <span class="ot">&lt;-</span></span>
<span id="cb499-16"><a href="solutions.html#cb499-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb499-17"><a href="solutions.html#cb499-17" aria-hidden="true" tabindex="-1"></a>      df_agg <span class="sc">|&gt;</span> </span>
<span id="cb499-18"><a href="solutions.html#cb499-18" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(k, </span>
<span id="cb499-19"><a href="solutions.html#cb499-19" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">starts_with</span>(<span class="st">&quot;mean_&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb499-20"><a href="solutions.html#cb499-20" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;mean_&quot;</span>),</span>
<span id="cb499-21"><a href="solutions.html#cb499-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>,</span>
<span id="cb499-22"><a href="solutions.html#cb499-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb499-23"><a href="solutions.html#cb499-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;mean_&quot;</span>),</span>
<span id="cb499-24"><a href="solutions.html#cb499-24" aria-hidden="true" tabindex="-1"></a>        df_agg <span class="sc">|&gt;</span> </span>
<span id="cb499-25"><a href="solutions.html#cb499-25" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(k, </span>
<span id="cb499-26"><a href="solutions.html#cb499-26" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">starts_with</span>(<span class="st">&quot;sd_&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb499-27"><a href="solutions.html#cb499-27" aria-hidden="true" tabindex="-1"></a>          tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb499-28"><a href="solutions.html#cb499-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;sd_&quot;</span>),</span>
<span id="cb499-29"><a href="solutions.html#cb499-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>,</span>
<span id="cb499-30"><a href="solutions.html#cb499-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_to =</span> <span class="st">&quot;sd&quot;</span>,</span>
<span id="cb499-31"><a href="solutions.html#cb499-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_prefix =</span> <span class="st">&quot;sd_&quot;</span></span>
<span id="cb499-32"><a href="solutions.html#cb499-32" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb499-33"><a href="solutions.html#cb499-33" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb499-34"><a href="solutions.html#cb499-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb499-35"><a href="solutions.html#cb499-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_long)</span>
<span id="cb499-36"><a href="solutions.html#cb499-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="run-the-cross-validation" class="section level4 unnumbered hasAnchor">
<h4>Run the cross-validation<a href="solutions.html#run-the-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="solutions.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick parameters for cross-validation</span></span>
<span id="cb500-2"><a href="solutions.html#cb500-2" aria-hidden="true" tabindex="-1"></a>my_k <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>)</span>
<span id="cb500-3"><a href="solutions.html#cb500-3" aria-hidden="true" tabindex="-1"></a>my_folds <span class="ot">&lt;-</span> <span class="dv">10</span></span></code></pre></div>
<!-- >>> CHECK FOR REDUCING COMPUTATIONAL COST TO RENDER BOOK ONLINE <<< -->
<!-- SAVE DATA WHEN RUNNING LOCALLY BY SETTING EVAL = TRUE, PUSH ONLY WITH EVAL = FALSE -->
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="solutions.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run cross validation</span></span>
<span id="cb501-2"><a href="solutions.html#cb501-2" aria-hidden="true" tabindex="-1"></a>df_cv <span class="ot">&lt;-</span> <span class="fu">cross_validation_by_hand</span>(</span>
<span id="cb501-3"><a href="solutions.html#cb501-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_train =</span> df_train,</span>
<span id="cb501-4"><a href="solutions.html#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds  =</span> my_folds,</span>
<span id="cb501-5"><a href="solutions.html#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">vec_k    =</span> my_k</span>
<span id="cb501-6"><a href="solutions.html#cb501-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb501-7"><a href="solutions.html#cb501-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-8"><a href="solutions.html#cb501-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract metrics and prepare df for plotting</span></span>
<span id="cb501-9"><a href="solutions.html#cb501-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate the metrics plot to the mean values for each metric</span></span>
<span id="cb501-10"><a href="solutions.html#cb501-10" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">aggregate_cv_metrics</span>(df_cv)</span>
<span id="cb501-11"><a href="solutions.html#cb501-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-12"><a href="solutions.html#cb501-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract value and k for each best metric</span></span>
<span id="cb501-13"><a href="solutions.html#cb501-13" aria-hidden="true" tabindex="-1"></a>df_best <span class="ot">&lt;-</span> </span>
<span id="cb501-14"><a href="solutions.html#cb501-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb501-15"><a href="solutions.html#cb501-15" aria-hidden="true" tabindex="-1"></a>    df_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>),</span>
<span id="cb501-16"><a href="solutions.html#cb501-16" aria-hidden="true" tabindex="-1"></a>    df_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;mae&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>),</span>
<span id="cb501-17"><a href="solutions.html#cb501-17" aria-hidden="true" tabindex="-1"></a>    df_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;rsq&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mean)) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb501-18"><a href="solutions.html#cb501-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Done:  8  %
## Done:  15  %
## Done:  23  %
## Done:  31  %
## Done:  38  %
## Done:  46  %
## Done:  54  %
## Done:  62  %
## Done:  69  %
## Done:  77  %
## Done:  85  %
## Done:  92  %
## Done:  100  %</code></pre>
<!-- >>> END OF CHECK <<< -->
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="solutions.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check what out our dataframes look like</span></span>
<span id="cb503-2"><a href="solutions.html#cb503-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_best)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##       k metric  mean     sd
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1    20 rmse   1.51  0.104 
## 2    40 mae    1.15  0.0630
## 3    20 rsq    0.660 0.0378</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="solutions.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##       k metric  mean     sd
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     2 rmse   1.77  0.137 
## 2     2 rsq    0.559 0.0462
## 3     2 mae    1.35  0.0957
## 4     5 rmse   1.59  0.0784
## 5     5 rsq    0.627 0.0256
## 6     5 mae    1.21  0.0544</code></pre>
</div>
<div id="create-output" class="section level4 unnumbered hasAnchor">
<h4>Create output<a href="solutions.html#create-output" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="solutions.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a nice facet plot showing how each metric changes with k and </span></span>
<span id="cb507-2"><a href="solutions.html#cb507-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with vertical bar showing the optimal k for that parameter</span></span>
<span id="cb507-3"><a href="solutions.html#cb507-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb507-4"><a href="solutions.html#cb507-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_long, <span class="fu">aes</span>(k, mean)) <span class="sc">+</span></span>
<span id="cb507-5"><a href="solutions.html#cb507-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_long, <span class="fu">aes</span>(k, mean)) <span class="sc">+</span></span>
<span id="cb507-6"><a href="solutions.html#cb507-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> df_best,</span>
<span id="cb507-7"><a href="solutions.html#cb507-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> k),</span>
<span id="cb507-8"><a href="solutions.html#cb507-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span>    </span>
<span id="cb507-9"><a href="solutions.html#cb507-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>metric, </span>
<span id="cb507-10"><a href="solutions.html#cb507-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb507-11"><a href="solutions.html#cb507-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb507-12"><a href="solutions.html#cb507-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb507-13"><a href="solutions.html#cb507-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;rmse&quot;</span> <span class="ot">=</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb507-14"><a href="solutions.html#cb507-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;mae&quot;</span> <span class="ot">=</span>  <span class="st">&quot;MAE&quot;</span>,</span>
<span id="cb507-15"><a href="solutions.html#cb507-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;rsq&quot;</span> <span class="ot">=</span>  <span class="st">&quot;R^2&quot;</span></span>
<span id="cb507-16"><a href="solutions.html#cb507-16" aria-hidden="true" tabindex="-1"></a>             ))) <span class="sc">+</span></span>
<span id="cb507-17"><a href="solutions.html#cb507-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Cross-Validated Hyperparameter Tuning&quot;</span>,</span>
<span id="cb507-18"><a href="solutions.html#cb507-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Mean Cross-Validated Metric Value&quot;</span>,</span>
<span id="cb507-19"><a href="solutions.html#cb507-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Number of Neighbours (k)&quot;</span>) <span class="sc">+</span></span>
<span id="cb507-20"><a href="solutions.html#cb507-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb507-21"><a href="solutions.html#cb507-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-271-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="solutions.html#cb508-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(df_best, </span>
<span id="cb508-2"><a href="solutions.html#cb508-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb508-3"><a href="solutions.html#cb508-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Mean and standard deviation for cross-validated metrics and their best k.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-272">Table A.1: </span>Mean and standard deviation for cross-validated metrics and their best k.</caption>
<thead>
<tr class="header">
<th align="right">k</th>
<th align="left">metric</th>
<th align="right">mean</th>
<th align="right">sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">20</td>
<td align="left">rmse</td>
<td align="right">1.51</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="left">mae</td>
<td align="right">1.15</td>
<td align="right">0.06</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">rsq</td>
<td align="right">0.66</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
</div>
<div id="interpretation-of-results" class="section level4 hasAnchor" number="12.10.0.1">
<h4><span class="header-section-number">A.10.0.1</span> Interpretation of results<a href="solutions.html#interpretation-of-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>What do we see?</strong>
The plot above shows how the cross-validated values for MAE, RMSE, and adj. <span class="math inline">\(R^2\)</span> changes with the number of neighours, <span class="math inline">\(k\)</span>. We see that for each metric, we can find a best value at a distinct optimal <span class="math inline">\(k\)</span>. Increasing or decreasing <span class="math inline">\(k\)</span> worsens model performance. We can also see that there is some plateauing going on between a <span class="math inline">\(k\)</span> of 15-40, where there are no substantial changes for all metrics.</p>
<p><strong>What does that imply?</strong>
The pattern of cross-validated metric versus <span class="math inline">\(k\)</span> shows that we should use a value between 15-40 in order to get the best model performance. Alternatively, we could also rerun our analysis with a finer array of <span class="math inline">\(k\)</span> like <code>seq(20, 40, 1)</code> to get an even better estimate for <span class="math inline">\(k\)</span>.</p>
<p><strong>How do we continue from here?</strong>
Our goal is to get the best model and report on what is to be expected if we apply this model to unseen data.
Therefore, we now train our model again with the average optimal <span class="math inline">\(k\)</span> found but this time we include all training data. We do this because we want to utilize all available data to create our final model. Then we evaluate this final model against our test data. In theory, the model performance metrics on the test data should fall within the mean and standard deviation from the cross-validated model training. Is that the case here?</p>
</div>
<div id="teseting-our-hypothesis" class="section level4 unnumbered hasAnchor">
<h4>Teseting our hypothesis<a href="solutions.html#teseting-our-hypothesis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- >>> CHECK FOR REDUCING COMPUTATIONAL COST TO RENDER BOOK ONLINE <<< -->
<!-- SAVE DATA WHEN RUNNING LOCALLY BY SETTING EVAL = TRUE, PUSH ONLY WITH EVAL = FALSE -->
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="solutions.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal k from our cross-validation exercise </span></span>
<span id="cb509-2"><a href="solutions.html#cb509-2" aria-hidden="true" tabindex="-1"></a>my_k <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_best<span class="sc">$</span>k) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span>
<span id="cb509-3"><a href="solutions.html#cb509-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-4"><a href="solutions.html#cb509-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run cross validation</span></span>
<span id="cb509-5"><a href="solutions.html#cb509-5" aria-hidden="true" tabindex="-1"></a>df_cv <span class="ot">&lt;-</span> <span class="fu">cross_validation_by_hand</span>(</span>
<span id="cb509-6"><a href="solutions.html#cb509-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">df_train =</span> df_train,</span>
<span id="cb509-7"><a href="solutions.html#cb509-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds  =</span> my_folds, </span>
<span id="cb509-8"><a href="solutions.html#cb509-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">vec_k    =</span> my_k</span>
<span id="cb509-9"><a href="solutions.html#cb509-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb509-10"><a href="solutions.html#cb509-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-11"><a href="solutions.html#cb509-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate cv-metrics</span></span>
<span id="cb509-12"><a href="solutions.html#cb509-12" aria-hidden="true" tabindex="-1"></a>metrics_final_model <span class="ot">&lt;-</span> <span class="fu">aggregate_cv_metrics</span>(df_cv)</span></code></pre></div>
<pre><code>## Done:  100  %</code></pre>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="solutions.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we train a new model with the same model setup but on the entire training set</span></span>
<span id="cb511-2"><a href="solutions.html#cb511-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s re-use the code from the tutorials!</span></span>
<span id="cb511-3"><a href="solutions.html#cb511-3" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> SW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> TA_F, </span>
<span id="cb511-4"><a href="solutions.html#cb511-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> df_train) <span class="sc">|&gt;</span> </span>
<span id="cb511-5"><a href="solutions.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_center</span>(recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb511-6"><a href="solutions.html#cb511-6" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_scale</span>( recipes<span class="sc">::</span><span class="fu">all_numeric</span>(), <span class="sc">-</span>recipes<span class="sc">::</span><span class="fu">all_outcomes</span>())</span>
<span id="cb511-7"><a href="solutions.html#cb511-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-8"><a href="solutions.html#cb511-8" aria-hidden="true" tabindex="-1"></a>mycv_knn <span class="ot">&lt;-</span> </span>
<span id="cb511-9"><a href="solutions.html#cb511-9" aria-hidden="true" tabindex="-1"></a>  caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb511-10"><a href="solutions.html#cb511-10" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb511-11"><a href="solutions.html#cb511-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb511-12"><a href="solutions.html#cb511-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb511-13"><a href="solutions.html#cb511-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;none&quot;</span>),</span>
<span id="cb511-14"><a href="solutions.html#cb511-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> my_k),</span>
<span id="cb511-15"><a href="solutions.html#cb511-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb511-16"><a href="solutions.html#cb511-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb511-17"><a href="solutions.html#cb511-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-18"><a href="solutions.html#cb511-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model against test set</span></span>
<span id="cb511-19"><a href="solutions.html#cb511-19" aria-hidden="true" tabindex="-1"></a>mycv_eval <span class="ot">&lt;-</span> <span class="fu">eval_model</span>(mycv_knn, </span>
<span id="cb511-20"><a href="solutions.html#cb511-20" aria-hidden="true" tabindex="-1"></a>                        df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb511-21"><a href="solutions.html#cb511-21" aria-hidden="true" tabindex="-1"></a>                        df_test, </span>
<span id="cb511-22"><a href="solutions.html#cb511-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">return_metrics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="solutions.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s see what caret::train() estimates</span></span>
<span id="cb512-2"><a href="solutions.html#cb512-2" aria-hidden="true" tabindex="-1"></a>caretcv_knn <span class="ot">&lt;-</span> </span>
<span id="cb512-3"><a href="solutions.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb512-4"><a href="solutions.html#cb512-4" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb512-5"><a href="solutions.html#cb512-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb512-6"><a href="solutions.html#cb512-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb512-7"><a href="solutions.html#cb512-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, </span>
<span id="cb512-8"><a href="solutions.html#cb512-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">number =</span> my_folds),</span>
<span id="cb512-9"><a href="solutions.html#cb512-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> my_k),</span>
<span id="cb512-10"><a href="solutions.html#cb512-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb512-11"><a href="solutions.html#cb512-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb512-12"><a href="solutions.html#cb512-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-13"><a href="solutions.html#cb512-13" aria-hidden="true" tabindex="-1"></a>caretcv_eval <span class="ot">&lt;-</span> <span class="fu">eval_model</span>(caretcv_knn, </span>
<span id="cb512-14"><a href="solutions.html#cb512-14" aria-hidden="true" tabindex="-1"></a>                           df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(), </span>
<span id="cb512-15"><a href="solutions.html#cb512-15" aria-hidden="true" tabindex="-1"></a>                           df_test, </span>
<span id="cb512-16"><a href="solutions.html#cb512-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">return_metrics =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<!-- >>> END OF CHECK <<< -->
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="solutions.html#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, compare the cross-validated metrics against the metrics on the test set</span></span>
<span id="cb513-2"><a href="solutions.html#cb513-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Cross-Validated Metrics by hand: </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-3"><a href="solutions.html#cb513-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>mean[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>sd[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-4"><a href="solutions.html#cb513-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>mean[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-5"><a href="solutions.html#cb513-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>mean[<span class="dv">3</span>], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(metrics_final_model<span class="sc">$</span>sd[<span class="dv">3</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-6"><a href="solutions.html#cb513-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb513-7"><a href="solutions.html#cb513-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Cross-Validated Metrics by {caret}: </span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-8"><a href="solutions.html#cb513-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">2</span>]], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">5</span>]], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-9"><a href="solutions.html#cb513-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">3</span>]], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">6</span>]], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-10"><a href="solutions.html#cb513-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">4</span>]], <span class="dv">3</span>), <span class="st">&quot; +/- &quot;</span>, <span class="fu">round</span>(caretcv_knn<span class="sc">$</span>results[[<span class="dv">7</span>]], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-11"><a href="solutions.html#cb513-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb513-12"><a href="solutions.html#cb513-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Metrics on Test Set by hand:</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-13"><a href="solutions.html#cb513-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(mycv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">1</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-14"><a href="solutions.html#cb513-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(mycv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">2</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-15"><a href="solutions.html#cb513-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(mycv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">3</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-16"><a href="solutions.html#cb513-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb513-17"><a href="solutions.html#cb513-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Metrics on Test Set by {caret}:</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-18"><a href="solutions.html#cb513-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; RMSE: &quot;</span>, <span class="fu">round</span>(caretcv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">1</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-19"><a href="solutions.html#cb513-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; R^2: &quot;</span>,  <span class="fu">round</span>(caretcv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">2</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb513-20"><a href="solutions.html#cb513-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; MAE: &quot;</span>,  <span class="fu">round</span>(caretcv_eval<span class="sc">$</span>test<span class="sc">$</span>.estimate[<span class="dv">3</span>], <span class="dv">3</span>) ,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Cross-Validated Metrics by hand: 
##   RMSE:  1.505  +/-  0.126 
##   R^2:  0.665  +/-  0.038 
##   MAE:  1.148  +/-  0.075 
##  
## Cross-Validated Metrics by {caret}: 
##   RMSE:  1.512  +/-  0.081 
##   R^2:  0.66  +/-  0.031 
##   MAE:  1.154  +/-  0.07 
##  
## Metrics on Test Set by hand:
##   RMSE:  1.539 
##   R^2:  0.647 
##   MAE:  1.149 
##  
## Metrics on Test Set by {caret}:
##   RMSE:  1.539 
##   R^2:  0.647 
##   MAE:  1.149</code></pre>
</div>
<div id="interpretation-of-results-1" class="section level4 unnumbered hasAnchor">
<h4>Interpretation of results<a href="solutions.html#interpretation-of-results-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nice, these number look good! They give us two key results:</p>
<ol style="list-style-type: decimal">
<li><p>The cross-validated estimated model metrics are very similar between using our own algorithm and the {caret} package, suggesting that our implementation is correct. Also, the metrics on the test set of the our and {caret}’s model are identical!</p></li>
<li><p>When testing our final model, the model that was was trained on the full training set, against the test data, it shows model metrics that are within the range of our estimated cross-validated metrics. For example, the cross-validation shows that if we are training a model on the full dataset and test it on unseen data, we expect that the MAE would fall within 1.148 +/- 0.075. We found an MAE on the test set of 1.149, which is within the expected range. Therefore, we can assume that our model would predict on unseen data with a similar uncertainty.</p></li>
</ol>
<!-- Exercise Improvements:
- The splitting between train and validation data does not account for distributions of variables. This could be improved.
-->
<!-- ### Testing the generalisability of a model {-} -->
<!-- *No solutions provided because part of the final report.* -->
</div>
</div>
</div>
<div id="random-forest" class="section level2 hasAnchor" number="12.11">
<h2><span class="header-section-number">A.11</span> Random Forest<a href="solutions.html#random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fitting-a-random-forest-1" class="section level3 unnumbered hasAnchor">
<h3>Fitting a Random Forest<a href="solutions.html#fitting-a-random-forest-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fit a random forest model to the flux data used in the examples of this chapter. Implement bagging 12 decision trees (<code>num.trees</code>), each with a maximum depth of 4 (<code>max.depth</code>). You can consult the respective arguments for the <code>"ranger"</code> method typing <code>?ranger</code>.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="solutions.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data loading and cleaning</span></span>
<span id="cb515-2"><a href="solutions.html#cb515-2" aria-hidden="true" tabindex="-1"></a>daily_fluxes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/FLX_CH-Dav_FLUXNET2015_FULLSET_DD_1997-2014_1-3.csv&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb515-3"><a href="solutions.html#cb515-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb515-4"><a href="solutions.html#cb515-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only the variables we are interested in</span></span>
<span id="cb515-5"><a href="solutions.html#cb515-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(TIMESTAMP,</span>
<span id="cb515-6"><a href="solutions.html#cb515-6" aria-hidden="true" tabindex="-1"></a>                GPP_NT_VUT_REF,    <span class="co"># the target</span></span>
<span id="cb515-7"><a href="solutions.html#cb515-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>),  <span class="co"># quality control info</span></span>
<span id="cb515-8"><a href="solutions.html#cb515-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;_F&quot;</span>),   <span class="co"># includes all all meteorological covariates</span></span>
<span id="cb515-9"><a href="solutions.html#cb515-9" aria-hidden="true" tabindex="-1"></a>                <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;JSB&quot;</span>)   <span class="co"># weird useless variable</span></span>
<span id="cb515-10"><a href="solutions.html#cb515-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb515-11"><a href="solutions.html#cb515-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb515-12"><a href="solutions.html#cb515-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to a nice date object</span></span>
<span id="cb515-13"><a href="solutions.html#cb515-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">TIMESTAMP =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(TIMESTAMP)) <span class="sc">|&gt;</span></span>
<span id="cb515-14"><a href="solutions.html#cb515-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb515-15"><a href="solutions.html#cb515-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set all -9999 to NA</span></span>
<span id="cb515-16"><a href="solutions.html#cb515-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">na_if</span>(<span class="sc">-</span><span class="dv">9999</span>) <span class="sc">|&gt;</span></span>
<span id="cb515-17"><a href="solutions.html#cb515-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb515-18"><a href="solutions.html#cb515-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># retain only data based on &gt;=80% good-quality measurements</span></span>
<span id="cb515-19"><a href="solutions.html#cb515-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># overwrite bad data with NA (not dropping rows)</span></span>
<span id="cb515-20"><a href="solutions.html#cb515-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">GPP_NT_VUT_REF =</span> <span class="fu">ifelse</span>(NEE_VUT_REF_QC <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, GPP_NT_VUT_REF),</span>
<span id="cb515-21"><a href="solutions.html#cb515-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">TA_F           =</span> <span class="fu">ifelse</span>(TA_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, TA_F),</span>
<span id="cb515-22"><a href="solutions.html#cb515-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">SW_IN_F        =</span> <span class="fu">ifelse</span>(SW_IN_F_QC     <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, SW_IN_F),</span>
<span id="cb515-23"><a href="solutions.html#cb515-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">LW_IN_F        =</span> <span class="fu">ifelse</span>(LW_IN_F_QC     <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, LW_IN_F),</span>
<span id="cb515-24"><a href="solutions.html#cb515-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">VPD_F          =</span> <span class="fu">ifelse</span>(VPD_F_QC       <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, VPD_F),</span>
<span id="cb515-25"><a href="solutions.html#cb515-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">PA_F           =</span> <span class="fu">ifelse</span>(PA_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, PA_F),</span>
<span id="cb515-26"><a href="solutions.html#cb515-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">P_F            =</span> <span class="fu">ifelse</span>(P_F_QC         <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, P_F),</span>
<span id="cb515-27"><a href="solutions.html#cb515-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">WS_F           =</span> <span class="fu">ifelse</span>(WS_F_QC        <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="cn">NA</span>, WS_F)) <span class="sc">|&gt;</span> </span>
<span id="cb515-28"><a href="solutions.html#cb515-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb515-29"><a href="solutions.html#cb515-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop QC variables (no longer needed)</span></span>
<span id="cb515-30"><a href="solutions.html#cb515-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;_QC&quot;</span>))</span>
<span id="cb515-31"><a href="solutions.html#cb515-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-32"><a href="solutions.html#cb515-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Data splitting</span></span>
<span id="cb515-33"><a href="solutions.html#cb515-33" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb515-34"><a href="solutions.html#cb515-34" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(daily_fluxes, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> <span class="st">&quot;VPD_F&quot;</span>)</span>
<span id="cb515-35"><a href="solutions.html#cb515-35" aria-hidden="true" tabindex="-1"></a>daily_fluxes_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(split)</span>
<span id="cb515-36"><a href="solutions.html#cb515-36" aria-hidden="true" tabindex="-1"></a>daily_fluxes_test <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(split)</span>
<span id="cb515-37"><a href="solutions.html#cb515-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-38"><a href="solutions.html#cb515-38" aria-hidden="true" tabindex="-1"></a><span class="co"># The same model formulation is in the previous chapter</span></span>
<span id="cb515-39"><a href="solutions.html#cb515-39" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(GPP_NT_VUT_REF <span class="sc">~</span> TA_F <span class="sc">+</span> SW_IN_F <span class="sc">+</span> LW_IN_F <span class="sc">+</span> VPD_F <span class="sc">+</span> P_F <span class="sc">+</span> WS_F, </span>
<span id="cb515-40"><a href="solutions.html#cb515-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> daily_fluxes_train) <span class="sc">|&gt;</span> </span>
<span id="cb515-41"><a href="solutions.html#cb515-41" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_center</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb515-42"><a href="solutions.html#cb515-42" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">step_scale</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>())</span></code></pre></div>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="solutions.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the first model of 12 trees and maximum depth 4</span></span>
<span id="cb516-2"><a href="solutions.html#cb516-2" aria-hidden="true" tabindex="-1"></a>rf_12_4 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb516-3"><a href="solutions.html#cb516-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb516-4"><a href="solutions.html#cb516-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb516-5"><a href="solutions.html#cb516-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb516-6"><a href="solutions.html#cb516-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb516-7"><a href="solutions.html#cb516-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb516-8"><a href="solutions.html#cb516-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb516-9"><a href="solutions.html#cb516-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="fu">floor</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">3</span>),        <span class="co"># default p/3</span></span>
<span id="cb516-10"><a href="solutions.html#cb516-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.min.node.size =</span> <span class="dv">5</span>,            <span class="co"># default 5</span></span>
<span id="cb516-11"><a href="solutions.html#cb516-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>),      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb516-12"><a href="solutions.html#cb516-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb516-13"><a href="solutions.html#cb516-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb516-14"><a href="solutions.html#cb516-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.depth =</span> <span class="dv">4</span>,</span>
<span id="cb516-15"><a href="solutions.html#cb516-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb516-16"><a href="solutions.html#cb516-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">12</span>,       </span>
<span id="cb516-17"><a href="solutions.html#cb516-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb516-18"><a href="solutions.html#cb516-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb516-19"><a href="solutions.html#cb516-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb516-20"><a href="solutions.html#cb516-20" aria-hidden="true" tabindex="-1"></a><span class="co"># generic print</span></span>
<span id="cb516-21"><a href="solutions.html#cb516-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_12_4)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 1910 samples
##    8 predictor
## 
## Recipe steps: center, scale 
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1528, 1528, 1529, 1527, 1528 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   1.501581  0.6680359  1.152593
## 
## Tuning parameter &#39;mtry&#39; was held constant at a value of 2
## Tuning
##  parameter &#39;splitrule&#39; was held constant at a value of variance
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 5</code></pre>
<p>Repeat the fitting with 1000 decision trees and max depth of 4, then with 12 decision trees and a max depth of 6. Then, discuss the role that the number of decision trees and the maximum depth of a tree play in the bias-variance trade-off and in the computation time.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="solutions.html#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Directly fit the model again, with same data and model formulation</span></span>
<span id="cb518-2"><a href="solutions.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Now train with 1000 trees and maximum depth 4</span></span>
<span id="cb518-3"><a href="solutions.html#cb518-3" aria-hidden="true" tabindex="-1"></a>rf_1000_4 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb518-4"><a href="solutions.html#cb518-4" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb518-5"><a href="solutions.html#cb518-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb518-6"><a href="solutions.html#cb518-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb518-7"><a href="solutions.html#cb518-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb518-8"><a href="solutions.html#cb518-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb518-9"><a href="solutions.html#cb518-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb518-10"><a href="solutions.html#cb518-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="fu">floor</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">3</span>),        <span class="co"># default p/3</span></span>
<span id="cb518-11"><a href="solutions.html#cb518-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.min.node.size =</span> <span class="dv">5</span>,            <span class="co"># default 5</span></span>
<span id="cb518-12"><a href="solutions.html#cb518-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>),      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb518-13"><a href="solutions.html#cb518-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb518-14"><a href="solutions.html#cb518-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb518-15"><a href="solutions.html#cb518-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.depth =</span> <span class="dv">4</span>,</span>
<span id="cb518-16"><a href="solutions.html#cb518-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb518-17"><a href="solutions.html#cb518-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">1000</span>,       </span>
<span id="cb518-18"><a href="solutions.html#cb518-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb518-19"><a href="solutions.html#cb518-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb518-20"><a href="solutions.html#cb518-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-21"><a href="solutions.html#cb518-21" aria-hidden="true" tabindex="-1"></a><span class="co"># generic print</span></span>
<span id="cb518-22"><a href="solutions.html#cb518-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_1000_4)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 1910 samples
##    8 predictor
## 
## Recipe steps: center, scale 
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1527, 1528, 1529, 1529, 1527 
## Resampling results:
## 
##   RMSE      Rsquared  MAE     
##   1.483676  0.681084  1.138781
## 
## Tuning parameter &#39;mtry&#39; was held constant at a value of 2
## Tuning
##  parameter &#39;splitrule&#39; was held constant at a value of variance
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 5</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="solutions.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat model fit with 12 trees and maximum depth 6</span></span>
<span id="cb520-2"><a href="solutions.html#cb520-2" aria-hidden="true" tabindex="-1"></a>rf_12_6 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb520-3"><a href="solutions.html#cb520-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb520-4"><a href="solutions.html#cb520-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb520-5"><a href="solutions.html#cb520-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb520-6"><a href="solutions.html#cb520-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb520-7"><a href="solutions.html#cb520-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb520-8"><a href="solutions.html#cb520-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb520-9"><a href="solutions.html#cb520-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="fu">floor</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">3</span>),        <span class="co"># default p/3</span></span>
<span id="cb520-10"><a href="solutions.html#cb520-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.min.node.size =</span> <span class="dv">5</span>,            <span class="co"># default 5</span></span>
<span id="cb520-11"><a href="solutions.html#cb520-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>),      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb520-12"><a href="solutions.html#cb520-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb520-13"><a href="solutions.html#cb520-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb520-14"><a href="solutions.html#cb520-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.depth =</span> <span class="dv">6</span>,</span>
<span id="cb520-15"><a href="solutions.html#cb520-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb520-16"><a href="solutions.html#cb520-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">12</span>,       </span>
<span id="cb520-17"><a href="solutions.html#cb520-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb520-18"><a href="solutions.html#cb520-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb520-19"><a href="solutions.html#cb520-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-20"><a href="solutions.html#cb520-20" aria-hidden="true" tabindex="-1"></a><span class="co"># generic print</span></span>
<span id="cb520-21"><a href="solutions.html#cb520-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_12_6)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 1910 samples
##    8 predictor
## 
## Recipe steps: center, scale 
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1527, 1528, 1529, 1528, 1528 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   1.456632  0.6847908  1.109273
## 
## Tuning parameter &#39;mtry&#39; was held constant at a value of 2
## Tuning
##  parameter &#39;splitrule&#39; was held constant at a value of variance
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 5</code></pre>
<p>** Interpretation of results**</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="solutions.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check results</span></span>
<span id="cb522-2"><a href="solutions.html#cb522-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb522-3"><a href="solutions.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  rf_12_4<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Setup =</span> <span class="st">&quot;12 Trees with depth 4&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Setup),</span>
<span id="cb522-4"><a href="solutions.html#cb522-4" aria-hidden="true" tabindex="-1"></a>  rf_1000_4<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Setup =</span> <span class="st">&quot;1000 Trees with depth 4&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Setup),</span>
<span id="cb522-5"><a href="solutions.html#cb522-5" aria-hidden="true" tabindex="-1"></a>  rf_12_6<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Setup =</span> <span class="st">&quot;12 Trees with depth 6&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Setup)</span>
<span id="cb522-6"><a href="solutions.html#cb522-6" aria-hidden="true" tabindex="-1"></a>)[,<span class="sc">-</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)] <span class="sc">|&gt;</span></span>
<span id="cb522-7"><a href="solutions.html#cb522-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;Comparison of cross-validated metrics across Random Forest setups.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-283">Table A.2: </span>Comparison of cross-validated metrics across Random Forest setups.</caption>
<colgroup>
<col width="28%" />
<col width="10%" />
<col width="12%" />
<col width="10%" />
<col width="12%" />
<col width="13%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Setup</th>
<th align="right">RMSE</th>
<th align="right">Rsquared</th>
<th align="right">MAE</th>
<th align="right">RMSESD</th>
<th align="right">RsquaredSD</th>
<th align="right">MAESD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">12 Trees with depth 4</td>
<td align="right">1.501581</td>
<td align="right">0.6680359</td>
<td align="right">1.152593</td>
<td align="right">0.0459916</td>
<td align="right">0.0180621</td>
<td align="right">0.0269470</td>
</tr>
<tr class="even">
<td align="left">1000 Trees with depth 4</td>
<td align="right">1.483676</td>
<td align="right">0.6810840</td>
<td align="right">1.138781</td>
<td align="right">0.0747796</td>
<td align="right">0.0300692</td>
<td align="right">0.0367361</td>
</tr>
<tr class="odd">
<td align="left">12 Trees with depth 6</td>
<td align="right">1.456632</td>
<td align="right">0.6847908</td>
<td align="right">1.109273</td>
<td align="right">0.0666895</td>
<td align="right">0.0210008</td>
<td align="right">0.0509939</td>
</tr>
</tbody>
</table>
<p>Increasing the number of decision trees leads to a decrease in error (e.g. RMSE) and in error variance in the random forest results, making the model more accurate, robust and generalisable. This can be seen by the smaller values of practically all the metrics above. In the bias-variance trade-off, higher <code>num.trees</code> shifts the balance towards both lower bias and lower variance.</p>
<p>Increasing the number of variables considered for each split allows for a better fit of the data, but makes the model less generalisable. This is seen by a reduction in the error metrics but an increase in their estimated standard deviation. Hence, using high values for <code>mtry</code> may lead to overfitting.</p>
</div>
<div id="hyperparameter-tuning-1" class="section level3 unnumbered hasAnchor">
<h3>Hyperparameter tuning<a href="solutions.html#hyperparameter-tuning-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a previous tutorial, you learned how to tune the hyperparameter <span class="math inline">\(k\)</span> in a KNN by hand. Now you will do the hyperparameter tuning for a Random Forest model. The task gets more complicated because there are more hyperparameters in a random forest. The {caret} package allows to vary three hyperparameters:</p>
<ul>
<li><code>mtry</code>: The number of variables to consider to make decisions at each node, often taken as <span class="math inline">\(p/3\)</span> for regression, where <span class="math inline">\(p\)</span> is the number of predictors.</li>
<li><code>min.node.size</code>: The number of data points at the “bottom” of each decision tree, i.e. the leaves.</li>
<li><code>splitrule</code>: The function applied to data in each branch of a tree, used for determining the goodness of a decision.</li>
</ul>
<p>Answer the following questions, giving a reason for your responses:</p>
<ol style="list-style-type: decimal">
<li>Check the help for the <code>ranger()</code> function and identify which values each of the three hyperparameters/arguments can take. Select a sensible range of values for each hyperparameter, that you will use in the hyperparameter search.</li>
</ol>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="solutions.html#cb523-1" aria-hidden="true" tabindex="-1"></a>mtry_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>)</span>
<span id="cb523-2"><a href="solutions.html#cb523-2" aria-hidden="true" tabindex="-1"></a>min.node.size_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb523-3"><a href="solutions.html#cb523-3" aria-hidden="true" tabindex="-1"></a>splitrule_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;variance&quot;</span>, <span class="st">&quot;extratrees&quot;</span>, <span class="st">&quot;maxstat&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>In the previous exercise, you have seen how the maximum tree depth regulates fit quality and overfitting. How does the minimum node size relate to tree depth? What happens at the edge cases, when <code>min.node.size = 1</code> and when <code>min.node.size = n</code> (<code>n</code> being the number of observations)? For the next questions, it’s not necessary to provide the <code>max.depth</code> argument to <code>train()</code> because <code>min.node.size</code> is already limiting the size of the trees in the random forests.</li>
</ol>
<p><strong>Solution</strong>:
The minimum node size is inversely related to the tree depth. The more nodes are required to be at the leaves, the shorter the tree will be, because not so many splits can be done. If we allowed each leave to correspond to a single observation, we would have a very large tree, such that each branch corresponds to one observation. If we force each leave to have at least <span class="math inline">\(n\)</span> observations, then the tree will not “grow”, that is, it will never even split.</p>
<ol start="3" style="list-style-type: decimal">
<li><em>Greedy hyperparameter tuning</em>: Sequentially optimize the choice of each hyperparameter, one at a time and keeping the other two constant. Take the code from the tutorial as a starting point, and those hyperparameter values as an initial point for the search.
&gt; Tip: Keep the number of trees low, otherwise it takes too long to fit each random forest model.</li>
</ol>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="solutions.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use data and model formulation created before</span></span>
<span id="cb524-2"><a href="solutions.html#cb524-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-3"><a href="solutions.html#cb524-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>()   <span class="co"># initialise results</span></span>
<span id="cb524-4"><a href="solutions.html#cb524-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1997</span>)   <span class="co"># for reproducibility</span></span>
<span id="cb524-5"><a href="solutions.html#cb524-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-6"><a href="solutions.html#cb524-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models in a loop, save metrics</span></span>
<span id="cb524-7"><a href="solutions.html#cb524-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(mtry_value <span class="cf">in</span> mtry_values){</span>
<span id="cb524-8"><a href="solutions.html#cb524-8" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb524-9"><a href="solutions.html#cb524-9" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb524-10"><a href="solutions.html#cb524-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb524-11"><a href="solutions.html#cb524-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(), </span>
<span id="cb524-12"><a href="solutions.html#cb524-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb524-13"><a href="solutions.html#cb524-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb524-14"><a href="solutions.html#cb524-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb524-15"><a href="solutions.html#cb524-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> mtry_value,           <span class="co"># modify mtry</span></span>
<span id="cb524-16"><a href="solutions.html#cb524-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.min.node.size =</span> <span class="dv">5</span>,            <span class="co"># default 5</span></span>
<span id="cb524-17"><a href="solutions.html#cb524-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>),      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb524-18"><a href="solutions.html#cb524-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb524-19"><a href="solutions.html#cb524-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb524-20"><a href="solutions.html#cb524-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb524-21"><a href="solutions.html#cb524-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">100</span>,                                     <span class="co"># keep small for computation</span></span>
<span id="cb524-22"><a href="solutions.html#cb524-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb524-23"><a href="solutions.html#cb524-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb524-24"><a href="solutions.html#cb524-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb524-25"><a href="solutions.html#cb524-25" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, mod<span class="sc">$</span>results)</span>
<span id="cb524-26"><a href="solutions.html#cb524-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb524-27"><a href="solutions.html#cb524-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-28"><a href="solutions.html#cb524-28" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##   mtry min.node.size splitrule     RMSE  Rsquared      MAE     RMSESD
## 1    2             5  variance 1.408401 0.7048393 1.079003 0.06273482
## 2    4             5  variance 1.415472 0.7036540 1.078367 0.02791004
## 3    6             5  variance 1.433248 0.6946220 1.094301 0.11539229
##   RsquaredSD      MAESD
## 1 0.01596849 0.04919243
## 2 0.01083131 0.03353947
## 3 0.03200823 0.07272992</code></pre>
<p>Based on the first round of hyperparameter tuning, we should take <code>mtry = 2</code> because it leads to the smallest RMSE and MAE, and the highest Rsquared. That is, the best fit. Nevertheless, the difference between taking <code>mtry = 2</code> or <code>4</code> is very small and the second actually leads to smaller variance in the metric estimates. Hence, the decision is not so clear.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="solutions.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the previous best model and tune next hyperparameter</span></span>
<span id="cb526-2"><a href="solutions.html#cb526-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-3"><a href="solutions.html#cb526-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>()   <span class="co"># initialise results</span></span>
<span id="cb526-4"><a href="solutions.html#cb526-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1997</span>)   <span class="co"># for reproducibility</span></span>
<span id="cb526-5"><a href="solutions.html#cb526-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-6"><a href="solutions.html#cb526-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models in a loop, save metrics</span></span>
<span id="cb526-7"><a href="solutions.html#cb526-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(min.node.size_value <span class="cf">in</span> min.node.size_values){</span>
<span id="cb526-8"><a href="solutions.html#cb526-8" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb526-9"><a href="solutions.html#cb526-9" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb526-10"><a href="solutions.html#cb526-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb526-11"><a href="solutions.html#cb526-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(), </span>
<span id="cb526-12"><a href="solutions.html#cb526-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb526-13"><a href="solutions.html#cb526-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb526-14"><a href="solutions.html#cb526-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb526-15"><a href="solutions.html#cb526-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="dv">2</span>,      <span class="co"># best mtry</span></span>
<span id="cb526-16"><a href="solutions.html#cb526-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.min.node.size =</span> min.node.size_value,   <span class="co"># modify</span></span>
<span id="cb526-17"><a href="solutions.html#cb526-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.splitrule =</span> <span class="st">&quot;variance&quot;</span>),      <span class="co"># default &quot;variance&quot;</span></span>
<span id="cb526-18"><a href="solutions.html#cb526-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb526-19"><a href="solutions.html#cb526-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb526-20"><a href="solutions.html#cb526-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb526-21"><a href="solutions.html#cb526-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">100</span>,                                     <span class="co"># keep small for computation</span></span>
<span id="cb526-22"><a href="solutions.html#cb526-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb526-23"><a href="solutions.html#cb526-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb526-24"><a href="solutions.html#cb526-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb526-25"><a href="solutions.html#cb526-25" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, mod<span class="sc">$</span>results)</span>
<span id="cb526-26"><a href="solutions.html#cb526-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb526-27"><a href="solutions.html#cb526-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-28"><a href="solutions.html#cb526-28" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##   mtry min.node.size splitrule     RMSE  Rsquared      MAE     RMSESD
## 1    2             2  variance 1.409582 0.7042913 1.082256 0.06241719
## 2    2             5  variance 1.412901 0.7047421 1.082553 0.03558331
## 3    2            10  variance 1.419546 0.7011209 1.087140 0.10747076
## 4    2            20  variance 1.423394 0.6994931 1.084389 0.05963332
##    RsquaredSD      MAESD
## 1 0.016718041 0.04856266
## 2 0.009743068 0.03817585
## 3 0.028336655 0.06783919
## 4 0.015821275 0.03888013</code></pre>
<p>The second hyperparameter should be either <code>min.node.size = 2</code> or <code>5</code> because they lead to the best metrics overall. Again, the differences are very small and each metric would lead to a different decision. By increasing <code>min.node.size</code>, we get more generalisability, but if it’s too high we will lose fit quality. If you change the random seed, you’ll see that the tuning results are not robust, so whichever hyperparameter we choose won’t make a big difference in the model fit (at least within the ranges searched). Let’s take <code>min.node.size = 5</code> for the next loop.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="solutions.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the previous best models and tune last hyperparameter</span></span>
<span id="cb528-2"><a href="solutions.html#cb528-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb528-3"><a href="solutions.html#cb528-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-4"><a href="solutions.html#cb528-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models in a loop, save metrics</span></span>
<span id="cb528-5"><a href="solutions.html#cb528-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(splitrule_value <span class="cf">in</span> splitrule_values){</span>
<span id="cb528-6"><a href="solutions.html#cb528-6" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb528-7"><a href="solutions.html#cb528-7" aria-hidden="true" tabindex="-1"></a>    pp, </span>
<span id="cb528-8"><a href="solutions.html#cb528-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb528-9"><a href="solutions.html#cb528-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(), </span>
<span id="cb528-10"><a href="solutions.html#cb528-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb528-11"><a href="solutions.html#cb528-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb528-12"><a href="solutions.html#cb528-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb528-13"><a href="solutions.html#cb528-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="dv">4</span>,                    <span class="co"># best mtry</span></span>
<span id="cb528-14"><a href="solutions.html#cb528-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.min.node.size =</span> <span class="dv">5</span>,             <span class="co"># best min.node.size</span></span>
<span id="cb528-15"><a href="solutions.html#cb528-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.splitrule =</span> splitrule_value),  <span class="co"># modify</span></span>
<span id="cb528-16"><a href="solutions.html#cb528-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb528-17"><a href="solutions.html#cb528-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb528-18"><a href="solutions.html#cb528-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb528-19"><a href="solutions.html#cb528-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">100</span>,                                     <span class="co"># keep small for computation</span></span>
<span id="cb528-20"><a href="solutions.html#cb528-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb528-21"><a href="solutions.html#cb528-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb528-22"><a href="solutions.html#cb528-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb528-23"><a href="solutions.html#cb528-23" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, mod<span class="sc">$</span>results)</span>
<span id="cb528-24"><a href="solutions.html#cb528-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb528-25"><a href="solutions.html#cb528-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-26"><a href="solutions.html#cb528-26" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##   mtry min.node.size  splitrule     RMSE  Rsquared      MAE     RMSESD
## 1    4             5   variance 1.429526 0.6961773 1.084222 0.07154814
## 2    4             5 extratrees 1.401250 0.7094276 1.067099 0.07570733
## 3    4             5    maxstat 1.435566 0.6943093 1.093873 0.06907025
##   RsquaredSD      MAESD
## 1 0.02130928 0.05505826
## 2 0.01639622 0.03893171
## 3 0.01968536 0.04358800</code></pre>
<p>According to the last round of tuning, we should use <code>spliturle = "extratrees"</code>. With that, we found the best model so far.</p>
<ol start="4" style="list-style-type: decimal">
<li><em>Grid hyperparameter tuning</em>: Starting with the same range of values for each hyperparameter as before, look for the combination that leads to the best model performance among all combinations of hyperparameter values. This time, use the <code>expand.grid()</code> function to create a data.frame of hyperparameter value combinations. This grid will be passed to <code>train()</code> via the <code>tuneGrid</code> argument (see example in the tutorial). This will automatically do the hyperparameter search for you. Comment the output of <code>train()</code> and the results of the hyperparameter search.</li>
</ol>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="solutions.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1403</span>)    <span class="co"># for reproducibility</span></span>
<span id="cb530-2"><a href="solutions.html#cb530-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb530-3"><a href="solutions.html#cb530-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb530-4"><a href="solutions.html#cb530-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb530-5"><a href="solutions.html#cb530-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb530-6"><a href="solutions.html#cb530-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb530-7"><a href="solutions.html#cb530-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb530-8"><a href="solutions.html#cb530-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb530-9"><a href="solutions.html#cb530-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand grid of tunable hyperparameters</span></span>
<span id="cb530-10"><a href="solutions.html#cb530-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> mtry_values,             </span>
<span id="cb530-11"><a href="solutions.html#cb530-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.min.node.size =</span> min.node.size_values,    </span>
<span id="cb530-12"><a href="solutions.html#cb530-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.splitrule =</span> splitrule_values),  </span>
<span id="cb530-13"><a href="solutions.html#cb530-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb530-14"><a href="solutions.html#cb530-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb530-15"><a href="solutions.html#cb530-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb530-16"><a href="solutions.html#cb530-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">100</span>,                                     <span class="co"># keep small for computation</span></span>
<span id="cb530-17"><a href="solutions.html#cb530-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb530-18"><a href="solutions.html#cb530-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="solutions.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-291-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="solutions.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">metric =</span> <span class="st">&quot;Rsquared&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-291-2.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Compare the results from the two hyperparameter tuning approaches. Do the optimal hyperparameters coincide? Are the corresponding RMSE estimates similar? What are the advantages and disadvantages of the greedy and the grid approaches?</li>
</ol>
<p>The best model according to the grid search, with lowest RMSE, is the one with <code>mtry = 4</code>, <code>min.node.size = 5</code> and <code>splitrule = "extratrees"</code> . This is not the “best model” we found with the greedy approach (different <code>mtry</code>) and also not the best according to Rsquared (<code>mtry = 4</code>, <code>min.node.size =</code> and <code>splitrule = ""</code>). The metric used for tuning matters, and looking at several of them at the same can help make decisions, if different metrics agree. All these hyperparameter tuning approaches agree that the best <code>splitrule</code> is <code>"extratrees"</code> (and if you change the random seed, this result is consistent). The best <code>mtry</code> value is different for each split rule used, so having started with <code>"variance"</code> in the greedy search lead the tuning in the wrong direction. This highlights that hyperparameter values interact with each other and optimizing over grids is preferred (although it takes more time).</p>
</div>
<div id="model-performance-1" class="section level3 unnumbered hasAnchor">
<h3>Model performance<a href="solutions.html#model-performance-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have trained several random forest models. Evaluate the model performance on the best model (the one for the tuned hyperparameters) and on one of your worse models. If you compare the RMSE and <span class="math inline">\(R^2\)</span> on the training and the test set, does it show overfitting?</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="solutions.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train best model</span></span>
<span id="cb533-2"><a href="solutions.html#cb533-2" aria-hidden="true" tabindex="-1"></a>mod_best <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb533-3"><a href="solutions.html#cb533-3" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb533-4"><a href="solutions.html#cb533-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb533-5"><a href="solutions.html#cb533-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb533-6"><a href="solutions.html#cb533-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb533-7"><a href="solutions.html#cb533-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb533-8"><a href="solutions.html#cb533-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb533-9"><a href="solutions.html#cb533-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand grid of tunable hyperparameters</span></span>
<span id="cb533-10"><a href="solutions.html#cb533-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="dv">6</span>,             </span>
<span id="cb533-11"><a href="solutions.html#cb533-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.min.node.size =</span> <span class="dv">10</span>,    </span>
<span id="cb533-12"><a href="solutions.html#cb533-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.splitrule =</span> <span class="st">&quot;extratrees&quot;</span>),  </span>
<span id="cb533-13"><a href="solutions.html#cb533-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb533-14"><a href="solutions.html#cb533-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb533-15"><a href="solutions.html#cb533-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb533-16"><a href="solutions.html#cb533-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">100</span>,                                     <span class="co"># keep small for computation</span></span>
<span id="cb533-17"><a href="solutions.html#cb533-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb533-18"><a href="solutions.html#cb533-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb533-19"><a href="solutions.html#cb533-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-20"><a href="solutions.html#cb533-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions</span></span>
<span id="cb533-21"><a href="solutions.html#cb533-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-22"><a href="solutions.html#cb533-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Train worst model</span></span>
<span id="cb533-23"><a href="solutions.html#cb533-23" aria-hidden="true" tabindex="-1"></a>mod_worst <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb533-24"><a href="solutions.html#cb533-24" aria-hidden="true" tabindex="-1"></a>  pp, </span>
<span id="cb533-25"><a href="solutions.html#cb533-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> daily_fluxes_train <span class="sc">%&gt;%</span> </span>
<span id="cb533-26"><a href="solutions.html#cb533-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(), </span>
<span id="cb533-27"><a href="solutions.html#cb533-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb533-28"><a href="solutions.html#cb533-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</span>
<span id="cb533-29"><a href="solutions.html#cb533-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">savePredictions =</span> <span class="st">&quot;final&quot;</span>),</span>
<span id="cb533-30"><a href="solutions.html#cb533-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand grid of tunable hyperparameters</span></span>
<span id="cb533-31"><a href="solutions.html#cb533-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>( <span class="at">.mtry =</span> <span class="dv">2</span>,             </span>
<span id="cb533-32"><a href="solutions.html#cb533-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.min.node.size =</span> <span class="dv">20</span>,    </span>
<span id="cb533-33"><a href="solutions.html#cb533-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.splitrule =</span> <span class="st">&quot;maxstat&quot;</span>),  </span>
<span id="cb533-34"><a href="solutions.html#cb533-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arguments specific to &quot;ranger&quot; method</span></span>
<span id="cb533-35"><a href="solutions.html#cb533-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb533-36"><a href="solutions.html#cb533-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5</span>,</span>
<span id="cb533-37"><a href="solutions.html#cb533-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">100</span>,                                     <span class="co"># keep small for computation</span></span>
<span id="cb533-38"><a href="solutions.html#cb533-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1982</span>                                          <span class="co"># for reproducibility</span></span>
<span id="cb533-39"><a href="solutions.html#cb533-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb533-40"><a href="solutions.html#cb533-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-41"><a href="solutions.html#cb533-41" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/eval_model.R&quot;</span>)</span>
<span id="cb533-42"><a href="solutions.html#cb533-42" aria-hidden="true" tabindex="-1"></a><span class="fu">eval_model</span>(mod_best, daily_fluxes_train, daily_fluxes_test)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-292-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="solutions.html#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval_model</span>(mod_worst, daily_fluxes_train, daily_fluxes_test)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-292-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>The performance on the test set for the best model is still close to the performance on the training set, so the model doesn’t seem to overfit. The same goes for the worse model, which leads to worse <span class="math inline">\(R^2\)</span> and RMSE and visually the fit is slightly worse.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="randomforest.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
